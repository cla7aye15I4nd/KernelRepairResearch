id: bd8cc73d665590a1fcad
bug_link: https://syzkaller.appspot.com/bug?extid=bd8cc73d665590a1fcad
title: WARNING in smc_unhash_sk (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f9cedf1a9b1cdcfb0c52edb391d01771e43994a4
fix_commit: cd2063604ea6a8c2683b4eb9b5f4c4da74592d87
datetime: '2019-08-05T13:24:37-07:00'
fix_commit_message: 'net/smc: avoid fallback in case of non-blocking connect


  FASTOPEN is not possible with SMC. sendmsg() with msg_flag MSG_FASTOPEN

  triggers a fallback to TCP if the socket is in state SMC_INIT.

  But if a nonblocking connect is already started, fallback to TCP

  is no longer possible, even though the socket may still be in state

  SMC_INIT.

  And if a nonblocking connect is already started, a listen() call

  does not make sense.


  Reported-by: syzbot+bd8cc73d665590a1fcad@syzkaller.appspotmail.com

  Fixes: 50717a37db032 ("net/smc: nonblocking connect rework")

  Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>

  Signed-off-by: Karsten Graul <kgraul@linux.ibm.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/smc
hunk_count: 3
covered_count: 0
