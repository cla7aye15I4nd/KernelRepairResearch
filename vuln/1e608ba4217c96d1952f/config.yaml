id: 1e608ba4217c96d1952f
bug_link: https://syzkaller.appspot.com/bug?extid=1e608ba4217c96d1952f
title: general protection fault in pn533_out_complete
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bced3f7db95ff2e6ca29dc4d1c9751ab5e736a09
fix_commit: 484b7059796e3bc1cb527caa61dfc60da649b4f6
datetime: '2023-03-10T15:52:25-08:00'
fix_commit_message: "nfc: pn533: initialize struct pn533_out_arg properly\n\nstruct\
  \ pn533_out_arg used as a temporary context for out_urb is not\ninitialized properly.\
  \ Its uninitialized 'phy' field can be dereferenced in\nerror cases inside pn533_out_complete()\
  \ callback function. It causes the\nfollowing failure:\n\ngeneral protection fault,\
  \ probably for non-canonical address 0xdffffc0000000000: 0000 [#1] PREEMPT SMP KASAN\n\
  KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]\nCPU: 1 PID:\
  \ 0 Comm: swapper/1 Not tainted 6.2.0-rc3-next-20230110-syzkaller #0\nHardware name:\
  \ Google Google Compute Engine/Google Compute Engine, BIOS Google 10/26/2022\nRIP:\
  \ 0010:pn533_out_complete.cold+0x15/0x44 drivers/nfc/pn533/usb.c:441\nCall Trace:\n\
  \ <IRQ>\n __usb_hcd_giveback_urb+0x2b6/0x5c0 drivers/usb/core/hcd.c:1671\n usb_hcd_giveback_urb+0x384/0x430\
  \ drivers/usb/core/hcd.c:1754\n dummy_timer+0x1203/0x32d0 drivers/usb/gadget/udc/dummy_hcd.c:1988\n\
  \ call_timer_fn+0x1da/0x800 kernel/time/timer.c:1700\n expire_timers+0x234/0x330\
  \ kernel/time/timer.c:1751\n __run_timers kernel/time/timer.c:2022 [inline]\n __run_timers\
  \ kernel/time/timer.c:1995 [inline]\n run_timer_softirq+0x326/0x910 kernel/time/timer.c:2035\n\
  \ __do_softirq+0x1fb/0xaf6 kernel/softirq.c:571\n invoke_softirq kernel/softirq.c:445\
  \ [inline]\n __irq_exit_rcu+0x123/0x180 kernel/softirq.c:650\n irq_exit_rcu+0x9/0x20\
  \ kernel/softirq.c:662\n sysvec_apic_timer_interrupt+0x97/0xc0 arch/x86/kernel/apic/apic.c:1107\n\
  \nInitialize the field with the pn533_usb_phy currently used.\n\nFound by Linux\
  \ Verification Center (linuxtesting.org) with Syzkaller.\n\nFixes: 9dab880d675b\
  \ (\"nfc: pn533: Wait for out_urb's completion in pn533_usb_send_frame()\")\nReported-by:\
  \ syzbot+1e608ba4217c96d1952f@syzkaller.appspotmail.com\nSigned-off-by: Fedor Pchelkin\
  \ <pchelkin@ispras.ru>\nReviewed-by: Simon Horman <simon.horman@corigine.com>\n\
  Link: https://lore.kernel.org/r/20230309165050.207390-1-pchelkin@ispras.ru\nSigned-off-by:\
  \ Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- drivers/nfc/pn533
hunk_count: 1
covered_count: 0
