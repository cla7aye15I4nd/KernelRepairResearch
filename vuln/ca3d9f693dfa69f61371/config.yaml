id: ca3d9f693dfa69f61371
bug_link: https://syzkaller.appspot.com/bug?extid=ca3d9f693dfa69f61371
title: WARNING in class_register
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 980c05616e5d554c46176fe08b5601801f2f8192
fix_commit: f326ea63ecc683b3dc88d8ee4f598598d4ed3b39
datetime: '2023-04-01T12:20:54+02:00'
fix_commit_message: 'driver core: class: fix slab-use-after-free Read in class_register()


  Syzbot found that we had forgotten to unregister the lock_class_key when

  using it in commit dcfbb67e48a2 ("driver core: class: use lock_class_key

  already present in struct subsys_private") so fix that up and correctly

  release it when done.


  Cc: "Rafael J. Wysocki" <rafael@kernel.org>

  Reported-and-tested-by: <syzbot+41d665317c811d4d88aa@syzkaller.appspotmail.com>

  Fixes: dcfbb67e48a2 ("driver core: class: use lock_class_key already present in
  struct subsys_private")

  Link: https://lore.kernel.org/r/2023040126-blandness-duckling-bd55@gregkh

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/base
hunk_count: 1
covered_count: 0
