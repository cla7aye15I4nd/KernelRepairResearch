id: dc54d9ba8153b216cae0
bug_link: https://syzkaller.appspot.com/bug?extid=dc54d9ba8153b216cae0
title: memory leak in netlink_policy_dump_add_policy
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5c23d6b717e4e956376f3852b90f58e262946b50
fix_commit: 249801360db3dec4f73768c502192020bfddeacc
datetime: '2022-08-18T10:20:48-07:00'
fix_commit_message: 'net: genl: fix error path memory leak in policy dumping


  If construction of the array of policies fails when recording

  non-first policy we need to unwind.


  netlink_policy_dump_add_policy() itself also needs fixing as

  it currently gives up on error without recording the allocated

  pointer in the pstate pointer.


  Reported-by: syzbot+dc54d9ba8153b216cae0@syzkaller.appspotmail.com

  Fixes: 50a896cf2d6f ("genetlink: properly support per-op policy dumping")

  Link: https://lore.kernel.org/r/20220816161939.577583-1-kuba@kernel.org

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/netlink
hunk_count: 4
covered_count: 4
