id: 5426c7ed6868c705ca14
bug_link: https://syzkaller.appspot.com/bug?extid=5426c7ed6868c705ca14
title: WARNING in signalfd_cleanup
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c84b8a3fef663933007e885535591b9d30bdc860
fix_commit: 791f3465c4afde02d7f16cf7424ca87070b69396
datetime: '2022-01-14T06:48:35-07:00'
fix_commit_message: 'io_uring: fix UAF due to missing POLLFREE handling


  Fixes a problem described in 50252e4b5e989

  ("aio: fix use-after-free due to missing POLLFREE handling")

  and copies the approach used there.


  In short, we have to forcibly eject a poll entry when we meet POLLFREE.

  We can''t rely on io_poll_get_ownership() as can''t wait for potentially

  running tw handlers, so we use the fact that wqs are RCU freed. See

  Eric''s patch and comments for more details.


  Reported-by: Eric Biggers <ebiggers@google.com>

  Link: https://lore.kernel.org/r/20211209010455.42744-6-ebiggers@kernel.org

  Reported-and-tested-by: syzbot+5426c7ed6868c705ca14@syzkaller.appspotmail.com

  Fixes: 221c5eb233823 ("io_uring: add support for IORING_OP_POLL")

  Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>

  Link: https://lore.kernel.org/r/4ed56b6f548f7ea337603a82315750449412748a.1642161259.git.asml.silence@gmail.com

  [axboe: drop non-functional change from patch]

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- fs
hunk_count: 3
covered_count: 0
