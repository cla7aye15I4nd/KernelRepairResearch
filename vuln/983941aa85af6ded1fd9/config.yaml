id: 983941aa85af6ded1fd9
bug_link: https://syzkaller.appspot.com/bug?extid=983941aa85af6ded1fd9
title: general protection fault in dev_get_by_index_rcu (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1e9d74660d4df625b0889e77018f9e94727ceacd
fix_commit: 382778edc8262b7535f00523e9eb22edba1b9816
datetime: '2022-01-11T09:44:06-08:00'
fix_commit_message: 'xdp: check prog type before updating BPF link


  The bpf_xdp_link_update() function didn''t check the program type before

  updating the program, which made it possible to install any program type as

  an XDP program, which is obviously not good. Syzbot managed to trigger this

  by swapping in an LWT program on the XDP hook which would crash in a helper

  call.


  Fix this by adding a check and bailing out if the types don''t match.


  Fixes: 026a4c28e1db ("bpf, xdp: Implement LINK_UPDATE for BPF XDP link")

  Reported-by: syzbot+983941aa85af6ded1fd9@syzkaller.appspotmail.com

  Acked-by: Andrii Nakryiko <andrii@kernel.org>

  Signed-off-by: Toke Høiland-Jørgensen <toke@redhat.com>

  Link: https://lore.kernel.org/r/20220107221115.326171-1-toke@redhat.com

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- net/core
hunk_count: 1
covered_count: 0
