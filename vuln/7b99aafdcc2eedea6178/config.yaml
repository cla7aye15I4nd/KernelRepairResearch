id: 7b99aafdcc2eedea6178
bug_link: https://syzkaller.appspot.com/bug?extid=7b99aafdcc2eedea6178
title: WARNING in sk_stream_kill_queues (5)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ec99a470c7d5517c97dee6dd7953275a92c63834
fix_commit: 097b9146c0e26aabaa6ff3e5ea536a53f5254a79
datetime: '2021-02-02T17:36:12-08:00'
fix_commit_message: 'net: fix up truesize of cloned skb in skb_prepare_for_shift()


  Avoid the assumption that ksize(kmalloc(S)) == ksize(kmalloc(S)): when

  cloning an skb, save and restore truesize after pskb_expand_head(). This

  can occur if the allocator decides to service an allocation of the same

  size differently (e.g. use a different size class, or pass the

  allocation on to KFENCE).


  Because truesize is used for bookkeeping (such as sk_wmem_queued), a

  modified truesize of a cloned skb may result in corrupt bookkeeping and

  relevant warnings (such as in sk_stream_kill_queues()).


  Link: https://lkml.kernel.org/r/X9JR/J6dMMOy1obu@elver.google.com

  Reported-by: syzbot+7b99aafdcc2eedea6178@syzkaller.appspotmail.com

  Suggested-by: Eric Dumazet <edumazet@google.com>

  Signed-off-by: Marco Elver <elver@google.com>

  Signed-off-by: Eric Dumazet <edumazet@google.com>

  Link: https://lore.kernel.org/r/20210201160420.2826895-1-elver@google.com

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/core
hunk_count: 1
covered_count: 0
