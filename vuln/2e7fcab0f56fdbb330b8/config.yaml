id: 2e7fcab0f56fdbb330b8
bug_link: https://syzkaller.appspot.com/bug?extid=2e7fcab0f56fdbb330b8
title: WARNING in do_dentry_open
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 66e58e0ef80a56a1d7857b6ce121141563cdd93e
fix_commit: b16558579576c8f2781062b638600f68954b1827
datetime: '2018-06-08T10:58:48-07:00'
fix_commit_message: "bpf: implement dummy fops for bpf objects\n\nsyzkaller was able\
  \ to trigger the following warning in\ndo_dentry_open():\n\n  WARNING: CPU: 1 PID:\
  \ 4508 at fs/open.c:778 do_dentry_open+0x4ad/0xe40 fs/open.c:778\n  Kernel panic\
  \ - not syncing: panic_on_warn set ...\n\n  CPU: 1 PID: 4508 Comm: syz-executor867\
  \ Not tainted 4.17.0+ #90\n  Hardware name: Google Google Compute Engine/Google\
  \ Compute Engine, BIOS Google 01/01/2011\n  Call Trace:\n  [...]\n   vfs_open+0x139/0x230\
  \ fs/open.c:908\n   do_last fs/namei.c:3370 [inline]\n   path_openat+0x1717/0x4dc0\
  \ fs/namei.c:3511\n   do_filp_open+0x249/0x350 fs/namei.c:3545\n   do_sys_open+0x56f/0x740\
  \ fs/open.c:1101\n   __do_sys_openat fs/open.c:1128 [inline]\n   __se_sys_openat\
  \ fs/open.c:1122 [inline]\n   __x64_sys_openat+0x9d/0x100 fs/open.c:1122\n   do_syscall_64+0x1b1/0x800\
  \ arch/x86/entry/common.c:287\n   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nProblem\
  \ was that prog and map inodes in bpf fs did not\nimplement a dummy file open operation\
  \ that would return an\nerror. The patch in do_dentry_open() checks whether f_ops\n\
  are present and if not bails out with an error. While this\nmay be fine, we really\
  \ shouldn't be throwing a warning\nthough. Thus follow the model similar to bad_file_ops\
  \ and\nreject the request unconditionally with -EIO.\n\nFixes: b2197755b263 (\"\
  bpf: add support for persistent maps/progs\")\nReported-by: syzbot+2e7fcab0f56fdbb330b8@syzkaller.appspotmail.com\n\
  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>\nSigned-off-by: Alexei Starovoitov\
  \ <ast@kernel.org>\n"
submodule:
- kernel/bpf
hunk_count: 3
covered_count: 0
