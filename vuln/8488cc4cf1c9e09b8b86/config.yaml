id: 8488cc4cf1c9e09b8b86
bug_link: https://syzkaller.appspot.com/bug?extid=8488cc4cf1c9e09b8b86
title: WARNING in smc_unhash_sk (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a36e629ee77a9df78310c972655092e41ce07ea4
fix_commit: 8204df72bea1a7d83d0777add6da98a41dfbdc34
datetime: '2019-11-16T13:03:33-08:00'
fix_commit_message: 'net/smc: fix fastopen for non-blocking connect()


  FASTOPEN does not work with SMC-sockets. Since SMC allows fallback to

  TCP native during connection start, the FASTOPEN setsockopts trigger

  this fallback, if the SMC-socket is still in state SMC_INIT.

  But if a FASTOPEN setsockopt is called after a non-blocking connect(),

  this is broken, and fallback does not make sense.

  This change complements

  commit cd2063604ea6 ("net/smc: avoid fallback in case of non-blocking connect")

  and fixes the syzbot reported problem "WARNING in smc_unhash_sk".


  Reported-by: syzbot+8488cc4cf1c9e09b8b86@syzkaller.appspotmail.com

  Fixes: e1bbdd570474 ("net/smc: reduce sock_put() for fallback sockets")

  Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>

  Signed-off-by: Karsten Graul <kgraul@linux.ibm.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/smc
hunk_count: 1
covered_count: 0
