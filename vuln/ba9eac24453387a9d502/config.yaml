id: ba9eac24453387a9d502
bug_link: https://syzkaller.appspot.com/bug?extid=ba9eac24453387a9d502
title: 'riscv/fixes test error: kernel panic: Kernel stack overflow'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c625154993d0d24a962b1830cd5ed92adda2cf86
fix_commit: cfb10de18538e383dbc4f3ce7f477ce49287ff3d
datetime: '2024-10-01T13:08:11-07:00'
fix_commit_message: 'riscv: Fix kernel stack size when KASAN is enabled


  We use Kconfig to select the kernel stack size, doubling the default

  size if KASAN is enabled.


  But that actually only works if KASAN is selected from the beginning,

  meaning that if KASAN config is added later (for example using

  menuconfig), CONFIG_THREAD_SIZE_ORDER won''t be updated, keeping the

  default size, which is not enough for KASAN as reported in [1].


  So fix this by moving the logic to compute the right kernel stack into a

  header.


  Fixes: a7555f6b62e7 ("riscv: stack: Add config of thread stack size")

  Reported-by: syzbot+ba9eac24453387a9d502@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/000000000000eb301906222aadc2@google.com/ [1]

  Cc: stable@vger.kernel.org

  Signed-off-by: Alexandre Ghiti <alexghiti@rivosinc.com>

  Link: https://lore.kernel.org/r/20240917150328.59831-1-alexghiti@rivosinc.com

  Signed-off-by: Palmer Dabbelt <palmer@rivosinc.com>

  '
submodule:
- arch/riscv
- arch/riscv/include/asm
hunk_count: 2
covered_count: 0
