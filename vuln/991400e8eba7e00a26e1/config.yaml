id: 991400e8eba7e00a26e1
bug_link: https://syzkaller.appspot.com/bug?extid=991400e8eba7e00a26e1
title: WARNING in iov_iter_pipe
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6334b91e502ca1ec10157f2a3a2c74eea6b5e279
fix_commit: 419e9c38aa075ed0cd3c13d47e15954b686bcdb6
datetime: '2019-11-22T08:36:02-08:00'
fix_commit_message: 'iomap: Fix pipe page leakage during splicing


  When splicing using iomap_dio_rw() to a pipe, we may leak pipe pages

  because bio_iov_iter_get_pages() records that the pipe will have full

  extent worth of data however if file size is not block size aligned

  iomap_dio_rw() returns less than what bio_iov_iter_get_pages() set up

  and splice code gets confused leaking a pipe page with the file tail.


  Handle the situation similarly to the old direct IO implementation and

  revert iter to actually returned read amount which makes iter consistent

  with value returned from iomap_dio_rw() and thus the splice code is

  happy.


  Fixes: ff6a9292e6f6 ("iomap: implement direct I/O")

  CC: stable@vger.kernel.org

  Reported-by: syzbot+991400e8eba7e00a26e1@syzkaller.appspotmail.com

  Signed-off-by: Jan Kara <jack@suse.cz>

  Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>

  Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>

  Reviewed-by: Christoph Hellwig <hch@lst.de>

  '
submodule:
- fs/iomap
hunk_count: 1
covered_count: 0
