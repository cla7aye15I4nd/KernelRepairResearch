id: 8cdad6430c24f396f158
bug_link: https://syzkaller.appspot.com/bug?extid=8cdad6430c24f396f158
title: general protection fault in kvm_arch_vcpu_ioctl
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 03d84f96890662681feee129cf92491f49247d28
fix_commit: f83894b24c2a96fcecdff4858755aa79eb756465
datetime: '2022-07-08T15:58:16-07:00'
fix_commit_message: 'KVM: x86: Fix handling of APIC LVT updates when userspace changes
  MCG_CAP


  Add a helper to update KVM''s in-kernel local APIC in response to MCG_CAP

  being changed by userspace to fix multiple bugs.  First and foremost,

  KVM needs to check that there''s an in-kernel APIC prior to dereferencing

  vcpu->arch.apic.  Beyond that, any "new" LVT entries need to be masked,

  and the APIC version register needs to be updated as it reports out the

  number of LVT entries.


  Fixes: 4b903561ec49 ("KVM: x86: Add Corrected Machine Check Interrupt (CMCI) emulation
  to lapic.")

  Reported-by: syzbot+8cdad6430c24f396f158@syzkaller.appspotmail.com

  Cc: Siddh Raman Pant <code@siddh.me>

  Cc: Jue Wang <juew@google.com>

  Signed-off-by: Sean Christopherson <seanjc@google.com>

  '
submodule:
- arch/x86/kvm
hunk_count: 3
covered_count: 1
