id: fadfba6a911f6bf71842
bug_link: https://syzkaller.appspot.com/bug?extid=fadfba6a911f6bf71842
title: 'INFO: trying to register non-static key in skb_dequeue'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 07528783c7da0b711385f0033a836453b5ec0c9c
fix_commit: be8597239379f0f53c9710dd6ab551bbf535bec6
datetime: '2021-03-22T17:04:22+01:00'
fix_commit_message: 'Bluetooth: initialize skb_queue_head at l2cap_chan_create()


  syzbot is hitting "INFO: trying to register non-static key." message [1],

  for "struct l2cap_chan"->tx_q.lock spinlock is not yet initialized when

  l2cap_chan_del() is called due to e.g. timeout.


  Since "struct l2cap_chan"->lock mutex is initialized at l2cap_chan_create()

  immediately after "struct l2cap_chan" is allocated using kzalloc(), let''s

  as well initialize "struct l2cap_chan"->{tx_q,srej_q}.lock spinlocks there.


  [1] https://syzkaller.appspot.com/bug?extid=fadfba6a911f6bf71842


  Reported-and-tested-by: syzbot <syzbot+fadfba6a911f6bf71842@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

  '
submodule:
- net/bluetooth
hunk_count: 1
covered_count: 1
