id: 04afcb3d2c840447559a
bug_link: https://syzkaller.appspot.com/bug?extid=04afcb3d2c840447559a
title: 'KASAN: slab-out-of-bounds Read in taprio_dequeue_from_txq'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c0e489372a294044feea650b38f38c888eff57a4
fix_commit: be3618d9651002cd5ff190dbfc6cf78f03e34e27
datetime: '2023-06-09T10:48:14+01:00'
fix_commit_message: 'net/sched: taprio: fix slab-out-of-bounds Read in taprio_dequeue_from_txq


  As shown in [1], out-of-bounds access occurs in two cases:

  1)when the qdisc of the taprio type is used to replace the previously

  configured taprio, count and offset in tc_to_txq can be set to 0. In this

  case, the value of *txq in taprio_next_tc_txq() will increases

  continuously. When the number of accessed queues exceeds the number of

  queues on the device, out-of-bounds access occurs.

  2)When packets are dequeued, taprio can be deleted. In this case, the tc

  rule of dev is cleared. The count and offset values are also set to 0. In

  this case, out-of-bounds access is also caused.


  Now the restriction on the queue number is added.


  [1] https://groups.google.com/g/syzkaller-bugs/c/_lYOKgkBVMg

  Fixes: 2f530df76c8c ("net/sched: taprio: give higher priority to higher TCs in software
  dequeue mode")

  Reported-by: syzbot+04afcb3d2c840447559a@syzkaller.appspotmail.com

  Signed-off-by: Zhengchao Shao <shaozhengchao@huawei.com>

  Tested-by: Pedro Tammela <pctammela@mojatatu.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 1
covered_count: 1
