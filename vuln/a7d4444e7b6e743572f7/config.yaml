id: a7d4444e7b6e743572f7
bug_link: https://syzkaller.appspot.com/bug?extid=a7d4444e7b6e743572f7
title: 'UBSAN: array-index-out-of-bounds in fbcon_info_from_console'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 864f9963ec6b4b76d104d595ba28110b87158003
fix_commit: cedc1b63394a866bf8663a3e40f4546f1d28c8d8
datetime: '2025-05-31T10:24:02+02:00'
fix_commit_message: "fbcon: Make sure modelist not set on unregistered console\n\n\
  It looks like attempting to write to the \"store_modes\" sysfs node will\nrun afoul\
  \ of unregistered consoles:\n\nUBSAN: array-index-out-of-bounds in drivers/video/fbdev/core/fbcon.c:122:28\n\
  index -1 is out of range for type 'fb_info *[32]'\n...\n fbcon_info_from_console+0x192/0x1a0\
  \ drivers/video/fbdev/core/fbcon.c:122\n fbcon_new_modelist+0xbf/0x2d0 drivers/video/fbdev/core/fbcon.c:3048\n\
  \ fb_new_modelist+0x328/0x440 drivers/video/fbdev/core/fbmem.c:673\n store_modes+0x1c9/0x3e0\
  \ drivers/video/fbdev/core/fbsysfs.c:113\n dev_attr_store+0x55/0x80 drivers/base/core.c:2439\n\
  \nstatic struct fb_info *fbcon_registered_fb[FB_MAX];\n...\nstatic signed char con2fb_map[MAX_NR_CONSOLES];\n\
  ...\nstatic struct fb_info *fbcon_info_from_console(int console)\n...\n        return\
  \ fbcon_registered_fb[con2fb_map[console]];\n\nIf con2fb_map contains a -1 things\
  \ go wrong here. Instead, return NULL,\nas callers of fbcon_info_from_console()\
  \ are trying to compare against\nexisting \"info\" pointers, so error handling should\
  \ kick in correctly.\n\nReported-by: syzbot+a7d4444e7b6e743572f7@syzkaller.appspotmail.com\n\
  Closes: https://lore.kernel.org/all/679d0a8f.050a0220.163cdc.000c.GAE@google.com/\n\
  Signed-off-by: Kees Cook <kees@kernel.org>\nSigned-off-by: Helge Deller <deller@gmx.de>\n"
submodule:
- drivers/video/fbdev/core
hunk_count: 1
covered_count: 1
