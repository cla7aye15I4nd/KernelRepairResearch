id: 5d1da78b375c3b5e6c2b
bug_link: https://syzkaller.appspot.com/bug?extid=5d1da78b375c3b5e6c2b
title: 'WARNING: ODEBUG bug in htab_map_alloc'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2fae67716bb99a956a4c4a47c0e2ece52a2a15ca
fix_commit: cf7de6a53600ea554a8358e44fbcf47b449235f9
datetime: '2022-09-10T16:04:07-07:00'
fix_commit_message: 'bpf: add missing percpu_counter_destroy() in htab_map_alloc()


  syzbot is reporting ODEBUG bug in htab_map_alloc() [1], for

  commit 86fe28f7692d96d2 ("bpf: Optimize element count in non-preallocated

  hash map.") added percpu_counter_init() to htab_map_alloc() but forgot to

  add percpu_counter_destroy() to the error path.


  Link: https://syzkaller.appspot.com/bug?extid=5d1da78b375c3b5e6c2b [1]

  Reported-by: syzbot <syzbot+5d1da78b375c3b5e6c2b@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Fixes: 86fe28f7692d96d2 ("bpf: Optimize element count in non-preallocated hash map.")

  Reviewed-by: Stanislav Fomichev <sdf@google.com>

  Link: https://lore.kernel.org/r/e2e4cc0e-9d36-4ca1-9bfa-ce23e6f8310b@I-love.SAKURA.ne.jp

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
