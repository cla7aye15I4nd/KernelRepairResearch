id: 01ef7a8da81a975e1ccd
bug_link: https://syzkaller.appspot.com/bug?extid=01ef7a8da81a975e1ccd
title: WARNING in bdev_getblk
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1bb94ff5ab4be2485884e0a46483f12629f3bb92
fix_commit: 7e49538288e523427beedd26993d446afef1a6fb
datetime: '2025-07-11T20:39:45-06:00'
fix_commit_message: 'loop: Avoid updating block size under exclusive owner


  Syzbot came up with a reproducer where a loop device block size is

  changed underneath a mounted filesystem. This causes a mismatch between

  the block device block size and the block size stored in the superblock

  causing confusion in various places such as fs/buffer.c. The particular

  issue triggered by syzbot was a warning in __getblk_slow() due to

  requested buffer size not matching block device block size.


  Fix the problem by getting exclusive hold of the loop device to change

  its block size. This fails if somebody (such as filesystem) has already

  an exclusive ownership of the block device and thus prevents modifying

  the loop device under some exclusive owner which doesn''t expect it.


  Reported-by: syzbot+01ef7a8da81a975e1ccd@syzkaller.appspotmail.com

  Signed-off-by: Jan Kara <jack@suse.cz>

  Tested-by: syzbot+01ef7a8da81a975e1ccd@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/r/20250711163202.19623-2-jack@suse.cz

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- drivers/block
hunk_count: 4
covered_count: 0
