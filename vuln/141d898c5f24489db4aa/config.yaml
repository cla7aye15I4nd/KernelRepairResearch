id: 141d898c5f24489db4aa
bug_link: https://syzkaller.appspot.com/bug?extid=141d898c5f24489db4aa
title: 'KASAN: use-after-free Read in sctp_do_sm'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a577d868b768a3baf16cdd4841ab8cfb165521d6
fix_commit: 6910e25de2257e2c82c7a2d126e3463cd8e50810
datetime: '2018-05-10T17:48:36-04:00'
fix_commit_message: 'sctp: remove sctp_chunk_put from fail_mark err path in sctp_ulpevent_make_rcvmsg


  In Commit 1f45f78f8e51 ("sctp: allow GSO frags to access the chunk too"),

  it held the chunk in sctp_ulpevent_make_rcvmsg to access it safely later

  in recvmsg. However, it also added sctp_chunk_put in fail_mark err path,

  which is only triggered before holding the chunk.


  syzbot reported a use-after-free crash happened on this err path, where

  it shouldn''t call sctp_chunk_put.


  This patch simply removes this call.


  Fixes: 1f45f78f8e51 ("sctp: allow GSO frags to access the chunk too")

  Reported-by: syzbot+141d898c5f24489db4aa@syzkaller.appspotmail.com

  Signed-off-by: Xin Long <lucien.xin@gmail.com>

  Acked-by: Neil Horman <nhorman@tuxdriver.com>

  Acked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sctp
hunk_count: 1
covered_count: 1
