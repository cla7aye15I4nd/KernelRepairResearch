id: d8941552e21eac774778
bug_link: https://syzkaller.appspot.com/bug?extid=d8941552e21eac774778
title: kernel BUG in btrfs_csum_one_bio
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7561551e7ba870b9659083b95feb520fb2dacce3
fix_commit: 806570c0bb7b4847828c22c4934fcf2dc8fc572f
datetime: '2023-05-17T13:08:28+02:00'
fix_commit_message: 'btrfs: handle memory allocation failure in btrfs_csum_one_bio


  Since f8a53bb58ec7 ("btrfs: handle checksum generation in the storage

  layer") the failures of btrfs_csum_one_bio() are handled via

  bio_end_io().


  This means, we can return BLK_STS_RESOURCE from btrfs_csum_one_bio() in

  case the allocation of the ordered sums fails.


  This also fixes a syzkaller report, where injecting a failure into the

  kvzalloc() call results in a BUG_ON().


  Reported-by: syzbot+d8941552e21eac774778@syzkaller.appspotmail.com

  Reviewed-by: Christoph Hellwig <hch@lst.de>

  Reviewed-by: Anand Jain <anand.jain@oracle.com>

  Signed-off-by: Johannes Thumshirn <johannes.thumshirn@wdc.com>

  Reviewed-by: David Sterba <dsterba@suse.com>

  Signed-off-by: David Sterba <dsterba@suse.com>

  '
submodule:
- fs/btrfs
hunk_count: 1
covered_count: 0
