id: 083f3b88782aa3a46bdb
bug_link: https://syzkaller.appspot.com/bug?extid=083f3b88782aa3a46bdb
title: 'WARNING: bad usercopy in __kvm_write_guest_page'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 28c20cc73b9cc4288c86c2a3fc62af4087de4b19
fix_commit: 0a06d4256674c4e041945b52044941995fee237d
datetime: '2018-07-20T17:44:57+02:00'
fix_commit_message: 'KVM: vmx: use local variable for current_vmptr when emulating
  VMPTRST


  Do not expose the address of vmx->nested.current_vmptr to

  kvm_write_guest_virt_system() as the resulting __copy_to_user()

  call will trigger a WARN when CONFIG_HARDENED_USERCOPY is

  enabled.


  Opportunistically clean up variable names in handle_vmptrst()

  to improve readability, e.g. vmcs_gva is misleading as the

  memory operand of VMPTRST is plain memory, not a VMCS.


  Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>

  Tested-by: Peter Shier <pshier@google.com>

  Reviewed-by: Peter Shier <pshier@google.com>

  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

  '
submodule:
- arch/x86/kvm
hunk_count: 1
covered_count: 0
