id: d1fe9b7b917f2715c7d4
bug_link: https://syzkaller.appspot.com/bug?extid=d1fe9b7b917f2715c7d4
title: general protection fault in try_to_wake_up
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ae4745730cf8e693d354ccd4dbaf59ea440c09a9
fix_commit: c769accdf3d8a103940bea2979b65556718567e9
datetime: '2018-03-30T12:36:27-04:00'
fix_commit_message: 'vlan: Fix vlan insertion for packets without ethernet header


  In some situation vlan packets do not have ethernet headers. One example

  is packets from tun devices. Users can specify vlan protocol in tun_pi

  field instead of IP protocol. When we have a vlan device with reorder_hdr

  disabled on top of the tun device, such packets from tun devices are

  untagged in skb_vlan_untag() and vlan headers will be inserted back in

  vlan_insert_inner_tag().


  vlan_insert_inner_tag() however did not expect packets without ethernet

  headers, so in such a case size argument for memmove() underflowed.


  We don''t need to copy headers for packets which do not have preceding

  headers of vlan headers, so skip memmove() in that case.

  Also don''t write vlan protocol in skb->data when it does not have enough

  room for it.


  Fixes: cbe7128c4b92 ("vlan: Fix out of order vlan headers with reorder header off")

  Signed-off-by: Toshiaki Makita <makita.toshiaki@lab.ntt.co.jp>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- include/linux
hunk_count: 1
covered_count: 0
