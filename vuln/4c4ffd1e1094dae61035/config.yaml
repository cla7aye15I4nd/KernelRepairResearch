id: 4c4ffd1e1094dae61035
bug_link: https://syzkaller.appspot.com/bug?extid=4c4ffd1e1094dae61035
title: memory leak in mgmt_cmd_complete
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b15bfa4df63529150df9ff0585675f728436e0c1
fix_commit: 709fca500067524381e28a5f481882930eebac88
datetime: '2021-10-12T17:30:17+02:00'
fix_commit_message: 'Bluetooth: hci_sock: purge socket queues in the destruct() callback


  The receive path may take the socket right before hci_sock_release(),

  but it may enqueue the packets to the socket queues after the call to

  skb_queue_purge(), therefore the socket can be destroyed without clear

  its queues completely.


  Moving these skb_queue_purge() to the hci_sock_destruct() will fix this

  issue, because nothing is referencing the socket at this point.


  Signed-off-by: Nguyen Dinh Phi <phind.uet@gmail.com>

  Reported-by: syzbot+4c4ffd1e1094dae61035@syzkaller.appspotmail.com

  Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

  '
submodule:
- net/bluetooth
hunk_count: 3
covered_count: 0
