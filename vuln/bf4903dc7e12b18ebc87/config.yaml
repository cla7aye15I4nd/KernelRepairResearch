id: bf4903dc7e12b18ebc87
bug_link: https://syzkaller.appspot.com/bug?extid=bf4903dc7e12b18ebc87
title: WARNING in collect_domain_accesses
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1613e604df0cd359cf2a7fbd9be7a0bcfacfabd0
fix_commit: 88da52ccd66e65f2e63a6c35c9dff55d448ef4dc
datetime: '2024-05-31T16:41:52+02:00'
fix_commit_message: 'landlock: Fix d_parent walk


  The WARN_ON_ONCE() in collect_domain_accesses() can be triggered when

  trying to link a root mount point.  This cannot work in practice because

  this directory is mounted, but the VFS check is done after the call to

  security_path_link().


  Do not use source directory''s d_parent when the source directory is the

  mount point.


  Cc: Günther Noack <gnoack@google.com>

  Cc: Paul Moore <paul@paul-moore.com>

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+bf4903dc7e12b18ebc87@syzkaller.appspotmail.com

  Fixes: b91c3e4ea756 ("landlock: Add support for file reparenting with LANDLOCK_ACCESS_FS_REFER")

  Closes: https://lore.kernel.org/r/000000000000553d3f0618198200@google.com

  Link: https://lore.kernel.org/r/20240516181935.1645983-2-mic@digikod.net

  [mic: Fix commit message]

  Signed-off-by: Mickaël Salaün <mic@digikod.net>

  '
submodule:
- security/landlock
hunk_count: 2
covered_count: 0
