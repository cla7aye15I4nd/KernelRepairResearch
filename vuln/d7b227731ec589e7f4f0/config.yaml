id: d7b227731ec589e7f4f0
bug_link: https://syzkaller.appspot.com/bug?extid=d7b227731ec589e7f4f0
title: WARNING in __ip6_make_skb (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d1f9e6513e4e64215c7a2a31476032c0c9107a23
fix_commit: 73451e9aaa24e8e44cb91e5fd6b59bf53e069c1f
datetime: '2024-06-01T15:47:23-07:00'
fix_commit_message: 'net: validate SO_TXTIME clockid coming from userspace


  Currently there are no strict checks while setting SO_TXTIME

  from userspace. With the recent development in skb->tstamp_type

  clockid with unsupported clocks results in warn_on_once, which causes

  unnecessary aborts in some systems which enables panic on warns.


  Add validation in setsockopt to support only CLOCK_REALTIME,

  CLOCK_MONOTONIC and CLOCK_TAI to be set from userspace.


  Link: https://lore.kernel.org/netdev/bc037db4-58bb-4861-ac31-a361a93841d3@linux.dev/

  Link: https://lore.kernel.org/lkml/6bdba7b6-fd22-4ea5-a356-12268674def1@quicinc.com/

  Fixes: 1693c5db6ab8 ("net: Add additional bit to support clockid_t timestamp type")

  Reported-by: syzbot+d7b227731ec589e7f4f0@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=d7b227731ec589e7f4f0

  Reported-by: syzbot+30a35a2e9c5067cc43fa@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=30a35a2e9c5067cc43fa

  Signed-off-by: Abhishek Chauhan <quic_abchauha@quicinc.com>

  Acked-by: Martin KaFai Lau <martin.lau@kernel.org>

  Reviewed-by: Willem de Bruijn <willemb@google.com>

  Link: https://lore.kernel.org/r/20240529183130.1717083-1-quic_abchauha@quicinc.com

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/core
hunk_count: 2
covered_count: 0
