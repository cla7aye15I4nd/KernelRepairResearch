id: 320a3bc8d80f478c37e4
bug_link: https://syzkaller.appspot.com/bug?extid=320a3bc8d80f478c37e4
title: 'WARNING: suspicious RCU usage in tcp_bpf_update_proto'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cbaa683bb3923df4d3c12481bff6cb6d8fdbc060
fix_commit: 51e0158a54321a48d260e95998393934bb0de52c
datetime: '2021-04-12T17:34:27+02:00'
fix_commit_message: 'skmsg: Pass psock pointer to ->psock_update_sk_prot()


  Using sk_psock() to retrieve psock pointer from sock requires

  RCU read lock, but we already get psock pointer before calling

  ->psock_update_sk_prot() in both cases, so we can just pass it

  without bothering sk_psock().


  Fixes: 8a59f9d1e3d4 ("sock: Introduce sk->sk_prot->psock_update_sk_prot()")

  Reported-by: syzbot+320a3bc8d80f478c37e4@syzkaller.appspotmail.com

  Signed-off-by: Cong Wang <cong.wang@bytedance.com>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  Tested-by: syzbot+320a3bc8d80f478c37e4@syzkaller.appspotmail.com

  Reviewed-by: Jakub Sitnicki <jakub@cloudflare.com>

  Acked-by: John Fastabend <john.fastabend@gmail.com>

  Link: https://lore.kernel.org/bpf/20210407032111.33398-1-xiyou.wangcong@gmail.com

  '
submodule:
- include/linux
- include/net
- net/core
- net/ipv4
hunk_count: 9
covered_count: 2
