id: cfcc1a3c85be15a40cba
bug_link: https://syzkaller.appspot.com/bug?extid=cfcc1a3c85be15a40cba
title: 'INFO: trying to register non-static key in rxe_cleanup_task (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a2e20b29cf9ce6d2070a6e36666e2239f7f9625b
fix_commit: b2b1ddc457458fecd1c6f385baa9fbda5f0c63ad
datetime: '2023-04-16T10:51:33+03:00'
fix_commit_message: 'RDMA/rxe: Fix the error "trying to register non-static key in
  rxe_cleanup_task"


  In the function rxe_create_qp(), rxe_qp_from_init() is called to

  initialize qp, internally things like rxe_init_task are not setup until

  rxe_qp_init_req().


  If an error occurred before this point then the unwind will call

  rxe_cleanup() and eventually to rxe_qp_do_cleanup()/rxe_cleanup_task()

  which will oops when trying to access the uninitialized spinlock.


  If rxe_init_task is not executed, rxe_cleanup_task will not be called.


  Reported-by: syzbot+cfcc1a3c85be15a40cba@syzkaller.appspotmail.com

  Link: https://syzkaller.appspot.com/bug?id=fd85757b74b3eb59f904138486f755f71e090df8

  Fixes: 8700e3e7c485 ("Soft RoCE driver")

  Fixes: 2d4b21e0a291 ("IB/rxe: Prevent from completer to operate on non valid QP")

  Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>

  Link: https://lore.kernel.org/r/20230413101115.1366068-1-yanjun.zhu@intel.com

  Signed-off-by: Leon Romanovsky <leon@kernel.org>

  '
submodule:
- drivers/infiniband/sw/rxe
hunk_count: 1
covered_count: 1
