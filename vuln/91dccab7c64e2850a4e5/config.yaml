id: 91dccab7c64e2850a4e5
bug_link: https://syzkaller.appspot.com/bug?extid=91dccab7c64e2850a4e5
title: 'INFO: task hung in __sync_dirty_buffer'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4c0b4818b1f636bc96359f7817a2d8bab6370162
fix_commit: f4ce24f54d9cca4f09a395f3eecce20d6bec4663
datetime: '2023-05-13T18:05:05-04:00'
fix_commit_message: "ext4: fix deadlock when converting an inline directory in nojournal\
  \ mode\n\nIn no journal mode, ext4_finish_convert_inline_dir() can self-deadlock\n\
  by calling ext4_handle_dirty_dirblock() when it already has taken the\ndirectory\
  \ lock.  There is a similar self-deadlock in\next4_incvert_inline_data_nolock()\
  \ for data files which we'll fix at\nthe same time.\n\nA simple reproducer demonstrating\
  \ the problem:\n\n    mke2fs -Fq -t ext2 -O inline_data -b 4k /dev/vdc 64\n    mount\
  \ -t ext4 -o dirsync /dev/vdc /vdc\n    cd /vdc\n    mkdir file0\n    cd file0\n\
  \    touch file0\n    touch file1\n    attr -s BurnSpaceInEA -V abcde .\n    touch\
  \ supercalifragilisticexpialidocious\n\nCc: stable@kernel.org\nLink: https://lore.kernel.org/r/20230507021608.1290720-1-tytso@mit.edu\n\
  Reported-by: syzbot+91dccab7c64e2850a4e5@syzkaller.appspotmail.com\nLink: https://syzkaller.appspot.com/bug?id=ba84cc80a9491d65416bc7877e1650c87530fe8a\n\
  Signed-off-by: Theodore Ts'o <tytso@mit.edu>\n"
submodule:
- fs/ext4
hunk_count: 3
covered_count: 3
