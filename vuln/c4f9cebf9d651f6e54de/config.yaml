id: c4f9cebf9d651f6e54de
bug_link: https://syzkaller.appspot.com/bug?extid=c4f9cebf9d651f6e54de
title: 'INFO: task hung in blk_queue_enter'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d00a11df691466772435ec02471292eae07885e5
fix_commit: cd4a4ae4683dc2e09380118e205e057896dcda2b
datetime: '2018-06-02T20:35:00-06:00'
fix_commit_message: 'block: don''t use blocking queue entered for recursive bio submits


  If we end up splitting a bio and the queue goes away between

  the initial submission and the later split submission, then we

  can block forever in blk_queue_enter() waiting for the reference

  to drop to zero. This will never happen, since we already hold

  a reference.


  Mark a split bio as already having entered the queue, so we can

  just use the live non-blocking queue enter variant.


  Thanks to Tetsuo Handa for the analysis.


  Reported-by: syzbot+c4f9cebf9d651f6e54de@syzkaller.appspotmail.com

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- block
- include/linux
hunk_count: 3
covered_count: 2
