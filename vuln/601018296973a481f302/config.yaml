id: 601018296973a481f302
bug_link: https://syzkaller.appspot.com/bug?extid=601018296973a481f302
title: 'UBSAN: array-index-out-of-bounds in f2fs_iget'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a842a90926b6b96ef38d6a190c27a4a60531a633
fix_commit: 958ccbbf1ce716d77c7cfa79ace50a421c1eed73
datetime: '2023-08-14T13:41:09-07:00'
fix_commit_message: "Revert \"f2fs: fix to do sanity check on extent cache correctly\"\
  \n\nsyzbot reports a f2fs bug as below:\n\nUBSAN: array-index-out-of-bounds in fs/f2fs/f2fs.h:3275:19\n\
  index 1409 is out of range for type '__le32[923]' (aka 'unsigned int[923]')\nCall\
  \ Trace:\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0x1e7/0x2d0\
  \ lib/dump_stack.c:106\n ubsan_epilogue lib/ubsan.c:217 [inline]\n __ubsan_handle_out_of_bounds+0x11c/0x150\
  \ lib/ubsan.c:348\n inline_data_addr fs/f2fs/f2fs.h:3275 [inline]\n __recover_inline_status\
  \ fs/f2fs/inode.c:113 [inline]\n do_read_inode fs/f2fs/inode.c:480 [inline]\n f2fs_iget+0x4730/0x48b0\
  \ fs/f2fs/inode.c:604\n f2fs_fill_super+0x640e/0x80c0 fs/f2fs/super.c:4601\n mount_bdev+0x276/0x3b0\
  \ fs/super.c:1391\n legacy_get_tree+0xef/0x190 fs/fs_context.c:611\n vfs_get_tree+0x8c/0x270\
  \ fs/super.c:1519\n do_new_mount+0x28f/0xae0 fs/namespace.c:3335\n do_mount fs/namespace.c:3675\
  \ [inline]\n __do_sys_mount fs/namespace.c:3884 [inline]\n __se_sys_mount+0x2d9/0x3c0\
  \ fs/namespace.c:3861\n do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n do_syscall_64+0x41/0xc0\
  \ arch/x86/entry/common.c:80\n entry_SYSCALL_64_after_hwframe+0x63/0xcd\n\nThe issue\
  \ was bisected to:\n\ncommit d48a7b3a72f121655d95b5157c32c7d555e44c05\nAuthor: Chao\
  \ Yu <chao@kernel.org>\nDate:   Mon Jan 9 03:49:20 2023 +0000\n\n    f2fs: fix to\
  \ do sanity check on extent cache correctly\n\nThe root cause is we applied both\
  \ v1 and v2 of the patch, v2 is the right\nfix, so it needs to revert v1 in order\
  \ to fix reported issue.\n\nv1:\ncommit d48a7b3a72f1 (\"f2fs: fix to do sanity check\
  \ on extent cache correctly\")\nhttps://lore.kernel.org/lkml/20230109034920.492914-1-chao@kernel.org/\n\
  \nv2:\ncommit 269d11948100 (\"f2fs: fix to do sanity check on extent cache correctly\"\
  )\nhttps://lore.kernel.org/lkml/20230207134808.1827869-1-chao@kernel.org/\n\nReported-by:\
  \ syzbot+601018296973a481f302@syzkaller.appspotmail.com\nCloses: https://lore.kernel.org/linux-f2fs-devel/000000000000fcf0690600e4d04d@google.com/\n\
  Fixes: d48a7b3a72f1 (\"f2fs: fix to do sanity check on extent cache correctly\"\
  )\nSigned-off-by: Chao Yu <chao@kernel.org>\nSigned-off-by: Jaegeuk Kim <jaegeuk@kernel.org>\n"
submodule:
- fs/f2fs
hunk_count: 2
covered_count: 2
