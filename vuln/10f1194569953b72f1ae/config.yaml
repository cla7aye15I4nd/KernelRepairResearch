id: 10f1194569953b72f1ae
bug_link: https://syzkaller.appspot.com/bug?extid=10f1194569953b72f1ae
title: memory leak in nr_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2f3fdd8d4805015fa964807e1c7f3d88f31bd389
fix_commit: 517a16b1a88bdb6b530f48d5d153478b2552d9a8
datetime: '2021-07-18T09:48:59-07:00'
fix_commit_message: 'netrom: Decrease sock refcount when sock timers expire


  Commit 63346650c1a9 ("netrom: switch to sock timer API") switched to use

  sock timer API. It replaces mod_timer() by sk_reset_timer(), and

  del_timer() by sk_stop_timer().


  Function sk_reset_timer() will increase the refcount of sock if it is

  called on an inactive timer, hence, in case the timer expires, we need to

  decrease the refcount ourselves in the handler, otherwise, the sock

  refcount will be unbalanced and the sock will never be freed.


  Signed-off-by: Nguyen Dinh Phi <phind.uet@gmail.com>

  Reported-by: syzbot+10f1194569953b72f1ae@syzkaller.appspotmail.com

  Fixes: 63346650c1a9 ("netrom: switch to sock timer API")

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/netrom
hunk_count: 9
covered_count: 0
