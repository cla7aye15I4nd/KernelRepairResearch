id: b282b65c2c68492df769
bug_link: https://syzkaller.appspot.com/bug?extid=b282b65c2c68492df769
title: possible deadlock in scheduler_tick
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c2c647f91aec192f45f0849c225f134183cf4e90
fix_commit: a83829f56c7ce17d5d05370820e185d9a23d3090
datetime: '2021-04-01T05:14:19-04:00'
fix_commit_message: "KVM: x86: disable interrupts while pvclock_gtod_sync_lock is\
  \ taken\n\npvclock_gtod_sync_lock can be taken with interrupts disabled if the\n\
  preempt notifier calls get_kvmclock_ns to update the Xen\nrunstate information:\n\
  \n   spin_lock include/linux/spinlock.h:354 [inline]\n   get_kvmclock_ns+0x25/0x390\
  \ arch/x86/kvm/x86.c:2587\n   kvm_xen_update_runstate+0x3d/0x2c0 arch/x86/kvm/xen.c:69\n\
  \   kvm_xen_update_runstate_guest+0x74/0x320 arch/x86/kvm/xen.c:100\n   kvm_xen_runstate_set_preempted\
  \ arch/x86/kvm/xen.h:96 [inline]\n   kvm_arch_vcpu_put+0x2d8/0x5a0 arch/x86/kvm/x86.c:4062\n\
  \nSo change the users of the spinlock to spin_lock_irqsave and\nspin_unlock_irqrestore.\n\
  \nReported-by: syzbot+b282b65c2c68492df769@syzkaller.appspotmail.com\nFixes: 30b5c851af79\
  \ (\"KVM: x86/xen: Add support for vCPU runstate information\")\nCc: David Woodhouse\
  \ <dwmw@amazon.co.uk>\nCc: Marcelo Tosatti <mtosatti@redhat.com>\nSigned-off-by:\
  \ Paolo Bonzini <pbonzini@redhat.com>\n"
submodule:
- arch/x86/kvm
hunk_count: 7
covered_count: 4
