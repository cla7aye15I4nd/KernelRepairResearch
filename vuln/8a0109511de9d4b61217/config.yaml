id: 8a0109511de9d4b61217
bug_link: https://syzkaller.appspot.com/bug?extid=8a0109511de9d4b61217
title: kernel BUG in bch2_bkey_cmp_packed
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 72acab3a7c5aee76451fa6054e9608026476a971
fix_commit: d335bb3fd3a4102f325ef8a353efc3d2fb523f55
datetime: '2024-11-07T16:48:20-05:00'
fix_commit_message: 'bcachefs: Ancient versions with bad bkey_formats are no longer
  supported


  Syzbot found an assertion pop, by generating an ancient filesystem

  version with an invalid bkey_format (with fields that can overflow) as

  well as packed keys that aren''t representable unpacked.


  This breaks key comparisons in all sorts of painful ways.


  Filesystems have been automatically rewriting nodes with such invalid

  formats for years; we can safely drop support for them.


  Reported-by: syzbot+8a0109511de9d4b61217@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 2
covered_count: 0
