id: 61e4b490d9d2da591b50
bug_link: https://syzkaller.appspot.com/bug?extid=61e4b490d9d2da591b50
title: 'KASAN: stack-out-of-bounds Read in __aa_lookupn_ns'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ca3fde5214e1d24f78269b337d3f22afd6bf445e
fix_commit: 250f2da49cb8e582215a65c03f50e8ddf5cd119c
datetime: '2018-10-03T06:29:22-07:00'
fix_commit_message: "apparmor: Fix uninitialized value in aa_split_fqname\n\nSyzkaller\
  \ reported a OOB-read with the stacktrace below. This occurs\ninside __aa_lookupn_ns\
  \ as `n` is not initialized. `n` is obtained from\naa_splitn_fqname. In cases where\
  \ `name` is invalid, aa_splitn_fqname\nreturns without initializing `ns_name` and\
  \ `ns_len`.\n\nFix this by always initializing `ns_name` and `ns_len`.\n\n\t__dump_stack\
  \ lib/dump_stack.c:77 [inline]\n\tdump_stack+0x1c4/0x2b4 lib/dump_stack.c:113\n\t\
  print_address_description.cold.8+0x9/0x1ff mm/kasan/report.c:256\n\tkasan_report_error\
  \ mm/kasan/report.c:354 [inline]\n\tkasan_report.cold.9+0x242/0x309 mm/kasan/report.c:412\n\
  \t__asan_report_load1_noabort+0x14/0x20 mm/kasan/report.c:430\n\tmemcmp+0xe3/0x160\
  \ lib/string.c:861\n\tstrnstr+0x4b/0x70 lib/string.c:934\n\t__aa_lookupn_ns+0xc1/0x570\
  \ security/apparmor/policy_ns.c:209\n\taa_lookupn_ns+0x88/0x1e0 security/apparmor/policy_ns.c:240\n\
  \taa_fqlookupn_profile+0x1b9/0x1010 security/apparmor/policy.c:468\n\tfqlookupn_profile+0x80/0xc0\
  \ security/apparmor/label.c:1844\n\taa_label_strn_parse+0xa3a/0x1230 security/apparmor/label.c:1908\n\
  \taa_label_parse+0x42/0x50 security/apparmor/label.c:1943\n\taa_change_profile+0x513/0x3510\
  \ security/apparmor/domain.c:1362\n\tapparmor_setprocattr+0xaa4/0x1150 security/apparmor/lsm.c:658\n\
  \tsecurity_setprocattr+0x66/0xc0 security/security.c:1298\n\tproc_pid_attr_write+0x301/0x540\
  \ fs/proc/base.c:2555\n\t__vfs_write+0x119/0x9f0 fs/read_write.c:485\n\tvfs_write+0x1fc/0x560\
  \ fs/read_write.c:549\n\tksys_write+0x101/0x260 fs/read_write.c:598\n\t__do_sys_write\
  \ fs/read_write.c:610 [inline]\n\t__se_sys_write fs/read_write.c:607 [inline]\n\t\
  __x64_sys_write+0x73/0xb0 fs/read_write.c:607\n\tdo_syscall_64+0x1b9/0x820 arch/x86/entry/common.c:290\n\
  \tentry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nFixes: 3b0aaf5866bf (\"apparmor: add\
  \ lib fn to find the \"split\" for fqnames\")\nReported-by: syzbot+61e4b490d9d2da591b50@syzkaller.appspotmail.com\n\
  Signed-off-by: Zubin Mithra <zsm@chromium.org>\nReviewed-by: Kees Cook <keescook@chromium.org>\n\
  Signed-off-by: John Johansen <john.johansen@canonical.com>\n"
submodule:
- security/apparmor
hunk_count: 1
covered_count: 0
