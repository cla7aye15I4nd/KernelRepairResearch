id: c9d1fb51ac9d0d10c39d
bug_link: https://syzkaller.appspot.com/bug?extid=c9d1fb51ac9d0d10c39d
title: kernel BUG at arch/x86/kvm/mmu/mmu.c:LINE!
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 22b1d57b032cea4d612746473ed28cb20665d876
fix_commit: 005ba37cb89bcc0cf63c2029a41f8db165aeb615
datetime: '2020-01-27T20:00:01+01:00'
fix_commit_message: 'mm: thp: KVM: Explicitly check for THP when populating secondary
  MMU


  Add a helper, is_transparent_hugepage(), to explicitly check whether a

  compound page is a THP and use it when populating KVM''s secondary MMU.

  The explicit check fixes a bug where a remapped compound page, e.g. for

  an XDP Rx socket, is mapped into a KVM guest and is mistaken for a THP,

  which results in KVM incorrectly creating a huge page in its secondary

  MMU.


  Fixes: 936a5fe6e6148 ("thp: kvm mmu transparent hugepage support")

  Reported-by: syzbot+c9d1fb51ac9d0d10c39d@syzkaller.appspotmail.com

  Cc: Andrea Arcangeli <aarcange@redhat.com>

  Cc: stable@vger.kernel.org

  Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>

  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

  '
submodule:
- arch/x86/kvm/mmu
- include/linux
- mm
- virt/kvm
- virt/kvm/arm
hunk_count: 8
covered_count: 0
