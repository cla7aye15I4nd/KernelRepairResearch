id: 18a5c5e8a9c856944876
bug_link: https://syzkaller.appspot.com/bug?extid=18a5c5e8a9c856944876
title: general protection fault in __copy_super
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c6040447c56496f4929db2d73ee445d898dd8a98
fix_commit: 40d40c6bea19ff1e40fb3d33b35b354a5b35025f
datetime: '2024-09-27T21:46:34-04:00'
fix_commit_message: 'bcachefs: assign return error when iterating through layout


  syzbot reported a null ptr deref in __copy_user [0]


  In __bch2_read_super, when a corrupt backup superblock matches the

  default opts offset, no error is assigned to ret and the freed superblock

  gets through, possibly being assigned as the best sb in bch2_fs_open and

  being later dereferenced, causing a fault. Assign EINVALID to ret when

  iterating through layout.


  [0]: https://syzkaller.appspot.com/bug?extid=18a5c5e8a9c856944876


  Reported-by: syzbot+18a5c5e8a9c856944876@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=18a5c5e8a9c856944876

  Signed-off-by: Diogo Jahchan Koike <djahchankoike@gmail.com>

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 0
