id: 148110ee7cf72f39f33e
bug_link: https://syzkaller.appspot.com/bug?extid=148110ee7cf72f39f33e
title: WARNING in __mark_chain_precision (4)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f91717007217d975aa975ddabd91ae1a107b9bff
fix_commit: 1f2a74b41ea8b902687eb97c4e7e3f558801865b
datetime: '2024-04-04T18:31:08-07:00'
fix_commit_message: 'bpf: prevent r10 register from being marked as precise


  r10 is a special register that is not under BPF program''s control and is

  always effectively precise. The rest of precision logic assumes that

  only r0-r9 SCALAR registers are marked as precise, so prevent r10 from

  being marked precise.


  This can happen due to signed cast instruction allowing to do something

  like `r0 = (s8)r10;`, which later, if r0 needs to be precise, would lead

  to an attempt to mark r10 as precise.


  Prevent this with an extra check during instruction backtracking.


  Fixes: 8100928c8814 ("bpf: Support new sign-extension mov insns")

  Reported-by: syzbot+148110ee7cf72f39f33e@syzkaller.appspotmail.com

  Signed-off-by: Andrii Nakryiko <andrii@kernel.org>

  Acked-by: Yonghong Song <yonghong.song@linux.dev>

  Link: https://lore.kernel.org/r/20240404214536.3551295-1-andrii@kernel.org

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 2
covered_count: 0
