id: c0272972b01b872e604a
bug_link: https://syzkaller.appspot.com/bug?extid=c0272972b01b872e604a
title: 'BUG: corrupted list in remove_wait_queue'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d222a084329f3c0b46ad4ed6d4b074f1d62e2056
fix_commit: dc6455a71c7fc5117977e197f67f71b49f27baba
datetime: '2018-03-27T13:03:18-04:00'
fix_commit_message: 'vhost: correctly remove wait queue during poll failure


  We tried to remove vq poll from wait queue, but do not check whether

  or not it was in a list before. This will lead double free. Fixing

  this by switching to use vhost_poll_stop() which zeros poll->wqh after

  removing poll from waitqueue to make sure it won''t be freed twice.


  Cc: Darren Kenny <darren.kenny@oracle.com>

  Reported-by: syzbot+c0272972b01b872e604a@syzkaller.appspotmail.com

  Fixes: 2b8b328b61c79 ("vhost_net: handle polling errors when setting backend")

  Signed-off-by: Jason Wang <jasowang@redhat.com>

  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>

  Acked-by: Michael S. Tsirkin <mst@redhat.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/vhost
hunk_count: 1
covered_count: 1
