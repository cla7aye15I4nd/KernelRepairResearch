id: 24452624fc4c571eedd9
bug_link: https://syzkaller.appspot.com/bug?extid=24452624fc4c571eedd9
title: memory leak in virtio_transport_send_pkt_info
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: eeddfd8e8d392bc94968d87e7a408ba9e9be4722
fix_commit: 8432b8114957235f42e070a16118a7f750de9d39
datetime: '2021-04-20T17:07:21-07:00'
fix_commit_message: 'vsock/virtio: free queued packets when closing socket


  As reported by syzbot [1], there is a memory leak while closing the

  socket. We partially solved this issue with commit ac03046ece2b

  ("vsock/virtio: free packets during the socket release"), but we

  forgot to drain the RX queue when the socket is definitely closed by

  the scheduled work.


  To avoid future issues, let''s use the new virtio_transport_remove_sock()

  to drain the RX queue before removing the socket from the af_vsock lists

  calling vsock_remove_sock().


  [1] https://syzkaller.appspot.com/bug?extid=24452624fc4c571eedd9


  Fixes: ac03046ece2b ("vsock/virtio: free packets during the socket release")

  Reported-and-tested-by: syzbot+24452624fc4c571eedd9@syzkaller.appspotmail.com

  Signed-off-by: Stefano Garzarella <sgarzare@redhat.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/vmw_vsock
hunk_count: 3
covered_count: 0
