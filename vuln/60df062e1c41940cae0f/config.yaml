id: 60df062e1c41940cae0f
bug_link: https://syzkaller.appspot.com/bug?extid=60df062e1c41940cae0f
title: WARNING in component_del
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 57bc3d3ae8c14df3ceb4e17d26ddf9eeab304581
fix_commit: c853685d11c09da35cb49bbf8f0c001abdc0d0a9
datetime: '2022-02-11T10:57:21+01:00'
fix_commit_message: 'usb: core: Unregister device on component_add() failure


  Commit 8c67d06f3fd9 ("usb: Link the ports to the connectors they are

  attached to") creates a link to the USB Type-C connector for every new

  port that is added when possible. If component_add() fails,

  usb_hub_create_port_device() prints a warning but does not unregister

  the device and does not return errors to the callers.


  Syzbot reported a "WARNING in component_del()".


  Fix this issue in usb_hub_create_port_device by calling device_unregister()

  and returning the errors from component_add().


  Fixes: 8c67d06f3fd9 ("usb: Link the ports to the connectors they are attached to")

  Reported-and-tested-by: syzbot+60df062e1c41940cae0f@syzkaller.appspotmail.com

  Reviewed-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>

  Signed-off-by: Fabio M. De Francesco <fmdefrancesco@gmail.com>

  Link: https://lore.kernel.org/r/20220209164500.8769-1-fmdefrancesco@gmail.com

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/usb/core
hunk_count: 1
covered_count: 1
