id: e7f4c64a4248a0340c37
bug_link: https://syzkaller.appspot.com/bug?extid=e7f4c64a4248a0340c37
title: memory leak in hdcs_probe_1x00
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 98965af1ebc3a652a597cee902f462f496ef9e11
fix_commit: 4f4e6644cd876c844cdb3bea2dd7051787d5ae25
datetime: '2021-04-09T13:19:38+02:00'
fix_commit_message: 'media: gscpa/stv06xx: fix memory leak


  For two of the supported sensors the stv06xx driver allocates memory which

  is stored in sd->sensor_priv. This memory is freed on a disconnect, but if

  the probe() fails, then it isn''t freed and so this leaks memory.


  Add a new probe_error() op that drivers can use to free any allocated

  memory in case there was a probe failure.


  Thanks to Pavel Skripkin <paskripkin@gmail.com> for discovering the cause

  of the memory leak.


  Reported-and-tested-by: syzbot+e7f4c64a4248a0340c37@syzkaller.appspotmail.com


  Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>

  Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>

  '
submodule:
- drivers/media/usb/gspca
- drivers/media/usb/gspca/stv06xx
hunk_count: 3
covered_count: 2
