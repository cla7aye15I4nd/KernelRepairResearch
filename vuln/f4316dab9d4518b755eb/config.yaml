id: f4316dab9d4518b755eb
bug_link: https://syzkaller.appspot.com/bug?extid=f4316dab9d4518b755eb
title: 'WARNING: refcount bug in blk_mq_free_request (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2b2ed9750fc9d040b9f6d076afcef6f00b6f1f7c
fix_commit: de6346ecbc8f5591ebd6c44ac164e8b8671d71d7
datetime: '2019-10-25T14:20:01-06:00'
fix_commit_message: 'nbd: protect cmd->status with cmd->lock


  We already do this for the most part, except in timeout and clear_req.

  For the timeout case we take the lock after we grab a ref on the config,

  but that isn''t really necessary because we''re safe to touch the cmd at

  this point, so just move the order around.


  For the clear_req cause this is initiated by the user, so again is safe.


  Reviewed-by: Mike Christie <mchristi@redhat.com>

  Signed-off-by: Josef Bacik <josef@toxicpanda.com>

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- drivers/block
hunk_count: 2
covered_count: 0
