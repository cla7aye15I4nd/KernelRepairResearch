id: 6e29a053eb165bd50de5
bug_link: https://syzkaller.appspot.com/bug?extid=6e29a053eb165bd50de5
title: memory leak in smc_create (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ee3b0826b4764f6c13ad6db67495c5a1c38e9025
fix_commit: 1a74e99323746353bba11562a2f2d0aa8102f402
datetime: '2022-04-15T11:14:38+01:00'
fix_commit_message: 'net/smc: Fix sock leak when release after smc_shutdown()


  Since commit e5d5aadcf3cd ("net/smc: fix sk_refcnt underflow on linkdown

  and fallback"), for a fallback connection, __smc_release() does not call

  sock_put() if its state is already SMC_CLOSED.


  When calling smc_shutdown() after falling back, its state is set to

  SMC_CLOSED but does not call sock_put(), so this patch calls it.


  Reported-and-tested-by: syzbot+6e29a053eb165bd50de5@syzkaller.appspotmail.com

  Fixes: e5d5aadcf3cd ("net/smc: fix sk_refcnt underflow on linkdown and fallback")

  Signed-off-by: Tony Lu <tonylu@linux.alibaba.com>

  Acked-by: Karsten Graul <kgraul@linux.ibm.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/smc
hunk_count: 1
covered_count: 0
