id: 80e32b5d1f9923f8ace6
bug_link: https://syzkaller.appspot.com/bug?extid=80e32b5d1f9923f8ace6
title: 'INFO: task hung in tcf_ife_init'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c2b947879ca320ac5505c6c29a731ff17da5e805
fix_commit: cc8e58f8325cdf14b9516b61c384cdfd02a4f408
datetime: '2020-09-04T22:08:59-07:00'
fix_commit_message: "act_ife: load meta modules before tcf_idr_check_alloc()\n\nThe\
  \ following deadlock scenario is triggered by syzbot:\n\nThread A:\t\t\t\tThread\
  \ B:\ntcf_idr_check_alloc()\n...\npopulate_metalist()\n  rtnl_unlock()\n\t\t\t\t\
  \trtnl_lock()\n\t\t\t\t\t...\n  request_module()\t\t\ttcf_idr_check_alloc()\n  rtnl_lock()\n\
  \nAt this point, thread A is waiting for thread B to release RTNL\nlock, while thread\
  \ B is waiting for thread A to commit the IDR\nchange with tcf_idr_insert() later.\n\
  \nBreak this deadlock situation by preloading ife modules earlier,\nbefore tcf_idr_check_alloc(),\
  \ this is fine because we only need\nto load modules we need potentially.\n\nReported-and-tested-by:\
  \ syzbot+80e32b5d1f9923f8ace6@syzkaller.appspotmail.com\nFixes: 0190c1d452a9 (\"\
  net: sched: atomically check-allocate action\")\nCc: Jamal Hadi Salim <jhs@mojatatu.com>\n\
  Cc: Vlad Buslov <vladbu@mellanox.com>\nCc: Jiri Pirko <jiri@resnulli.us>\nSigned-off-by:\
  \ Cong Wang <xiyou.wangcong@gmail.com>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/sched
hunk_count: 4
covered_count: 4
