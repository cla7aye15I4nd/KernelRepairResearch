id: 9331a354f4f624a52a55
bug_link: https://syzkaller.appspot.com/bug?extid=9331a354f4f624a52a55
title: 'WARNING: lock held when returning to user space in ovl_write_iter'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 53afcd310e867d25e394718558783c476301205c
fix_commit: c853680453ac235e9010987a8bdaaba0e116d3c8
datetime: '2020-03-13T15:53:06+01:00'
fix_commit_message: 'ovl: fix lockdep warning for async write


  Lockdep reports "WARNING: lock held when returning to user space!" due to

  async write holding freeze lock over the write.  Apparently aio.c already

  deals with this by lying to lockdep about the state of the lock.


  Do the same here.  No need to check for S_IFREG() here since these file ops

  are regular-only.


  Reported-by: syzbot+9331a354f4f624a52a55@syzkaller.appspotmail.com

  Fixes: 2406a307ac7d ("ovl: implement async IO routines")

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  '
submodule:
- fs/overlayfs
hunk_count: 2
covered_count: 1
