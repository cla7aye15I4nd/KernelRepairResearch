id: 6ac73b3abf1b598863fa
bug_link: https://syzkaller.appspot.com/bug?extid=6ac73b3abf1b598863fa
title: 'INFO: task hung in lock_sock_nested (5)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b493f881aaa70ac63a448267bd447ad1eb2b16a1
fix_commit: 06cc8786516f65bf0171402bfc2a4db6818b380b
datetime: '2025-01-10T18:34:45-08:00'
fix_commit_message: 'tls: skip setting sk_write_space on rekey


  syzbot reported a problem when calling setsockopt(SO_SNDBUF) after a

  rekey. SO_SNDBUF calls sk_write_space, ie tls_write_space, which then

  calls the original socket''s sk_write_space, saved in

  ctx->sk_write_space. Rekeys should skip re-assigning

  ctx->sk_write_space, so we don''t end up with tls_write_space calling

  itself.


  Fixes: 47069594e67e ("tls: implement rekey for TLS1.3")

  Reported-by: syzbot+6ac73b3abf1b598863fa@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/netdev/676d231b.050a0220.2f3838.0461.GAE@google.com/

  Tested-by: syzbot+6ac73b3abf1b598863fa@syzkaller.appspotmail.com

  Signed-off-by: Sabrina Dubroca <sd@queasysnail.net>

  Link: https://patch.msgid.link/ffdbe4de691d1c1eead556bbf42e33ae215304a7.1736436785.git.sd@queasysnail.net

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/tls
hunk_count: 1
covered_count: 0
