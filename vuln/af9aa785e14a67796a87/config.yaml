id: af9aa785e14a67796a87
bug_link: https://syzkaller.appspot.com/bug?extid=af9aa785e14a67796a87
title: possible deadlock in seq_read_iter (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: fec50db7033ea478773b159e0e2efb135270e3b7
fix_commit: 16b52bbee4823b01ab7fe3919373c981a38f3797
datetime: '2024-04-14T06:55:46-04:00'
fix_commit_message: 'kernfs: annotate different lockdep class for of->mutex of writable
  files


  The writable file /sys/power/resume may call vfs lookup helpers for

  arbitrary paths and readonly files can be read by overlayfs from vfs

  helpers when sysfs is a lower layer of overalyfs.


  To avoid a lockdep warning of circular dependency between overlayfs

  inode lock and kernfs of->mutex, use a different lockdep class for

  writable and readonly kernfs files.


  Reported-by: syzbot+9a5b0ced8b1bfb238b56@syzkaller.appspotmail.com

  Fixes: 0fedefd4c4e3 ("kernfs: sysfs: support custom llseek method for sysfs entries")

  Suggested-by: Al Viro <viro@zeniv.linux.org.uk>

  Signed-off-by: Amir Goldstein <amir73il@gmail.com>

  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

  '
submodule:
- fs/kernfs
hunk_count: 1
covered_count: 0
