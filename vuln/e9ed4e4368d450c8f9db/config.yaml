id: e9ed4e4368d450c8f9db
bug_link: https://syzkaller.appspot.com/bug?extid=e9ed4e4368d450c8f9db
title: 'WARNING: refcount bug in ethnl_phy_done'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 06a104d55d56aae199ebac1078ca19f0f45202bc
fix_commit: 1ad84a151af7f4b3933983677bc75074f957bdf5
datetime: '2024-09-13T21:40:12-07:00'
fix_commit_message: 'net: ethtool: phy: Don''t set the context dev pointer for unfiltered
  DUMP


  The context info allows continuing DUMP requests, shall they fill the

  netlink buffer.


  In the case of filtered DUMP requests, a reference on the netdev is

  grabbed in the .start() callback and release in .done().


  Unfiltered DUMP request don''t need the dev pointer to be set in the context

  info, doing so will trigger an unwanted netdev_put() in .done().


  Reported-by: syzbot+e9ed4e4368d450c8f9db@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/netdev/000000000000d3bf150621d361a7@google.com/

  Fixes: 17194be4c8e1 ("net: ethtool: Introduce a command to list PHYs on an interface")

  Signed-off-by: Maxime Chevallier <maxime.chevallier@bootlin.com>

  Reviewed-by: Vadim Fedorenko <vadim.fedorenko@linux.dev>

  Link: https://patch.msgid.link/20240913100515.167341-1-maxime.chevallier@bootlin.com

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/ethtool
hunk_count: 1
covered_count: 1
