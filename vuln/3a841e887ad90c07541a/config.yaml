id: 3a841e887ad90c07541a
bug_link: https://syzkaller.appspot.com/bug?extid=3a841e887ad90c07541a
title: kernel BUG in submit_bh_wbc
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f2f26b4a84a0ef41791bd2d70861c8eac748f4ba
fix_commit: 269cdf353b5bdd15f1a079671b0f889113865f20
datetime: '2024-03-14T09:17:30-07:00'
fix_commit_message: 'nilfs2: prevent kernel bug at submit_bh_wbc()


  Fix a bug where nilfs_get_block() returns a successful status when

  searching and inserting the specified block both fail inconsistently.  If

  this inconsistent behavior is not due to a previously fixed bug, then an

  unexpected race is occurring, so return a temporary error -EAGAIN instead.


  This prevents callers such as __block_write_begin_int() from requesting a

  read into a buffer that is not mapped, which would cause the BUG_ON check

  for the BH_Mapped flag in submit_bh_wbc() to fail.


  Link: https://lkml.kernel.org/r/20240313105827.5296-3-konishi.ryusuke@gmail.com

  Fixes: 1f5abe7e7dbc ("nilfs2: replace BUG_ON and BUG calls triggerable from ioctl")

  Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/nilfs2
hunk_count: 1
covered_count: 0
