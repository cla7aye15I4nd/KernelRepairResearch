id: 7f45fa9805c40db3f108
bug_link: https://syzkaller.appspot.com/bug?extid=7f45fa9805c40db3f108
title: 'UBSAN: shift-out-of-bounds in bch2_alloc_to_text'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2045fc4295c427d420aa1ff551b4de8179b6e5d5
fix_commit: 5c41f75d1b921b9eaf79588cdd3b22b00fb4ec52
datetime: '2024-10-24T17:41:43-04:00'
fix_commit_message: 'bcachefs: fix shift oob in alloc_lru_idx_fragmentation


  The size of a.data_type is set abnormally large, causing shift-out-of-bounds.

  To fix this, we need to add validation on a.data_type in

  alloc_lru_idx_fragmentation().


  Reported-by: syzbot+7f45fa9805c40db3f108@syzkaller.appspotmail.com

  Fixes: 260af1562ec1 ("bcachefs: Kill alloc_v4.fragmentation_lru")

  Signed-off-by: Jeongjun Park <aha310510@gmail.com>

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 1
