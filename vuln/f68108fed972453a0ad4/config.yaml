id: f68108fed972453a0ad4
bug_link: https://syzkaller.appspot.com/bug?extid=f68108fed972453a0ad4
title: 'KASAN: vmalloc-out-of-bounds Read in compat_copy_entries'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d05d5db815d56a0ce203ed297153d9794dfdcb68
fix_commit: e608f631f0ba5f1fc5ee2e260a3a35d13107cbfe
datetime: '2019-12-20T02:12:27+01:00'
fix_commit_message: "netfilter: ebtables: compat: reject all padding in matches/watchers\n\
  \nsyzbot reported following splat:\n\nBUG: KASAN: vmalloc-out-of-bounds in size_entry_mwt\
  \ net/bridge/netfilter/ebtables.c:2063 [inline]\nBUG: KASAN: vmalloc-out-of-bounds\
  \ in compat_copy_entries+0x128b/0x1380 net/bridge/netfilter/ebtables.c:2155\nRead\
  \ of size 4 at addr ffffc900004461f4 by task syz-executor267/7937\n\nCPU: 1 PID:\
  \ 7937 Comm: syz-executor267 Not tainted 5.5.0-rc1-syzkaller #0\n size_entry_mwt\
  \ net/bridge/netfilter/ebtables.c:2063 [inline]\n compat_copy_entries+0x128b/0x1380\
  \ net/bridge/netfilter/ebtables.c:2155\n compat_do_replace+0x344/0x720 net/bridge/netfilter/ebtables.c:2249\n\
  \ compat_do_ebt_set_ctl+0x22f/0x27e net/bridge/netfilter/ebtables.c:2333\n [..]\n\
  \nBecause padding isn't considered during computation of ->buf_user_offset,\n\"\
  total\" is decremented by fewer bytes than it should.\n\nTherefore, the first part\
  \ of\n\nif (*total < sizeof(*entry) || entry->next_offset < sizeof(*entry))\n\n\
  will pass, -- it should not have.  This causes oob access:\nentry->next_offset is\
  \ past the vmalloced size.\n\nReject padding and check that computed user offset\
  \ (sum of ebt_entry\nstructure plus all individual matches/watchers/targets) is\
  \ same\nvalue that userspace gave us as the offset of the next entry.\n\nReported-by:\
  \ syzbot+f68108fed972453a0ad4@syzkaller.appspotmail.com\nFixes: 81e675c227ec (\"\
  netfilter: ebtables: add CONFIG_COMPAT support\")\nSigned-off-by: Florian Westphal\
  \ <fw@strlen.de>\nSigned-off-by: Pablo Neira Ayuso <pablo@netfilter.org>\n"
submodule:
- net/bridge
hunk_count: 5
covered_count: 2
