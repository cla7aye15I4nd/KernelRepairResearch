id: 46fe08363dbba223dec5
bug_link: https://syzkaller.appspot.com/bug?extid=46fe08363dbba223dec5
title: general protection fault in kobject_get
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f2f2b3bbf0d9f8d090b9a019679223b2bd1c66c4
fix_commit: 5bdfa854013ce4193de0d097931fd841382c76a7
datetime: '2020-03-13T10:32:02-03:00'
fix_commit_message: "RDMA/mad: Do not crash if the rdma device does not have a umad\
  \ interface\n\nNon-IB devices do not have a umad interface and the client_data will\
  \ be\nleft set to NULL. In this case calling get_nl_info() will try to kref a\n\
  NULL cdev causing a crash:\n\n  general protection fault, probably for non-canonical\
  \ address 0xdffffc00000000ba: 0000 [#1] PREEMPT SMP KASAN\n  KASAN: null-ptr-deref\
  \ in range [0x00000000000005d0-0x00000000000005d7]\n  CPU: 0 PID: 20851 Comm: syz-executor.0\
  \ Not tainted 5.6.0-rc2-syzkaller #0\n  Hardware name: Google Google Compute Engine/Google\
  \ Compute Engine, BIOS Google 01/01/2011\n  RIP: 0010:kobject_get+0x35/0x150 lib/kobject.c:640\n\
  \  Code: 53 e8 3f b0 8b f9 4d 85 e4 0f 84 a2 00 00 00 e8 31 b0 8b f9 49 8d 7c 24\
  \ 3c 48 b8 00 00 00 00 00 fc ff df 48 89 fa 48 c1 ea 03 <0f  b6 04 02 48 89 fa\n\
  +83 e2 07 38 d0 7f 08 84 c0 0f 85 eb 00 00 00\n  RSP: 0018:ffffc9000946f1a0 EFLAGS:\
  \ 00010203\n  RAX: dffffc0000000000 RBX: ffffffff85bdbbb0 RCX: ffffc9000bf22000\n\
  \  RDX: 00000000000000ba RSI: ffffffff87e9d78f RDI: 00000000000005d4\n  RBP: ffffc9000946f1b8\
  \ R08: ffff8880581a6440 R09: ffff8880581a6cd0\n  R10: fffffbfff154b838 R11: ffffffff8aa5c1c7\
  \ R12: 0000000000000598\n  R13: 0000000000000000 R14: ffffc9000946f278 R15: ffff88805cb0c4d0\n\
  \  FS:  00007faa9e8af700(0000) GS:ffff8880ae800000(0000) knlGS:0000000000000000\n\
  \  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 0000001b30121000 CR3:\
  \ 000000004515d000 CR4: 00000000001406f0\n  DR0: 0000000000000000 DR1: 0000000000000000\
  \ DR2: 0000000000000000\n  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n\
  \  Call Trace:\n   get_device+0x25/0x40 drivers/base/core.c:2574\n   __ib_get_client_nl_info+0x205/0x2e0\
  \ drivers/infiniband/core/device.c:1861\n   ib_get_client_nl_info+0x35/0x180 drivers/infiniband/core/device.c:1881\n\
  \   nldev_get_chardev+0x575/0xac0 drivers/infiniband/core/nldev.c:1621\n   rdma_nl_rcv_msg\
  \ drivers/infiniband/core/netlink.c:195 [inline]\n   rdma_nl_rcv_skb drivers/infiniband/core/netlink.c:239\
  \ [inline]\n   rdma_nl_rcv+0x5d9/0x980 drivers/infiniband/core/netlink.c:259\n \
  \  netlink_unicast_kernel net/netlink/af_netlink.c:1303 [inline]\n   netlink_unicast+0x59e/0x7e0\
  \ net/netlink/af_netlink.c:1329\n   netlink_sendmsg+0x91c/0xea0 net/netlink/af_netlink.c:1918\n\
  \   sock_sendmsg_nosec net/socket.c:652 [inline]\n   sock_sendmsg+0xd7/0x130 net/socket.c:672\n\
  \   ____sys_sendmsg+0x753/0x880 net/socket.c:2343\n   ___sys_sendmsg+0x100/0x170\
  \ net/socket.c:2397\n   __sys_sendmsg+0x105/0x1d0 net/socket.c:2430\n   __do_sys_sendmsg\
  \ net/socket.c:2439 [inline]\n   __se_sys_sendmsg net/socket.c:2437 [inline]\n \
  \  __x64_sys_sendmsg+0x78/0xb0 net/socket.c:2437\n   do_syscall_64+0xfa/0x790 arch/x86/entry/common.c:294\n\
  \   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nCc: stable@kernel.org\nFixes: 8f71bb0030b8\
  \ (\"RDMA: Report available cdevs through RDMA_NLDEV_CMD_GET_CHARDEV\")\nLink: https://lore.kernel.org/r/20200310075339.238090-1-leon@kernel.org\n\
  Reported-by: syzbot+46fe08363dbba223dec5@syzkaller.appspotmail.com\nSigned-off-by:\
  \ Leon Romanovsky <leonro@mellanox.com>\nSigned-off-by: Jason Gunthorpe <jgg@mellanox.com>\n"
submodule:
- drivers/infiniband/core
hunk_count: 2
covered_count: 0
