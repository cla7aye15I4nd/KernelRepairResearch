id: 15342c1aa6a00fb7a438
bug_link: https://syzkaller.appspot.com/bug?extid=15342c1aa6a00fb7a438
title: 'UBSAN: shift-out-of-bounds in dbAllocAG'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bbb8ceb5e2421184db9560e9d2cfaf858e1db616
fix_commit: 898f706695682b9954f280d95e49fa86ffa55d08
datetime: '2022-10-18T08:49:42-05:00'
fix_commit_message: 'fs: jfs: fix shift-out-of-bounds in dbAllocAG


  Syzbot found a crash : UBSAN: shift-out-of-bounds in dbAllocAG. The

  underlying bug is the missing check of bmp->db_agl2size. The field can

  be greater than 64 and trigger the shift-out-of-bounds.


  Fix this bug by adding a check of bmp->db_agl2size in dbMount since this

  field is used in many following functions. The upper bound for this

  field is L2MAXL2SIZE - L2MAXAG, thanks for the help of Dave Kleikamp.

  Note that, for maintenance, I reorganized error handling code of dbMount.


  Reported-by: syzbot+15342c1aa6a00fb7a438@syzkaller.appspotmail.com

  Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>

  Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>

  '
submodule:
- fs/jfs
hunk_count: 5
covered_count: 3
