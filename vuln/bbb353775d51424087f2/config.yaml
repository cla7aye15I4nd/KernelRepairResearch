id: bbb353775d51424087f2
bug_link: https://syzkaller.appspot.com/bug?extid=bbb353775d51424087f2
title: general protection fault in erofs_bread (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f1fcbaa18b28dec10281551dfe6ed3a3ed80e3d6
fix_commit: 0a17567b4a85243ac1620886b75b3813acde41fc
datetime: '2023-05-23T16:56:21+08:00'
fix_commit_message: 'erofs: fix null-ptr-deref caused by erofs_xattr_prefixes_init


  Fragments and dedupe share one feature bit, and thus packed inode may not

  exist when fragment feature bit (dedupe feature bit exactly) is set, e.g.

  when deduplication feature is in use while fragments feature is not.  In

  this case, sbi->packed_inode could be NULL while fragments feature bit

  is set.


  Fix this by accessing packed inode only when it exists.


  Reported-by: syzbot+902d5a9373ae8f748a94@syzkaller.appspotmail.com

  Link: https://syzkaller.appspot.com/bug?extid=902d5a9373ae8f748a94

  Reported-and-tested-by: syzbot+bbb353775d51424087f2@syzkaller.appspotmail.com

  Fixes: 9e382914617c ("erofs: add helpers to load long xattr name prefixes")

  Fixes: 6a318ccd7e08 ("erofs: enable long extended attribute name prefixes")

  Signed-off-by: Jingbo Xu <jefflexu@linux.alibaba.com>

  Reviewed-by: Yue Hu <huyue2@coolpad.com>

  Reviewed-by: Chao Yu <chao@kernel.org>

  Link: https://lore.kernel.org/r/20230515103941.129784-1-jefflexu@linux.alibaba.com

  Signed-off-by: Gao Xiang <hsiangkao@linux.alibaba.com>

  '
submodule:
- fs/erofs
hunk_count: 1
covered_count: 1
