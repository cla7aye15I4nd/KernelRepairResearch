id: ee90502d5c8fd1d0dd93
bug_link: https://syzkaller.appspot.com/bug?extid=ee90502d5c8fd1d0dd93
title: WARNING in btrfs_split_ordered_extent
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 79b8ee702c918f1936e17cc53e14bec388ce1045
fix_commit: 7833b865953c8e62abc76a3261c04132b2fb69de
datetime: '2023-06-13T00:01:00+02:00'
fix_commit_message: 'btrfs: fix iomap_begin length for nocow writes


  can_nocow_extent can reduce the len passed in, which needs to be

  propagated to btrfs_dio_iomap_begin so that iomap does not submit

  more data then is mapped.


  This problems exists since the btrfs_get_blocks_direct helper was added

  in commit c5794e51784a ("btrfs: Factor out write portion of

  btrfs_get_blocks_direct"), but the ordered_extent splitting added in

  commit b73a6fd1b1ef ("btrfs: split partial dio bios before submit")

  added a WARN_ON that made a syzkaller test fail.


  Reported-by: syzbot+ee90502d5c8fd1d0dd93@syzkaller.appspotmail.com

  Fixes: c5794e51784a ("btrfs: Factor out write portion of btrfs_get_blocks_direct")

  CC: stable@vger.kernel.org # 6.1+

  Tested-by: syzbot+ee90502d5c8fd1d0dd93@syzkaller.appspotmail.com

  Reviewed-by: Filipe Manana <fdmanana@suse.com>

  Signed-off-by: Christoph Hellwig <hch@lst.de>

  Signed-off-by: David Sterba <dsterba@suse.com>

  '
submodule:
- fs/btrfs
hunk_count: 5
covered_count: 0
