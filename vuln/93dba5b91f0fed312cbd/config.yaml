id: 93dba5b91f0fed312cbd
bug_link: https://syzkaller.appspot.com/bug?extid=93dba5b91f0fed312cbd
title: 'KASAN: use-after-free Read in cipso_v4_doi_add'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f91488ee15bd3cac467e2d6a361fc2d34d1052ae
fix_commit: 0934ad42bb2c5df90a1b9de690f93de735b622fe
datetime: '2021-10-22T08:46:53-07:00'
fix_commit_message: 'smackfs: use netlbl_cfg_cipsov4_del() for deleting cipso_v4_doi


  syzbot is reporting UAF at cipso_v4_doi_search() [1], for smk_cipso_doi()

  is calling kfree() without removing from the cipso_v4_doi_list list after

  netlbl_cfg_cipsov4_map_add() returned an error. We need to use

  netlbl_cfg_cipsov4_del() in order to remove from the list and wait for

  RCU grace period before kfree().


  Link: https://syzkaller.appspot.com/bug?extid=93dba5b91f0fed312cbd [1]

  Reported-by: syzbot <syzbot+93dba5b91f0fed312cbd@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Fixes: 6c2e8ac0953fccdd ("netlabel: Update kernel configuration API")

  Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>

  '
submodule:
- security/smack
hunk_count: 1
covered_count: 1
