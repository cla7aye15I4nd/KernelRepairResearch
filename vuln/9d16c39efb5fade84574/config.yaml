id: 9d16c39efb5fade84574
bug_link: https://syzkaller.appspot.com/bug?extid=9d16c39efb5fade84574
title: possible deadlock in jbd2_log_wait_commit
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7fc1f5c28ae4c615ccc5346f39a7bf4c4e0900ac
fix_commit: 3c92792da8506a295afb6d032b4476e46f979725
datetime: '2023-03-07T21:45:38-05:00'
fix_commit_message: 'ext4: Fix deadlock during directory rename


  As lockdep properly warns, we should not be locking i_rwsem while having

  transactions started as the proper lock ordering used by all directory

  handling operations is i_rwsem -> transaction start. Fix the lock

  ordering by moving the locking of the directory earlier in

  ext4_rename().


  Reported-by: syzbot+9d16c39efb5fade84574@syzkaller.appspotmail.com

  Fixes: 0813299c586b ("ext4: Fix possible corruption when moving a directory")

  Link: https://syzkaller.appspot.com/bug?extid=9d16c39efb5fade84574

  Signed-off-by: Jan Kara <jack@suse.cz>

  Link: https://lore.kernel.org/r/20230301141004.15087-1-jack@suse.cz

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 3
covered_count: 2
