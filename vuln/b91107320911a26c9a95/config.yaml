id: b91107320911a26c9a95
bug_link: https://syzkaller.appspot.com/bug?extid=b91107320911a26c9a95
title: 'INFO: trying to register non-static key in exfat_cache_inval_inode'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d6c9efd92443b23307995f34246c2374056ebbd8
fix_commit: 8ff006e57ad3a25f909c456d053aa498b6673a39
datetime: '2020-10-07T14:27:13+09:00'
fix_commit_message: "exfat: fix use of uninitialized spinlock on error path\n\nsyzbot\
  \ reported warning message:\n\nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n\
  \ dump_stack+0x1d6/0x29e lib/dump_stack.c:118\n register_lock_class+0xf06/0x1520\
  \ kernel/locking/lockdep.c:893\n __lock_acquire+0xfd/0x2ae0 kernel/locking/lockdep.c:4320\n\
  \ lock_acquire+0x148/0x720 kernel/locking/lockdep.c:5029\n __raw_spin_lock include/linux/spinlock_api_smp.h:142\
  \ [inline]\n _raw_spin_lock+0x2a/0x40 kernel/locking/spinlock.c:151\n spin_lock\
  \ include/linux/spinlock.h:354 [inline]\n exfat_cache_inval_inode+0x30/0x280 fs/exfat/cache.c:226\n\
  \ exfat_evict_inode+0x124/0x270 fs/exfat/inode.c:660\n evict+0x2bb/0x6d0 fs/inode.c:576\n\
  \ exfat_fill_super+0x1e07/0x27d0 fs/exfat/super.c:681\n get_tree_bdev+0x3e9/0x5f0\
  \ fs/super.c:1342\n vfs_get_tree+0x88/0x270 fs/super.c:1547\n do_new_mount fs/namespace.c:2875\
  \ [inline]\n path_mount+0x179d/0x29e0 fs/namespace.c:3192\n do_mount fs/namespace.c:3205\
  \ [inline]\n __do_sys_mount fs/namespace.c:3413 [inline]\n __se_sys_mount+0x126/0x180\
  \ fs/namespace.c:3390\n do_syscall_64+0x31/0x70 arch/x86/entry/common.c:46\n entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\
  \nIf exfat_read_root() returns an error, spinlock is used in\nexfat_evict_inode()\
  \ without initialization. This patch combines\nexfat_cache_init_inode() with exfat_inode_init_once()\
  \ to initialize\nspinlock by slab constructor.\n\nFixes: c35b6810c495 (\"exfat:\
  \ add exfat cache\")\nCc: stable@vger.kernel.org # v5.7+\nReported-by: syzbot <syzbot+b91107320911a26c9a95@syzkaller.appspotmail.com>\n\
  Signed-off-by: Namjae Jeon <namjae.jeon@samsung.com>\n"
submodule:
- fs/exfat
hunk_count: 7
covered_count: 3
