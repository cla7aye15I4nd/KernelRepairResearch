id: 6cffdef928852907751c
bug_link: https://syzkaller.appspot.com/bug?extid=6cffdef928852907751c
title: WARNING in static_key_disable_cpuslocked
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 37342bdaf5b363cf2e1bd170ce7d1de34ecf57e7
fix_commit: 9c48060141bd937497774546e4bb89b8992be383
datetime: '2018-11-16T23:01:56-08:00'
fix_commit_message: 'udp: fix jump label misuse


  The commit 60fb9567bf30 ("udp: implement complete book-keeping for

  encap_needed") introduced a severe misuse of jump label APIs, which

  syzbot, as reported by Eric, was able to exploit.


  When multiple sockets/process can concurrently request (and than

  disable) the udp encap, we need to track the activation counter with

  *_inc()/*_dec() jump label variants, or we can experience bad things

  at disable time.


  Fixes: 60fb9567bf30 ("udp: implement complete book-keeping for encap_needed")

  Reported-by: Eric Dumazet <eric.dumazet@gmail.com>

  Signed-off-by: Paolo Abeni <pabeni@redhat.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/ipv4
- net/ipv6
hunk_count: 4
covered_count: 0
