id: 1a240cdb1f4cc88819df
bug_link: https://syzkaller.appspot.com/bug?extid=1a240cdb1f4cc88819df
title: WARNING in kvmalloc_node
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 952fad8e323975c4e826b659087d2648777594a6
fix_commit: 7fc17e909edfb9bf421ee04e981d3d474175c7c7
datetime: '2018-02-14T15:34:27+01:00'
fix_commit_message: 'bpf: cpumap: use GFP_KERNEL instead of GFP_ATOMIC in __cpu_map_entry_alloc()


  There''re several implications after commit 0bf7800f1799 ("ptr_ring:

  try vmalloc() when kmalloc() fails") with the using of vmalloc() since

  can''t allow GFP_ATOMIC but mandate GFP_KERNEL. This will lead a WARN

  since cpumap try to call with GFP_ATOMIC. Fortunately, entry

  allocation of cpumap can only be done through syscall path which means

  GFP_ATOMIC is not necessary, so fixing this by replacing GFP_ATOMIC

  with GFP_KERNEL.


  Reported-by: syzbot+1a240cdb1f4cc88819df@syzkaller.appspotmail.com

  Fixes: 0bf7800f1799 ("ptr_ring: try vmalloc() when kmalloc() fails")

  Cc: Michal Hocko <mhocko@kernel.org>

  Cc: Daniel Borkmann <daniel@iogearbox.net>

  Cc: Matthew Wilcox <willy@infradead.org>

  Cc: Jesper Dangaard Brouer <brouer@redhat.com>

  Cc: akpm@linux-foundation.org

  Cc: dhowells@redhat.com

  Cc: hannes@cmpxchg.org

  Signed-off-by: Jason Wang <jasowang@redhat.com>

  Acked-by: Jesper Dangaard Brouer <brouer@redhat.com>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
