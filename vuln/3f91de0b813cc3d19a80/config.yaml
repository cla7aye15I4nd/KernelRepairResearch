id: 3f91de0b813cc3d19a80
bug_link: https://syzkaller.appspot.com/bug?extid=3f91de0b813cc3d19a80
title: 'KASAN: use-after-free Read in netlbl_catmap_walk'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6880fa6c56601bb8ed59df6c30fd390cc5f6dd8f
fix_commit: 0817534ff9ea809fac1322c5c8c574be8483ea57
datetime: '2021-09-15T16:42:25-07:00'
fix_commit_message: 'smackfs: Fix use-after-free in netlbl_catmap_walk()


  Syzkaller reported use-after-free bug as described in [1]. The bug is

  triggered when smk_set_cipso() tries to free stale category bitmaps

  while there are concurrent reader(s) using the same bitmaps.


  Wait for RCU grace period to finish before freeing the category bitmaps

  in smk_set_cipso(). This makes sure that there are no more readers using

  the stale bitmaps and freeing them should be safe.


  [1] https://lore.kernel.org/netdev/000000000000a814c505ca657a4e@google.com/


  Reported-by: syzbot+3f91de0b813cc3d19a80@syzkaller.appspotmail.com

  Signed-off-by: Pawan Gupta <pawan.kumar.gupta@linux.intel.com>

  Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>

  '
submodule:
- security/smack
hunk_count: 2
covered_count: 2
