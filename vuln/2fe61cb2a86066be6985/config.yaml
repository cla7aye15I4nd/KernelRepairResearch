id: 2fe61cb2a86066be6985
bug_link: https://syzkaller.appspot.com/bug?extid=2fe61cb2a86066be6985
title: WARNING in perf_pending_task
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d7b8f8e20813f0179d8ef519541a3527e7661d3a
fix_commit: 3da6bb419750f3ad834786d6ba7c9d5d062c770b
datetime: '2025-07-09T13:40:17+02:00'
fix_commit_message: 'perf/core: Fix WARN in perf_sigtrap()


  Since exit_task_work() runs after perf_event_exit_task_context() updated

  ctx->task to TASK_TOMBSTONE, perf_sigtrap() from perf_pending_task() might

  observe event->ctx->task == TASK_TOMBSTONE.


  Swap the early exit tests in order not to hit WARN_ON_ONCE().


  Closes: https://syzkaller.appspot.com/bug?extid=2fe61cb2a86066be6985

  Reported-by: syzbot <syzbot+2fe61cb2a86066be6985@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>

  Link: https://lkml.kernel.org/r/b1c224bd-97f9-462c-a3e3-125d5e19c983@I-love.SAKURA.ne.jp

  '
submodule:
- kernel/events
hunk_count: 1
covered_count: 1
