id: f9549f5ee8a5416f0b95
bug_link: https://syzkaller.appspot.com/bug?extid=f9549f5ee8a5416f0b95
title: possible deadlock in usb_deregister_dev (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1d427be4a39defadda6dd8f4659bc17f7591740f
fix_commit: 33a7813219f208f4952ece60ee255fd983272dec
datetime: '2019-10-04T14:01:56+02:00'
fix_commit_message: "USB: legousbtower: fix deadlock on disconnect\n\nFix a potential\
  \ deadlock if disconnect races with open.\n\nSince commit d4ead16f50f9 (\"USB: prevent\
  \ char device open/deregister\nrace\") core holds an rw-semaphore while open is\
  \ called and when\nreleasing the minor number during deregistration. This can lead\
  \ to an\nABBA deadlock if a driver takes a lock in open which it also holds\nduring\
  \ deregistration.\n\nThis effectively reverts commit 78663ecc344b (\"USB: disconnect\
  \ open race\nin legousbtower\") which needlessly introduced this issue after a generic\n\
  fix for this race had been added to core by commit d4ead16f50f9 (\"USB:\nprevent\
  \ char device open/deregister race\").\n\nFixes: 78663ecc344b (\"USB: disconnect\
  \ open race in legousbtower\")\nCc: stable <stable@vger.kernel.org>\t# 2.6.24\n\
  Reported-by: syzbot+f9549f5ee8a5416f0b95@syzkaller.appspotmail.com\nTested-by: syzbot+f9549f5ee8a5416f0b95@syzkaller.appspotmail.com\n\
  Signed-off-by: Johan Hovold <johan@kernel.org>\nLink: https://lore.kernel.org/r/20190919083039.30898-3-johan@kernel.org\n\
  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n"
submodule:
- drivers/usb/misc
hunk_count: 7
covered_count: 4
