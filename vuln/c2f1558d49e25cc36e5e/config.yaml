id: c2f1558d49e25cc36e5e
bug_link: https://syzkaller.appspot.com/bug?extid=c2f1558d49e25cc36e5e
title: 'BUG: sleeping function called from invalid context in lock_sock_nested'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bfcdcef8c8e3469f4d6c082a1da27a6ef77e5715
fix_commit: 37f96694cf73ba116993a9d2d99ad6a75fa7fdb0
datetime: '2019-12-11T16:37:02+08:00'
fix_commit_message: 'crypto: af_alg - Use bh_lock_sock in sk_destruct


  As af_alg_release_parent may be called from BH context (most notably

  due to an async request that only completes after socket closure,

  or as reported here because of an RCU-delayed sk_destruct call), we

  must use bh_lock_sock instead of lock_sock.


  Reported-by: syzbot+c2f1558d49e25cc36e5e@syzkaller.appspotmail.com

  Reported-by: Eric Dumazet <eric.dumazet@gmail.com>

  Fixes: c840ac6af3f8 ("crypto: af_alg - Disallow bind/setkey/...")

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

  '
submodule:
- crypto
hunk_count: 1
covered_count: 0
