id: 8dd98a9e98ee28dc484a
bug_link: https://syzkaller.appspot.com/bug?extid=8dd98a9e98ee28dc484a
title: WARNING in __rate_control_send_low (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ea63fb71993c56628f323b8268d36f4bbd836a7f
fix_commit: e7a7ef9a0742dbd0818d5b15fba2c5313ace765b
datetime: '2024-08-27T10:13:23+02:00'
fix_commit_message: 'wifi: mac80211: don''t use rate mask for offchannel TX either


  Like the commit ab9177d83c04 ("wifi: mac80211: don''t use rate mask for

  scanning"), ignore incorrect settings to avoid no supported rate warning

  reported by syzbot.


  The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:

  fix default HE tx bitrate mask in 2G band"), which however corrects

  bitmask of HE MCS and recognizes correctly settings of empty legacy rate

  plus HE MCS rate instead of returning -EINVAL.


  As suggestions [1], follow the change of SCAN TX to consider this case of

  offchannel TX as well.


  [1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024


  Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/

  Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")

  Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>

  Link: https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- include/net
- net/mac80211
hunk_count: 6
covered_count: 2
