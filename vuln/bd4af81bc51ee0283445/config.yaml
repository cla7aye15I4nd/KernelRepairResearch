id: bd4af81bc51ee0283445
bug_link: https://syzkaller.appspot.com/bug?extid=bd4af81bc51ee0283445
title: general protection fault in nldev_stat_set_doit
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a4e63bce1414df7ab6eb82ca9feb8494ce13e554
fix_commit: 78f34a16c28654cb47791257006f90d0948f2f0c
datetime: '2020-03-04T14:17:10-04:00'
fix_commit_message: "RDMA/nldev: Fix crash when set a QP to a new counter but QPN\
  \ is missing\n\nThis fixes the kernel crash when a RDMA_NLDEV_CMD_STAT_SET command\
  \ is\nreceived, but the QP number parameter is not available.\n\n  iwpm_register_pid:\
  \ Unable to send a nlmsg (client = 2)\n  infiniband syz1: RDMA CMA: cma_listen_on_dev,\
  \ error -98\n  general protection fault, probably for non-canonical address 0xdffffc0000000000:\
  \ 0000 [#1] PREEMPT SMP KASAN\n  KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]\n\
  \  CPU: 0 PID: 9754 Comm: syz-executor069 Not tainted 5.6.0-rc2-syzkaller #0\n \
  \ Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google\
  \ 01/01/2011\n  RIP: 0010:nla_get_u32 include/net/netlink.h:1474 [inline]\n  RIP:\
  \ 0010:nldev_stat_set_doit+0x63c/0xb70 drivers/infiniband/core/nldev.c:1760\n  Code:\
  \ fc 01 0f 84 58 03 00 00 e8 41 83 bf fb 4c 8b a3 58 fd ff ff 48 b8 00 00 00 00\
  \ 00 fc ff df 49 8d 7c 24 04 48 89 fa 48 c1 ea 03 <0f> b6 14 02 48 89 f8 83 e0 07\
  \ 83 c0 03 38 d0 7c 08 84 d2 0f 85 6d\n  RSP: 0018:ffffc900068bf350 EFLAGS: 00010247\n\
  \  RAX: dffffc0000000000 RBX: ffffc900068bf728 RCX: ffffffff85b60470\n  RDX: 0000000000000000\
  \ RSI: ffffffff85b6047f RDI: 0000000000000004\n  RBP: ffffc900068bf750 R08: ffff88808c3ee140\
  \ R09: ffff8880a25e6010\n  R10: ffffed10144bcddc R11: ffff8880a25e6ee3 R12: 0000000000000000\n\
  \  R13: ffff88809acb0000 R14: ffff888092a42c80 R15: 000000009ef2e29a\n  FS:  0000000001ff0880(0000)\
  \ GS:ffff8880ae800000(0000) knlGS:0000000000000000\n  CS:  0010 DS: 0000 ES: 0000\
  \ CR0: 0000000080050033\n  CR2: 00007f4733e34000 CR3: 00000000a9b27000 CR4: 00000000001406f0\n\
  \  DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n  DR3: 0000000000000000\
  \ DR6: 00000000fffe0ff0 DR7: 0000000000000400\n  Call Trace:\n    rdma_nl_rcv_msg\
  \ drivers/infiniband/core/netlink.c:195 [inline]\n    rdma_nl_rcv_skb drivers/infiniband/core/netlink.c:239\
  \ [inline]\n    rdma_nl_rcv+0x5d9/0x980 drivers/infiniband/core/netlink.c:259\n\
  \    netlink_unicast_kernel net/netlink/af_netlink.c:1303 [inline]\n    netlink_unicast+0x59e/0x7e0\
  \ net/netlink/af_netlink.c:1329\n    netlink_sendmsg+0x91c/0xea0 net/netlink/af_netlink.c:1918\n\
  \    sock_sendmsg_nosec net/socket.c:652 [inline]\n    sock_sendmsg+0xd7/0x130 net/socket.c:672\n\
  \    ____sys_sendmsg+0x753/0x880 net/socket.c:2343\n    ___sys_sendmsg+0x100/0x170\
  \ net/socket.c:2397\n    __sys_sendmsg+0x105/0x1d0 net/socket.c:2430\n    __do_sys_sendmsg\
  \ net/socket.c:2439 [inline]\n    __se_sys_sendmsg net/socket.c:2437 [inline]\n\
  \    __x64_sys_sendmsg+0x78/0xb0 net/socket.c:2437\n    do_syscall_64+0xfa/0x790\
  \ arch/x86/entry/common.c:294\n    entry_SYSCALL_64_after_hwframe+0x49/0xbe\n  RIP:\
  \ 0033:0x4403d9\n  Code: 18 89 d0 c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 48 89\
  \ f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01\
  \ f0 ff ff 0f 83 fb 13 fc ff c3 66 2e 0f 1f 84 00 00 00 00\n  RSP: 002b:00007ffc0efbc5c8\
  \ EFLAGS: 00000246 ORIG_RAX: 000000000000002e\n  RAX: ffffffffffffffda RBX: 00000000004002c8\
  \ RCX: 00000000004403d9\n  RDX: 0000000000000000 RSI: 0000000020000240 RDI: 0000000000000004\n\
  \  RBP: 00000000006ca018 R08: 0000000000000008 R09: 00000000004002c8\n  R10: 000000000000004a\
  \ R11: 0000000000000246 R12: 0000000000401c60\n  R13: 0000000000401cf0 R14: 0000000000000000\
  \ R15: 0000000000000000\n\nFixes: b389327df905 (\"RDMA/nldev: Allow counter manual\
  \ mode configration through RDMA netlink\")\nLink: https://lore.kernel.org/r/20200227125111.99142-1-leon@kernel.org\n\
  Reported-by: syzbot+bd4af81bc51ee0283445@syzkaller.appspotmail.com\nSigned-off-by:\
  \ Mark Zhang <markz@mellanox.com>\nSigned-off-by: Leon Romanovsky <leonro@mellanox.com>\n\
  Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>\n"
submodule:
- drivers/infiniband/core
hunk_count: 1
covered_count: 1
