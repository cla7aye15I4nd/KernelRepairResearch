id: 72db9ee39db57c3fecc5
bug_link: https://syzkaller.appspot.com/bug?extid=72db9ee39db57c3fecc5
title: WARNING in est_timer
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c407beb5b883b8b89c9372e588bad5634a30927a
fix_commit: 9f74c0ea9b26d1505d55b61e36b1623dd347e1d1
datetime: '2025-08-29T19:04:20-07:00'
fix_commit_message: "net_sched: gen_estimator: fix est_timer() vs CONFIG_PREEMPT_RT=y\n\
  \nsyzbot reported a WARNING in est_timer() [1]\n\nProblem here is that with CONFIG_PREEMPT_RT=y,\
  \ timer callbacks\ncan be preempted.\n\nAdopt preempt_disable_nested()/preempt_enable_nested()\
  \ to fix this.\n\n[1]\n WARNING: CPU: 0 PID: 16 at ./include/linux/seqlock.h:221\
  \ __seqprop_assert include/linux/seqlock.h:221 [inline]\n WARNING: CPU: 0 PID: 16\
  \ at ./include/linux/seqlock.h:221 est_timer+0x6dc/0x9f0 net/core/gen_estimator.c:93\n\
  Modules linked in:\nCPU: 0 UID: 0 PID: 16 Comm: ktimers/0 Not tainted syzkaller\
  \ #0 PREEMPT_{RT,(full)}\nHardware name: Google Google Compute Engine/Google Compute\
  \ Engine, BIOS Google 07/12/2025\n RIP: 0010:__seqprop_assert include/linux/seqlock.h:221\
  \ [inline]\n RIP: 0010:est_timer+0x6dc/0x9f0 net/core/gen_estimator.c:93\nCall Trace:\n\
  \ <TASK>\n  call_timer_fn+0x17e/0x5f0 kernel/time/timer.c:1747\n  expire_timers\
  \ kernel/time/timer.c:1798 [inline]\n  __run_timers kernel/time/timer.c:2372 [inline]\n\
  \  __run_timer_base+0x648/0x970 kernel/time/timer.c:2384\n  run_timer_base kernel/time/timer.c:2393\
  \ [inline]\n  run_timer_softirq+0xb7/0x180 kernel/time/timer.c:2403\n  handle_softirqs+0x22c/0x710\
  \ kernel/softirq.c:579\n  __do_softirq kernel/softirq.c:613 [inline]\n  run_ktimerd+0xcf/0x190\
  \ kernel/softirq.c:1043\n  smpboot_thread_fn+0x53f/0xa60 kernel/smpboot.c:160\n\
  \  kthread+0x70e/0x8a0 kernel/kthread.c:463\n  ret_from_fork+0x3fc/0x770 arch/x86/kernel/process.c:148\n\
  \  ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:245\n </TASK>\n\nFixes:\
  \ d2d6422f8bd1 (\"x86: Allow to enable PREEMPT_RT.\")\nReported-by: syzbot+72db9ee39db57c3fecc5@syzkaller.appspotmail.com\n\
  Closes: https://lore.kernel.org/netdev/68adf6fa.a70a0220.3cafd4.0000.GAE@google.com/T/#u\n\
  Signed-off-by: Eric Dumazet <edumazet@google.com>\nReviewed-by: Sebastian Andrzej\
  \ Siewior <bigeasy@linutronix.de>\nLink: https://patch.msgid.link/20250827162352.3960779-1-edumazet@google.com\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/core
hunk_count: 1
covered_count: 1
