id: 9e0404b505e604f67e41
bug_link: https://syzkaller.appspot.com/bug?extid=9e0404b505e604f67e41
title: 'KASAN: slab-use-after-free Read in percpu_ref_put'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 8ed823b19214e403ca485532f48c0e02035021ae
fix_commit: 0b50b7313ef2494926df30ce8e2ce284f1b847fc
datetime: '2024-08-22T02:07:23-04:00'
fix_commit_message: 'bcachefs: Fix refcounting in discard path


  bch_dev->io_ref does not protect against the filesystem going away;

  bch_fs->writes does.


  Thus the filesystem write ref needs to be the last ref we release.


  Reported-by: syzbot+9e0404b505e604f67e41@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 0
