id: 6720d64f31c081c2f708
bug_link: https://syzkaller.appspot.com/bug?extid=6720d64f31c081c2f708
title: 'KASAN: use-after-free Read in sock_def_write_space (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 657237f56b26be2784cbf82867d65ebddff16539
fix_commit: af9f691f0f5bdd1ade65a7b84927639882d7c3e5
datetime: '2020-07-24T17:29:52-07:00'
fix_commit_message: 'qrtr: orphan socket in qrtr_release()


  We have to detach sock from socket in qrtr_release(),

  otherwise skb->sk may still reference to this socket

  when the skb is released in tun->queue, particularly

  sk->sk_wq still points to &sock->wq, which leads to

  a UAF.


  Reported-and-tested-by: syzbot+6720d64f31c081c2f708@syzkaller.appspotmail.com

  Fixes: 28fb4e59a47d ("net: qrtr: Expose tunneling endpoint to user space")

  Cc: Bjorn Andersson <bjorn.andersson@linaro.org>

  Cc: Eric Dumazet <eric.dumazet@gmail.com>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Reviewed-by: Eric Dumazet <edumazet@google.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/qrtr
hunk_count: 1
covered_count: 0
