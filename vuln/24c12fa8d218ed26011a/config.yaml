id: 24c12fa8d218ed26011a
bug_link: https://syzkaller.appspot.com/bug?extid=24c12fa8d218ed26011a
title: 'INFO: task hung in nbd_ioctl'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 962399bb7fbf5ce0c5b768ca7115614f31ff8f3f
fix_commit: cf1b2326b734896734c6e167e41766f9cee7686a
datetime: '2019-10-25T14:37:21-06:00'
fix_commit_message: 'nbd: verify socket is supported during setup


  nbd requires socket families to support the shutdown method so the nbd

  recv workqueue can be woken up from its sock_recvmsg call. If the socket

  does not support the callout we will leave recv works running or get hangs

  later when the device or module is removed.


  This adds a check during socket connection/reconnection to make sure the

  socket being passed in supports the needed callout.


  Reported-by: syzbot+24c12fa8d218ed26011a@syzkaller.appspotmail.com

  Fixes: e9e006f5fcf2 ("nbd: fix max number of supported devs")

  Tested-by: Richard W.M. Jones <rjones@redhat.com>

  Signed-off-by: Mike Christie <mchristi@redhat.com>

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- drivers/block
hunk_count: 3
covered_count: 0
