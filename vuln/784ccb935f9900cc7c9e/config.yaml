id: 784ccb935f9900cc7c9e
bug_link: https://syzkaller.appspot.com/bug?extid=784ccb935f9900cc7c9e
title: 'KASAN: use-after-free Write in hiddev_disconnect'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 84a4062632462c4320704fcdf8e99e89e94c0aba
fix_commit: 5c02c447eaeda29d3da121a2e17b97ccaf579b51
datetime: '2020-02-12T14:46:56+01:00'
fix_commit_message: 'HID: hiddev: Fix race in in hiddev_disconnect()


  Syzbot reports that "hiddev" is used after it''s free in hiddev_disconnect().

  The hiddev_disconnect() function sets "hiddev->exist = 0;" so

  hiddev_release() can free it as soon as we drop the "existancelock"

  lock.  This patch moves the mutex_unlock(&hiddev->existancelock) until

  after we have finished using it.


  Reported-by: syzbot+784ccb935f9900cc7c9e@syzkaller.appspotmail.com

  Fixes: 7f77897ef2b6 ("HID: hiddev: fix potential use-after-free")

  Suggested-by: Alan Stern <stern@rowland.harvard.edu>

  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>

  Signed-off-by: Jiri Kosina <jkosina@suse.cz>

  '
submodule:
- drivers/hid/usbhid
hunk_count: 1
covered_count: 1
