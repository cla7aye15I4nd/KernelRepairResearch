id: 11e05f04c15e03be5254
bug_link: https://syzkaller.appspot.com/bug?extid=11e05f04c15e03be5254
title: 'KASAN: use-after-free Read in __llc_lookup_established'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d0f068e5720ac4eea13e184bb7526848f189f909
fix_commit: 5a8e7aea953bdb6d4da13aff6f1e7f9c62023499
datetime: '2018-10-15T22:01:37-07:00'
fix_commit_message: 'llc: set SOCK_RCU_FREE in llc_sap_add_socket()


  WHen an llc sock is added into the sk_laddr_hash of an llc_sap,

  it is not marked with SOCK_RCU_FREE.


  This causes that the sock could be freed while it is still being

  read by __llc_lookup_established() with RCU read lock. sock is

  refcounted, but with RCU read lock, nothing prevents the readers

  getting a zero refcnt.


  Fix it by setting SOCK_RCU_FREE in llc_sap_add_socket().


  Reported-by: syzbot+11e05f04c15e03be5254@syzkaller.appspotmail.com

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/llc
hunk_count: 1
covered_count: 0
