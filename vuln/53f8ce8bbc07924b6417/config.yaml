id: 53f8ce8bbc07924b6417
bug_link: https://syzkaller.appspot.com/bug?extid=53f8ce8bbc07924b6417
title: 'BUG: using __this_cpu_read() in preemptible code in trace_hardirqs_on'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ed3e453798d4f81c99056aa09fcd79d0874a60fd
fix_commit: f8e48a3dca060e80f672d398d181db1298fbc86c
datetime: '2020-10-22T12:37:22+02:00'
fix_commit_message: 'lockdep: Fix preemption WARN for spurious IRQ-enable


  It is valid (albeit uncommon) to call local_irq_enable() without first

  having called local_irq_disable(). In this case we enter

  lockdep_hardirqs_on*() with IRQs enabled and trip a preemption warning

  for using __this_cpu_read().


  Use this_cpu_read() instead to avoid the warning.


  Fixes: 4d004099a6 ("lockdep: Fix lockdep recursion")

  Reported-by: syzbot+53f8ce8bbc07924b6417@syzkaller.appspotmail.com

  Reported-by: kernel test robot <lkp@intel.com>

  Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>

  '
submodule:
- kernel/locking
hunk_count: 2
covered_count: 2
