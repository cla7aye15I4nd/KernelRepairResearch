id: 85e58cdf5b3136471d4b
bug_link: https://syzkaller.appspot.com/bug?extid=85e58cdf5b3136471d4b
title: possible deadlock in ovl_copy_up_flags
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1613e604df0cd359cf2a7fbd9be7a0bcfacfabd0
fix_commit: db03d39053a97d2f2a6baec025ebdacbab5886d2
datetime: '2024-05-28T10:06:55+02:00'
fix_commit_message: 'ovl: fix copy-up in tmpfile


  Move ovl_copy_up() call outside of ovl_want_write()/ovl_drop_write()

  region, since copy up may also call ovl_want_write() resulting in recursive

  locking on sb->s_writers.


  Reported-and-tested-by: syzbot+85e58cdf5b3136471d4b@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/000000000000f6865106191c3e58@google.com/

  Fixes: 9a87907de359 ("ovl: implement tmpfile")

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  '
submodule:
- fs/overlayfs
hunk_count: 2
covered_count: 2
