id: 491c1b7565ba9069ecae
bug_link: https://syzkaller.appspot.com/bug?extid=491c1b7565ba9069ecae
title: general protection fault in xsk_map_update_elem
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 8a03222f508bf09e03cf38f6bd77b34b450c1d60
fix_commit: fcd30ae0665c778e283f73c1c885c7fd26d12ef2
datetime: '2019-09-25T22:14:16+02:00'
fix_commit_message: 'bpf/xskmap: Return ERR_PTR for failure case instead of NULL.


  When kzalloc() failed, NULL was returned to the caller, which

  tested the pointer with IS_ERR(), which didn''t match, so the

  pointer was used later, resulting in a NULL dereference.


  Return ERR_PTR(-ENOMEM) instead of NULL.


  Reported-by: syzbot+491c1b7565ba9069ecae@syzkaller.appspotmail.com

  Fixes: 0402acd683c6 ("xsk: remove AF_XDP socket from map when the socket is released")

  Signed-off-by: Jonathan Lemon <jonathan.lemon@gmail.com>

  Acked-by: Björn Töpel <bjorn.topel@intel.com>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
