id: a63a1f6a062033cf0f40
bug_link: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
title: 'KMSAN: uninit-value in br_dev_xmit (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: aea27a92a41dae14843f92c79e9e42d8f570105c
fix_commit: 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc
datetime: '2024-05-15T11:41:02+01:00'
fix_commit_message: "net: bridge: xmit: make sure we have at least eth header len\
  \ bytes\n\nsyzbot triggered an uninit value[1] error in bridge device's xmit path\n\
  by sending a short (less than ETH_HLEN bytes) skb. To fix it check if\nwe can actually\
  \ pull that amount instead of assuming.\n\nTested with dropwatch:\n drop at: br_dev_xmit+0xb93/0x12d0\
  \ [bridge] (0xffffffffc06739b3)\n origin: software\n timestamp: Mon May 13 11:31:53\
  \ 2024 778214037 nsec\n protocol: 0x88a8\n length: 2\n original length: 2\n drop\
  \ reason: PKT_TOO_SMALL\n\n[1]\nBUG: KMSAN: uninit-value in br_dev_xmit+0x61d/0x1cb0\
  \ net/bridge/br_device.c:65\n br_dev_xmit+0x61d/0x1cb0 net/bridge/br_device.c:65\n\
  \ __netdev_start_xmit include/linux/netdevice.h:4903 [inline]\n netdev_start_xmit\
  \ include/linux/netdevice.h:4917 [inline]\n xmit_one net/core/dev.c:3531 [inline]\n\
  \ dev_hard_start_xmit+0x247/0xa20 net/core/dev.c:3547\n __dev_queue_xmit+0x34db/0x5350\
  \ net/core/dev.c:4341\n dev_queue_xmit include/linux/netdevice.h:3091 [inline]\n\
  \ __bpf_tx_skb net/core/filter.c:2136 [inline]\n __bpf_redirect_common net/core/filter.c:2180\
  \ [inline]\n __bpf_redirect+0x14a6/0x1620 net/core/filter.c:2187\n ____bpf_clone_redirect\
  \ net/core/filter.c:2460 [inline]\n bpf_clone_redirect+0x328/0x470 net/core/filter.c:2432\n\
  \ ___bpf_prog_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997\n __bpf_prog_run512+0xb5/0xe0\
  \ kernel/bpf/core.c:2238\n bpf_dispatcher_nop_func include/linux/bpf.h:1234 [inline]\n\
  \ __bpf_prog_run include/linux/filter.h:657 [inline]\n bpf_prog_run include/linux/filter.h:664\
  \ [inline]\n bpf_test_run+0x499/0xc30 net/bpf/test_run.c:425\n bpf_prog_test_run_skb+0x14ea/0x1f20\
  \ net/bpf/test_run.c:1058\n bpf_prog_test_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269\n\
  \ __sys_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678\n __do_sys_bpf kernel/bpf/syscall.c:5767\
  \ [inline]\n __se_sys_bpf kernel/bpf/syscall.c:5765 [inline]\n __x64_sys_bpf+0xa0/0xe0\
  \ kernel/bpf/syscall.c:5765\n x64_sys_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls_64.h:322\n\
  \ do_syscall_x64 arch/x86/entry/common.c:52 [inline]\n do_syscall_64+0xcf/0x1e0\
  \ arch/x86/entry/common.c:83\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\n\nFixes:\
  \ 1da177e4c3f4 (\"Linux-2.6.12-rc2\")\nReported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com\n\
  Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40\nSigned-off-by:\
  \ Nikolay Aleksandrov <razor@blackwall.org>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/bridge
hunk_count: 2
covered_count: 2
