id: 6e95a4fabf88dc217145
bug_link: https://syzkaller.appspot.com/bug?extid=6e95a4fabf88dc217145
title: 'INFO: trying to register non-static key in red_destroy'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1255457429309e723b1ee619bb6bb94a9be2a939
fix_commit: 608b4adab17889576c6636311f495b1a52418c69
datetime: '2020-07-28T17:41:23-07:00'
fix_commit_message: 'net_sched: initialize timer earlier in red_init()


  When red_init() fails, red_destroy() is called to clean up.

  If the timer is not initialized yet, del_timer_sync() will

  complain. So we have to move timer_setup() before any failure.


  Reported-and-tested-by: syzbot+6e95a4fabf88dc217145@syzkaller.appspotmail.com

  Fixes: aee9caa03fc3 ("net: sched: sch_red: Add qevents "early_drop" and "mark"")

  Cc: Petr Machata <petrm@mellanox.com>

  Cc: Jamal Hadi Salim <jhs@mojatatu.com>

  Cc: Jiri Pirko <jiri@resnulli.us>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Reviewed-by: Petr Machata <petrm@mellanox.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 2
covered_count: 0
