id: 5d6e4af21385f5cfc56a
bug_link: https://syzkaller.appspot.com/bug?extid=5d6e4af21385f5cfc56a
title: memory leak in qrtr_tun_open
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 92584ddf550ae72d492858c19d1f9025e07a9350
fix_commit: fc0494ead6398609c49afa37bc949b61c5c16b91
datetime: '2021-02-23T15:38:22-08:00'
fix_commit_message: "net: qrtr: Fix memory leak in qrtr_tun_open\n\nIf qrtr_endpoint_register()\
  \ failed, tun is leaked.\nFix this, by freeing tun in error path.\n\nsyzbot report:\n\
  BUG: memory leak\nunreferenced object 0xffff88811848d680 (size 64):\n  comm \"syz-executor684\"\
  , pid 10171, jiffies 4294951561 (age 26.070s)\n  hex dump (first 32 bytes):\n  \
  \  80 dd 0a 84 ff ff ff ff 00 00 00 00 00 00 00 00  ................\n    90 d6\
  \ 48 18 81 88 ff ff 90 d6 48 18 81 88 ff ff  ..H.......H.....\n  backtrace:\n  \
  \  [<0000000018992a50>] kmalloc include/linux/slab.h:552 [inline]\n    [<0000000018992a50>]\
  \ kzalloc include/linux/slab.h:682 [inline]\n    [<0000000018992a50>] qrtr_tun_open+0x22/0x90\
  \ net/qrtr/tun.c:35\n    [<0000000003a453ef>] misc_open+0x19c/0x1e0 drivers/char/misc.c:141\n\
  \    [<00000000dec38ac8>] chrdev_open+0x10d/0x340 fs/char_dev.c:414\n    [<0000000079094996>]\
  \ do_dentry_open+0x1e6/0x620 fs/open.c:817\n    [<000000004096d290>] do_open fs/namei.c:3252\
  \ [inline]\n    [<000000004096d290>] path_openat+0x74a/0x1b00 fs/namei.c:3369\n\
  \    [<00000000b8e64241>] do_filp_open+0xa0/0x190 fs/namei.c:3396\n    [<00000000a3299422>]\
  \ do_sys_openat2+0xed/0x230 fs/open.c:1172\n    [<000000002c1bdcef>] do_sys_open\
  \ fs/open.c:1188 [inline]\n    [<000000002c1bdcef>] __do_sys_openat fs/open.c:1204\
  \ [inline]\n    [<000000002c1bdcef>] __se_sys_openat fs/open.c:1199 [inline]\n \
  \   [<000000002c1bdcef>] __x64_sys_openat+0x7f/0xe0 fs/open.c:1199\n    [<00000000f3a5728f>]\
  \ do_syscall_64+0x2d/0x70 arch/x86/entry/common.c:46\n    [<000000004b38b7ec>] entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\
  \nFixes: 28fb4e59a47d (\"net: qrtr: Expose tunneling endpoint to user space\")\n\
  Reported-by: syzbot+5d6e4af21385f5cfc56a@syzkaller.appspotmail.com\nSigned-off-by:\
  \ Takeshi Misawa <jeliantsurux@gmail.com>\nLink: https://lore.kernel.org/r/20210221234427.GA2140@DESKTOP\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/qrtr
hunk_count: 2
covered_count: 2
