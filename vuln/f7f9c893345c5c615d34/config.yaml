id: f7f9c893345c5c615d34
bug_link: https://syzkaller.appspot.com/bug?extid=f7f9c893345c5c615d34
title: WARNING in io_cqring_event_overflow (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 8515f1661ca1f9ad63850a5e1e86599399420d2e
fix_commit: 3b7c16be30e35ec035b2efcc0f7d7b368789c443
datetime: '2024-07-02T08:48:17-06:00'
fix_commit_message: "io_uring/msg_ring: fix overflow posting\n\nThe caller of io_cqring_event_overflow()\
  \ should be holding the\ncompletion_lock, which is violated by io_msg_tw_complete.\
  \ There\nis only one caller of io_add_aux_cqe(), so just add locking there\nfor\
  \ now.\n\nWARNING: CPU: 0 PID: 5145 at io_uring/io_uring.c:703 io_cqring_event_overflow+0x442/0x660\
  \ io_uring/io_uring.c:703\nRIP: 0010:io_cqring_event_overflow+0x442/0x660 io_uring/io_uring.c:703\n\
  \ <TASK>\n __io_post_aux_cqe io_uring/io_uring.c:816 [inline]\n io_add_aux_cqe+0x27c/0x320\
  \ io_uring/io_uring.c:837\n io_msg_tw_complete+0x9d/0x4d0 io_uring/msg_ring.c:78\n\
  \ io_fallback_req_func+0xce/0x1c0 io_uring/io_uring.c:256\n process_one_work kernel/workqueue.c:3224\
  \ [inline]\n process_scheduled_works+0xa2c/0x1830 kernel/workqueue.c:3305\n worker_thread+0x86d/0xd40\
  \ kernel/workqueue.c:3383\n kthread+0x2f0/0x390 kernel/kthread.c:389\n ret_from_fork+0x4b/0x80\
  \ arch/x86/kernel/process.c:144\n ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244\n\
  \ </TASK>\n\nFixes: f33096a3c99c0 (\"io_uring: add io_add_aux_cqe() helper\")\n\
  Reported-by: syzbot+f7f9c893345c5c615d34@syzkaller.appspotmail.com\nSigned-off-by:\
  \ Pavel Begunkov <asml.silence@gmail.com>\nLink: https://lore.kernel.org/r/c7350d07fefe8cce32b50f57665edbb6355ea8c1.1719927398.git.asml.silence@gmail.com\n\
  Signed-off-by: Jens Axboe <axboe@kernel.dk>\n"
submodule:
- io_uring
hunk_count: 1
covered_count: 1
