id: 83f2d54ec6b7e417e13f
bug_link: https://syzkaller.appspot.com/bug?extid=83f2d54ec6b7e417e13f
title: WARNING in batadv_mcast_mla_tt_retract
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bdc76fd299600736e832f1525f4f23dd210b97cb
fix_commit: a3c7cd0cdf1107f891aff847ad481e34df727055
datetime: '2019-05-06T11:40:46+02:00'
fix_commit_message: 'batman-adv: mcast: fix multicast tt/tvlv worker locking


  Syzbot has reported some issues with the locking assumptions made for

  the multicast tt/tvlv worker: It was able to trigger the WARN_ON() in

  batadv_mcast_mla_tt_retract() and batadv_mcast_mla_tt_add().

  While hard/not reproduceable for us so far it seems that the

  delayed_work_pending() we use might not be quite safe from reordering.


  Therefore this patch adds an explicit, new spinlock to protect the

  update of the mla_list and flags in bat_priv and then removes the

  WARN_ON(delayed_work_pending()).


  Reported-by: syzbot+83f2d54ec6b7e417e13f@syzkaller.appspotmail.com

  Reported-by: syzbot+050927a651272b145a5d@syzkaller.appspotmail.com

  Reported-by: syzbot+979ffc89b87309b1b94b@syzkaller.appspotmail.com

  Reported-by: syzbot+f9f3f388440283da2965@syzkaller.appspotmail.com

  Fixes: cbebd363b2e9 ("batman-adv: Use own timer for multicast TT and TVLV updates")

  Signed-off-by: Linus LÃ¼ssing <linus.luessing@c0d3.blue>

  Signed-off-by: Sven Eckelmann <sven@narfation.org>

  Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>

  '
submodule:
- net/batman-adv
hunk_count: 7
covered_count: 5
