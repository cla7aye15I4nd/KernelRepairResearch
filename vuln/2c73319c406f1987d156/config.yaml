id: 2c73319c406f1987d156
bug_link: https://syzkaller.appspot.com/bug?extid=2c73319c406f1987d156
title: 'bpf-next boot error: KASAN: use-after-free Write in call_usermodehelper_exec_work'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2ac0e1524d9585f5261cebecca262da6cedc1d85
fix_commit: bf956be520fb534510e31564231163aa05f7f091
datetime: '2018-06-07T16:56:28-04:00'
fix_commit_message: "umh: fix race condition\n\nkasan reported use-after-free:\nBUG:\
  \ KASAN: use-after-free in call_usermodehelper_exec_work+0x2d3/0x310 kernel/umh.c:195\n\
  Write of size 4 at addr ffff8801d9202370 by task kworker/u4:2/50\nWorkqueue: events_unbound\
  \ call_usermodehelper_exec_work\nCall Trace:\n __dump_stack lib/dump_stack.c:77\
  \ [inline]\n dump_stack+0x1b9/0x294 lib/dump_stack.c:113\n print_address_description+0x6c/0x20b\
  \ mm/kasan/report.c:256\n kasan_report_error mm/kasan/report.c:354 [inline]\n kasan_report.cold.7+0x242/0x2fe\
  \ mm/kasan/report.c:412\n __asan_report_store4_noabort+0x17/0x20 mm/kasan/report.c:437\n\
  \ call_usermodehelper_exec_work+0x2d3/0x310 kernel/umh.c:195\n process_one_work+0xc1e/0x1b50\
  \ kernel/workqueue.c:2145\n worker_thread+0x1cc/0x1440 kernel/workqueue.c:2279\n\
  \ kthread+0x345/0x410 kernel/kthread.c:240\n ret_from_fork+0x3a/0x50 arch/x86/entry/entry_64.S:412\n\
  \nThe reason is that 'sub_info' cannot be accessed out of parent task\ncontext,\
  \ since it will be freed by the child.\nInstead remember the pid in the child task.\n\
  \nFixes: 449325b52b7a (\"umh: introduce fork_usermode_blob() helper\")\nReported-by:\
  \ syzbot+2c73319c406f1987d156@syzkaller.appspotmail.com\nSigned-off-by: Alexei Starovoitov\
  \ <ast@kernel.org>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- kernel
hunk_count: 2
covered_count: 2
