id: c74c24b43c9ae534f0e0
bug_link: https://syzkaller.appspot.com/bug?extid=c74c24b43c9ae534f0e0
title: 'KMSAN: uninit-value in smsc95xx_reset'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9f771493da935299c6393ad3563b581255d01a37
fix_commit: 51a32e828109b4a209efde44505baa356b37a4ce
datetime: '2023-10-22T11:39:26+01:00'
fix_commit_message: "net: usb: smsc95xx: Fix uninit-value access in smsc95xx_read_reg\n\
  \nsyzbot reported the following uninit-value access issue [1]:\n\nsmsc95xx 1-1:0.0\
  \ (unnamed net_device) (uninitialized): Failed to read reg index 0x00000030: -32\n\
  smsc95xx 1-1:0.0 (unnamed net_device) (uninitialized): Error reading E2P_CMD\n=====================================================\n\
  BUG: KMSAN: uninit-value in smsc95xx_reset+0x409/0x25f0 drivers/net/usb/smsc95xx.c:896\n\
  \ smsc95xx_reset+0x409/0x25f0 drivers/net/usb/smsc95xx.c:896\n smsc95xx_bind+0x9bc/0x22e0\
  \ drivers/net/usb/smsc95xx.c:1131\n usbnet_probe+0x100b/0x4060 drivers/net/usb/usbnet.c:1750\n\
  \ usb_probe_interface+0xc75/0x1210 drivers/usb/core/driver.c:396\n really_probe+0x506/0xf40\
  \ drivers/base/dd.c:658\n __driver_probe_device+0x2a7/0x5d0 drivers/base/dd.c:800\n\
  \ driver_probe_device+0x72/0x7b0 drivers/base/dd.c:830\n __device_attach_driver+0x55a/0x8f0\
  \ drivers/base/dd.c:958\n bus_for_each_drv+0x3ff/0x620 drivers/base/bus.c:457\n\
  \ __device_attach+0x3bd/0x640 drivers/base/dd.c:1030\n device_initial_probe+0x32/0x40\
  \ drivers/base/dd.c:1079\n bus_probe_device+0x3d8/0x5a0 drivers/base/bus.c:532\n\
  \ device_add+0x16ae/0x1f20 drivers/base/core.c:3622\n usb_set_configuration+0x31c9/0x38c0\
  \ drivers/usb/core/message.c:2207\n usb_generic_driver_probe+0x109/0x2a0 drivers/usb/core/generic.c:238\n\
  \ usb_probe_device+0x290/0x4a0 drivers/usb/core/driver.c:293\n really_probe+0x506/0xf40\
  \ drivers/base/dd.c:658\n __driver_probe_device+0x2a7/0x5d0 drivers/base/dd.c:800\n\
  \ driver_probe_device+0x72/0x7b0 drivers/base/dd.c:830\n __device_attach_driver+0x55a/0x8f0\
  \ drivers/base/dd.c:958\n bus_for_each_drv+0x3ff/0x620 drivers/base/bus.c:457\n\
  \ __device_attach+0x3bd/0x640 drivers/base/dd.c:1030\n device_initial_probe+0x32/0x40\
  \ drivers/base/dd.c:1079\n bus_probe_device+0x3d8/0x5a0 drivers/base/bus.c:532\n\
  \ device_add+0x16ae/0x1f20 drivers/base/core.c:3622\n usb_new_device+0x15f6/0x22f0\
  \ drivers/usb/core/hub.c:2589\n hub_port_connect drivers/usb/core/hub.c:5440 [inline]\n\
  \ hub_port_connect_change drivers/usb/core/hub.c:5580 [inline]\n port_event drivers/usb/core/hub.c:5740\
  \ [inline]\n hub_event+0x53bc/0x7290 drivers/usb/core/hub.c:5822\n process_one_work\
  \ kernel/workqueue.c:2630 [inline]\n process_scheduled_works+0x104e/0x1e70 kernel/workqueue.c:2703\n\
  \ worker_thread+0xf45/0x1490 kernel/workqueue.c:2784\n kthread+0x3e8/0x540 kernel/kthread.c:388\n\
  \ ret_from_fork+0x66/0x80 arch/x86/kernel/process.c:147\n ret_from_fork_asm+0x11/0x20\
  \ arch/x86/entry/entry_64.S:304\n\nLocal variable buf.i225 created at:\n smsc95xx_read_reg\
  \ drivers/net/usb/smsc95xx.c:90 [inline]\n smsc95xx_reset+0x203/0x25f0 drivers/net/usb/smsc95xx.c:892\n\
  \ smsc95xx_bind+0x9bc/0x22e0 drivers/net/usb/smsc95xx.c:1131\n\nCPU: 1 PID: 773\
  \ Comm: kworker/1:2 Not tainted 6.6.0-rc1-syzkaller-00125-ge42bebf6db29 #0\nHardware\
  \ name: Google Google Compute Engine/Google Compute Engine, BIOS Google 08/04/2023\n\
  Workqueue: usb_hub_wq hub_event\n=====================================================\n\
  \nSimilar to e9c65989920f (\"net: usb: smsc75xx: Fix uninit-value access in\n__smsc75xx_read_reg\"\
  ), this issue is caused because usbnet_read_cmd() reads\nless bytes than requested\
  \ (zero byte in the reproducer). In this case,\n'buf' is not properly filled.\n\n\
  This patch fixes the issue by returning -ENODATA if usbnet_read_cmd() reads\nless\
  \ bytes than requested.\n\nsysbot reported similar uninit-value access issue [2].\
  \ The root cause is\nthe same as mentioned above, and this patch addresses it as\
  \ well.\n\nFixes: 2f7ca802bdae (\"net: Add SMSC LAN9500 USB2.0 10/100 ethernet adapter\
  \ driver\")\nReported-and-tested-by: syzbot+c74c24b43c9ae534f0e0@syzkaller.appspotmail.com\n\
  Reported-and-tested-by: syzbot+2c97a98a5ba9ea9c23bd@syzkaller.appspotmail.com\n\
  Closes: https://syzkaller.appspot.com/bug?extid=c74c24b43c9ae534f0e0 [1]\nCloses:\
  \ https://syzkaller.appspot.com/bug?extid=2c97a98a5ba9ea9c23bd [2]\nSigned-off-by:\
  \ Shigeru Yoshida <syoshida@redhat.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- drivers/net/usb
hunk_count: 1
covered_count: 1
