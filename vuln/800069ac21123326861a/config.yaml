id: 800069ac21123326861a
bug_link: https://syzkaller.appspot.com/bug?extid=800069ac21123326861a
title: WARNING in lockdep_unregister_key (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 618d919cae2fcaadc752f27ddac8b939da8b441a
fix_commit: 8b39adbee805c539a461dbf208b125b096152b1c
datetime: '2019-04-16T08:21:51+02:00'
fix_commit_message: "locking/lockdep: Make lockdep_unregister_key() honor 'debug_locks'\
  \ again\n\nIf lockdep_register_key() and lockdep_unregister_key() are called with\n\
  debug_locks == false then the following warning is reported:\n\n  WARNING: CPU:\
  \ 2 PID: 15145 at kernel/locking/lockdep.c:4920 lockdep_unregister_key+0x1ad/0x240\n\
  \nThat warning is reported because lockdep_unregister_key() ignores the\nvalue of\
  \ 'debug_locks' and because the behavior of lockdep_register_key()\ndepends on whether\
  \ or not 'debug_locks' is set. Fix this inconsistency\nby making lockdep_unregister_key()\
  \ take 'debug_locks' again into\naccount.\n\nSigned-off-by: Bart Van Assche <bvanassche@acm.org>\n\
  Cc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Peter Zijlstra <peterz@infradead.org>\n\
  Cc: Thomas Gleixner <tglx@linutronix.de>\nCc: Waiman Long <longman@redhat.com>\n\
  Cc: Will Deacon <will.deacon@arm.com>\nCc: shenghui <shhuiw@foxmail.com>\nFixes:\
  \ 90c1cba2b3b3 (\"locking/lockdep: Zap lock classes even with lock debugging disabled\"\
  )\nLink: http://lkml.kernel.org/r/20190415170538.23491-1-bvanassche@acm.org\nSigned-off-by:\
  \ Ingo Molnar <mingo@kernel.org>\n"
submodule:
- kernel/locking
hunk_count: 2
covered_count: 2
