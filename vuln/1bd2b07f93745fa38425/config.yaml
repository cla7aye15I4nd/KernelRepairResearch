id: 1bd2b07f93745fa38425
bug_link: https://syzkaller.appspot.com/bug?extid=1bd2b07f93745fa38425
title: WARNING in rds_rdma_extra_size
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 43f4a20a1266d393840ce010f547486d14cc0071
fix_commit: a11148e6fcce2ae53f47f0a442d098d860b4f7db
datetime: '2021-02-02T08:44:08-08:00'
fix_commit_message: "net/rds: restrict iovecs length for RDS_CMSG_RDMA_ARGS\n\nsyzbot\
  \ found WARNING in rds_rdma_extra_size [1] when RDS_CMSG_RDMA_ARGS\ncontrol message\
  \ is passed with user-controlled\n0x40001 bytes of args->nr_local, causing order\
  \ >= MAX_ORDER condition.\n\nThe exact value 0x40001 can be checked with UIO_MAXIOV\
  \ which is 0x400.\nSo for kcalloc() 0x400 iovecs with sizeof(struct rds_iovec) =\
  \ 0x10\nis the closest limit, with 0x10 leftover.\n\nSame condition is currently\
  \ done in rds_cmsg_rdma_args().\n\n[1] WARNING: mm/page_alloc.c:5011\n[..]\nCall\
  \ Trace:\n alloc_pages_current+0x18c/0x2a0 mm/mempolicy.c:2267\n alloc_pages include/linux/gfp.h:547\
  \ [inline]\n kmalloc_order+0x2e/0xb0 mm/slab_common.c:837\n kmalloc_order_trace+0x14/0x120\
  \ mm/slab_common.c:853\n kmalloc_array include/linux/slab.h:592 [inline]\n kcalloc\
  \ include/linux/slab.h:621 [inline]\n rds_rdma_extra_size+0xb2/0x3b0 net/rds/rdma.c:568\n\
  \ rds_rm_size net/rds/send.c:928 [inline]\n\nReported-by: syzbot+1bd2b07f93745fa38425@syzkaller.appspotmail.com\n\
  Signed-off-by: Sabyrzhan Tasbolatov <snovitoll@gmail.com>\nAcked-by: Santosh Shilimkar\
  \ <santosh.shilimkar@oracle.com>\nLink: https://lore.kernel.org/r/20210201203233.1324704-1-snovitoll@gmail.com\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/rds
hunk_count: 1
covered_count: 1
