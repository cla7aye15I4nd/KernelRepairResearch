id: b296579ba5015704d9fa
bug_link: https://syzkaller.appspot.com/bug?extid=b296579ba5015704d9fa
title: general protection fault in free_verifier_state (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 05d57f1793fb250c85028c9952c3720010baa853
fix_commit: f59bbfc2f6099e8655f9e8f585e10ffde17176d0
datetime: '2020-01-22T12:09:02+01:00'
fix_commit_message: 'bpf: Fix error path under memory pressure


  Restore the ''if (env->cur_state)'' check that was incorrectly removed during

  code move. Under memory pressure env->cur_state can be freed and zeroed inside

  do_check(). Hence the check is necessary.


  Fixes: 51c39bb1d5d1 ("bpf: Introduce function-by-function verification")

  Reported-by: syzbot+b296579ba5015704d9fa@syzkaller.appspotmail.com

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  Acked-by: Song Liu <songliubraving@fb.com>

  Link: https://lore.kernel.org/bpf/20200122024138.3385590-1-ast@kernel.org

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
