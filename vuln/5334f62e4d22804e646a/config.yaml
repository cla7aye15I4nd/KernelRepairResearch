id: 5334f62e4d22804e646a
bug_link: https://syzkaller.appspot.com/bug?extid=5334f62e4d22804e646a
title: 'KASAN: use-after-free Write in xp_put_pool'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1d6fd78a213ee3874f46bdce083b7a41d208886d
fix_commit: 83cf5c68d663fc78ce529c41bf24f9f6be88bef4
datetime: '2020-09-02T23:37:19+02:00'
fix_commit_message: 'xsk: Fix use-after-free in failed shared_umem bind


  Fix use-after-free when a shared umem bind fails. The code incorrectly

  tried to free the allocated buffer pool both in the bind code and then

  later also when the socket was released. Fix this by setting the

  buffer pool pointer to NULL after the bind code has freed the pool, so

  that the socket release code will not try to free the pool. This is

  the same solution as the regular, non-shared umem code path has. This

  was missing from the shared umem path.


  Fixes: b5aea28dca13 ("xsk: Add shared umem support between queue ids")

  Reported-by: syzbot+5334f62e4d22804e646a@syzkaller.appspotmail.com

  Signed-off-by: Magnus Karlsson <magnus.karlsson@intel.com>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  Link: https://lore.kernel.org/bpf/1599032164-25684-1-git-send-email-magnus.karlsson@intel.com

  '
submodule:
- net/xdp
hunk_count: 1
covered_count: 1
