id: d0cf0ad6513e9a1da5df
bug_link: https://syzkaller.appspot.com/bug?extid=d0cf0ad6513e9a1da5df
title: WARNING in pstore_kill_sb
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 19d8e9149c27b689c6224f5c84b96a159342195a
fix_commit: 9c7d83ae6ba67d6c6199cce24573983db3b56332
datetime: '2021-02-23T09:27:20-08:00'
fix_commit_message: 'pstore: Fix warning in pstore_kill_sb()


  syzbot is hitting WARN_ON(pstore_sb != sb) at pstore_kill_sb() [1], for the

  assumption that pstore_sb != NULL is wrong because pstore_fill_super() will

  not assign pstore_sb = sb when new_inode() for d_make_root() returned NULL

  (due to memory allocation fault injection).


  Since mount_single() calls pstore_kill_sb() when pstore_fill_super()

  failed, pstore_kill_sb() needs to be aware of such failure path.


  [1] https://syzkaller.appspot.com/bug?id=6abacb8da5137cb47a416f2bef95719ed60508a0


  Reported-by: syzbot <syzbot+d0cf0ad6513e9a1da5df@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Signed-off-by: Kees Cook <keescook@chromium.org>

  Link: https://lore.kernel.org/r/20210214031307.57903-1-penguin-kernel@I-love.SAKURA.ne.jp

  '
submodule:
- fs/pstore
hunk_count: 1
covered_count: 1
