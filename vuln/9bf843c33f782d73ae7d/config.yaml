id: 9bf843c33f782d73ae7d
bug_link: https://syzkaller.appspot.com/bug?extid=9bf843c33f782d73ae7d
title: 'BUG: sleeping function called from invalid context at mm/slab.h:LINE (4)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c9613335bf4fe259a654aa0e9701f0c4cddc12ba
fix_commit: f9c9bdb5131eee60dc3b92e5126d4c0e291703e2
datetime: '2018-12-23T11:52:44+08:00'
fix_commit_message: 'crypto: x86/chacha - avoid sleeping under kernel_fpu_begin()


  Passing atomic=true to skcipher_walk_virt() only makes the later

  skcipher_walk_done() calls use atomic memory allocations, not

  skcipher_walk_virt() itself.  Thus, we have to move it outside of the

  preemption-disabled region (kernel_fpu_begin()/kernel_fpu_end()).


  (skcipher_walk_virt() only allocates memory for certain layouts of the

  input scatterlist, hence why I didn''t notice this earlier...)


  Reported-by: syzbot+9bf843c33f782d73ae7d@syzkaller.appspotmail.com

  Fixes: 4af78261870a ("crypto: x86/chacha20 - add XChaCha20 support")

  Signed-off-by: Eric Biggers <ebiggers@google.com>

  Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

  '
submodule:
- arch/x86/crypto
hunk_count: 6
covered_count: 6
