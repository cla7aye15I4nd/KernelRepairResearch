id: 803e0047ac3a3096bb4f
bug_link: https://syzkaller.appspot.com/bug?extid=803e0047ac3a3096bb4f
title: WARNING in snd_pcm_hw_params
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: e15dc99dbb9cf99f6432e8e3c0b3a8f7a3403a86
fix_commit: e1a3a981e320a6916b30ff53571ba144274def0e
datetime: '2018-04-09T17:39:31+02:00'
fix_commit_message: 'ALSA: pcm: Remove WARN_ON() at snd_pcm_hw_params() error


  snd_pcm_hw_params() (more exactly snd_pcm_hw_params_choose()) contains

  a check of the return error from snd_pcm_hw_param_first() and _last()

  with snd_BUG_ON() -- i.e. it may trigger WARN_ON() depending on the

  kconfig.


  This was a valid check in the past, as these functions shouldn''t

  return any error if the parameters have been already refined via

  snd_pcm_hw_refine() beforehand.  However, the recent rewrite

  introduced a kmalloc() in snd_pcm_hw_refine() for removing VLA, and

  this brought a possibility to trigger an error.  As a result, syzbot

  caught lots of superfluous kernel WARN_ON() and paniced via fault

  injection.


  As the WARN_ON() is no longer valid with the introduction of

  kmalloc(), let''s drop snd_BUG_ON() check, in order to make the world

  peaceful place again.


  Reported-by: syzbot+803e0047ac3a3096bb4f@syzkaller.appspotmail.com

  Fixes: 5730f9f744cf ("ALSA: pcm: Remove VLA usage")

  Signed-off-by: Takashi Iwai <tiwai@suse.de>

  '
submodule:
- sound/core
hunk_count: 1
covered_count: 1
