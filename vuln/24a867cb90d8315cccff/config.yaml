id: 24a867cb90d8315cccff
bug_link: https://syzkaller.appspot.com/bug?extid=24a867cb90d8315cccff
title: kernel BUG in bch2_bucket_alloc_trans
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a0bd30e4ea9da9499c5527dc84a0e2d291f273d2
fix_commit: 44ec5990357b9ebb8e5e88bb4f98a2746b938fab
datetime: '2024-06-28T19:47:31-04:00'
fix_commit_message: 'bcachefs: Don''t use the new_fs() bucket alloc path on an initialized
  fs


  On a new filesystem or device we have to allocate the journal with a

  bump allocator, because allocation info isn''t ready yet - but when

  hot-adding a device that doesn''t have a journal, we don''t want to use

  that path.


  Reported-by: syzbot+24a867cb90d8315cccff@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 6
covered_count: 0
