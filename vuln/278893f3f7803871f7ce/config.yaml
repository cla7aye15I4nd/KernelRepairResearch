id: 278893f3f7803871f7ce
bug_link: https://syzkaller.appspot.com/bug?extid=278893f3f7803871f7ce
title: 'WARNING: refcount bug in llc_sap_find'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 61ef4b07fcdc30535889990cf4229766502561cf
fix_commit: 0dcb82254d65f72333aa50ad626d1e9665ad093b
datetime: '2018-08-07T15:54:00-07:00'
fix_commit_message: 'llc: use refcount_inc_not_zero() for llc_sap_find()


  llc_sap_put() decreases the refcnt before deleting sap

  from the global list. Therefore, there is a chance

  llc_sap_find() could find a sap with zero refcnt

  in this global list.


  Close this race condition by checking if refcnt is zero

  or not in llc_sap_find(), if it is zero then it is being

  removed so we can just treat it as gone.


  Reported-by: <syzbot+278893f3f7803871f7ce@syzkaller.appspotmail.com>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- include/net
- net/llc
hunk_count: 2
covered_count: 2
