id: 205c2644abdff9d3f9fc
bug_link: https://syzkaller.appspot.com/bug?extid=205c2644abdff9d3f9fc
title: 'INFO: task hung in exfat_sync_fs'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 70465acbb0ce1bb69447acf32f136c8153cda0de
fix_commit: fee873761bd978d077d8c55334b4966ac4cb7b59
datetime: '2024-12-31T17:49:40+09:00'
fix_commit_message: 'exfat: fix the infinite loop in exfat_readdir()


  If the file system is corrupted so that a cluster is linked to

  itself in the cluster chain, and there is an unused directory

  entry in the cluster, ''dentry'' will not be incremented, causing

  condition ''dentry < max_dentries'' unable to prevent an infinite

  loop.


  This infinite loop causes s_lock not to be released, and other

  tasks will hang, such as exfat_sync_fs().


  This commit stops traversing the cluster chain when there is unused

  directory entry in the cluster to avoid this infinite loop.


  Reported-by: syzbot+205c2644abdff9d3f9fc@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=205c2644abdff9d3f9fc

  Tested-by: syzbot+205c2644abdff9d3f9fc@syzkaller.appspotmail.com

  Fixes: ca06197382bd ("exfat: add directory operations")

  Signed-off-by: Yuezhang Mo <Yuezhang.Mo@sony.com>

  Reviewed-by: Sungjong Seo <sj1557.seo@samsung.com>

  Signed-off-by: Namjae Jeon <linkinjeon@kernel.org>

  '
submodule:
- fs/exfat
hunk_count: 2
covered_count: 1
