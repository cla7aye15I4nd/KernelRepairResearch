id: 853d80cba98ce1157ae6
bug_link: https://syzkaller.appspot.com/bug?extid=853d80cba98ce1157ae6
title: 'KASAN: slab-use-after-free Read in add_ra_bio_pages (3)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 320d8dc612660da84c3b70a28658bb38069e5a9a
fix_commit: 8e7860543a94784d744c7ce34b78a2e11beefa5c
datetime: '2024-07-11T16:32:22+02:00'
fix_commit_message: 'btrfs: fix extent map use-after-free when adding pages to compressed
  bio


  At add_ra_bio_pages() we are accessing the extent map to calculate

  ''add_size'' after we dropped our reference on the extent map, resulting

  in a use-after-free. Fix this by computing ''add_size'' before dropping our

  extent map reference.


  Reported-by: syzbot+853d80cba98ce1157ae6@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/linux-btrfs/000000000000038144061c6d18f2@google.com/

  Fixes: 6a4049102055 ("btrfs: subpage: make add_ra_bio_pages() compatible")

  CC: stable@vger.kernel.org # 6.1+

  Signed-off-by: Filipe Manana <fdmanana@suse.com>

  Reviewed-by: David Sterba <dsterba@suse.com>

  Signed-off-by: David Sterba <dsterba@suse.com>

  '
submodule:
- fs/btrfs
hunk_count: 2
covered_count: 2
