id: c6e8fca81c294fd5620a
bug_link: https://syzkaller.appspot.com/bug?extid=c6e8fca81c294fd5620a
title: general protection fault in ieee80211_subif_start_xmit (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6788ba8aed4e28e90f72d68a9d794e34eac17295
fix_commit: 780854186946e0de2be192ee7fa5125666533b3a
datetime: '2022-11-02T09:46:11+01:00'
fix_commit_message: "wifi: mac80211: fix general-protection-fault in ieee80211_subif_start_xmit()\n\
  \nWhen device is running and the interface status is changed, the gpf issue\nis\
  \ triggered. The problem triggering process is as follows:\nThread A:          \
  \                 Thread B\nieee80211_runtime_change_iftype()   process_one_work()\n\
  \    ...                                 ...\n    ieee80211_do_stop()          \
  \       ...\n    ...                                 ...\n        sdata->bss = NULL\
  \               ...\n        ...                             ieee80211_subif_start_xmit()\n\
  \                                            ieee80211_multicast_to_unicast\n  \
  \                                  //!sdata->bss->multicast_to_unicast\n       \
  \                               cause gpf issue\n\nWhen the interface status is\
  \ changed, the sending queue continues to send\npackets. After the bss is set to\
  \ NULL, the bss is accessed. As a result,\nthis causes a general-protection-fault\
  \ issue.\n\nThe following is the stack information:\ngeneral protection fault, probably\
  \ for non-canonical address\n0xdffffc000000002f: 0000 [#1] PREEMPT SMP KASAN\nKASAN:\
  \ null-ptr-deref in range [0x0000000000000178-0x000000000000017f]\nWorkqueue: mld\
  \ mld_ifc_work\nRIP: 0010:ieee80211_subif_start_xmit+0x25b/0x1310\nCall Trace:\n\
  <TASK>\ndev_hard_start_xmit+0x1be/0x990\n__dev_queue_xmit+0x2c9a/0x3b60\nip6_finish_output2+0xf92/0x1520\n\
  ip6_finish_output+0x6af/0x11e0\nip6_output+0x1ed/0x540\nmld_sendpack+0xa09/0xe70\n\
  mld_ifc_work+0x71c/0xdb0\nprocess_one_work+0x9bf/0x1710\nworker_thread+0x665/0x1080\n\
  kthread+0x2e4/0x3a0\nret_from_fork+0x1f/0x30\n</TASK>\n\nFixes: f856373e2f31 (\"\
  wifi: mac80211: do not wake queues on a vif that is being stopped\")\nReported-by:\
  \ syzbot+c6e8fca81c294fd5620a@syzkaller.appspotmail.com\nSigned-off-by: Zhengchao\
  \ Shao <shaozhengchao@huawei.com>\nLink: https://lore.kernel.org/r/20221026063959.177813-1-shaozhengchao@huawei.com\n\
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>\n"
submodule:
- net/mac80211
hunk_count: 1
covered_count: 1
