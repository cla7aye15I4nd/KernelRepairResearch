id: 27771d4abcd9b7a1f5d3
bug_link: https://syzkaller.appspot.com/bug?extid=27771d4abcd9b7a1f5d3
title: 'WARNING: suspicious RCU usage in wiphy_apply_custom_regulatory'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 70b6ff35d62050d1573876cc0e1e078acd3e6008
fix_commit: 51d62f2f2c501a93d9a6a46f43731f984e227764
datetime: '2021-01-08T21:03:27+01:00'
fix_commit_message: 'cfg80211: Save the regulatory domain with a lock


  Saving the regulatory domain while setting custom regulatory domain

  was done while accessing a RCU protected pointer but without any

  protection.


  Fix this by using RTNL while accessing the pointer.


  Signed-off-by: Ilan Peer <ilan.peer@intel.com>

  Reported-by: syzbot+27771d4abcd9b7a1f5d3@syzkaller.appspotmail.com

  Reported-by: syzbot+db4035751c56c0079282@syzkaller.appspotmail.com

  Reported-by: Hans de Goede <hdegoede@redhat.com>

  Fixes: beee24695157 ("cfg80211: Save the regulatory domain when setting custom regulatory")

  Signed-off-by: Luca Coelho <luciano.coelho@intel.com>

  Link: https://lore.kernel.org/r/iwlwifi.20210105165657.613e9a876829.Ia38d27dbebea28bf9c56d70691d243186ede70e7@changeid

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- net/wireless
hunk_count: 3
covered_count: 3
