id: a2ff6fa45162a5ed4dd3
bug_link: https://syzkaller.appspot.com/bug?extid=a2ff6fa45162a5ed4dd3
title: memory leak in nf_tables_parse_netdev_hooks (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ee84f19cbbe9cf7cba2958acb03163fed3ecbb0f
fix_commit: 2d285f26ecd072800a29c5b71e63437f21ef830a
datetime: '2020-03-04T02:27:18+01:00'
fix_commit_message: 'netfilter: nf_tables: free flowtable hooks on hook register error


  If hook registration fails, the hooks allocated via nft_netdev_hook_alloc

  need to be freed.


  We can''t change the goto label to ''goto 5'' -- while it does fix the memleak

  it does cause a warning splat from the netfilter core (the hooks were not

  registered).


  Fixes: 3f0465a9ef02 ("netfilter: nf_tables: dynamically allocate hooks per net_device
  in flowtables")

  Reported-by: syzbot+a2ff6fa45162a5ed4dd3@syzkaller.appspotmail.com

  Signed-off-by: Florian Westphal <fw@strlen.de>

  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

  '
submodule:
- net/netfilter
hunk_count: 1
covered_count: 1
