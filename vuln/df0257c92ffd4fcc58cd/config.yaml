id: df0257c92ffd4fcc58cd
bug_link: https://syzkaller.appspot.com/bug?extid=df0257c92ffd4fcc58cd
title: 'KMSAN: uninit-value in strcmp'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4a026da91caaa36004a53a844dd00959370ea8fc
fix_commit: 94f6a80c0c11828cb7b3d79294459dd8d761ca89
datetime: '2018-05-10T08:25:13-04:00'
fix_commit_message: "tipc: eliminate KMSAN uninit-value in strcmp complaint\n\nWhen\
  \ we get link properties through netlink interface with\ntipc_nl_node_get_link(),\
  \ we don't validate TIPC_NLA_LINK_NAME\nattribute at all, instead we directly use\
  \ it. As a consequence,\nKMSAN detected the TIPC_NLA_LINK_NAME attribute was an\
  \ uninitialized\nvalue, and then posted the following complaint:\n\n==================================================================\n\
  BUG: KMSAN: uninit-value in strcmp+0xf7/0x160 lib/string.c:329\nCPU: 1 PID: 4527\
  \ Comm: syz-executor655 Not tainted 4.16.0+ #87\nHardware name: Google Google Compute\
  \ Engine/Google Compute Engine, BIOS\nGoogle 01/01/2011\nCall Trace:\n  __dump_stack\
  \ lib/dump_stack.c:17 [inline]\n  dump_stack+0x185/0x1d0 lib/dump_stack.c:53\n \
  \ kmsan_report+0x142/0x240 mm/kmsan/kmsan.c:1067\n  __msan_warning_32+0x6c/0xb0\
  \ mm/kmsan/kmsan_instr.c:683\n  strcmp+0xf7/0x160 lib/string.c:329\n  tipc_nl_node_get_link+0x220/0x6f0\
  \ net/tipc/node.c:1881\n  genl_family_rcv_msg net/netlink/genetlink.c:599 [inline]\n\
  \  genl_rcv_msg+0x1686/0x1810 net/netlink/genetlink.c:624\n  netlink_rcv_skb+0x378/0x600\
  \ net/netlink/af_netlink.c:2447\n  genl_rcv+0x63/0x80 net/netlink/genetlink.c:635\n\
  \  netlink_unicast_kernel net/netlink/af_netlink.c:1311 [inline]\n  netlink_unicast+0x166b/0x1740\
  \ net/netlink/af_netlink.c:1337\n  netlink_sendmsg+0x1048/0x1310 net/netlink/af_netlink.c:1900\n\
  \  sock_sendmsg_nosec net/socket.c:630 [inline]\n  sock_sendmsg net/socket.c:640\
  \ [inline]\n  ___sys_sendmsg+0xec0/0x1310 net/socket.c:2046\n  __sys_sendmsg net/socket.c:2080\
  \ [inline]\n  SYSC_sendmsg+0x2a3/0x3d0 net/socket.c:2091\n  SyS_sendmsg+0x54/0x80\
  \ net/socket.c:2087\n  do_syscall_64+0x309/0x430 arch/x86/entry/common.c:287\n \
  \ entry_SYSCALL_64_after_hwframe+0x3d/0xa2\nRIP: 0033:0x445589\nRSP: 002b:00007fb7ee66cdb8\
  \ EFLAGS: 00000246 ORIG_RAX: 000000000000002e\nRAX: ffffffffffffffda RBX: 00000000006dac24\
  \ RCX: 0000000000445589\nRDX: 0000000000000000 RSI: 0000000020023000 RDI: 0000000000000003\n\
  RBP: 00000000006dac20 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000\
  \ R11: 0000000000000246 R12: 0000000000000000\nR13: 00007fffa2bf3f3f R14: 00007fb7ee66d9c0\
  \ R15: 0000000000000001\n\nUninit was created at:\n  kmsan_save_stack_with_flags\
  \ mm/kmsan/kmsan.c:278 [inline]\n  kmsan_internal_poison_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188\n\
  \  kmsan_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314\n  kmsan_slab_alloc+0x11/0x20 mm/kmsan/kmsan.c:321\n\
  \  slab_post_alloc_hook mm/slab.h:445 [inline]\n  slab_alloc_node mm/slub.c:2737\
  \ [inline]\n  __kmalloc_node_track_caller+0xaed/0x11c0 mm/slub.c:4369\n  __kmalloc_reserve\
  \ net/core/skbuff.c:138 [inline]\n  __alloc_skb+0x2cf/0x9f0 net/core/skbuff.c:206\n\
  \  alloc_skb include/linux/skbuff.h:984 [inline]\n  netlink_alloc_large_skb net/netlink/af_netlink.c:1183\
  \ [inline]\n  netlink_sendmsg+0x9a6/0x1310 net/netlink/af_netlink.c:1875\n  sock_sendmsg_nosec\
  \ net/socket.c:630 [inline]\n  sock_sendmsg net/socket.c:640 [inline]\n  ___sys_sendmsg+0xec0/0x1310\
  \ net/socket.c:2046\n  __sys_sendmsg net/socket.c:2080 [inline]\n  SYSC_sendmsg+0x2a3/0x3d0\
  \ net/socket.c:2091\n  SyS_sendmsg+0x54/0x80 net/socket.c:2087\n  do_syscall_64+0x309/0x430\
  \ arch/x86/entry/common.c:287\n  entry_SYSCALL_64_after_hwframe+0x3d/0xa2\n==================================================================\n\
  \nTo quiet the complaint, TIPC_NLA_LINK_NAME attribute has been\nvalidated in tipc_nl_node_get_link()\
  \ before it's used.\n\nReported-by: syzbot+df0257c92ffd4fcc58cd@syzkaller.appspotmail.com\n\
  Signed-off-by: Ying Xue <ying.xue@windriver.com>\nSigned-off-by: David S. Miller\
  \ <davem@davemloft.net>\n"
submodule:
- net/tipc
hunk_count: 2
covered_count: 0
