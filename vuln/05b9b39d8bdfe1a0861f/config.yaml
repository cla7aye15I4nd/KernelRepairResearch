id: 05b9b39d8bdfe1a0861f
bug_link: https://syzkaller.appspot.com/bug?extid=05b9b39d8bdfe1a0861f
title: 'KASAN: null-ptr-deref Write in jbd2_journal_update_sb_log_tail'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 052a45c1cb1b32f05dd63a295d65496d8b403283
fix_commit: 5784d9fcfd43bd853654bb80c87ef293b9e8e80a
datetime: '2024-09-09T15:15:53-07:00'
fix_commit_message: "ocfs2: fix null-ptr-deref when journal load failed.\n\nDuring\
  \ the mounting process, if journal_reset() fails because of too short\njournal,\
  \ then lead to jbd2_journal_load() fails with NULL j_sb_buffer. \nSubsequently,\
  \ ocfs2_journal_shutdown() calls\njbd2_journal_flush()->jbd2_cleanup_journal_tail()->\n\
  __jbd2_update_log_tail()->jbd2_journal_update_sb_log_tail()\n->lock_buffer(journal->j_sb_buffer),\
  \ resulting in a null-pointer\ndereference error.\n\nTo resolve this issue, we should\
  \ check the JBD2_LOADED flag to ensure the\njournal was properly loaded.  Additionally,\
  \ use journal instead of\nosb->journal directly to simplify the code.\n\nLink: https://syzkaller.appspot.com/bug?extid=05b9b39d8bdfe1a0861f\n\
  Link: https://lkml.kernel.org/r/20240902030844.422725-1-sunjunchao2870@gmail.com\n\
  Fixes: f6f50e28f0cb (\"jbd2: Fail to load a journal if it is too short\")\nSigned-off-by:\
  \ Julian Sun <sunjunchao2870@gmail.com>\nReported-by: syzbot+05b9b39d8bdfe1a0861f@syzkaller.appspotmail.com\n\
  Suggested-by: Joseph Qi <joseph.qi@linux.alibaba.com>\nReviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>\n\
  Cc: Mark Fasheh <mark@fasheh.com>\nCc: Joel Becker <jlbec@evilplan.org>\nCc: Junxiao\
  \ Bi <junxiao.bi@oracle.com>\nCc: Changwei Ge <gechangwei@live.cn>\nCc: Gang He\
  \ <ghe@suse.com>\nCc: Jun Piao <piaojun@huawei.com>\nCc: <stable@vger.kernel.org>\n\
  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>\n"
submodule:
- fs/ocfs2
hunk_count: 2
covered_count: 2
