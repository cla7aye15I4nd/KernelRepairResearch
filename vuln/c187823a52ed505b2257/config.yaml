id: c187823a52ed505b2257
bug_link: https://syzkaller.appspot.com/bug?extid=c187823a52ed505b2257
title: WARNING in bond_xdp_get_xmit_slave (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 3b067536daa4842adbf685accf47c899a26367d3
fix_commit: 0cbfd45fbcf0cb26d85c981b91c62fe73cdee01c
datetime: '2024-09-24T15:19:50+02:00'
fix_commit_message: "bonding: Fix unnecessary warnings and logs from bond_xdp_get_xmit_slave()\n\
  \nsyzbot reported a WARNING in bond_xdp_get_xmit_slave. To reproduce\nthis[1], one\
  \ bond device (bond1) has xdpdrv, which increases\nbpf_master_redirect_enabled_key.\
  \ Another bond device (bond0) which is\nunsupported by XDP but its slave (veth3)\
  \ has xdpgeneric that returns\nXDP_TX. This triggers WARN_ON_ONCE() from the xdp_master_redirect().\n\
  To reduce unnecessary warnings and improve log management, we need to\ndelete the\
  \ WARN_ON_ONCE() and add ratelimit to the netdev_err().\n\n[1] Steps to reproduce:\n\
  \    # Needs tx_xdp with return XDP_TX;\n    ip l add veth0 type veth peer veth1\n\
  \    ip l add veth3 type veth peer veth4\n    ip l add bond0 type bond mode 6 #\
  \ BOND_MODE_ALB, unsupported by XDP\n    ip l add bond1 type bond # BOND_MODE_ROUNDROBIN\
  \ by default\n    ip l set veth0 master bond1\n    ip l set bond1 up\n    # Increases\
  \ bpf_master_redirect_enabled_key\n    ip l set dev bond1 xdpdrv object tx_xdp.o\
  \ section xdp_tx\n    ip l set veth3 master bond0\n    ip l set bond0 up\n    ip\
  \ l set veth4 up\n    # Triggers WARN_ON_ONCE() from the xdp_master_redirect()\n\
  \    ip l set veth3 xdpgeneric object tx_xdp.o section xdp_tx\n\nReported-by: syzbot+c187823a52ed505b2257@syzkaller.appspotmail.com\n\
  Closes: https://syzkaller.appspot.com/bug?extid=c187823a52ed505b2257\nFixes: 9e2ee5c7e7c3\
  \ (\"net, bonding: Add XDP support to the bonding driver\")\nSigned-off-by: Jiwon\
  \ Kim <jiwonaid0@gmail.com>\nSigned-off-by: Nikolay Aleksandrov <razor@blackwall.org>\n\
  Link: https://patch.msgid.link/20240918140602.18644-1-jiwonaid0@gmail.com\nSigned-off-by:\
  \ Paolo Abeni <pabeni@redhat.com>\n\n"
submodule:
- drivers/net/bonding
hunk_count: 1
covered_count: 0
