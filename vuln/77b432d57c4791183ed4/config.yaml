id: 77b432d57c4791183ed4
bug_link: https://syzkaller.appspot.com/bug?extid=77b432d57c4791183ed4
title: memory leak in usb_set_configuration (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5b9b598453d3ae5fa66d7ab591008373a89b91a0
fix_commit: 945a9a8e448b65bec055d37eba58f711b39f66f0
datetime: '2022-06-20T10:30:37+01:00'
fix_commit_message: 'media: pvrusb2: fix memory leak in pvr_probe


  The error handling code in pvr2_hdw_create forgets to unregister the

  v4l2 device. When pvr2_hdw_create returns back to pvr2_context_create,

  it calls pvr2_context_destroy to destroy context, but mp->hdw is NULL,

  which leads to that pvr2_hdw_destroy directly returns.


  Fix this by adding v4l2_device_unregister to decrease the refcount of

  usb interface.


  Reported-by: syzbot+77b432d57c4791183ed4@syzkaller.appspotmail.com

  Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>

  Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>

  Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>

  '
submodule:
- drivers/media/usb/pvrusb2
hunk_count: 1
covered_count: 0
