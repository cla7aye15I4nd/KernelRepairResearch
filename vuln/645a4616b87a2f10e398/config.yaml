id: 645a4616b87a2f10e398
bug_link: https://syzkaller.appspot.com/bug?extid=645a4616b87a2f10e398
title: memory leak in __proc_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4b1a2c2a8e0ddcb89c5f6c5003bd9b53142f69e3
fix_commit: be03df3d4bfe7e8866d4aa43d62e648ffe884f5f
datetime: '2023-03-09T21:07:21-05:00'
fix_commit_message: 'scsi: core: Fix a procfs host directory removal regression


  scsi_proc_hostdir_rm() decreases a reference counter and hence must only be

  called once per host that is removed. This change does not require a

  scsi_add_host_with_dma() change since scsi_add_host_with_dma() will return

  0 (success) if scsi_proc_host_add() is called.


  Fixes: fc663711b944 ("scsi: core: Remove the /proc/scsi/${proc_name} directory earlier")

  Cc: John Garry <john.g.garry@oracle.com>

  Reported-by: John Garry <john.g.garry@oracle.com>

  Link: https://lore.kernel.org/all/ed6b8027-a9d9-1b45-be8e-df4e8c6c4605@oracle.com/

  Reported-by: syzbot+645a4616b87a2f10e398@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/linux-scsi/000000000000890fab05f65342b6@google.com/

  Signed-off-by: Bart Van Assche <bvanassche@acm.org>

  Link: https://lore.kernel.org/r/20230307214428.3703498-1-bvanassche@acm.org

  Tested-by: John Garry <john.g.garry@oracle.com>

  Tested-by: Shin''ichiro Kawasaki <shinichiro.kawasaki@wdc.com>

  Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

  '
submodule:
- drivers/scsi
hunk_count: 1
covered_count: 1
