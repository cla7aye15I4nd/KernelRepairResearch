id: ff14db38f56329ef68df
bug_link: https://syzkaller.appspot.com/bug?extid=ff14db38f56329ef68df
title: 'KMSAN: uninit-value in p9_client_rpc (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a38297e3fb012ddfa7ce0321a7e5a8daeb1872b6
fix_commit: 25460d6f39024cc3b8241b14c7ccf0d6f11a736a
datetime: '2024-05-21T21:27:28+09:00'
fix_commit_message: "net/9p: fix uninit-value in p9_client_rpc()\n\nSyzbot with the\
  \ help of KMSAN reported the following error:\n\nBUG: KMSAN: uninit-value in trace_9p_client_res\
  \ include/trace/events/9p.h:146 [inline]\nBUG: KMSAN: uninit-value in p9_client_rpc+0x1314/0x1340\
  \ net/9p/client.c:754\n trace_9p_client_res include/trace/events/9p.h:146 [inline]\n\
  \ p9_client_rpc+0x1314/0x1340 net/9p/client.c:754\n p9_client_create+0x1551/0x1ff0\
  \ net/9p/client.c:1031\n v9fs_session_init+0x1b9/0x28e0 fs/9p/v9fs.c:410\n v9fs_mount+0xe2/0x12b0\
  \ fs/9p/vfs_super.c:122\n legacy_get_tree+0x114/0x290 fs/fs_context.c:662\n vfs_get_tree+0xa7/0x570\
  \ fs/super.c:1797\n do_new_mount+0x71f/0x15e0 fs/namespace.c:3352\n path_mount+0x742/0x1f20\
  \ fs/namespace.c:3679\n do_mount fs/namespace.c:3692 [inline]\n __do_sys_mount fs/namespace.c:3898\
  \ [inline]\n __se_sys_mount+0x725/0x810 fs/namespace.c:3875\n __x64_sys_mount+0xe4/0x150\
  \ fs/namespace.c:3875\n do_syscall_64+0xd5/0x1f0\n entry_SYSCALL_64_after_hwframe+0x6d/0x75\n\
  \nUninit was created at:\n __alloc_pages+0x9d6/0xe70 mm/page_alloc.c:4598\n __alloc_pages_node\
  \ include/linux/gfp.h:238 [inline]\n alloc_pages_node include/linux/gfp.h:261 [inline]\n\
  \ alloc_slab_page mm/slub.c:2175 [inline]\n allocate_slab mm/slub.c:2338 [inline]\n\
  \ new_slab+0x2de/0x1400 mm/slub.c:2391\n ___slab_alloc+0x1184/0x33d0 mm/slub.c:3525\n\
  \ __slab_alloc mm/slub.c:3610 [inline]\n __slab_alloc_node mm/slub.c:3663 [inline]\n\
  \ slab_alloc_node mm/slub.c:3835 [inline]\n kmem_cache_alloc+0x6d3/0xbe0 mm/slub.c:3852\n\
  \ p9_tag_alloc net/9p/client.c:278 [inline]\n p9_client_prepare_req+0x20a/0x1770\
  \ net/9p/client.c:641\n p9_client_rpc+0x27e/0x1340 net/9p/client.c:688\n p9_client_create+0x1551/0x1ff0\
  \ net/9p/client.c:1031\n v9fs_session_init+0x1b9/0x28e0 fs/9p/v9fs.c:410\n v9fs_mount+0xe2/0x12b0\
  \ fs/9p/vfs_super.c:122\n legacy_get_tree+0x114/0x290 fs/fs_context.c:662\n vfs_get_tree+0xa7/0x570\
  \ fs/super.c:1797\n do_new_mount+0x71f/0x15e0 fs/namespace.c:3352\n path_mount+0x742/0x1f20\
  \ fs/namespace.c:3679\n do_mount fs/namespace.c:3692 [inline]\n __do_sys_mount fs/namespace.c:3898\
  \ [inline]\n __se_sys_mount+0x725/0x810 fs/namespace.c:3875\n __x64_sys_mount+0xe4/0x150\
  \ fs/namespace.c:3875\n do_syscall_64+0xd5/0x1f0\n entry_SYSCALL_64_after_hwframe+0x6d/0x75\n\
  \nIf p9_check_errors() fails early in p9_client_rpc(), req->rc.tag\nwill not be\
  \ properly initialized. However, trace_9p_client_res()\nends up trying to print\
  \ it out anyway before p9_client_rpc()\nfinishes.\n\nFix this issue by assigning\
  \ default values to p9_fcall fields\nsuch as 'tag' and (just in case KMSAN unearths\
  \ something new) 'id'\nduring the tag allocation stage.\n\nReported-and-tested-by:\
  \ syzbot+ff14db38f56329ef68df@syzkaller.appspotmail.com\nFixes: 348b59012e5c (\"\
  net/9p: Convert net/9p protocol dumps to tracepoints\")\nSigned-off-by: Nikita Zhandarovich\
  \ <n.zhandarovich@fintech.ru>\nReviewed-by: Christian Schoenebeck <linux_oss@crudebyte.com>\n\
  Cc: stable@vger.kernel.org\nMessage-ID: <20240408141039.30428-1-n.zhandarovich@fintech.ru>\n\
  Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>\n"
submodule:
- net/9p
hunk_count: 1
covered_count: 1
