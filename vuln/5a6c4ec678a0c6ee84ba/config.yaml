id: 5a6c4ec678a0c6ee84ba
bug_link: https://syzkaller.appspot.com/bug?extid=5a6c4ec678a0c6ee84ba
title: 'KASAN: slab-out-of-bounds Read in hidraw_ioctl'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: fcf887e7caaa813eea821d11bf2b7619a37df37a
fix_commit: 416dacb819f59180e4d86a5550052033ebb6d72c
datetime: '2019-08-22T09:50:25+02:00'
fix_commit_message: "HID: hidraw: Fix invalid read in hidraw_ioctl\n\nThe syzbot fuzzer\
  \ has reported a pair of problems in the\nhidraw_ioctl() function: slab-out-of-bounds\
  \ read and use-after-free\nread.  An example of the first:\n\nBUG: KASAN: slab-out-of-bounds\
  \ in strlen+0x79/0x90 lib/string.c:525\nRead of size 1 at addr ffff8881c8035f38\
  \ by task syz-executor.4/2833\n\nCPU: 1 PID: 2833 Comm: syz-executor.4 Not tainted\
  \ 5.3.0-rc2+ #1\nHardware name: Google Google Compute Engine/Google Compute Engine,\
  \ BIOS\nGoogle 01/01/2011\nCall Trace:\n  __dump_stack lib/dump_stack.c:77 [inline]\n\
  \  dump_stack+0xca/0x13e lib/dump_stack.c:113\n  print_address_description+0x6a/0x32c\
  \ mm/kasan/report.c:351\n  __kasan_report.cold+0x1a/0x33 mm/kasan/report.c:482\n\
  \  kasan_report+0xe/0x12 mm/kasan/common.c:612\n  strlen+0x79/0x90 lib/string.c:525\n\
  \  strlen include/linux/string.h:281 [inline]\n  hidraw_ioctl+0x245/0xae0 drivers/hid/hidraw.c:446\n\
  \  vfs_ioctl fs/ioctl.c:46 [inline]\n  file_ioctl fs/ioctl.c:509 [inline]\n  do_vfs_ioctl+0xd2d/0x1330\
  \ fs/ioctl.c:696\n  ksys_ioctl+0x9b/0xc0 fs/ioctl.c:713\n  __do_sys_ioctl fs/ioctl.c:720\
  \ [inline]\n  __se_sys_ioctl fs/ioctl.c:718 [inline]\n  __x64_sys_ioctl+0x6f/0xb0\
  \ fs/ioctl.c:718\n  do_syscall_64+0xb7/0x580 arch/x86/entry/common.c:296\n  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\
  RIP: 0033:0x459829\nCode: fd b7 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48\
  \ 89 f8 48 89 f7\n48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48>\
  \ 3d 01 f0 ff\nff 0f 83 cb b7 fb ff c3 66 2e 0f 1f 84 00 00 00 00\nRSP: 002b:00007f7a68f6dc78\
  \ EFLAGS: 00000246 ORIG_RAX: 0000000000000010\nRAX: ffffffffffffffda RBX: 0000000000000003\
  \ RCX: 0000000000459829\nRDX: 0000000000000000 RSI: 0000000080404805 RDI: 0000000000000004\n\
  RBP: 000000000075bf20 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000\
  \ R11: 0000000000000246 R12: 00007f7a68f6e6d4\nR13: 00000000004c21de R14: 00000000004d5620\
  \ R15: 00000000ffffffff\n\nThe two problems have the same cause: hidraw_ioctl()\
  \ fails to test\nwhether the device has been removed.  This patch adds the missing\
  \ test.\n\nReported-and-tested-by: syzbot+5a6c4ec678a0c6ee84ba@syzkaller.appspotmail.com\n\
  Signed-off-by: Alan Stern <stern@rowland.harvard.edu>\nCC: <stable@vger.kernel.org>\n\
  Signed-off-by: Jiri Kosina <jkosina@suse.cz>\n"
submodule:
- drivers/hid
hunk_count: 1
covered_count: 0
