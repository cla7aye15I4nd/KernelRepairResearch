id: 4a08ffdf3667b36650a1
bug_link: https://syzkaller.appspot.com/bug?extid=4a08ffdf3667b36650a1
title: kernel BUG in __block_write_begin_int
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0bb80ecc33a8fb5a682236443c1e740d5c917d1d
fix_commit: 4aa8cdd5e523d2d8ec8df29dcd696bf207d7a494
datetime: '2023-09-12T10:05:48-07:00'
fix_commit_message: 'iomap: handle error conditions more gracefully in iomap_to_bh


  iomap_to_bh currently BUG()s when the passed in block number is not

  in the iomap.  For file systems that have proper synchronization this

  should never happen and so far hasn''t in mainline, but for block devices

  size changes aren''t fully synchronized against ongoing I/O.  Instead

  of BUG()ing in this case, return -EIO to the caller, which already has

  proper error handling.  While we''re at it, also return -EIO for an

  unknown iomap state instead of returning garbage.


  Fixes: 487c607df790 ("block: use iomap for writes to block devices")

  Reported-by: syzbot+4a08ffdf3667b36650a1@syzkaller.appspotmail.com

  Signed-off-by: Christoph Hellwig <hch@lst.de>

  Reviewed-by: Darrick J. Wong <djwong@kernel.org>

  Signed-off-by: Darrick J. Wong <djwong@kernel.org>

  Reviewed-by: Damien Le Moal <dlemoal@kernel.org>

  '
submodule:
- fs
hunk_count: 6
covered_count: 6
