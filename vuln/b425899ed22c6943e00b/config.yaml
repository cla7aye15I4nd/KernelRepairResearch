id: b425899ed22c6943e00b
bug_link: https://syzkaller.appspot.com/bug?extid=b425899ed22c6943e00b
title: 'KASAN: slab-out-of-bounds Read in smc_fback_error_report'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 97b9af7a70936e331170c79040cc9bf20071b566
fix_commit: 0558226cebee256aa3f8ec0cc5a800a10bf120a6
datetime: '2022-04-25T11:03:48-07:00'
fix_commit_message: 'net/smc: Fix slab-out-of-bounds issue in fallback


  syzbot reported a slab-out-of-bounds/use-after-free issue,

  which was caused by accessing an already freed smc sock in

  fallback-specific callback functions of clcsock.


  This patch fixes the issue by restoring fallback-specific

  callback functions to original ones and resetting clcsock

  sk_user_data to NULL before freeing smc sock.


  Meanwhile, this patch introduces sk_callback_lock to make

  the access and assignment to sk_user_data mutually exclusive.


  Reported-by: syzbot+b425899ed22c6943e00b@syzkaller.appspotmail.com

  Fixes: 341adeec9ada ("net/smc: Forward wakeup to smc socket waitqueue after fallback")

  Link: https://lore.kernel.org/r/00000000000013ca8105d7ae3ada@google.com/

  Signed-off-by: Wen Gu <guwen@linux.alibaba.com>

  Acked-by: Karsten Graul <kgraul@linux.ibm.com>

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/smc
hunk_count: 7
covered_count: 0
