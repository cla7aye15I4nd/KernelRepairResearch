id: cdbd40e0c3ca02cae3b7
bug_link: https://syzkaller.appspot.com/bug?extid=cdbd40e0c3ca02cae3b7
title: 'KMSAN: kernel-infoleak in move_addr_to_user (6)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5e75d0b215b868337e7a193f28a543ec00e858b1
fix_commit: d6d86830705f173fca6087a3e67ceaf68db80523
datetime: '2021-12-31T18:37:08-08:00'
fix_commit_message: "net ticp:fix a kernel-infoleak in __tipc_sendmsg()\n\nstruct\
  \ tipc_socket_addr.ref has a 4-byte hole,and __tipc_getname() currently\ncopying\
  \ it to user space,causing kernel-infoleak.\n\nBUG: KMSAN: kernel-infoleak in instrument_copy_to_user\
  \ include/linux/instrumented.h:121 [inline]\nBUG: KMSAN: kernel-infoleak in instrument_copy_to_user\
  \ include/linux/instrumented.h:121 [inline] lib/usercopy.c:33\nBUG: KMSAN: kernel-infoleak\
  \ in _copy_to_user+0x1c9/0x270 lib/usercopy.c:33 lib/usercopy.c:33\n instrument_copy_to_user\
  \ include/linux/instrumented.h:121 [inline]\n instrument_copy_to_user include/linux/instrumented.h:121\
  \ [inline] lib/usercopy.c:33\n _copy_to_user+0x1c9/0x270 lib/usercopy.c:33 lib/usercopy.c:33\n\
  \ copy_to_user include/linux/uaccess.h:209 [inline]\n copy_to_user include/linux/uaccess.h:209\
  \ [inline] net/socket.c:287\n move_addr_to_user+0x3f6/0x600 net/socket.c:287 net/socket.c:287\n\
  \ __sys_getpeername+0x470/0x6b0 net/socket.c:1987 net/socket.c:1987\n __do_sys_getpeername\
  \ net/socket.c:1997 [inline]\n __se_sys_getpeername net/socket.c:1994 [inline]\n\
  \ __do_sys_getpeername net/socket.c:1997 [inline] net/socket.c:1994\n __se_sys_getpeername\
  \ net/socket.c:1994 [inline] net/socket.c:1994\n __x64_sys_getpeername+0xda/0x120\
  \ net/socket.c:1994 net/socket.c:1994\n do_syscall_x64 arch/x86/entry/common.c:51\
  \ [inline]\n do_syscall_x64 arch/x86/entry/common.c:51 [inline] arch/x86/entry/common.c:82\n\
  \ do_syscall_64+0x54/0xd0 arch/x86/entry/common.c:82 arch/x86/entry/common.c:82\n\
  \ entry_SYSCALL_64_after_hwframe+0x44/0xae\n\nUninit was stored to memory at:\n\
  \ tipc_getname+0x575/0x5e0 net/tipc/socket.c:757 net/tipc/socket.c:757\n __sys_getpeername+0x3b3/0x6b0\
  \ net/socket.c:1984 net/socket.c:1984\n __do_sys_getpeername net/socket.c:1997 [inline]\n\
  \ __se_sys_getpeername net/socket.c:1994 [inline]\n __do_sys_getpeername net/socket.c:1997\
  \ [inline] net/socket.c:1994\n __se_sys_getpeername net/socket.c:1994 [inline] net/socket.c:1994\n\
  \ __x64_sys_getpeername+0xda/0x120 net/socket.c:1994 net/socket.c:1994\n do_syscall_x64\
  \ arch/x86/entry/common.c:51 [inline]\n do_syscall_x64 arch/x86/entry/common.c:51\
  \ [inline] arch/x86/entry/common.c:82\n do_syscall_64+0x54/0xd0 arch/x86/entry/common.c:82\
  \ arch/x86/entry/common.c:82\n entry_SYSCALL_64_after_hwframe+0x44/0xae\n\nUninit\
  \ was stored to memory at:\n msg_set_word net/tipc/msg.h:212 [inline]\n msg_set_destport\
  \ net/tipc/msg.h:619 [inline]\n msg_set_word net/tipc/msg.h:212 [inline] net/tipc/socket.c:1486\n\
  \ msg_set_destport net/tipc/msg.h:619 [inline] net/tipc/socket.c:1486\n __tipc_sendmsg+0x44fa/0x5890\
  \ net/tipc/socket.c:1486 net/tipc/socket.c:1486\n tipc_sendmsg+0xeb/0x140 net/tipc/socket.c:1402\
  \ net/tipc/socket.c:1402\n sock_sendmsg_nosec net/socket.c:704 [inline]\n sock_sendmsg\
  \ net/socket.c:724 [inline]\n sock_sendmsg_nosec net/socket.c:704 [inline] net/socket.c:2409\n\
  \ sock_sendmsg net/socket.c:724 [inline] net/socket.c:2409\n ____sys_sendmsg+0xe11/0x12c0\
  \ net/socket.c:2409 net/socket.c:2409\n ___sys_sendmsg net/socket.c:2463 [inline]\n\
  \ ___sys_sendmsg net/socket.c:2463 [inline] net/socket.c:2492\n __sys_sendmsg+0x704/0x840\
  \ net/socket.c:2492 net/socket.c:2492\n __do_sys_sendmsg net/socket.c:2501 [inline]\n\
  \ __se_sys_sendmsg net/socket.c:2499 [inline]\n __do_sys_sendmsg net/socket.c:2501\
  \ [inline] net/socket.c:2499\n __se_sys_sendmsg net/socket.c:2499 [inline] net/socket.c:2499\n\
  \ __x64_sys_sendmsg+0xe2/0x120 net/socket.c:2499 net/socket.c:2499\n do_syscall_x64\
  \ arch/x86/entry/common.c:51 [inline]\n do_syscall_x64 arch/x86/entry/common.c:51\
  \ [inline] arch/x86/entry/common.c:82\n do_syscall_64+0x54/0xd0 arch/x86/entry/common.c:82\
  \ arch/x86/entry/common.c:82\n entry_SYSCALL_64_after_hwframe+0x44/0xae\n\nLocal\
  \ variable skaddr created at:\n __tipc_sendmsg+0x2d0/0x5890 net/tipc/socket.c:1419\
  \ net/tipc/socket.c:1419\n tipc_sendmsg+0xeb/0x140 net/tipc/socket.c:1402 net/tipc/socket.c:1402\n\
  \nBytes 4-7 of 16 are uninitialized\nMemory access of size 16 starts at ffff888113753e00\n\
  Data copied to user address 0000000020000280\n\nReported-by: syzbot+cdbd40e0c3ca02cae3b7@syzkaller.appspotmail.com\n\
  Signed-off-by: Haimin Zhang <tcs_kernel@tencent.com>\nAcked-by: Jon Maloy <jmaloy@redhat.com>\n\
  Link: https://lore.kernel.org/r/1640918123-14547-1-git-send-email-tcs.kernel@gmail.com\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/tipc
hunk_count: 1
covered_count: 1
