id: 2e5c1e55b9e5c28a3da7
bug_link: https://syzkaller.appspot.com/bug?extid=2e5c1e55b9e5c28a3da7
title: WARNING in drv_remove_interface
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b76adb9758f8eaaf22b824d0bcdd694551ce0557
fix_commit: 49f27f29446a5bfe633dd2cc0cfebd48a1a5e77f
datetime: '2025-02-11T12:39:49+01:00'
fix_commit_message: 'wifi: nl80211: reject cooked mode if it is set along with other
  flags


  It is possible to set both MONITOR_FLAG_COOK_FRAMES and MONITOR_FLAG_ACTIVE

  flags simultaneously on the same monitor interface from the userspace. This

  causes a sub-interface to be created with no IEEE80211_SDATA_IN_DRIVER bit

  set because the monitor interface is in the cooked state and it takes

  precedence over all other states. When the interface is then being deleted

  the kernel calls WARN_ONCE() from check_sdata_in_driver() because of missing

  that bit.


  Fix this by rejecting MONITOR_FLAG_COOK_FRAMES if it is set along with

  other flags.


  Found by Linux Verification Center (linuxtesting.org) with Syzkaller.


  Fixes: 66f7ac50ed7c ("nl80211: Add monitor interface configuration flags")

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+2e5c1e55b9e5c28a3da7@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=2e5c1e55b9e5c28a3da7

  Signed-off-by: Vitaliy Shevtsov <v.shevtsov@mt-integration.ru>

  Link: https://patch.msgid.link/20250131152657.5606-1-v.shevtsov@mt-integration.ru

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- net/wireless
hunk_count: 1
covered_count: 0
