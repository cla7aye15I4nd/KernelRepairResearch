id: cd8dada2671a39f2f9e6
bug_link: https://syzkaller.appspot.com/bug?extid=cd8dada2671a39f2f9e6
title: 'WARNING: suspicious RCU usage (4)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 57361846b52bc686112da6ca5368d11210796804
fix_commit: 865e63b04e9b2a658d7f26bd13a71dcd964a9118
datetime: '2018-09-05T11:23:21-04:00'
fix_commit_message: "tracing: Add back in rcu_irq_enter/exit_irqson() for rcuidle\
  \ tracepoints\n\nBorislav reported the following splat:\n\n =============================\n\
  \ WARNING: suspicious RCU usage\n 4.19.0-rc1+ #1 Not tainted\n -----------------------------\n\
  \ ./include/linux/rcupdate.h:631 rcu_read_lock() used illegally while idle!\n other\
  \ info that might help us debug this:\n\n RCU used illegally from idle CPU!\n rcu_scheduler_active\
  \ = 2, debug_locks = 1\n RCU used illegally from extended quiescent state!\n 1 lock\
  \ held by swapper/0/0:\n  #0: 000000004557ee0e (rcu_read_lock){....}, at: perf_event_output_forward+0x0/0x130\n\
  \n stack backtrace:\n CPU: 0 PID: 0 Comm: swapper/0 Not tainted 4.19.0-rc1+ #1\n\
  \ Hardware name: LENOVO 2320CTO/2320CTO, BIOS G2ET86WW (2.06 ) 11/13/2012\n Call\
  \ Trace:\n  dump_stack+0x85/0xcb\n  perf_event_output_forward+0xf6/0x130\n  __perf_event_overflow+0x52/0xe0\n\
  \  perf_swevent_overflow+0x91/0xb0\n  perf_tp_event+0x11a/0x350\n  ? find_held_lock+0x2d/0x90\n\
  \  ? __lock_acquire+0x2ce/0x1350\n  ? __lock_acquire+0x2ce/0x1350\n  ? retint_kernel+0x2d/0x2d\n\
  \  ? find_held_lock+0x2d/0x90\n  ? tick_nohz_get_sleep_length+0x83/0xb0\n  ? perf_trace_cpu+0xbb/0xd0\n\
  \  ? perf_trace_buf_alloc+0x5a/0xa0\n  perf_trace_cpu+0xbb/0xd0\n  cpuidle_enter_state+0x185/0x340\n\
  \  do_idle+0x1eb/0x260\n  cpu_startup_entry+0x5f/0x70\n  start_kernel+0x49b/0x4a6\n\
  \  secondary_startup_64+0xa4/0xb0\n\nThis is due to the tracepoints moving to SRCU\
  \ usage which does not require\nRCU to be \"watching\". But perf uses these tracepoints\
  \ with RCU and expects\nit to be. Hence, we still need to add in the rcu_irq_enter/exit_irqson()\n\
  calls for \"rcuidle\" tracepoints. This is a temporary fix until we have SRCU\n\
  working in NMI context, and then perf can be converted to use that instead\nof normal\
  \ RCU.\n\nLink: http://lkml.kernel.org/r/20180904162611.6a120068@gandalf.local.home\n\
  \nCc: x86-ml <x86@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nReported-by:\
  \ Borislav Petkov <bp@alien8.de>\nTested-by: Borislav Petkov <bp@alien8.de>\nReviewed-by:\
  \ \"Paul E. McKenney\" <paulmck@linux.vnet.ibm.com>\nFixes: e6753f23d961d (\"tracepoint:\
  \ Make rcuidle tracepoint callers use SRCU\")\nSigned-off-by: Steven Rostedt (VMware)\
  \ <rostedt@goodmis.org>\n"
submodule:
- include/linux
hunk_count: 2
covered_count: 0
