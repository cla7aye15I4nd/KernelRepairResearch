id: 0251e883fe39e7a0cb0a
bug_link: https://syzkaller.appspot.com/bug?extid=0251e883fe39e7a0cb0a
title: 'INFO: rcu detected stall in wg_packet_tx_worker'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cf7fc3af87b2d767f55eeec9faeb4b45b929341c
fix_commit: df4953e4e997e273501339f607b77953772e3559
datetime: '2020-04-27T11:49:57-07:00'
fix_commit_message: 'sch_sfq: validate silly quantum values


  syzbot managed to set up sfq so that q->scaled_quantum was zero,

  triggering an infinite loop in sfq_dequeue()


  More generally, we must only accept quantum between 1 and 2^18 - 7,

  meaning scaled_quantum must be in [1, 0x7FFF] range.


  Otherwise, we also could have a loop in sfq_dequeue()

  if scaled_quantum happens to be 0x8000, since slot->allot

  could indefinitely switch between 0 and 0x8000.


  Fixes: eeaeb068f139 ("sch_sfq: allow big packets and be fair")

  Signed-off-by: Eric Dumazet <edumazet@google.com>

  Reported-by: syzbot+0251e883fe39e7a0cb0a@syzkaller.appspotmail.com

  Cc: Jason A. Donenfeld <Jason@zx2c4.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 1
covered_count: 0
