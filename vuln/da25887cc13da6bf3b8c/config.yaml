id: da25887cc13da6bf3b8c
bug_link: https://syzkaller.appspot.com/bug?extid=da25887cc13da6bf3b8c
title: 'KCSAN: data-race in __swap_writepage / scan_swap_map_slots (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: dffe24e9587607c377d87d6c372653ae44b99ce7
fix_commit: 7b7aca6d7c0f9b2d9400bfc57cb2b23cfbd5134d
datetime: '2024-07-17T21:05:18-07:00'
fix_commit_message: 'mm: ignore data-race in __swap_writepage


  Syzbot reported a possible data race:


  BUG: KCSAN: data-race in __swap_writepage / scan_swap_map_slots


  read-write to 0xffff888102fca610 of 8 bytes by task 7106 on cpu 1.

  read to 0xffff888102fca610 of 8 bytes by task 7080 on cpu 0.


  While we are in __swap_writepage to read sis->flags, scan_swap_map_slots

  is trying to update it with SWP_SCANNING.


  value changed: 0x0000000000008083 -> 0x0000000000004083.


  While this can be updated non-atomicially, this won''t affect

  SWP_SYNCHRONOUS_IO, so we consider this data-race safe.


  This is possibly introduced by commit 3222d8c2a7f8 ("block: remove

  ->rw_page"), where this if branch is introduced.


  Link: https://lkml.kernel.org/r/20240711-bug13-v1-1-cea2b8ae8d76@gmail.com

  Fixes: 3222d8c2a7f8 ("block: remove ->rw_page")

  Signed-off-by: Pei Li <peili.dev@gmail.com>

  Reported-by: syzbot+da25887cc13da6bf3b8c@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=da25887cc13da6bf3b8c

  Cc: Dan Williams <dan.j.williams@intel.com>

  Cc: Shuah Khan <skhan@linuxfoundation.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- mm
hunk_count: 1
covered_count: 1
