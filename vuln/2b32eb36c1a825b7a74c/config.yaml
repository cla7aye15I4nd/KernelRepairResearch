id: 2b32eb36c1a825b7a74c
bug_link: https://syzkaller.appspot.com/bug?extid=2b32eb36c1a825b7a74c
title: 'INFO: trying to register non-static key in nilfs_bmap_lookup_at_level'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d325dc6eb763c10f591c239550b8c7e5466a5d09
fix_commit: 21a87d88c2253350e115029f14fe2a10a7e6c856
datetime: '2022-10-11T19:05:45-07:00'
fix_commit_message: 'nilfs2: fix NULL pointer dereference at nilfs_bmap_lookup_at_level()


  If the i_mode field in inode of metadata files is corrupted on disk, it

  can cause the initialization of bmap structure, which should have been

  called from nilfs_read_inode_common(), not to be called.  This causes a

  lockdep warning followed by a NULL pointer dereference at

  nilfs_bmap_lookup_at_level().


  This patch fixes these issues by adding a missing sanitiy check for the

  i_mode field of metadata file''s inode.


  Link: https://lkml.kernel.org/r/20221002030804.29978-1-konishi.ryusuke@gmail.com

  Signed-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>

  Reported-by: syzbot+2b32eb36c1a825b7a74c@syzkaller.appspotmail.com

  Reported-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Tested-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/nilfs2
hunk_count: 1
covered_count: 1
