id: 9adb4b567003cac781f0
bug_link: https://syzkaller.appspot.com/bug?extid=9adb4b567003cac781f0
title: 'KMSAN: kernel-infoleak in put_cmsg'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ae2dcb28c24794a87e424a726a1cf1a61980f52d
fix_commit: 2efd4fca703a6707cad16ab486eaab8fc7f0fd49
datetime: '2018-07-24T16:35:58-07:00'
fix_commit_message: "ip: in cmsg IP(V6)_ORIGDSTADDR call pskb_may_pull\n\nSyzbot reported\
  \ a read beyond the end of the skb head when returning\nIPV6_ORIGDSTADDR:\n\n  BUG:\
  \ KMSAN: kernel-infoleak in put_cmsg+0x5ef/0x860 net/core/scm.c:242\n  CPU: 0 PID:\
  \ 4501 Comm: syz-executor128 Not tainted 4.17.0+ #9\n  Hardware name: Google Google\
  \ Compute Engine/Google Compute Engine, BIOS\n  Google 01/01/2011\n  Call Trace:\n\
  \    __dump_stack lib/dump_stack.c:77 [inline]\n    dump_stack+0x185/0x1d0 lib/dump_stack.c:113\n\
  \    kmsan_report+0x188/0x2a0 mm/kmsan/kmsan.c:1125\n    kmsan_internal_check_memory+0x138/0x1f0\
  \ mm/kmsan/kmsan.c:1219\n    kmsan_copy_to_user+0x7a/0x160 mm/kmsan/kmsan.c:1261\n\
  \    copy_to_user include/linux/uaccess.h:184 [inline]\n    put_cmsg+0x5ef/0x860\
  \ net/core/scm.c:242\n    ip6_datagram_recv_specific_ctl+0x1cf3/0x1eb0 net/ipv6/datagram.c:719\n\
  \    ip6_datagram_recv_ctl+0x41c/0x450 net/ipv6/datagram.c:733\n    rawv6_recvmsg+0x10fb/0x1460\
  \ net/ipv6/raw.c:521\n    [..]\n\nThis logic and its ipv4 counterpart read the destination\
  \ port from\nthe packet at skb_transport_offset(skb) + 4.\n\nWith MSG_MORE and a\
  \ local SOCK_RAW sender, syzbot was able to cook a\npacket that stores headers exactly\
  \ up to skb_transport_offset(skb) in\nthe head and the remainder in a frag.\n\n\
  Call pskb_may_pull before accessing the pointer to ensure that it lies\nin skb head.\n\
  \nLink: http://lkml.kernel.org/r/CAF=yD-LEJwZj5a1-bAAj2Oy_hKmGygV6rsJ_WOrAYnv-fnayiQ@mail.gmail.com\n\
  Reported-by: syzbot+9adb4b567003cac781f0@syzkaller.appspotmail.com\nSigned-off-by:\
  \ Willem de Bruijn <willemb@google.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/ipv4
- net/ipv6
hunk_count: 2
covered_count: 1
