id: 805f5f6ae37411f15b64
bug_link: https://syzkaller.appspot.com/bug?extid=805f5f6ae37411f15b64
title: 'INFO: task hung in __do_sys_reboot'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bf9b82b7fe4d3c7d4d432ef80b4299c9b6b4a1f8
fix_commit: b292b50b0efcc7095d8bf15505fba6909bb35dce
datetime: '2020-07-23T15:21:28+02:00'
fix_commit_message: 'driver core: Fix probe_count imbalance in really_probe()


  syzbot is reporting hung task in wait_for_device_probe() [1]. At least,

  we always need to decrement probe_count if we incremented probe_count in

  really_probe().


  However, since I can''t find "Resources present before probing" message in

  the console log, both "this message simply flowed off" and "syzbot is not

  hitting this path" will be possible. Therefore, while we are at it, let''s

  also prepare for concurrent wait_for_device_probe() calls by replacing

  wake_up() with wake_up_all().


  [1] https://syzkaller.appspot.com/bug?id=25c833f1983c9c1d512f4ff860dd0d7f5a2e2c0f


  Reported-by: syzbot <syzbot+805f5f6ae37411f15b64@syzkaller.appspotmail.com>

  Fixes: 7c35e699c88bd607 ("driver core: Print device when resources present in really_probe()")

  Cc: Geert Uytterhoeven <geert+renesas@glider.be>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Cc: stable <stable@kernel.org>

  Link: https://lore.kernel.org/r/20200713021254.3444-1-penguin-kernel@I-love.SAKURA.ne.jp

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/base
hunk_count: 3
covered_count: 0
