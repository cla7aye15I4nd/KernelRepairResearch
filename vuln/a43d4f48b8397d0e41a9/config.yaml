id: a43d4f48b8397d0e41a9
bug_link: https://syzkaller.appspot.com/bug?extid=a43d4f48b8397d0e41a9
title: 'INFO: task hung in ext4_quota_write'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4f3e6db3c3719952cfef89340290e0b7b03f7cbc
fix_commit: 0a46ef234756dca04623b7591e8ebb3440622f0b
datetime: '2024-05-03T00:02:24-04:00'
fix_commit_message: 'ext4: do not create EA inode under buffer lock


  ext4_xattr_set_entry() creates new EA inodes while holding buffer lock

  on the external xattr block. This is problematic as it nests all the

  allocation locking (which acquires locks on other buffers) under the

  buffer lock. This can even deadlock when the filesystem is corrupted and

  e.g. quota file is setup to contain xattr block as data block. Move the

  allocation of EA inode out of ext4_xattr_set_entry() into the callers.


  Reported-by: syzbot+a43d4f48b8397d0e41a9@syzkaller.appspotmail.com

  Signed-off-by: Jan Kara <jack@suse.cz>

  Link: https://lore.kernel.org/r/20240321162657.27420-2-jack@suse.cz

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 11
covered_count: 4
