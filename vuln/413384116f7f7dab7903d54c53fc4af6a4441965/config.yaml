id: 413384116f7f7dab7903d54c53fc4af6a4441965
bug_link: https://syzkaller.appspot.com/bug?extid=413384116f7f7dab7903d54c53fc4af6a4441965
title: kernel BUG at net/key/af_key.c:LINE!
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b39545684a90ef3374abc0969d64c7bc540d128d
fix_commit: 0e74aa1d79a5bbc663e03a2804399cae418a0321
datetime: '2017-11-14T07:00:47+01:00'
fix_commit_message: 'xfrm: Copy policy family in clone_policy


  The syzbot found an ancient bug in the IPsec code.  When we cloned

  a socket policy (for example, for a child TCP socket derived from a

  listening socket), we did not copy the family field.  This results

  in a live policy with a zero family field.  This triggers a BUG_ON

  check in the af_key code when the cloned policy is retrieved.


  This patch fixes it by copying the family field over.


  Reported-by: syzbot <syzkaller@googlegroups.com>

  Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

  Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>

  '
submodule:
- net/xfrm
hunk_count: 1
covered_count: 0
