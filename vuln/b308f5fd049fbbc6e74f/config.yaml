id: b308f5fd049fbbc6e74f
bug_link: https://syzkaller.appspot.com/bug?extid=b308f5fd049fbbc6e74f
title: 'KASAN: use-after-free Read in bit_putcs'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b63537020db34ac3f88086095cc49df65283fb61
fix_commit: 988d0763361bb65690d60e2bc53a6b72777040c3
datetime: '2020-09-27T14:17:43+02:00'
fix_commit_message: "vt_ioctl: make VT_RESIZEX behave like VT_RESIZE\n\nsyzbot is\
  \ reporting UAF/OOB read at bit_putcs()/soft_cursor() [1][2], for\nvt_resizex()\
  \ from ioctl(VT_RESIZEX) allows setting font height larger than\nactual font height\
  \ calculated by con_font_set() from ioctl(PIO_FONT).\nSince fbcon_set_font() from\
  \ con_font_set() allocates minimal amount of\nmemory based on actual font height\
  \ calculated by con_font_set(),\nuse of vt_resizex() can cause UAF/OOB read for\
  \ font data.\n\nVT_RESIZEX was introduced in Linux 1.3.3, but it is unclear that\
  \ what\ncomes to the \"+ more\" part, and I couldn't find a user of VT_RESIZEX.\n\
  \n  #define VT_RESIZE   0x5609 /* set kernel's idea of screensize */\n  #define\
  \ VT_RESIZEX  0x560A /* set kernel's idea of screensize + more */\n\nSo far we are\
  \ not aware of syzbot reports caused by setting non-zero value\nto v_vlin parameter.\
  \ But given that it is possible that nobody is using\nVT_RESIZEX, we can try removing\
  \ support for v_clin and v_vlin parameters.\n\nTherefore, this patch effectively\
  \ makes VT_RESIZEX behave like VT_RESIZE,\nwith emitting a message if somebody is\
  \ still using v_clin and/or v_vlin\nparameters.\n\n[1] https://syzkaller.appspot.com/bug?id=32577e96d88447ded2d3b76d71254fb855245837\n\
  [2] https://syzkaller.appspot.com/bug?id=6b8355d27b2b94fb5cedf4655e3a59162d9e48e3\n\
  \nReported-by: syzbot <syzbot+b308f5fd049fbbc6e74f@syzkaller.appspotmail.com>\n\
  Reported-by: syzbot <syzbot+16469b5e8e5a72e9131e@syzkaller.appspotmail.com>\nSigned-off-by:\
  \ Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>\nCc: stable <stable@vger.kernel.org>\n\
  Link: https://lore.kernel.org/r/4933b81b-9b1a-355b-df0e-9b31e8280ab9@i-love.sakura.ne.jp\n\
  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n"
submodule:
- drivers/tty/vt
hunk_count: 1
covered_count: 0
