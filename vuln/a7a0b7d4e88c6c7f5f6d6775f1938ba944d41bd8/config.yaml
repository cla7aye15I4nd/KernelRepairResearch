id: a7a0b7d4e88c6c7f5f6d6775f1938ba944d41bd8
bug_link: https://syzkaller.appspot.com/bug?extid=a7a0b7d4e88c6c7f5f6d6775f1938ba944d41bd8
title: 'KASAN: use-after-free Read in fsnotify'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ff5abbe799e29099695cb8b5b2f198dd8b8bdf26
fix_commit: b3a0066005821acdc0cdb092cb72587182ab583f
datetime: '2017-10-31T17:41:04+01:00'
fix_commit_message: 'dnotify: Handle errors from fsnotify_add_mark_locked() in fcntl_dirnotify()


  fsnotify_add_mark_locked() can fail but we do not check its return

  value. This didn''t matter before commit 9dd813c15b2c "fsnotify: Move

  mark list head from object into dedicated structure" as none of possible

  failures could happen for dnotify but after that commit -ENOMEM can be

  returned. Handle this error properly in fcntl_dirnotify() as

  otherwise we just hit BUG_ON(dn_mark->dn) in dnotify_free_mark().


  Reviewed-by: Amir Goldstein <amir73il@gmail.com>

  Reported-by: syzkaller

  Fixes: 9dd813c15b2c101168808d4f5941a29985758973

  Signed-off-by: Jan Kara <jack@suse.cz>

  '
submodule:
- fs/notify
hunk_count: 2
covered_count: 0
