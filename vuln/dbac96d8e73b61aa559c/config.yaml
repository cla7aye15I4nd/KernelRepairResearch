id: dbac96d8e73b61aa559c
bug_link: https://syzkaller.appspot.com/bug?extid=dbac96d8e73b61aa559c
title: 'BUG: sleeping function called from invalid context in console_lock (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a47cf07f60dcb02d01daa19ecf2d5775d6cd12db
fix_commit: 6bd23e0c2bb6c65d4f5754d1456bc9a4427fc59b
datetime: '2024-05-04T18:45:11+02:00'
fix_commit_message: "tty: add the option to have a tty reject a new ldisc\n\n... and\
  \ use it to limit the virtual terminals to just N_TTY.  They are\nkind of special,\
  \ and in particular, the \"con_write()\" routine violates\nthe \"writes cannot sleep\"\
  \ rule that some ldiscs rely on.\n\nThis avoids the\n\n   BUG: sleeping function\
  \ called from invalid context at kernel/printk/printk.c:2659\n\nwhen N_GSM has been\
  \ attached to a virtual console, and gsmld_write()\ncalls con_write() while holding\
  \ a spinlock, and con_write() then tries\nto get the console lock.\n\nTested-by:\
  \ Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>\nCc: Jiri Slaby <jirislaby@kernel.org>\n\
  Cc: Andrew Morton <akpm@linux-foundation.org>\nCc: Daniel Starke <daniel.starke@siemens.com>\n\
  Reported-by: syzbot <syzbot+dbac96d8e73b61aa559c@syzkaller.appspotmail.com>\nCloses:\
  \ https://syzkaller.appspot.com/bug?extid=dbac96d8e73b61aa559c\nSigned-off-by: Linus\
  \ Torvalds <torvalds@linux-foundation.org>\nLink: https://lore.kernel.org/r/20240423163339.59780-1-torvalds@linux-foundation.org\n\
  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n"
submodule:
- drivers/tty
- drivers/tty/vt
- include/linux
hunk_count: 5
covered_count: 0
