id: 8de19a03d6fdf256eb2b90ec48916b6f47b9b5a3
bug_link: https://syzkaller.appspot.com/bug?extid=8de19a03d6fdf256eb2b90ec48916b6f47b9b5a3
title: WARNING in drm_modeset_lock_all
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 62884cd386b876638720ef88374b31a84ca7ee5f
fix_commit: d18d1a5ac811d12f7ebc1129230312b5f2c50cb8
datetime: '2017-10-31T17:36:46+01:00'
fix_commit_message: 'drm: Require __GFP_NOFAIL for the legacy drm_modeset_lock_all


  To acquire all modeset locks requires a ww_ctx to be allocated. As this

  is the legacy path and the allocation small, to reduce the changes

  required (and complex untested error handling) to the legacy drivers, we

  simply assume that the allocation succeeds. At present, it relies on the

  too-small-to-fail rule, but syzbot found that by injecting a failure

  here we would hit the WARN. Document that this allocation must succeed

  with __GFP_NOFAIL.


  Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

  Cc: Daniel Vetter <daniel.vetter@ffwll.ch>

  Reported-by: syzbot <syzkaller@googlegroups.com>

  Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

  Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>

  Link: https://patchwork.freedesktop.org/patch/msgid/20171031115535.15166-1-chris@chris-wilson.co.uk

  '
submodule:
- drivers/gpu/drm
hunk_count: 1
covered_count: 1
