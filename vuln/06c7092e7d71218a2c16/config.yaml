id: 06c7092e7d71218a2c16
bug_link: https://syzkaller.appspot.com/bug?extid=06c7092e7d71218a2c16
title: WARNING in userfaultfd_ioctl
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 61c6de667263184125d5ca75e894fcad632b0dd3
fix_commit: 01e881f5a1fca4677e82733061868c6d6ea05ca7
datetime: '2018-12-14T15:05:45-08:00'
fix_commit_message: 'userfaultfd: check VM_MAYWRITE was set after verifying the uffd
  is registered


  Calling UFFDIO_UNREGISTER on virtual ranges not yet registered in uffd

  could trigger an harmless false positive WARN_ON.  Check the vma is

  already registered before checking VM_MAYWRITE to shut off the false

  positive warning.


  Link: http://lkml.kernel.org/r/20181206212028.18726-2-aarcange@redhat.com

  Cc: <stable@vger.kernel.org>

  Fixes: 29ec90660d68 ("userfaultfd: shmem/hugetlbfs: only allow to register VM_MAYWRITE
  vmas")

  Signed-off-by: Andrea Arcangeli <aarcange@redhat.com>

  Reported-by: syzbot+06c7092e7d71218a2c16@syzkaller.appspotmail.com

  Acked-by: Mike Rapoport <rppt@linux.ibm.com>

  Acked-by: Hugh Dickins <hughd@google.com>

  Acked-by: Peter Xu <peterx@redhat.com>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

  '
submodule:
- fs
hunk_count: 2
covered_count: 2
