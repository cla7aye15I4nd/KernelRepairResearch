id: 9399c158fcc09b21d0d2
bug_link: https://syzkaller.appspot.com/bug?extid=9399c158fcc09b21d0d2
title: 'KASAN: use-after-free Read in nr_insert_socket'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 260637903f47f20c5918bb5c1eea52b2a28ea863
fix_commit: 4638faac032756f7eab5524be7be56bee77e426b
datetime: '2019-07-24T15:49:05-07:00'
fix_commit_message: 'netrom: hold sock when setting skb->destructor


  sock_efree() releases the sock refcnt, if we don''t hold this refcnt

  when setting skb->destructor to it, the refcnt would not be balanced.

  This leads to several bug reports from syzbot.


  I have checked other users of sock_efree(), all of them hold the

  sock refcnt.


  Fixes: c8c8218ec5af ("netrom: fix a memory leak in nr_rx_frame()")

  Reported-and-tested-by: <syzbot+622bdabb128acc33427d@syzkaller.appspotmail.com>

  Reported-and-tested-by: <syzbot+6eaef7158b19e3fec3a0@syzkaller.appspotmail.com>

  Reported-and-tested-by: <syzbot+9399c158fcc09b21d0d2@syzkaller.appspotmail.com>

  Reported-and-tested-by: <syzbot+a34e5f3d0300163f0c87@syzkaller.appspotmail.com>

  Cc: Ralf Baechle <ralf@linux-mips.org>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/netrom
hunk_count: 1
covered_count: 1
