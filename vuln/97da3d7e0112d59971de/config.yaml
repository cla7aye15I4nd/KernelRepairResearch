id: 97da3d7e0112d59971de
bug_link: https://syzkaller.appspot.com/bug?extid=97da3d7e0112d59971de
title: 'WARNING: locking bug in __lock_task_sighand'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9fe17b7466f6c1dd29bac83a7a53303b8b16410f
fix_commit: 87c544108b612512b254c8f79aa5c0a8546e2cc4
datetime: '2025-01-15T13:44:08-08:00'
fix_commit_message: 'bpf: Send signals asynchronously if !preemptible


  BPF programs can execute in all kinds of contexts and when a program

  running in a non-preemptible context uses the bpf_send_signal() kfunc,

  it will cause issues because this kfunc can sleep.

  Change `irqs_disabled()` to `!preemptible()`.


  Reported-by: syzbot+97da3d7e0112d59971de@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/67486b09.050a0220.253251.0084.GAE@google.com/

  Fixes: 1bc7896e9ef4 ("bpf: Fix deadlock with rq_lock in bpf_send_signal()")

  Signed-off-by: Puranjay Mohan <puranjay@kernel.org>

  Acked-by: Yonghong Song <yonghong.song@linux.dev>

  Link: https://lore.kernel.org/r/20250115103647.38487-1-puranjay@kernel.org

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/trace
hunk_count: 1
covered_count: 1
