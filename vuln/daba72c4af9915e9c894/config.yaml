id: daba72c4af9915e9c894
bug_link: https://syzkaller.appspot.com/bug?extid=daba72c4af9915e9c894
title: 'KASAN: slab-use-after-free Read in __free_filter'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 86731a2a651e58953fc949573895f2fa6d456841
fix_commit: 6921d1e07cb5eddec830801087b419194fde0803
datetime: '2025-06-27T15:51:36-04:00'
fix_commit_message: 'tracing: Fix filter logic error


  If the processing of the tr->events loop fails, the filter that has been

  added to filter_head will be released twice in free_filter_list(&head->rcu)

  and __free_filter(filter).


  After adding the filter of tr->events, add the filter to the filter_head

  process to avoid triggering uaf.


  Link: https://lore.kernel.org/tencent_4EF87A626D702F816CD0951CE956EC32CD0A@qq.com

  Fixes: a9d0aab5eb33 ("tracing: Fix regression of filter waiting a long time on RCU
  synchronization")

  Reported-by: syzbot+daba72c4af9915e9c894@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=daba72c4af9915e9c894

  Tested-by: syzbot+daba72c4af9915e9c894@syzkaller.appspotmail.com

  Acked-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>

  Signed-off-by: Edward Adam Davis <eadavis@qq.com>

  Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>

  '
submodule:
- kernel/trace
hunk_count: 2
covered_count: 2
