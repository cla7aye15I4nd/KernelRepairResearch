id: 3417712847e7219a60ee
bug_link: https://syzkaller.appspot.com/bug?extid=3417712847e7219a60ee
title: 'KASAN: use-after-free Read in corrupted'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6becdb601bae2a043d7fb9762c4d48699528ea6e
fix_commit: 543b8f8662fe6d21f19958b666ab0051af9db21a
datetime: '2018-05-31T12:26:11+02:00'
fix_commit_message: 'fuse: don''t keep dead fuse_conn at fuse_fill_super().


  syzbot is reporting use-after-free at fuse_kill_sb_blk() [1].

  Since sb->s_fs_info field is not cleared after fc was released by

  fuse_conn_put() when initialization failed, fuse_kill_sb_blk() finds

  already released fc and tries to hold the lock. Fix this by clearing

  sb->s_fs_info field after calling fuse_conn_put().


  [1] https://syzkaller.appspot.com/bug?id=a07a680ed0a9290585ca424546860464dd9658db


  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Reported-by: syzbot <syzbot+ec3986119086fe4eec97@syzkaller.appspotmail.com>

  Fixes: 3b463ae0c626 ("fuse: invalidation reverse calls")

  Cc: John Muir <john@jmuir.com>

  Cc: Csaba Henk <csaba@gluster.com>

  Cc: Anand Avati <avati@redhat.com>

  Cc: <stable@vger.kernel.org> # v2.6.31

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  '
submodule:
- fs/fuse
hunk_count: 1
covered_count: 1
