id: 6e181fc95081c2cf9051
bug_link: https://syzkaller.appspot.com/bug?extid=6e181fc95081c2cf9051
title: 'KASAN: use-after-free Read in llc_conn_ac_send_sabme_cmd_p_set_x'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 02b94fc70ffe320a7799c35e09372809e40b7131
fix_commit: f7e43672683b097bb074a8fe7af9bc600a23f231
datetime: '2018-04-19T13:54:53-04:00'
fix_commit_message: "llc: hold llc_sap before release_sock()\n\nsyzbot reported we\
  \ still access llc->sap in llc_backlog_rcv()\nafter it is freed in llc_sap_remove_socket():\n\
  \nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n dump_stack+0x1b9/0x294\
  \ lib/dump_stack.c:113\n print_address_description+0x6c/0x20b mm/kasan/report.c:256\n\
  \ kasan_report_error mm/kasan/report.c:354 [inline]\n kasan_report.cold.7+0x242/0x2fe\
  \ mm/kasan/report.c:412\n __asan_report_load1_noabort+0x14/0x20 mm/kasan/report.c:430\n\
  \ llc_conn_ac_send_sabme_cmd_p_set_x+0x3a8/0x460 net/llc/llc_c_ac.c:785\n llc_exec_conn_trans_actions\
  \ net/llc/llc_conn.c:475 [inline]\n llc_conn_service net/llc/llc_conn.c:400 [inline]\n\
  \ llc_conn_state_process+0x4e1/0x13a0 net/llc/llc_conn.c:75\n llc_backlog_rcv+0x195/0x1e0\
  \ net/llc/llc_conn.c:891\n sk_backlog_rcv include/net/sock.h:909 [inline]\n __release_sock+0x12f/0x3a0\
  \ net/core/sock.c:2335\n release_sock+0xa4/0x2b0 net/core/sock.c:2850\n llc_ui_release+0xc8/0x220\
  \ net/llc/af_llc.c:204\n\nllc->sap is refcount'ed and llc_sap_remove_socket() is\
  \ paired\nwith llc_sap_add_socket(). This can be amended by holding its refcount\n\
  before llc_sap_remove_socket() and releasing it after release_sock().\n\nReported-by:\
  \ <syzbot+6e181fc95081c2cf9051@syzkaller.appspotmail.com>\nSigned-off-by: Cong Wang\
  \ <xiyou.wangcong@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/llc
hunk_count: 2
covered_count: 2
