id: 34dc2fea3478e659af01
bug_link: https://syzkaller.appspot.com/bug?extid=34dc2fea3478e659af01
title: WARNING in dma_map_page_attrs
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 3cea11cd5e3b00d91caf0b4730194039b45c5891
fix_commit: 683a9c7ed81769b6ecb6229afb00b6cda8e4bcfb
datetime: '2020-11-02T15:14:56-04:00'
fix_commit_message: "RDMA: Fix software RDMA drivers for dma mapping error\n\nThe\
  \ commit f959dcd6ddfd (\"dma-direct: Fix potential NULL pointer\ndereference\")\
  \ made dma_mask as mandetory field to be setup even for\ndma_virt_ops based dma\
  \ devices. The commit in the fixes tag omitted\nsetting up the dma_mask on virtual\
  \ devices triggering the below trace when\nthey were combined during the merge window.\n\
  \nFix it by setting empty DMA MASK for software based RDMA devices.\n\n  WARNING:\
  \ CPU: 1 PID: 8488 at kernel/dma/mapping.c:149 dma_map_page_attrs+0x493/0x700\n\
  \  CPU: 1 PID: 8488 Comm: syz-executor144 Not tainted 5.9.0-syzkaller #0\n  Hardware\
  \ name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\n\
  \  RIP: 0010:dma_map_page_attrs+0x493/0x700 kernel/dma/mapping.c:149\n  Trace:\n\
  \   dma_map_single_attrs include/linux/dma-mapping.h:279 [inline]\n   ib_dma_map_single\
  \ include/rdma/ib_verbs.h:3967 [inline]\n   ib_mad_post_receive_mads+0x23f/0xd60\
  \ drivers/infiniband/core/mad.c:2715\n   ib_mad_port_start drivers/infiniband/core/mad.c:2862\
  \ [inline]\n   ib_mad_port_open drivers/infiniband/core/mad.c:3016 [inline]\n  \
  \ ib_mad_init_device+0x72b/0x1400 drivers/infiniband/core/mad.c:3092\n   add_client_context+0x405/0x5e0\
  \ drivers/infiniband/core/device.c:680\n   enable_device_and_get+0x1d5/0x3c0 drivers/infiniband/core/device.c:1301\n\
  \   ib_register_device drivers/infiniband/core/device.c:1376 [inline]\n   ib_register_device+0x7a7/0xa40\
  \ drivers/infiniband/core/device.c:1335\n   rxe_register_device+0x46d/0x570 drivers/infiniband/sw/rxe/rxe_verbs.c:1182\n\
  \   rxe_add+0x12fe/0x16d0 drivers/infiniband/sw/rxe/rxe.c:247\n   rxe_net_add+0x8c/0xe0\
  \ drivers/infiniband/sw/rxe/rxe_net.c:507\n   rxe_newlink drivers/infiniband/sw/rxe/rxe.c:269\
  \ [inline]\n   rxe_newlink+0xb7/0xe0 drivers/infiniband/sw/rxe/rxe.c:250\n   nldev_newlink+0x30e/0x540\
  \ drivers/infiniband/core/nldev.c:1555\n   rdma_nl_rcv_msg+0x367/0x690 drivers/infiniband/core/netlink.c:195\n\
  \   rdma_nl_rcv_skb drivers/infiniband/core/netlink.c:239 [inline]\n   rdma_nl_rcv+0x2f2/0x440\
  \ drivers/infiniband/core/netlink.c:259\n   netlink_unicast_kernel net/netlink/af_netlink.c:1304\
  \ [inline]\n   netlink_unicast+0x533/0x7d0 net/netlink/af_netlink.c:1330\n   netlink_sendmsg+0x856/0xd90\
  \ net/netlink/af_netlink.c:1919\n   sock_sendmsg_nosec net/socket.c:651 [inline]\n\
  \   sock_sendmsg+0xcf/0x120 net/socket.c:671\n   ____sys_sendmsg+0x6e8/0x810 net/socket.c:2353\n\
  \   ___sys_sendmsg+0xf3/0x170 net/socket.c:2407\n   __sys_sendmsg+0xe5/0x1b0 net/socket.c:2440\n\
  \   do_syscall_64+0x2d/0x70 arch/x86/entry/common.c:46\n   entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\
  \  RIP: 0033:0x443699\n\nLink: https://lore.kernel.org/r/20201030093803.278830-1-parav@nvidia.com\n\
  Reported-by: syzbot+34dc2fea3478e659af01@syzkaller.appspotmail.com\nFixes: e0477b34d9d1\
  \ (\"RDMA: Explicitly pass in the dma_device to ib_register_device\")\nSigned-off-by:\
  \ Parav Pandit <parav@nvidia.com>\nTested-by: Guoqing Jiang <guoqing.jiang@cloud.ionos.com>\n\
  Tested-by: Dennis Dalessandro <dennis.dalessandro@cornelisnetworks.com>\nReviewed-by:\
  \ Christoph Hellwig <hch@lst.de>\nAcked-by: Zhu Yanjun <yanjunz@nvidia.com>\nSigned-off-by:\
  \ Jason Gunthorpe <jgg@nvidia.com>\n"
submodule:
- drivers/infiniband/sw/rdmavt
- drivers/infiniband/sw/rxe
- drivers/infiniband/sw/siw
hunk_count: 6
covered_count: 1
