id: 37db7b2a61b64a9abb81
bug_link: https://syzkaller.appspot.com/bug?extid=37db7b2a61b64a9abb81
title: 'KASAN: slab-out-of-bounds Read in cap_inode_getsecurity'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 30a7acd573899fd8b8ac39236eff6468b195ac7d
fix_commit: dc32b5c3e6e2ef29cef76d9ce1b92d394446150e
datetime: '2018-01-02T20:49:13+11:00'
fix_commit_message: "capabilities: fix buffer overread on very short xattr\n\nIf userspace\
  \ attempted to set a \"security.capability\" xattr shorter than\n4 bytes (e.g. 'setfattr\
  \ -n security.capability -v x file'), then\ncap_convert_nscap() read past the end\
  \ of the buffer containing the xattr\nvalue because it accessed the ->magic_etc\
  \ field without verifying that\nthe xattr value is long enough to contain that field.\n\
  \nFix it by validating the xattr value size first.\n\nThis bug was found using syzkaller\
  \ with KASAN.  The KASAN report was as\nfollows (cleaned up slightly):\n\n    BUG:\
  \ KASAN: slab-out-of-bounds in cap_convert_nscap+0x514/0x630 security/commoncap.c:498\n\
  \    Read of size 4 at addr ffff88002d8741c0 by task syz-executor1/2852\n\n    CPU:\
  \ 0 PID: 2852 Comm: syz-executor1 Not tainted 4.15.0-rc6-00200-gcc0aac99d977 #253\n\
  \    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.11.0-20171110_100015-anatol\
  \ 04/01/2014\n    Call Trace:\n     __dump_stack lib/dump_stack.c:17 [inline]\n\
  \     dump_stack+0xe3/0x195 lib/dump_stack.c:53\n     print_address_description+0x73/0x260\
  \ mm/kasan/report.c:252\n     kasan_report_error mm/kasan/report.c:351 [inline]\n\
  \     kasan_report+0x235/0x350 mm/kasan/report.c:409\n     cap_convert_nscap+0x514/0x630\
  \ security/commoncap.c:498\n     setxattr+0x2bd/0x350 fs/xattr.c:446\n     path_setxattr+0x168/0x1b0\
  \ fs/xattr.c:472\n     SYSC_setxattr fs/xattr.c:487 [inline]\n     SyS_setxattr+0x36/0x50\
  \ fs/xattr.c:483\n     entry_SYSCALL_64_fastpath+0x18/0x85\n\nFixes: 8db6c34f1dbc\
  \ (\"Introduce v3 namespaced file capabilities\")\nCc: <stable@vger.kernel.org>\
  \ # v4.14+\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nReviewed-by: Serge\
  \ Hallyn <serge@hallyn.com>\nSigned-off-by: James Morris <james.l.morris@oracle.com>\n"
submodule:
- security
hunk_count: 5
covered_count: 3
