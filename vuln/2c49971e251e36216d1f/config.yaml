id: 2c49971e251e36216d1f
bug_link: https://syzkaller.appspot.com/bug?extid=2c49971e251e36216d1f
title: 'WARNING: bad usercopy in fanotify_read'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 62c9d2674b31d4c8a674bee86b7edc6da2803aea
fix_commit: b2d22b6bb33aac10c415e4ba13c8eade201c6f09
datetime: '2019-03-19T09:29:07+01:00'
fix_commit_message: 'fanotify: Allow copying of file handle to userspace


  When file handle is embedded inside fanotify_event and usercopy checks

  are enabled, we get a warning like:


  Bad or missing usercopy whitelist? Kernel memory exposure attempt detected

  from SLAB object ''fanotify_event'' (offset 40, size 8)!

  WARNING: CPU: 1 PID: 7649 at mm/usercopy.c:78 usercopy_warn+0xeb/0x110

  mm/usercopy.c:78


  Annotate handling in fanotify_event properly to mark copying it to

  userspace is fine.


  Reported-by: syzbot+2c49971e251e36216d1f@syzkaller.appspotmail.com

  Fixes: a8b13aa20afb ("fanotify: enable FAN_REPORT_FID init flag")

  Signed-off-by: Kees Cook <keescook@chromium.org>

  Reviewed-by: Amir Goldstein <amir73il@gmail.com>

  Signed-off-by: Jan Kara <jack@suse.cz>

  '
submodule:
- fs/notify
hunk_count: 2
covered_count: 2
