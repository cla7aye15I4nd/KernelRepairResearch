id: 859119106243eb95085b
bug_link: https://syzkaller.appspot.com/bug?extid=859119106243eb95085b
title: memory leak in kobject_set_name_vargs (4)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a7a69d8ba88d8dcee7ef00e91d413a4bd003a814
fix_commit: 8fd0c1b0647a6bda4067ee0cd61e8395954b6f28
datetime: '2021-06-24T19:40:53-07:00'
fix_commit_message: "nilfs2: fix memory leak in nilfs_sysfs_delete_device_group\n\n\
  My local syzbot instance hit memory leak in nilfs2.  The problem was in\nmissing\
  \ kobject_put() in nilfs_sysfs_delete_device_group().\n\nkobject_del() does not\
  \ call kobject_cleanup() for passed kobject and it\nleads to leaking duped kobject\
  \ name if kobject_put() was not called.\n\nFail log:\n\n  BUG: memory leak\n  unreferenced\
  \ object 0xffff8880596171e0 (size 8):\n  comm \"syz-executor379\", pid 8381, jiffies\
  \ 4294980258 (age 21.100s)\n  hex dump (first 8 bytes):\n    6c 6f 6f 70 30 00 00\
  \ 00                          loop0...\n  backtrace:\n     kstrdup+0x36/0x70 mm/util.c:60\n\
  \     kstrdup_const+0x53/0x80 mm/util.c:83\n     kvasprintf_const+0x108/0x190 lib/kasprintf.c:48\n\
  \     kobject_set_name_vargs+0x56/0x150 lib/kobject.c:289\n     kobject_add_varg\
  \ lib/kobject.c:384 [inline]\n     kobject_init_and_add+0xc9/0x160 lib/kobject.c:473\n\
  \     nilfs_sysfs_create_device_group+0x150/0x800 fs/nilfs2/sysfs.c:999\n     init_nilfs+0xe26/0x12b0\
  \ fs/nilfs2/the_nilfs.c:637\n\nLink: https://lkml.kernel.org/r/20210612140559.20022-1-paskripkin@gmail.com\n\
  Fixes: da7141fb78db (\"nilfs2: add /sys/fs/nilfs2/<device> group\")\nSigned-off-by:\
  \ Pavel Skripkin <paskripkin@gmail.com>\nAcked-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>\n\
  Cc: Michael L. Semon <mlsemon35@gmail.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\n\
  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>\n"
submodule:
- fs/nilfs2
hunk_count: 1
covered_count: 0
