id: aafb3f37cfeb6534c4ac
bug_link: https://syzkaller.appspot.com/bug?extid=aafb3f37cfeb6534c4ac
title: WARNING in rmqueue
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 12c2987e896bd1c433150a64f5bae9993c29d551
fix_commit: cc4efd3dd2ac9f89143e5d881609747ecff04164
datetime: '2023-04-17T01:15:49+08:00'
fix_commit_message: "erofs: stop parsing non-compact HEAD index if clusterofs is invalid\n\
  \nSyzbot generated a crafted image [1] with a non-compact HEAD index of\nclusterofs\
  \ 33024 while valid numbers should be 0 ~ lclustersize-1,\nwhich causes the following\
  \ unexpected behavior as below:\n\n BUG: unable to handle page fault for address:\
  \ fffff52101a3fff9\n #PF: supervisor read access in kernel mode\n #PF: error_code(0x0000)\
  \ - not-present page\n PGD 23ffed067 P4D 23ffed067 PUD 0\n Oops: 0000 [#1] PREEMPT\
  \ SMP KASAN\n CPU: 1 PID: 4398 Comm: kworker/u5:1 Not tainted 6.3.0-rc6-syzkaller-g09a9639e56c0\
  \ #0\n Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google\
  \ 03/30/2023\n Workqueue: erofs_worker z_erofs_decompressqueue_work\n RIP: 0010:z_erofs_decompress_queue+0xb7e/0x2b40\n\
  \ ...\n Call Trace:\n  <TASK>\n  z_erofs_decompressqueue_work+0x99/0xe0\n  process_one_work+0x8f6/0x1170\n\
  \  worker_thread+0xa63/0x1210\n  kthread+0x270/0x300\n  ret_from_fork+0x1f/0x30\n\
  \nNote that normal images or images using compact indexes are not\nimpacted.  Let's\
  \ fix this now.\n\n[1] https://lore.kernel.org/r/000000000000ec75b005ee97fbaa@google.com\n\
  \nReported-and-tested-by: syzbot+aafb3f37cfeb6534c4ac@syzkaller.appspotmail.com\n\
  Fixes: 02827e1796b3 (\"staging: erofs: add erofs_map_blocks_iter\")\nFixes: 152a333a5895\
  \ (\"staging: erofs: add compacted compression indexes support\")\nSigned-off-by:\
  \ Gao Xiang <hsiangkao@linux.alibaba.com>\nReviewed-by: Chao Yu <chao@kernel.org>\n\
  Link: https://lore.kernel.org/r/20230410173714.104604-1-hsiangkao@linux.alibaba.com\n"
submodule:
- fs/erofs
hunk_count: 1
covered_count: 0
