id: 90b8e10515ae88228a92
bug_link: https://syzkaller.appspot.com/bug?extid=90b8e10515ae88228a92
title: 'KASAN: invalid-free in fat_fill_super'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5a6964944cdfe83de849a5f748f51c983f9914ec
fix_commit: 35033ab988c396ad7bce3b6d24060c16a9066db8
datetime: '2018-07-21T12:50:46-07:00'
fix_commit_message: 'fat: fix memory allocation failure handling of match_strdup()


  In parse_options(), if match_strdup() failed, parse_options() leaves

  opts->iocharset in unexpected state (i.e.  still pointing the freed

  string).  And this can be the cause of double free.


  To fix, this initialize opts->iocharset always when freeing.


  Link: http://lkml.kernel.org/r/8736wp9dzc.fsf@mail.parknet.co.jp

  Signed-off-by: OGAWA Hirofumi <hirofumi@mail.parknet.co.jp>

  Reported-by: syzbot+90b8e10515ae88228a92@syzkaller.appspotmail.com

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

  '
submodule:
- fs/fat
hunk_count: 4
covered_count: 2
