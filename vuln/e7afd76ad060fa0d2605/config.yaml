id: e7afd76ad060fa0d2605
bug_link: https://syzkaller.appspot.com/bug?extid=e7afd76ad060fa0d2605
title: memory leak in class_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1e94be78ec1556e90056ac038b15231723d315a9
fix_commit: ddaf098ea779b3c1302c7843f6ff01e89b1fd380
datetime: '2023-05-19T11:03:36+01:00'
fix_commit_message: 'driver core: class: properly reference count class_dev_iter()


  When class_dev_iter is initialized, the reference count for the subsys

  private structure is incremented, but never decremented, causing a

  memory leak over time.  To resolve this, save off a pointer to the

  internal structure into the class_dev_iter structure and then when the

  iterator is finished, drop the reference count.


  Reported-and-tested-by: syzbot+e7afd76ad060fa0d2605@syzkaller.appspotmail.com

  Fixes: 7b884b7f24b4 ("driver core: class.c: convert to only use class_to_subsys")

  Reported-by: Mirsad Goran Todorovac <mirsad.todorovac@alu.unizg.hr>

  Cc: Alan Stern <stern@rowland.harvard.edu>

  Acked-by: Rafael J. Wysocki <rafael@kernel.org>

  Tested-by: Mirsad Goran Todorovac <mirsad.todorovac@alu.unizg.hr>

  Link: https://lore.kernel.org/r/2023051610-stove-condense-9a77@gregkh

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/base
- include/linux/device
hunk_count: 3
covered_count: 1
