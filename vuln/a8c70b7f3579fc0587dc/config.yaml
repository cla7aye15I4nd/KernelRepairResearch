id: a8c70b7f3579fc0587dc
bug_link: https://syzkaller.appspot.com/bug?extid=a8c70b7f3579fc0587dc
title: 'WARNING: bad unlock balance in __get_user_pages_remote'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ba841078cd0557b43b59c63f5c048b12168f0db2
fix_commit: c7b6a566b98524baea6a244186e665d22b633545
datetime: '2020-04-07T19:34:31-07:00'
fix_commit_message: 'mm/gup: Mark lock taken only after a successful retake


  It''s definitely incorrect to mark the lock as taken even if

  down_read_killable() failed.


  This wass overlooked when we switched from down_read() to

  down_read_killable() because down_read() won''t fail while

  down_read_killable() could.


  Fixes: 71335f37c5e8 ("mm/gup: allow to react to fatal signals")

  Reported-by: syzbot+a8c70b7f3579fc0587dc@syzkaller.appspotmail.com

  Signed-off-by: Peter Xu <peterx@redhat.com>

  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

  '
submodule:
- mm
hunk_count: 2
covered_count: 2
