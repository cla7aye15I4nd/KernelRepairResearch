id: a61bac2fcc1a7c6623fe
bug_link: https://syzkaller.appspot.com/bug?extid=a61bac2fcc1a7c6623fe
title: general protection fault in vsock_poll
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 41077c99026643c633a1f79376d369fffc757e06
fix_commit: 1980c05844830a44708c98c96d600833aa3fae08
datetime: '2020-08-12T12:56:06-07:00'
fix_commit_message: "vsock: fix potential null pointer dereference in vsock_poll()\n\
  \nsyzbot reported this issue where in the vsock_poll() we find the\nsocket state\
  \ at TCP_ESTABLISHED, but 'transport' is null:\n  general protection fault, probably\
  \ for non-canonical address 0xdffffc0000000012: 0000 [#1] PREEMPT SMP KASAN\n  KASAN:\
  \ null-ptr-deref in range [0x0000000000000090-0x0000000000000097]\n  CPU: 0 PID:\
  \ 8227 Comm: syz-executor.2 Not tainted 5.8.0-rc7-syzkaller #0\n  Hardware name:\
  \ Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\n \
  \ RIP: 0010:vsock_poll+0x75a/0x8e0 net/vmw_vsock/af_vsock.c:1038\n  Call Trace:\n\
  \   sock_poll+0x159/0x460 net/socket.c:1266\n   vfs_poll include/linux/poll.h:90\
  \ [inline]\n   do_pollfd fs/select.c:869 [inline]\n   do_poll fs/select.c:917 [inline]\n\
  \   do_sys_poll+0x607/0xd40 fs/select.c:1011\n   __do_sys_poll fs/select.c:1069\
  \ [inline]\n   __se_sys_poll fs/select.c:1057 [inline]\n   __x64_sys_poll+0x18c/0x440\
  \ fs/select.c:1057\n   do_syscall_64+0x60/0xe0 arch/x86/entry/common.c:384\n   entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\
  \nThis issue can happen if the TCP_ESTABLISHED state is set after we read\nthe vsk->transport\
  \ in the vsock_poll().\n\nWe could put barriers to synchronize, but this can only\
  \ happen during\nconnection setup, so we can simply check that 'transport' is valid.\n\
  \nFixes: c0cfa2d8a788 (\"vsock: add multi-transports support\")\nReported-and-tested-by:\
  \ syzbot+a61bac2fcc1a7c6623fe@syzkaller.appspotmail.com\nSigned-off-by: Stefano\
  \ Garzarella <sgarzare@redhat.com>\nReviewed-by: Jorgen Hansen <jhansen@vmware.com>\n\
  Signed-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/vmw_vsock
hunk_count: 1
covered_count: 1
