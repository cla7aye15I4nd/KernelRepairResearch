id: 87c490fd2be656269b6a
bug_link: https://syzkaller.appspot.com/bug?extid=87c490fd2be656269b6a
title: inconsistent lock state in lru_gen_rotate_memcg
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0518dbe97fe629fea255318841cf3ef1b4532d66
fix_commit: 814bc1de03ea4361101408e63a68e4b82aef22cb
datetime: '2023-06-23T16:10:12-07:00'
fix_commit_message: 'mm/mglru: make memcg_lru->lock irq safe


  lru_gen_rotate_memcg() can happen in softirq if memory.soft_limit_in_bytes

  is set.  This requires memcg_lru->lock to be irq safe.  Lockdep warns on

  this.


  This problem only affects memcg v1.


  Link: https://lkml.kernel.org/r/20230619193821.2710944-1-yuzhao@google.com

  Fixes: e4dde56cd208 ("mm: multi-gen LRU: per-node lru_gen_folio lists")

  Signed-off-by: Yu Zhao <yuzhao@google.com>

  Reported-by: syzbot+87c490fd2be656269b6a@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=87c490fd2be656269b6a

  Reviewed-by: Yosry Ahmed <yosryahmed@google.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- mm
hunk_count: 6
covered_count: 6
