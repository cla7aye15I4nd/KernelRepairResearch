id: fd555292a1da3180fc82
bug_link: https://syzkaller.appspot.com/bug?extid=fd555292a1da3180fc82
title: WARNING in __kvm_gpc_refresh (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: dee67a94d4c6cbd05b8f6e1181498e94caa33334
fix_commit: ebbdf37ce9abb597015fa85df6630ebfa7d0a97f
datetime: '2024-06-28T08:31:46-07:00'
fix_commit_message: 'KVM: Validate hva in kvm_gpc_activate_hva() to fix __kvm_gpc_refresh()
  WARN


  Check that the virtual address is "ok" when activating a gfn_to_pfn_cache

  with a host VA to ensure that KVM never attempts to use a bad address.


  This fixes a bug where KVM fails to check the incoming address when

  handling KVM_XEN_VCPU_ATTR_TYPE_VCPU_INFO_HVA in kvm_xen_vcpu_set_attr().


  Reported-by: syzbot+fd555292a1da3180fc82@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=fd555292a1da3180fc82

  Tested-by: syzbot+fd555292a1da3180fc82@syzkaller.appspotmail.com

  Signed-off-by: Pei Li <peili.dev@gmail.com>

  Reviewed-by: Paul Durrant <paul@xen.org>

  Reviewed-by: David Woodhouse <dwmw@amazon.co.uk>

  Link: https://lore.kernel.org/r/20240627-bug5-v2-1-2c63f7ee6739@gmail.com

  [sean: rewrite changelog with --verbose]

  Signed-off-by: Sean Christopherson <seanjc@google.com>

  '
submodule:
- arch/x86/kvm
- virt/kvm
hunk_count: 2
covered_count: 1
