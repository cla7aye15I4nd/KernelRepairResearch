id: 08106c4b7d60702dbc14
bug_link: https://syzkaller.appspot.com/bug?extid=08106c4b7d60702dbc14
title: WARNING in ext4_iomap_overwrite_begin
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4f04351888a83e595571de672e0a4a8b74f4fb31
fix_commit: fa83c34e3e56b3c672af38059e066242655271b1
datetime: '2023-05-13T18:05:04-04:00'
fix_commit_message: 'ext4: check iomap type only if ext4_iomap_begin() does not fail


  When ext4_iomap_overwrite_begin() calls ext4_iomap_begin() map blocks may

  fail for some reason (e.g. memory allocation failure, bare disk write), and

  later because "iomap->type ! = IOMAP_MAPPED" triggers WARN_ON(). When ext4

  iomap_begin() returns an error, it is normal that the type of iomap->type

  may not match the expectation. Therefore, we only determine if iomap->type

  is as expected when ext4_iomap_begin() is executed successfully.


  Cc: stable@kernel.org

  Reported-by: syzbot+08106c4b7d60702dbc14@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/all/00000000000015760b05f9b4eee9@google.com

  Signed-off-by: Baokun Li <libaokun1@huawei.com>

  Reviewed-by: Jan Kara <jack@suse.cz>

  Link: https://lore.kernel.org/r/20230505132429.714648-1-libaokun1@huawei.com

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 1
covered_count: 0
