id: dce5aae19ae4d6399986
bug_link: https://syzkaller.appspot.com/bug?extid=dce5aae19ae4d6399986
title: WARNING in bpf_map_lookup_percpu_elem
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 86bc9c742426a16b52a10ef61f5b721aecca2344
fix_commit: d4965578267e2e81f67c86e2608481e77e9c8569
datetime: '2025-05-27T10:45:59-07:00'
fix_commit_message: 'bpf: Check rcu_read_lock_trace_held() in bpf_map_lookup_percpu_elem()


  bpf_map_lookup_percpu_elem() helper is also available for sleepable bpf

  program. When BPF JIT is disabled or under 32-bit host,

  bpf_map_lookup_percpu_elem() will not be inlined. Using it in a

  sleepable bpf program will trigger the warning in

  bpf_map_lookup_percpu_elem(), because the bpf program only holds

  rcu_read_lock_trace lock. Therefore, add the missed check.


  Reported-by: syzbot+dce5aae19ae4d6399986@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/bpf/000000000000176a130617420310@google.com/

  Signed-off-by: Hou Tao <houtao1@huawei.com>

  Link: https://lore.kernel.org/r/20250526062534.1105938-1-houtao@huaweicloud.com

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
