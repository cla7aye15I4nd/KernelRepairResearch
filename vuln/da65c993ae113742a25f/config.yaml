id: da65c993ae113742a25f
bug_link: https://syzkaller.appspot.com/bug?extid=da65c993ae113742a25f
title: kernel BUG in pskb_expand_head (4)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a466fd7e9fafd975949e5945e2f70c33a94b1a70
fix_commit: 64e6a754d33d31aa844b3ee66fb93ac84ca1565e
datetime: '2025-03-03T14:00:04+00:00'
fix_commit_message: "llc: do not use skb_get() before dev_queue_xmit()\n\nsyzbot is\
  \ able to crash hosts [1], using llc and devices\nnot supporting IFF_TX_SKB_SHARING.\n\
  \nIn this case, e1000 driver calls eth_skb_pad(), while\nthe skb is shared.\n\n\
  Simply replace skb_get() by skb_clone() in net/llc/llc_s_ac.c\n\nNote that e1000\
  \ driver might have an issue with pktgen,\nbecause it does not clear IFF_TX_SKB_SHARING,\
  \ this is an\northogonal change.\n\nWe need to audit other skb_get() uses in net/llc.\n\
  \n[1]\n\nkernel BUG at net/core/skbuff.c:2178 !\nOops: invalid opcode: 0000 [#1]\
  \ PREEMPT SMP KASAN NOPTI\nCPU: 0 UID: 0 PID: 16371 Comm: syz.2.2764 Not tainted\
  \ 6.14.0-rc4-syzkaller-00052-gac9c34d1e45a #0\nHardware name: QEMU Standard PC (Q35\
  \ + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2~bpo12+1 04/01/2014\n RIP: 0010:pskb_expand_head+0x6ce/0x1240\
  \ net/core/skbuff.c:2178\nCall Trace:\n <TASK>\n  __skb_pad+0x18a/0x610 net/core/skbuff.c:2466\n\
  \  __skb_put_padto include/linux/skbuff.h:3843 [inline]\n  skb_put_padto include/linux/skbuff.h:3862\
  \ [inline]\n  eth_skb_pad include/linux/etherdevice.h:656 [inline]\n  e1000_xmit_frame+0x2d99/0x5800\
  \ drivers/net/ethernet/intel/e1000/e1000_main.c:3128\n  __netdev_start_xmit include/linux/netdevice.h:5151\
  \ [inline]\n  netdev_start_xmit include/linux/netdevice.h:5160 [inline]\n  xmit_one\
  \ net/core/dev.c:3806 [inline]\n  dev_hard_start_xmit+0x9a/0x7b0 net/core/dev.c:3822\n\
  \  sch_direct_xmit+0x1ae/0xc30 net/sched/sch_generic.c:343\n  __dev_xmit_skb net/core/dev.c:4045\
  \ [inline]\n  __dev_queue_xmit+0x13d4/0x43e0 net/core/dev.c:4621\n  dev_queue_xmit\
  \ include/linux/netdevice.h:3313 [inline]\n  llc_sap_action_send_test_c+0x268/0x320\
  \ net/llc/llc_s_ac.c:144\n  llc_exec_sap_trans_actions net/llc/llc_sap.c:153 [inline]\n\
  \  llc_sap_next_state net/llc/llc_sap.c:182 [inline]\n  llc_sap_state_process+0x239/0x510\
  \ net/llc/llc_sap.c:209\n  llc_ui_sendmsg+0xd0d/0x14e0 net/llc/af_llc.c:993\n  sock_sendmsg_nosec\
  \ net/socket.c:718 [inline]\n\nFixes: 1da177e4c3f4 (\"Linux-2.6.12-rc2\")\nReported-by:\
  \ syzbot+da65c993ae113742a25f@syzkaller.appspotmail.com\nCloses: https://lore.kernel.org/netdev/67c020c0.050a0220.222324.0011.GAE@google.com/T/#u\n\
  Signed-off-by: Eric Dumazet <edumazet@google.com>\nReviewed-by: Simon Horman <horms@kernel.org>\n\
  Signed-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/llc
hunk_count: 5
covered_count: 4
