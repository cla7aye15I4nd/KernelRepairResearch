id: 93976391bf299d425f44
bug_link: https://syzkaller.appspot.com/bug?extid=93976391bf299d425f44
title: 'KASAN: invalid-free in ieee80211_ibss_leave'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1944015fe9c1d9fa5e9eb7ffbbb5ef8954d6753b
fix_commit: 3bd801b14e0c5d29eeddc7336558beb3344efaa3
datetime: '2021-03-16T21:13:09+01:00'
fix_commit_message: "mac80211: fix double free in ibss_leave\n\nClear beacon ie pointer\
  \ and ie length after free\nin order to prevent double free.\n\n==================================================================\n\
  BUG: KASAN: double-free or invalid-free \\\nin ieee80211_ibss_leave+0x83/0xe0 net/mac80211/ibss.c:1876\n\
  \nCPU: 0 PID: 8472 Comm: syz-executor100 Not tainted 5.11.0-rc6-syzkaller #0\nCall\
  \ Trace:\n __dump_stack lib/dump_stack.c:79 [inline]\n dump_stack+0x107/0x163 lib/dump_stack.c:120\n\
  \ print_address_description.constprop.0.cold+0x5b/0x2c6 mm/kasan/report.c:230\n\
  \ kasan_report_invalid_free+0x51/0x80 mm/kasan/report.c:355\n ____kasan_slab_free+0xcc/0xe0\
  \ mm/kasan/common.c:341\n kasan_slab_free include/linux/kasan.h:192 [inline]\n __cache_free\
  \ mm/slab.c:3424 [inline]\n kfree+0xed/0x270 mm/slab.c:3760\n ieee80211_ibss_leave+0x83/0xe0\
  \ net/mac80211/ibss.c:1876\n rdev_leave_ibss net/wireless/rdev-ops.h:545 [inline]\n\
  \ __cfg80211_leave_ibss+0x19a/0x4c0 net/wireless/ibss.c:212\n __cfg80211_leave+0x327/0x430\
  \ net/wireless/core.c:1172\n cfg80211_leave net/wireless/core.c:1221 [inline]\n\
  \ cfg80211_netdev_notifier_call+0x9e8/0x12c0 net/wireless/core.c:1335\n notifier_call_chain+0xb5/0x200\
  \ kernel/notifier.c:83\n call_netdevice_notifiers_info+0xb5/0x130 net/core/dev.c:2040\n\
  \ call_netdevice_notifiers_extack net/core/dev.c:2052 [inline]\n call_netdevice_notifiers\
  \ net/core/dev.c:2066 [inline]\n __dev_close_many+0xee/0x2e0 net/core/dev.c:1586\n\
  \ __dev_close net/core/dev.c:1624 [inline]\n __dev_change_flags+0x2cb/0x730 net/core/dev.c:8476\n\
  \ dev_change_flags+0x8a/0x160 net/core/dev.c:8549\n dev_ifsioc+0x210/0xa70 net/core/dev_ioctl.c:265\n\
  \ dev_ioctl+0x1b1/0xc40 net/core/dev_ioctl.c:511\n sock_do_ioctl+0x148/0x2d0 net/socket.c:1060\n\
  \ sock_ioctl+0x477/0x6a0 net/socket.c:1177\n vfs_ioctl fs/ioctl.c:48 [inline]\n\
  \ __do_sys_ioctl fs/ioctl.c:753 [inline]\n __se_sys_ioctl fs/ioctl.c:739 [inline]\n\
  \ __x64_sys_ioctl+0x193/0x200 fs/ioctl.c:739\n do_syscall_64+0x2d/0x70 arch/x86/entry/common.c:46\n\
  \ entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\nReported-by: syzbot+93976391bf299d425f44@syzkaller.appspotmail.com\n\
  Signed-off-by: Markus Theil <markus.theil@tu-ilmenau.de>\nLink: https://lore.kernel.org/r/20210213133653.367130-1-markus.theil@tu-ilmenau.de\n\
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>\n"
submodule:
- net/mac80211
hunk_count: 1
covered_count: 1
