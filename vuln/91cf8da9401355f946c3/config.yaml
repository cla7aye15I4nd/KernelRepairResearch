id: 91cf8da9401355f946c3
bug_link: https://syzkaller.appspot.com/bug?extid=91cf8da9401355f946c3
title: 'KASAN: slab-use-after-free Read in __mmap_region'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f5d09de9f1bf9674c6418ff10d0a40cfe29268e1
fix_commit: 42c4e4b20d9c4651903c4afc53a4ff18b7451b3e
datetime: '2024-12-18T19:04:42-08:00'
fix_commit_message: 'mm: correctly reference merged VMA


  On second merge attempt on mmap() we incorrectly discard the possibly

  merged VMA, resulting in a possible use-after-free (and most certainly a

  reference to the wrong VMA) in this instance in the subsequent

  __mmap_complete() invocation.


  Correct this mistake by reassigning vma correctly if a merge succeeds in

  this case.


  Link: https://lkml.kernel.org/r/20241206215229.244413-1-lorenzo.stoakes@oracle.com

  Fixes: 5ac87a885aec ("mm: defer second attempt at merge on mmap()")

  Signed-off-by: Lorenzo Stoakes <lorenzo.stoakes@oracle.com>

  Suggested-by: Jann Horn <jannh@google.com>

  Reported-by: syzbot+91cf8da9401355f946c3@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/67536a25.050a0220.a30f1.0149.GAE@google.com/

  Reviewed-by: Liam R. Howlett <Liam.Howlett@Oracle.com>

  Reviewed-by: Vlastimil Babka <vbabka@suse.cz>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- mm
hunk_count: 1
covered_count: 1
