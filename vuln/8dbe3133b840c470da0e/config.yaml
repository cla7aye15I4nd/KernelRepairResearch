id: 8dbe3133b840c470da0e
bug_link: https://syzkaller.appspot.com/bug?extid=8dbe3133b840c470da0e
title: WARNING in sock_map_close (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7888173eb18063c15e10d099310a58ab8c3a4b44
fix_commit: 1461f5a3d810869e182f1d11caaac7dee0458ff7
datetime: '2024-08-26T09:55:40-07:00'
fix_commit_message: 'l2tp: avoid overriding sk->sk_user_data


  Although commit 4a4cd70369f1 ("l2tp: don''t set sk_user_data in tunnel socket")

  removed sk->sk_user_data usage, setup_udp_tunnel_sock() still touches

  sk->sk_user_data, this conflicts with sockmap which also leverages

  sk->sk_user_data to save psock.


  Restore this sk->sk_user_data check to avoid such conflicts.


  Fixes: 4a4cd70369f1 ("l2tp: don''t set sk_user_data in tunnel socket")

  Reported-by: syzbot+8dbe3133b840c470da0e@syzkaller.appspotmail.com

  Cc: Tom Parkin <tparkin@katalix.com>

  Signed-off-by: Cong Wang <cong.wang@bytedance.com>

  Tested-by: James Chapman <jchapman@katalix.com>

  Reviewed-by: James Chapman <jchapman@katalix.com>

  Link: https://patch.msgid.link/20240822182544.378169-1-xiyou.wangcong@gmail.com

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- net/l2tp
hunk_count: 1
covered_count: 0
