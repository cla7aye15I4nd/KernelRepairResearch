id: 5245cb609175fb6e8122
bug_link: https://syzkaller.appspot.com/bug?extid=5245cb609175fb6e8122
title: upstream build error (23)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 94fd44648dae2a5b6149a41faa0b07928c3e1963
fix_commit: f627b51aaa041cba715b59026cf2d9cb1476c7ed
datetime: '2025-07-29T17:19:35-07:00'
fix_commit_message: 'compiler_types: Provide __no_kstack_erase to disable coverage
  only on Clang


  In order to support Clang''s stack depth tracking (for Linux''s kstack_erase

  feature), the coverage sanitizer needed to be disabled for __init (and

  __head) section code. Doing this universally (i.e. for GCC too) created

  a number of unexpected problems, ranging from changes to inlining logic

  to failures to DCE code on earlier GCC versions.


  Since this change is only needed for Clang, specialize it so that GCC

  doesn''t see the change as it isn''t needed there (the GCC implementation

  of kstack_erase uses a GCC plugin that removes stack depth tracking

  instrumentation from __init sections during a late pass in the IR).


  Successfully build and boot tested with GCC 12 and Clang 22.


  Fixes: 381a38ea53d2 ("init.h: Disable sanitizer coverage for __init and __head")

  Reported-by: kernel test robot <lkp@intel.com>

  Closes: https://lore.kernel.org/oe-kbuild-all/202507270258.neWuiXLd-lkp@intel.com/

  Reported-by: syzbot+5245cb609175fb6e8122@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/6888d004.a00a0220.26d0e1.0004.GAE@google.com/

  Reviewed-by: Nathan Chancellor <nathan@kernel.org>

  Reviewed-by: Marco Elver <elver@google.com>

  Link: https://lore.kernel.org/r/20250729234055.it.233-kees@kernel.org

  Signed-off-by: Kees Cook <kees@kernel.org>

  '
submodule:
- arch/x86/include/asm
- include/linux
hunk_count: 4
covered_count: 0
