id: ba2e91df8f74809417fa
bug_link: https://syzkaller.appspot.com/bug?extid=ba2e91df8f74809417fa
title: 'UBSAN: shift-out-of-bounds in xprt_calc_majortimeo'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f892c41c14e0fa3d78ce37de1d5c8161ed13bf08
fix_commit: c09f11ef35955785f92369e25819bf0629df2e59
datetime: '2021-04-05T09:04:20-04:00'
fix_commit_message: 'NFS: fs_context: validate UDP retrans to prevent shift out-of-bounds


  Fix shift out-of-bounds in xprt_calc_majortimeo(). This is caused

  by a garbage timeout (retrans) mount option being passed to nfs mount,

  in this case from syzkaller.


  If the protocol is XPRT_TRANSPORT_UDP, then ''retrans'' is a shift

  value for a 64-bit long integer, so ''retrans'' cannot be >= 64.

  If it is >= 64, fail the mount and return an error.


  Fixes: 9954bf92c0cd ("NFS: Move mount parameterisation bits into their own file")

  Reported-by: syzbot+ba2e91df8f74809417fa@syzkaller.appspotmail.com

  Reported-by: syzbot+f3a0fa110fd630ab56c8@syzkaller.appspotmail.com

  Signed-off-by: Randy Dunlap <rdunlap@infradead.org>

  Cc: Trond Myklebust <trond.myklebust@hammerspace.com>

  Cc: Anna Schumaker <anna.schumaker@netapp.com>

  Cc: linux-nfs@vger.kernel.org

  Cc: David Howells <dhowells@redhat.com>

  Cc: Al Viro <viro@zeniv.linux.org.uk>

  Cc: stable@vger.kernel.org

  Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>

  '
submodule:
- fs/nfs
hunk_count: 2
covered_count: 0
