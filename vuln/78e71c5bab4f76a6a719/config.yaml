id: 78e71c5bab4f76a6a719
bug_link: https://syzkaller.appspot.com/bug?extid=78e71c5bab4f76a6a719
title: 'KASAN: use-after-free Read in rxrpc_queue_local'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b00df840fb4004b7087940ac5f68801562d0d2de
fix_commit: 06d9532fa6b34f12a6d75711162d47c17c1add72
datetime: '2019-08-14T11:37:51+01:00'
fix_commit_message: 'rxrpc: Fix read-after-free in rxrpc_queue_local()


  rxrpc_queue_local() attempts to queue the local endpoint it is given and

  then, if successful, prints a trace line.  The trace line includes the

  current usage count - but we''re not allowed to look at the local endpoint

  at this point as we passed our ref on it to the workqueue.


  Fix this by reading the usage count before queuing the work item.


  Also fix the reading of local->debug_id for trace lines, which must be done

  with the same consideration as reading the usage count.


  Fixes: 09d2bf595db4 ("rxrpc: Add a tracepoint to track rxrpc_local refcounting")

  Reported-by: syzbot+78e71c5bab4f76a6a719@syzkaller.appspotmail.com

  Signed-off-by: David Howells <dhowells@redhat.com>

  '
submodule:
- include/trace/events
- net/rxrpc
hunk_count: 8
covered_count: 6
