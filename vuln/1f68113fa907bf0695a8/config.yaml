id: 1f68113fa907bf0695a8
bug_link: https://syzkaller.appspot.com/bug?extid=1f68113fa907bf0695a8
title: memory leak in skb_clone
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 889d0e7dc68314a273627d89cbb60c09e1cc1c25
fix_commit: 1090340f7ee53e824fd4eef66a4855d548110c5b
datetime: '2021-08-10T12:18:10+02:00'
fix_commit_message: "net: Fix memory leak in ieee802154_raw_deliver\n\nIf IEEE-802.15.4-RAW\
  \ is closed before receive skb, skb is leaked.\nFix this, by freeing sk_receive_queue\
  \ in sk->sk_destruct().\n\nsyzbot report:\nBUG: memory leak\nunreferenced object\
  \ 0xffff88810f644600 (size 232):\n  comm \"softirq\", pid 0, jiffies 4294967032\
  \ (age 81.270s)\n  hex dump (first 32 bytes):\n    10 7d 4b 12 81 88 ff ff 10 7d\
  \ 4b 12 81 88 ff ff  .}K......}K.....\n    00 00 00 00 00 00 00 00 40 7c 4b 12 81\
  \ 88 ff ff  ........@|K.....\n  backtrace:\n    [<ffffffff83651d4a>] skb_clone+0xaa/0x2b0\
  \ net/core/skbuff.c:1496\n    [<ffffffff83fe1b80>] ieee802154_raw_deliver net/ieee802154/socket.c:369\
  \ [inline]\n    [<ffffffff83fe1b80>] ieee802154_rcv+0x100/0x340 net/ieee802154/socket.c:1070\n\
  \    [<ffffffff8367cc7a>] __netif_receive_skb_one_core+0x6a/0xa0 net/core/dev.c:5384\n\
  \    [<ffffffff8367cd07>] __netif_receive_skb+0x27/0xa0 net/core/dev.c:5498\n  \
  \  [<ffffffff8367cdd9>] netif_receive_skb_internal net/core/dev.c:5603 [inline]\n\
  \    [<ffffffff8367cdd9>] netif_receive_skb+0x59/0x260 net/core/dev.c:5662\n   \
  \ [<ffffffff83fe6302>] ieee802154_deliver_skb net/mac802154/rx.c:29 [inline]\n \
  \   [<ffffffff83fe6302>] ieee802154_subif_frame net/mac802154/rx.c:102 [inline]\n\
  \    [<ffffffff83fe6302>] __ieee802154_rx_handle_packet net/mac802154/rx.c:212 [inline]\n\
  \    [<ffffffff83fe6302>] ieee802154_rx+0x612/0x620 net/mac802154/rx.c:284\n   \
  \ [<ffffffff83fe59a6>] ieee802154_tasklet_handler+0x86/0xa0 net/mac802154/main.c:35\n\
  \    [<ffffffff81232aab>] tasklet_action_common.constprop.0+0x5b/0x100 kernel/softirq.c:557\n\
  \    [<ffffffff846000bf>] __do_softirq+0xbf/0x2ab kernel/softirq.c:345\n    [<ffffffff81232f4c>]\
  \ do_softirq kernel/softirq.c:248 [inline]\n    [<ffffffff81232f4c>] do_softirq+0x5c/0x80\
  \ kernel/softirq.c:235\n    [<ffffffff81232fc1>] __local_bh_enable_ip+0x51/0x60\
  \ kernel/softirq.c:198\n    [<ffffffff8367a9a4>] local_bh_enable include/linux/bottom_half.h:32\
  \ [inline]\n    [<ffffffff8367a9a4>] rcu_read_unlock_bh include/linux/rcupdate.h:745\
  \ [inline]\n    [<ffffffff8367a9a4>] __dev_queue_xmit+0x7f4/0xf60 net/core/dev.c:4221\n\
  \    [<ffffffff83fe2db4>] raw_sendmsg+0x1f4/0x2b0 net/ieee802154/socket.c:295\n\
  \    [<ffffffff8363af16>] sock_sendmsg_nosec net/socket.c:654 [inline]\n    [<ffffffff8363af16>]\
  \ sock_sendmsg+0x56/0x80 net/socket.c:674\n    [<ffffffff8363deec>] __sys_sendto+0x15c/0x200\
  \ net/socket.c:1977\n    [<ffffffff8363dfb6>] __do_sys_sendto net/socket.c:1989\
  \ [inline]\n    [<ffffffff8363dfb6>] __se_sys_sendto net/socket.c:1985 [inline]\n\
  \    [<ffffffff8363dfb6>] __x64_sys_sendto+0x26/0x30 net/socket.c:1985\n\nFixes:\
  \ 9ec767160357 (\"net: add IEEE 802.15.4 socket family implementation\")\nReported-and-tested-by:\
  \ syzbot+1f68113fa907bf0695a8@syzkaller.appspotmail.com\nSigned-off-by: Takeshi\
  \ Misawa <jeliantsurux@gmail.com>\nAcked-by: Alexander Aring <aahringo@redhat.com>\n\
  Link: https://lore.kernel.org/r/20210805075414.GA15796@DESKTOP\nSigned-off-by: Stefan\
  \ Schmidt <stefan@datenfreihafen.org>\n"
submodule:
- net/ieee802154
hunk_count: 2
covered_count: 1
