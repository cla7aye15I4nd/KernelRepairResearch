id: 621409285c4156a009b3
bug_link: https://syzkaller.appspot.com/bug?extid=621409285c4156a009b3
title: 'KASAN: slab-use-after-free Read in pvr2_context_set_notify'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0cb8c9482501c46854ddb3d43b1bc05d771b9624
fix_commit: ded85b0c0edd8f45fec88783d7555a5b982449c1
datetime: '2023-11-23T13:35:08+01:00'
fix_commit_message: 'media: pvrusb2: fix use after free on context disconnection


  Upon module load, a kthread is created targeting the

  pvr2_context_thread_func function, which may call pvr2_context_destroy

  and thus call kfree() on the context object. However, that might happen

  before the usb hub_event handler is able to notify the driver. This

  patch adds a sanity check before the invalid read reported by syzbot,

  within the context disconnection call stack.


  Reported-and-tested-by: syzbot+621409285c4156a009b3@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/000000000000a02a4205fff8eb92@google.com/


  Fixes: e5be15c63804 ("V4L/DVB (7711): pvrusb2: Fix race on module unload")

  Signed-off-by: Ricardo B. Marliere <ricardo@marliere.net>

  Acked-by: Mike Isely <isely@pobox.com>

  Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>

  Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>

  '
submodule:
- drivers/media/usb/pvrusb2
hunk_count: 1
covered_count: 0
