id: 0e22d63dcebb802b9bc8
bug_link: https://syzkaller.appspot.com/bug?extid=0e22d63dcebb802b9bc8
title: WARNING in dlfb_submit_urb/usb_submit_urb (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 93f57c7a10890645d1d3b88eea1692b285bf3f38
fix_commit: ed9de4ed39875706607fb08118a58344ae6c5f42
datetime: '2023-05-20T07:02:13+02:00'
fix_commit_message: "fbdev: udlfb: Fix endpoint check\n\nThe syzbot fuzzer detected\
  \ a problem in the udlfb driver, caused by an\nendpoint not having the expected\
  \ type:\n\nusb 1-1: Read EDID byte 0 failed: -71\nusb 1-1: Unable to get valid EDID\
  \ from device/display\n------------[ cut here ]------------\nusb 1-1: BOGUS urb\
  \ xfer, pipe 3 != type 1\nWARNING: CPU: 0 PID: 9 at drivers/usb/core/urb.c:504 usb_submit_urb+0xed6/0x1880\n\
  drivers/usb/core/urb.c:504\nModules linked in:\nCPU: 0 PID: 9 Comm: kworker/0:1\
  \ Not tainted\n6.4.0-rc1-syzkaller-00016-ga4422ff22142 #0\nHardware name: Google\
  \ Google Compute Engine/Google Compute Engine, BIOS Google\n04/28/2023\nWorkqueue:\
  \ usb_hub_wq hub_event\nRIP: 0010:usb_submit_urb+0xed6/0x1880 drivers/usb/core/urb.c:504\n\
  ...\nCall Trace:\n <TASK>\n dlfb_submit_urb+0x92/0x180 drivers/video/fbdev/udlfb.c:1980\n\
  \ dlfb_set_video_mode+0x21f0/0x2950 drivers/video/fbdev/udlfb.c:315\n dlfb_ops_set_par+0x2a7/0x8d0\
  \ drivers/video/fbdev/udlfb.c:1111\n dlfb_usb_probe+0x149a/0x2710 drivers/video/fbdev/udlfb.c:1743\n\
  \nThe current approach for this issue failed to catch the problem\nbecause it only\
  \ checks for the existence of a bulk-OUT endpoint; it\ndoesn't check whether this\
  \ endpoint is the one that the driver will\nactually use.\n\nWe can fix the problem\
  \ by instead checking that the endpoint used by\nthe driver does exist and is bulk-OUT.\n\
  \nReported-and-tested-by: syzbot+0e22d63dcebb802b9bc8@syzkaller.appspotmail.com\n\
  Signed-off-by: Alan Stern <stern@rowland.harvard.edu>\nCC: Pavel Skripkin <paskripkin@gmail.com>\n\
  Fixes: aaf7dbe07385 (\"video: fbdev: udlfb: properly check endpoint type\")\nSigned-off-by:\
  \ Helge Deller <deller@gmx.de>\n"
submodule:
- drivers/video/fbdev
hunk_count: 4
covered_count: 2
