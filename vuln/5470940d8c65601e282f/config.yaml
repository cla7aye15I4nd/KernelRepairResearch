id: 5470940d8c65601e282f
bug_link: https://syzkaller.appspot.com/bug?extid=5470940d8c65601e282f
title: 'WARNING: ODEBUG bug in __init_work'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4ae649e8879d5a96b0ce104c8eae6563c6f368a1
fix_commit: ef299cc3fa1a9e1288665a9fdc8bff55629fd359
datetime: '2020-03-16T01:59:32-07:00'
fix_commit_message: 'net_sched: cls_route: remove the right filter from hashtable


  route4_change() allocates a new filter and copies values from

  the old one. After the new filter is inserted into the hash

  table, the old filter should be removed and freed, as the final

  step of the update.


  However, the current code mistakenly removes the new one. This

  looks apparently wrong to me, and it causes double "free" and

  use-after-free too, as reported by syzbot.


  Reported-and-tested-by: syzbot+f9b32aaacd60305d9687@syzkaller.appspotmail.com

  Reported-and-tested-by: syzbot+2f8c233f131943d6056d@syzkaller.appspotmail.com

  Reported-and-tested-by: syzbot+9c2df9fd5e9445b74e01@syzkaller.appspotmail.com

  Fixes: 1109c00547fc ("net: sched: RCU cls_route")

  Cc: Jamal Hadi Salim <jhs@mojatatu.com>

  Cc: Jiri Pirko <jiri@resnulli.us>

  Cc: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 1
covered_count: 1
