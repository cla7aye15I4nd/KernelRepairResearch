id: d7521c1e3841ed075a42
bug_link: https://syzkaller.appspot.com/bug?extid=d7521c1e3841ed075a42
title: 'KMSAN: uninit-value in virtqueue_add (4)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 922621a6828430ea3119b869336157d253489334
fix_commit: 61b258b0d2f60858888e248da9744d63e0fa6856
datetime: '2024-04-25T21:07:02-07:00'
fix_commit_message: 'x86: call instrumentation hooks from copy_mc.c


  Memory accesses in copy_mc_to_kernel() and copy_mc_to_user() are performed

  by assembly routines and are invisible to KASAN, KCSAN, and KMSAN.  Add

  hooks from instrumentation.h to tell the tools these functions have

  memcpy/copy_from_user semantics.


  The call to copy_mc_fragile() in copy_mc_fragile_handle_tail() is left

  intact, because the latter is only called from the assembly implementation

  of copy_mc_fragile(), so the memory accesses in it are covered by the

  instrumentation in copy_mc_to_kernel() and copy_mc_to_user().


  Link: https://lore.kernel.org/all/3b7dbd88-0861-4638-b2d2-911c97a4cadf@I-love.SAKURA.ne.jp/

  Link: https://lkml.kernel.org/r/20240320101851.2589698-3-glider@google.com

  Signed-off-by: Alexander Potapenko <glider@google.com>

  Suggested-by: Linus Torvalds <torvalds@linux-foundation.org>

  Cc: Dmitry Vyukov <dvyukov@google.com>

  Cc: Marco Elver <elver@google.com>

  Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Cc: Thomas Gleixner <tglx@linutronix.de>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- arch/x86/lib
hunk_count: 4
covered_count: 0
