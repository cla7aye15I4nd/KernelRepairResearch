id: 5ba06978f34abb058571
bug_link: https://syzkaller.appspot.com/bug?extid=5ba06978f34abb058571
title: WARNING in dev_index_reserve
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c727c6f788e673add829e4b54e7894fb2907df1c
fix_commit: f534f6581ec084fe94d6759f7672bd009794b07e
datetime: '2023-08-20T11:40:03+01:00'
fix_commit_message: "net: validate veth and vxcan peer ifindexes\n\nveth and vxcan\
  \ need to make sure the ifindexes of the peer\nare not negative, core does not validate\
  \ this.\n\nUsing iproute2 with user-space-level checking removed:\n\nBefore:\n\n\
  \  # ./ip link add index 10 type veth peer index -1\n  # ip link show\n  1: lo:\
  \ <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group\
  \ default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n\
  \  2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP\
  \ mode DEFAULT group default qlen 1000\n    link/ether 52:54:00:74:b2:03 brd ff:ff:ff:ff:ff:ff\n\
  \  10: veth1@veth0: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN\
  \ mode DEFAULT group default qlen 1000\n    link/ether 8a:90:ff:57:6d:5d brd ff:ff:ff:ff:ff:ff\n\
  \  -1: veth0@veth1: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN\
  \ mode DEFAULT group default qlen 1000\n    link/ether ae:ed:18:e6:fa:7f brd ff:ff:ff:ff:ff:ff\n\
  \nNow:\n\n  $ ./ip link add index 10 type veth peer index -1\n  Error: ifindex can't\
  \ be negative.\n\nThis problem surfaced in net-next because an explicit WARN()\n\
  was added, the root cause is older.\n\nFixes: e6f8f1a739b6 (\"veth: Allow to create\
  \ peer link with given ifindex\")\nFixes: a8f820a380a2 (\"can: add Virtual CAN Tunnel\
  \ driver (vxcan)\")\nReported-by: syzbot+5ba06978f34abb058571@syzkaller.appspotmail.com\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\nReviewed-by: Eric Dumazet <edumazet@google.com>\n\
  Signed-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- drivers/net
- drivers/net/can
- include/net
- net/core
hunk_count: 4
covered_count: 0
