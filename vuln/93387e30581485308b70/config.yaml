id: 93387e30581485308b70
bug_link: https://syzkaller.appspot.com/bug?extid=93387e30581485308b70
title: general protection fault in __sock_release
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0c6bc6e531a6db36f49622f1f115770160f7afb0
fix_commit: 99ba2b5aba24e022683a7db63204f9e306fe7ab9
datetime: '2018-07-07T15:19:30-07:00'
fix_commit_message: 'bpf: sockhash, disallow bpf_tcp_close and update in parallel


  After latest lock updates there is no longer anything preventing a

  close and recvmsg call running in parallel. Additionally, we can

  race update with close if we close a socket and simultaneously update

  if via the BPF userspace API (note the cgroup ops are already run

  with sock_lock held).


  To resolve this take sock_lock in close and update paths.


  Reported-by: syzbot+b680e42077a0d7c9a0c4@syzkaller.appspotmail.com

  Fixes: e9db4ef6bf4c ("bpf: sockhash fix omitted bucket lock in sock_close")

  Signed-off-by: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 5
covered_count: 0
