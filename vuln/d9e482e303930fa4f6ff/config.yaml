id: d9e482e303930fa4f6ff
bug_link: https://syzkaller.appspot.com/bug?extid=d9e482e303930fa4f6ff
title: memory leak in ext4_multi_mount_protect
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1fc57ca5a2cd26e0a526e5eb2b0fc0c054117a5b
fix_commit: 618f003199c6188e01472b03cdbba227f1dc5f24
datetime: '2021-06-17T10:53:19-04:00'
fix_commit_message: 'ext4: fix memory leak in ext4_fill_super


  static int kthread(void *_create) will return -ENOMEM

  or -EINTR in case of internal failure or

  kthread_stop() call happens before threadfn call.


  To prevent fancy error checking and make code

  more straightforward we moved all cleanup code out

  of kmmpd threadfn.


  Also, dropped struct mmpd_data at all. Now struct super_block

  is a threadfn data and struct buffer_head embedded into

  struct ext4_sb_info.


  Reported-by: syzbot+d9e482e303930fa4f6ff@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Link: https://lore.kernel.org/r/20210430185046.15742-1-paskripkin@gmail.com

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 9
covered_count: 1
