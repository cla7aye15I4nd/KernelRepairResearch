id: 83699adeb2d13579c31e
bug_link: https://syzkaller.appspot.com/bug?extid=83699adeb2d13579c31e
title: 'BUG: unable to handle kernel paging request in build_segment_manager'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5d64600d4f337dc2bb89cd59da99f452f5e4f3c3
fix_commit: b2ca374f33bd33fd822eb871876e4888cf79dc97
datetime: '2018-05-31T11:31:48-07:00'
fix_commit_message: "f2fs: sanity check on sit entry\n\nsyzbot hit the following crash\
  \ on upstream commit\n87ef12027b9b1dd0e0b12cf311fbcb19f9d92539 (Wed Apr 18 19:48:17\
  \ 2018 +0000)\nMerge tag 'ceph-for-4.17-rc2' of git://github.com/ceph/ceph-client\n\
  syzbot dashboard link: https://syzkaller.appspot.com/bug?extid=83699adeb2d13579c31e\n\
  \nC reproducer: https://syzkaller.appspot.com/x/repro.c?id=5805208181407744\nsyzkaller\
  \ reproducer: https://syzkaller.appspot.com/x/repro.syz?id=6005073343676416\nRaw\
  \ console output: https://syzkaller.appspot.com/x/log.txt?id=6555047731134464\n\
  Kernel config: https://syzkaller.appspot.com/x/.config?id=1808800213120130118\n\
  compiler: gcc (GCC) 8.0.1 20180413 (experimental)\n\nIMPORTANT: if you fix the bug,\
  \ please add the following tag to the commit:\nReported-by: syzbot+83699adeb2d13579c31e@syzkaller.appspotmail.com\n\
  It will help syzbot understand when the bug is fixed. See footer for details.\n\
  If you forward the report, please keep this part and the footer.\n\nF2FS-fs (loop0):\
  \ Magic Mismatch, valid(0xf2f52010) - read(0x0)\nF2FS-fs (loop0): Can't find valid\
  \ F2FS filesystem in 1th superblock\nF2FS-fs (loop0): invalid crc value\nBUG: unable\
  \ to handle kernel paging request at ffffed006b2a50c0\nPGD 21ffee067 P4D 21ffee067\
  \ PUD 21fbeb067 PMD 0\nOops: 0000 [#1] SMP KASAN\nDumping ftrace buffer:\n   (ftrace\
  \ buffer empty)\nModules linked in:\nCPU: 0 PID: 4514 Comm: syzkaller989480 Not\
  \ tainted 4.17.0-rc1+ #8\nHardware name: Google Google Compute Engine/Google Compute\
  \ Engine, BIOS Google 01/01/2011\nRIP: 0010:build_sit_entries fs/f2fs/segment.c:3653\
  \ [inline]\nRIP: 0010:build_segment_manager+0x7ef7/0xbf70 fs/f2fs/segment.c:3852\n\
  RSP: 0018:ffff8801b102e5b0 EFLAGS: 00010a06\nRAX: 1ffff1006b2a50c0 RBX: 0000000000000004\
  \ RCX: 0000000000000001\nRDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8801ac74243e\n\
  RBP: ffff8801b102f410 R08: ffff8801acbd46c0 R09: fffffbfff14d9af8\nR10: fffffbfff14d9af8\
  \ R11: ffff8801acbd46c0 R12: ffff8801ac742a80\nR13: ffff8801d9519100 R14: dffffc0000000000\
  \ R15: ffff880359528600\nFS:  0000000001e04880(0000) GS:ffff8801dae00000(0000) knlGS:0000000000000000\n\
  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: ffffed006b2a50c0 CR3: 00000001ac6ac000\
  \ CR4: 00000000001406f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n\
  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n\
  \ f2fs_fill_super+0x4095/0x7bf0 fs/f2fs/super.c:2803\n mount_bdev+0x30c/0x3e0 fs/super.c:1165\n\
  \ f2fs_mount+0x34/0x40 fs/f2fs/super.c:3020\n mount_fs+0xae/0x328 fs/super.c:1268\n\
  \ vfs_kern_mount.part.34+0xd4/0x4d0 fs/namespace.c:1037\n vfs_kern_mount fs/namespace.c:1027\
  \ [inline]\n do_new_mount fs/namespace.c:2517 [inline]\n do_mount+0x564/0x3070 fs/namespace.c:2847\n\
  \ ksys_mount+0x12d/0x140 fs/namespace.c:3063\n __do_sys_mount fs/namespace.c:3077\
  \ [inline]\n __se_sys_mount fs/namespace.c:3074 [inline]\n __x64_sys_mount+0xbe/0x150\
  \ fs/namespace.c:3074\n do_syscall_64+0x1b1/0x800 arch/x86/entry/common.c:287\n\
  \ entry_SYSCALL_64_after_hwframe+0x49/0xbe\nRIP: 0033:0x443d6a\nRSP: 002b:00007ffd312813c8\
  \ EFLAGS: 00000297 ORIG_RAX: 00000000000000a5\nRAX: ffffffffffffffda RBX: 0000000020000c00\
  \ RCX: 0000000000443d6a\nRDX: 0000000020000000 RSI: 0000000020000100 RDI: 00007ffd312813d0\n\
  RBP: 0000000000000003 R08: 0000000020016a00 R09: 000000000000000a\nR10: 0000000000000000\
  \ R11: 0000000000000297 R12: 0000000000000004\nR13: 0000000000402c60 R14: 0000000000000000\
  \ R15: 0000000000000000\nRIP: build_sit_entries fs/f2fs/segment.c:3653 [inline]\
  \ RSP: ffff8801b102e5b0\nRIP: build_segment_manager+0x7ef7/0xbf70 fs/f2fs/segment.c:3852\
  \ RSP: ffff8801b102e5b0\nCR2: ffffed006b2a50c0\n---[ end trace a2034989e196ff17\
  \ ]---\n\nReported-and-tested-by: syzbot+83699adeb2d13579c31e@syzkaller.appspotmail.com\n\
  Reviewed-by: Chao Yu <yuchao0@huawei.com>\nSigned-off-by: Jaegeuk Kim <jaegeuk@kernel.org>\n"
submodule:
- fs/f2fs
hunk_count: 1
covered_count: 1
