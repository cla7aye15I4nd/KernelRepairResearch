id: bb1836a212e69f8e201a
bug_link: https://syzkaller.appspot.com/bug?extid=bb1836a212e69f8e201a
title: WARNING in ovl_rename
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9c6d8f13e9da10a26ad7f0a020ef86e8ef142835
fix_commit: 6889ee5a53b8d969aa542047f5ac8acdc0e79a91
datetime: '2019-12-10T16:00:55+01:00'
fix_commit_message: 'ovl: relax WARN_ON() on rename to self


  In ovl_rename(), if new upper is hardlinked to old upper underneath

  overlayfs before upper dirs are locked, user will get an ESTALE error

  and a WARN_ON will be printed.


  Changes to underlying layers while overlayfs is mounted may result in

  unexpected behavior, but it shouldn''t crash the kernel and it shouldn''t

  trigger WARN_ON() either, so relax this WARN_ON().


  Reported-by: syzbot+bb1836a212e69f8e201a@syzkaller.appspotmail.com

  Fixes: 804032fabb3b ("ovl: don''t check rename to self")

  Cc: <stable@vger.kernel.org> # v4.9+

  Signed-off-by: Amir Goldstein <amir73il@gmail.com>

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  '
submodule:
- fs/overlayfs
hunk_count: 1
covered_count: 1
