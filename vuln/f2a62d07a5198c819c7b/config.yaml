id: f2a62d07a5198c819c7b
bug_link: https://syzkaller.appspot.com/bug?extid=f2a62d07a5198c819c7b
title: 'kernel panic: stack is corrupted in vhost_net_ioctl'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0c0ddd6ae47c9238c18f475bcca675ca74c9dc31
fix_commit: 42d84c8490f9f0931786f1623191fcab397c3d64
datetime: '2020-02-22T21:41:42-08:00'
fix_commit_message: 'vhost: Check docket sk_family instead of call getname


  Doing so, we save one call to get data we already have in the struct.


  Also, since there is no guarantee that getname use sockaddr_ll

  parameter beyond its size, we add a little bit of security here.

  It should do not do beyond MAX_ADDR_LEN, but syzbot found that

  ax25_getname writes more (72 bytes, the size of full_sockaddr_ax25,

  versus 20 + 32 bytes of sockaddr_ll + MAX_ADDR_LEN in syzbot repro).


  Fixes: 3a4d5c94e9593 ("vhost_net: a kernel-level virtio server")

  Reported-by: syzbot+f2a62d07a5198c819c7b@syzkaller.appspotmail.com

  Signed-off-by: Eugenio PÃ©rez <eperezma@redhat.com>

  Acked-by: Michael S. Tsirkin <mst@redhat.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/vhost
hunk_count: 2
covered_count: 0
