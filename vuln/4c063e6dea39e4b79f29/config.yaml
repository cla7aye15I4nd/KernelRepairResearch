id: 4c063e6dea39e4b79f29
bug_link: https://syzkaller.appspot.com/bug?extid=4c063e6dea39e4b79f29
title: 'WARNING: refcount bug in smc_release'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ad9bd8daf2f9938572b0604e1280fefa8f338581
fix_commit: 301428ea3708188dc4a243e6e6b46c03b46a0fbc
datetime: '2019-10-29T18:09:50-07:00'
fix_commit_message: 'net/smc: fix refcounting for non-blocking connect()


  If a nonblocking socket is immediately closed after connect(),

  the connect worker may not have started. This results in a refcount

  problem, since sock_hold() is called from the connect worker.

  This patch moves the sock_hold in front of the connect worker

  scheduling.


  Reported-by: syzbot+4c063e6dea39e4b79f29@syzkaller.appspotmail.com

  Fixes: 50717a37db03 ("net/smc: nonblocking connect rework")

  Reviewed-by: Karsten Graul <kgraul@linux.ibm.com>

  Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/smc
hunk_count: 2
covered_count: 0
