id: 694120e1002c117747ed
bug_link: https://syzkaller.appspot.com/bug?extid=694120e1002c117747ed
title: 'KASAN: use-after-free Read in tcp_retransmit_timer (5)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f5c2174a3775491e890ce285df52f5715fbef875
fix_commit: 3a58f13a881ed351198ffab4cf9953cf19d2ab3a
datetime: '2022-05-03T13:22:50+02:00'
fix_commit_message: 'net: rds: acquire refcount on TCP sockets


  syzbot is reporting use-after-free read in tcp_retransmit_timer() [1],

  for TCP socket used by RDS is accessing sock_net() without acquiring a

  refcount on net namespace. Since TCP''s retransmission can happen after

  a process which created net namespace terminated, we need to explicitly

  acquire a refcount.


  Link: https://syzkaller.appspot.com/bug?extid=694120e1002c117747ed [1]

  Reported-by: syzbot <syzbot+694120e1002c117747ed@syzkaller.appspotmail.com>

  Fixes: 26abe14379f8e2fa ("net: Modify sk_alloc to not reference count the netns
  of kernel sockets.")

  Fixes: 8a68173691f03661 ("net: sk_clone_lock() should only do get_net() if the parent
  is not a kernel socket")

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Tested-by: syzbot <syzbot+694120e1002c117747ed@syzkaller.appspotmail.com>

  Link: https://lore.kernel.org/r/a5fb1fc4-2284-3359-f6a0-e4e390239d7b@I-love.SAKURA.ne.jp

  Signed-off-by: Paolo Abeni <pabeni@redhat.com>

  '
submodule:
- net/rds
hunk_count: 1
covered_count: 0
