id: 77fa5bdb65cc39711820
bug_link: https://syzkaller.appspot.com/bug?extid=77fa5bdb65cc39711820
title: WARNING in iomap_apply
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9f364e1d9537d44fdf58deeeddb51277d8327ce5
fix_commit: 175efa81feb8405676e0136d97b10380179c92e0
datetime: '2020-06-03T23:16:54-04:00'
fix_commit_message: 'ext4: fix EXT4_MAX_LOGICAL_BLOCK macro


  ext4 supports max number of logical blocks in a file to be 0xffffffff.

  (This is since ext4_extent''s ee_block is __le32).

  This means that EXT4_MAX_LOGICAL_BLOCK should be 0xfffffffe (starting

  from 0 logical offset). This patch fixes this.


  The issue was seen when ext4 moved to iomap_fiemap API and when

  overlayfs was mounted on top of ext4. Since overlayfs was missing

  filemap_check_ranges(), so it could pass a arbitrary huge length which

  lead to overflow of map.m_len logic.


  This patch fixes that.


  Fixes: d3b6f23f7167 ("ext4: move ext4_fiemap to use iomap framework")

  Reported-by: syzbot+77fa5bdb65cc39711820@syzkaller.appspotmail.com

  Signed-off-by: Ritesh Harjani <riteshh@linux.ibm.com>

  Reviewed-by: Jan Kara <jack@suse.cz>

  Signed-off-by: Christoph Hellwig <hch@lst.de>

  Link: https://lore.kernel.org/r/20200505154324.3226743-2-hch@lst.de

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 1
covered_count: 0
