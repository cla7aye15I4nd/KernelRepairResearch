id: afb980676c836b4a0afa
bug_link: https://syzkaller.appspot.com/bug?extid=afb980676c836b4a0afa
title: memory leak in lapb_register
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5cf02612b33f104fe1015b2dfaf1758ad3675588
fix_commit: 6be8e297f9bcea666ea85ac7a6cd9d52d6deaf92
datetime: '2019-06-16T20:44:20-07:00'
fix_commit_message: 'lapb: fixed leak of control-blocks.


  lapb_register calls lapb_create_cb, which initializes the control-

  block''s ref-count to one, and __lapb_insert_cb, which increments it when

  adding the new block to the list of blocks.


  lapb_unregister calls __lapb_remove_cb, which decrements the ref-count

  when removing control-block from the list of blocks, and calls lapb_put

  itself to decrement the ref-count before returning.


  However, lapb_unregister also calls __lapb_devtostruct to look up the

  right control-block for the given net_device, and __lapb_devtostruct

  also bumps the ref-count, which means that when lapb_unregister returns

  the ref-count is still 1 and the control-block is leaked.


  Call lapb_put after __lapb_devtostruct to fix leak.


  Reported-by: syzbot+afb980676c836b4a0afa@syzkaller.appspotmail.com

  Signed-off-by: Jeremy Sowden <jeremy@azazel.net>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/lapb
hunk_count: 1
covered_count: 1
