id: df0d4ec12332661dd1f9
bug_link: https://syzkaller.appspot.com/bug?extid=df0d4ec12332661dd1f9
title: kernel BUG at include/linux/scatterlist.h:LINE!
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c329ef9684de9517d82af5b4758c9e1b64a8a11a
fix_commit: d10523d0b3d78153ee58d19853ced26c9004c8c4
datetime: '2019-11-28T22:40:29-08:00'
fix_commit_message: 'net/tls: free the record on encryption error


  When tls_do_encryption() fails the SG lists are left with the

  SG_END and SG_CHAIN marks in place. One could hope that once

  encryption fails we will never see the record again, but that

  is in fact not true. Commit d3b18ad31f93 ("tls: add bpf support

  to sk_msg handling") added special handling to ENOMEM and ENOSPC

  errors which mean we may see the same record re-submitted.


  As suggested by John free the record, the BPF code is already

  doing just that.


  Reported-by: syzbot+df0d4ec12332661dd1f9@syzkaller.appspotmail.com

  Fixes: d3b18ad31f93 ("tls: add bpf support to sk_msg handling")

  Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>

  Reviewed-by: Simon Horman <simon.horman@netronome.com>

  Acked-by: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/tls
hunk_count: 1
covered_count: 0
