id: 5078fc2d7cf37d71de1c
bug_link: https://syzkaller.appspot.com/bug?extid=5078fc2d7cf37d71de1c
title: general protection fault in xfrm_user_rcv_msg_compat
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2580d3f40022642452dd8422bfb8c22e54cf84bb
fix_commit: 4e9505064f58d1252805952f8547a5b7dbc5c111
datetime: '2021-07-21T09:53:25+02:00'
fix_commit_message: "net/xfrm/compat: Copy xfrm_spdattr_type_t atributes\n\nThe attribute-translator\
  \ has to take in mind maxtype, that is\nxfrm_link::nla_max. When it is set, attributes\
  \ are not of xfrm_attr_type_t.\nCurrently, they can be only XFRMA_SPD_MAX (message\
  \ XFRM_MSG_NEWSPDINFO),\ntheir UABI is the same for 64/32-bit, so just copy them.\n\
  \nThanks to YueHaibing for reporting this:\nIn xfrm_user_rcv_msg_compat() if maxtype\
  \ is not zero and less than\nXFRMA_MAX, nlmsg_parse_deprecated() do not initialize\
  \ attrs array fully.\nxfrm_xlate32() will access uninit 'attrs[i]' while iterating\
  \ all attrs\narray.\n\nKASAN: probably user-memory-access in range [0x0000000041b58ab0-0x0000000041b58ab7]\n\
  CPU: 0 PID: 15799 Comm: syz-executor.2 Tainted: G        W         5.14.0-rc1-syzkaller\
  \ #0\nRIP: 0010:nla_type include/net/netlink.h:1130 [inline]\nRIP: 0010:xfrm_xlate32_attr\
  \ net/xfrm/xfrm_compat.c:410 [inline]\nRIP: 0010:xfrm_xlate32 net/xfrm/xfrm_compat.c:532\
  \ [inline]\nRIP: 0010:xfrm_user_rcv_msg_compat+0x5e5/0x1070 net/xfrm/xfrm_compat.c:577\n\
  [...]\nCall Trace:\n xfrm_user_rcv_msg+0x556/0x8b0 net/xfrm/xfrm_user.c:2774\n netlink_rcv_skb+0x153/0x420\
  \ net/netlink/af_netlink.c:2504\n xfrm_netlink_rcv+0x6b/0x90 net/xfrm/xfrm_user.c:2824\n\
  \ netlink_unicast_kernel net/netlink/af_netlink.c:1314 [inline]\n netlink_unicast+0x533/0x7d0\
  \ net/netlink/af_netlink.c:1340\n netlink_sendmsg+0x86d/0xdb0 net/netlink/af_netlink.c:1929\n\
  \ sock_sendmsg_nosec net/socket.c:702 [inline]\n\nFixes: 5106f4a8acff (\"xfrm/compat:\
  \ Add 32=>64-bit messages translator\")\nCc: <stable@kernel.org>\nReported-by: YueHaibing\
  \ <yuehaibing@huawei.com>\nSigned-off-by: Dmitry Safonov <dima@arista.com>\nSigned-off-by:\
  \ Steffen Klassert <steffen.klassert@secunet.com>\n"
submodule:
- net/xfrm
hunk_count: 7
covered_count: 5
