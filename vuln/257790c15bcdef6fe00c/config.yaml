id: 257790c15bcdef6fe00c
bug_link: https://syzkaller.appspot.com/bug?extid=257790c15bcdef6fe00c
title: general protection fault in hci_uart_write_work
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 035a960e7a279a59d74585105dcd263559d74f24
fix_commit: 32a7b4cbe93b0a0ef7e63d31ca69ce54736c4412
datetime: '2019-02-18T13:54:53+01:00'
fix_commit_message: 'Bluetooth: hci_ldisc: Initialize hci_dev before open()


  The hci_dev struct hdev is referenced in work queues and timers started

  by open() in some protocols. This creates a race between the

  initialization function and the work or timer which can result hdev

  being dereferenced while it is still null.


  The syzbot report contains a reliable reproducer which causes a null

  pointer dereference of hdev in hci_uart_write_work() by making the

  memory allocation for hdev fail.


  To fix this, ensure hdev is valid from before calling a protocol''s

  open() until after calling a protocol''s close().


  Reported-by: syzbot+257790c15bcdef6fe00c@syzkaller.appspotmail.com

  Signed-off-by: Jeremy Cline <jcline@redhat.com>

  Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

  '
submodule:
- drivers/bluetooth
hunk_count: 4
covered_count: 1
