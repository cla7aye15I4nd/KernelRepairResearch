id: e5ea5f8a3ecfd4427a1c
bug_link: https://syzkaller.appspot.com/bug?extid=e5ea5f8a3ecfd4427a1c
title: 'WARNING: refcount bug in red_destroy'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f272285f6abb9178d029375599626baf3d5f4e8a
fix_commit: 5438dd45831ee33869779bd1919b05816ae4dbc9
datetime: '2020-08-28T07:16:46-07:00'
fix_commit_message: 'net_sched: fix error path in red_init()


  When ->init() fails, ->destroy() is called to clean up.

  So it is unnecessary to clean up in red_init(), and it

  would cause some refcount underflow.


  Fixes: aee9caa03fc3 ("net: sched: sch_red: Add qevents "early_drop" and "mark"")

  Reported-and-tested-by: syzbot+b33c1cb0a30ebdc8a5f9@syzkaller.appspotmail.com

  Reported-and-tested-by: syzbot+e5ea5f8a3ecfd4427a1c@syzkaller.appspotmail.com

  Cc: Petr Machata <petrm@mellanox.com>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Reviewed-by: Petr Machata <petrm@nvidia.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 1
covered_count: 0
