id: 10d25e23199614b7721f
bug_link: https://syzkaller.appspot.com/bug?extid=10d25e23199614b7721f
title: WARNING in percpu_ref_kill_and_confirm
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 085b7755808aa11f78ab9377257e1dad2e6fa4bb
fix_commit: 35fa71a030caa50458a043560d4814ea9bcd639f
datetime: '2019-04-22T10:37:07-06:00'
fix_commit_message: 'io_uring: fail io_uring_register(2) on a dying io_uring instance


  If we have multiple threads doing io_uring_register(2) on an io_uring

  fd, then we can potentially try and kill the percpu reference while

  someone else has already killed it.


  Prevent this race by failing io_uring_register(2) if the ref is marked

  dying. This is safe since we''re inside the io_uring mutex.


  Fixes: b19062a56726 ("io_uring: fix possible deadlock between io_uring_{enter,register}")

  Reported-by: syzbot <syzbot+10d25e23199614b7721f@syzkaller.appspotmail.com>

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- fs
hunk_count: 1
covered_count: 1
