id: 1a0a53300ce782f8b3ad
bug_link: https://syzkaller.appspot.com/bug?extid=1a0a53300ce782f8b3ad
title: 'BUG: unable to handle kernel NULL pointer dereference in io_do_iopoll'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2d2d5cb6ca8424fa849ebb4edb8e8022c13860c7
fix_commit: aa184e8671f0f911fc2fb3f68cd506e4d7838faa
datetime: '2022-05-17T12:46:04-06:00'
fix_commit_message: 'io_uring: don''t attempt to IOPOLL for MSG_RING requests


  We gate whether to IOPOLL for a request on whether the opcode is allowed

  on a ring setup for IOPOLL and if it''s got a file assigned. MSG_RING

  is the only one that allows a file yet isn''t pollable, it''s merely

  supported to allow communication on an IOPOLL ring, not because we can

  poll for completion of it.


  Put the assigned file early and clear it, so we don''t attempt to poll

  for it.


  Reported-by: syzbot+1a0a53300ce782f8b3ad@syzkaller.appspotmail.com

  Fixes: 3f1d52abf098 ("io_uring: defer msg-ring file validity check until command
  issue")

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- fs
hunk_count: 1
covered_count: 0
