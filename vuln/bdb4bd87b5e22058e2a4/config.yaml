id: bdb4bd87b5e22058e2a4
bug_link: https://syzkaller.appspot.com/bug?extid=bdb4bd87b5e22058e2a4
title: 'BUG: stack guard page was hit in vsock_bpf_recvmsg'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b2ca1661c7db9693095cee7991c55d67c3b5d346
fix_commit: 69139d2919dd4aa9a553c8245e7c63e82613e3fc
datetime: '2024-08-15T12:07:04+02:00'
fix_commit_message: "vsock: fix recursive ->recvmsg calls\n\nAfter a vsock socket\
  \ has been added to a BPF sockmap, its prot->recvmsg\nhas been replaced with vsock_bpf_recvmsg().\
  \ Thus the following\nrecursiion could happen:\n\nvsock_bpf_recvmsg()\n -> __vsock_recvmsg()\n\
  \  -> vsock_connectible_recvmsg()\n   -> prot->recvmsg()\n    -> vsock_bpf_recvmsg()\
  \ again\n\nWe need to fix it by calling the original ->recvmsg() without any BPF\n\
  sockmap logic in __vsock_recvmsg().\n\nFixes: 634f1a7110b4 (\"vsock: support sockmap\"\
  )\nReported-by: syzbot+bdb4bd87b5e22058e2a4@syzkaller.appspotmail.com\nTested-by:\
  \ syzbot+bdb4bd87b5e22058e2a4@syzkaller.appspotmail.com\nCc: Bobby Eshleman <bobby.eshleman@bytedance.com>\n\
  Cc: Michael S. Tsirkin <mst@redhat.com>\nCc: Stefano Garzarella <sgarzare@redhat.com>\n\
  Signed-off-by: Cong Wang <cong.wang@bytedance.com>\nAcked-by: Michael S. Tsirkin\
  \ <mst@redhat.com>\nLink: https://patch.msgid.link/20240812022153.86512-1-xiyou.wangcong@gmail.com\n\
  Signed-off-by: Paolo Abeni <pabeni@redhat.com>\n\n"
submodule:
- include/net
- net/vmw_vsock
hunk_count: 6
covered_count: 1
