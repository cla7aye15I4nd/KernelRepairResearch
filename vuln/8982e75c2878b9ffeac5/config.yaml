id: 8982e75c2878b9ffeac5
bug_link: https://syzkaller.appspot.com/bug?extid=8982e75c2878b9ffeac5
title: 'WARNING: bad unlock balance in bpf'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4aadd2920b81b3d7e5c8ac63c7d5d673f3c8aaeb
fix_commit: 4266f41feaeee2521749ce2cfb52eafd4e2947c5
datetime: '2023-05-26T12:16:12+02:00'
fix_commit_message: 'bpf: Fix bad unlock balance on freeze_mutex


  Commit c4c84f6fb2c4 ("bpf: drop unnecessary bpf_capable() check in

  BPF_MAP_FREEZE command") moved the permissions check outside of the

  freeze_mutex in the map_freeze() handler. The error paths still jumps

  to the err_put which tries to unlock the freeze_mutex even though it

  was not locked in the first place. Fix it.


  Fixes: c4c84f6fb2c4 ("bpf: drop unnecessary bpf_capable() check in BPF_MAP_FREEZE
  command")

  Reported-by: syzbot+8982e75c2878b9ffeac5@syzkaller.appspotmail.com

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  '
submodule:
- kernel/bpf
hunk_count: 1
covered_count: 1
