id: 131cd4c6d21724b99a26
bug_link: https://syzkaller.appspot.com/bug?extid=131cd4c6d21724b99a26
title: 'KMSAN: uninit-value in xfrm_state_find'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5fc46f94219d1d103ffb5f0832be9da674d85a73
fix_commit: 3d776e31c841ba2f69895d2255a49320bec7cea6
datetime: '2023-05-10T07:04:50+02:00'
fix_commit_message: 'xfrm: Reject optional tunnel/BEET mode templates in outbound
  policies


  xfrm_state_find() uses `encap_family` of the current template with

  the passed local and remote addresses to find a matching state.

  If an optional tunnel or BEET mode template is skipped in a mixed-family

  scenario, there could be a mismatch causing an out-of-bounds read as

  the addresses were not replaced to match the family of the next template.


  While there are theoretical use cases for optional templates in outbound

  policies, the only practical one is to skip IPComp states in inbound

  policies if uncompressed packets are received that are handled by an

  implicitly created IPIP state instead.


  Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")

  Signed-off-by: Tobias Brunner <tobias@strongswan.org>

  Acked-by: Herbert Xu <herbert@gondor.apana.org.au>

  Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>

  '
submodule:
- net/xfrm
hunk_count: 6
covered_count: 0
