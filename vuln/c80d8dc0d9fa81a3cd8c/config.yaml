id: c80d8dc0d9fa81a3cd8c
bug_link: https://syzkaller.appspot.com/bug?extid=c80d8dc0d9fa81a3cd8c
title: WARNING in to_nfit_bus_uuid
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7eb172143d5508b4da468ed59ee857c6e5e01da6
fix_commit: 2ff0e408db36c21ed3fa5e3c1e0e687c82cf132f
datetime: '2025-03-03T08:03:43-06:00'
fix_commit_message: 'acpi: nfit: fix narrowing conversion in acpi_nfit_ctl


  Syzkaller has reported a warning in to_nfit_bus_uuid(): "only secondary

  bus families can be translated". This warning is emited if the argument

  is equal to NVDIMM_BUS_FAMILY_NFIT == 0. Function acpi_nfit_ctl() first

  verifies that a user-provided value call_pkg->nd_family of type u64 is

  not equal to 0. Then the value is converted to int, and only after that

  is compared to NVDIMM_BUS_FAMILY_MAX. This can lead to passing an invalid

  argument to acpi_nfit_ctl(), if call_pkg->nd_family is non-zero, while

  the lower 32 bits are zero.


  Furthermore, it is best to return EINVAL immediately upon seeing the

  invalid user input.  The WARNING is insufficient to prevent further

  undefined behavior based on other invalid user input.


  All checks of the input value should be applied to the original variable

  call_pkg->nd_family.


  [iweiny: update commit message]


  Fixes: 6450ddbd5d8e ("ACPI: NFIT: Define runtime firmware activation commands")

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+c80d8dc0d9fa81a3cd8c@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=c80d8dc0d9fa81a3cd8c

  Signed-off-by: Murad Masimov <m.masimov@mt-integration.ru>

  Link: https://patch.msgid.link/20250123163945.251-1-m.masimov@mt-integration.ru

  Signed-off-by: Ira Weiny <ira.weiny@intel.com>

  '
submodule:
- drivers/acpi/nfit
hunk_count: 1
covered_count: 1
