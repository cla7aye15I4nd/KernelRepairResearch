id: e836ff7133ac02be825f
bug_link: https://syzkaller.appspot.com/bug?extid=e836ff7133ac02be825f
title: 'KASAN: slab-out-of-bounds Read in __hfs_brec_find'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4d8586e04602fe42f0a782d2005956f8b6302678
fix_commit: 8d824e69d9f3fa3121b2dda25053bae71e2460d2
datetime: '2022-12-11T19:30:19-08:00'
fix_commit_message: "hfs: fix OOB Read in __hfs_brec_find\n\nSyzbot reported a OOB\
  \ read bug:\n\n==================================================================\n\
  BUG: KASAN: slab-out-of-bounds in hfs_strcmp+0x117/0x190\nfs/hfs/string.c:84\nRead\
  \ of size 1 at addr ffff88807eb62c4e by task kworker/u4:1/11\nCPU: 1 PID: 11 Comm:\
  \ kworker/u4:1 Not tainted\n6.1.0-rc6-syzkaller-00308-g644e9524388a #0\nWorkqueue:\
  \ writeback wb_workfn (flush-7:0)\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:88\
  \ [inline]\n dump_stack_lvl+0x1b1/0x28e lib/dump_stack.c:106\n print_address_description+0x74/0x340\
  \ mm/kasan/report.c:284\n print_report+0x107/0x1f0 mm/kasan/report.c:395\n kasan_report+0xcd/0x100\
  \ mm/kasan/report.c:495\n hfs_strcmp+0x117/0x190 fs/hfs/string.c:84\n __hfs_brec_find+0x213/0x5c0\
  \ fs/hfs/bfind.c:75\n hfs_brec_find+0x276/0x520 fs/hfs/bfind.c:138\n hfs_write_inode+0x34c/0xb40\
  \ fs/hfs/inode.c:462\n write_inode fs/fs-writeback.c:1440 [inline]\n\nIf the input\
  \ inode of hfs_write_inode() is incorrect:\nstruct inode\n  struct hfs_inode_info\n\
  \    struct hfs_cat_key\n      struct hfs_name\n        u8 len # len is greater\
  \ than HFS_NAMELEN(31) which is the\nmaximum length of an HFS filename\n\nOOB read\
  \ occurred:\nhfs_write_inode()\n  hfs_brec_find()\n    __hfs_brec_find()\n     \
  \ hfs_cat_keycmp()\n        hfs_strcmp() # OOB read occurred due to len is too large\n\
  \nFix this by adding a Check on len in hfs_write_inode() before calling\nhfs_brec_find().\n\
  \nLink: https://lkml.kernel.org/r/20221130065959.2168236-1-zhangpeng362@huawei.com\n\
  Signed-off-by: ZhangPeng <zhangpeng362@huawei.com>\nReported-by: <syzbot+e836ff7133ac02be825f@syzkaller.appspotmail.com>\n\
  Cc: Damien Le Moal <damien.lemoal@opensource.wdc.com>\nCc: Ira Weiny <ira.weiny@intel.com>\n\
  Cc: Jeff Layton <jlayton@kernel.org>\nCc: Kefeng Wang <wangkefeng.wang@huawei.com>\n\
  Cc: Matthew Wilcox <willy@infradead.org>\nCc: Nanyong Sun <sunnanyong@huawei.com>\n\
  Cc: Viacheslav Dubeyko <slava@dubeyko.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\n"
submodule:
- fs/hfs
hunk_count: 1
covered_count: 1
