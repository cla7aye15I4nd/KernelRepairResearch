id: 6e1efbd8efaaa6860e91
bug_link: https://syzkaller.appspot.com/bug?extid=6e1efbd8efaaa6860e91
title: WARNING in fuse_write_file_get
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f2906aa863381afb0015a9eb7fefad885d4e5a56
fix_commit: 035ff33cf4db101250fb980a3941bf078f37a544
datetime: '2022-07-21T16:02:45+02:00'
fix_commit_message: 'fuse: write inode in fuse_release()


  A race between write(2) and close(2) allows pages to be dirtied after

  fuse_flush -> write_inode_now().  If these pages are not flushed from

  fuse_release(), then there might not be a writable open file later.  So any

  remaining dirty pages must be written back before the file is released.


  This is a partial revert of the blamed commit.


  Reported-by: syzbot+6e1efbd8efaaa6860e91@syzkaller.appspotmail.com

  Fixes: 36ea23374d1f ("fuse: write inode in fuse_vma_close() instead of fuse_release()")

  Cc: <stable@vger.kernel.org> # v5.16

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  '
submodule:
- fs/fuse
hunk_count: 1
covered_count: 0
