id: e4b5080f1e963225063e
bug_link: https://syzkaller.appspot.com/bug?extid=e4b5080f1e963225063e
title: kernel BUG in bch2_fs_btree_write_buffer_exit
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 8440da933127fc5330c3d1090cdd612fddbc40eb
fix_commit: ca43f73cd1720e3b0b9c49deec1a13c89c0ca1e8
datetime: '2024-11-07T23:31:11-05:00'
fix_commit_message: 'bcachefs: bch2_btree_write_buffer_flush_going_ro()


  The write buffer needs to be specifically flushed when going RO: keys in

  the journal that haven''t yet been moved to the write buffer don''t have a

  journal pin yet.


  This fixes numerous syzbot bugs, all with symptoms of still doing writes

  after we''ve got RO.


  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 6
covered_count: 0
