id: e5f3c9783e7048a74233054febbe9f1bdf54b6da
bug_link: https://syzkaller.appspot.com/bug?extid=e5f3c9783e7048a74233054febbe9f1bdf54b6da
title: 'KASAN: use-after-free Read in snd_timer_user_info_compat'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f265788c336979090ac80b9ae173aa817c4fe40d
fix_commit: 79fb0518fec8c8b4ea7f1729f54f293724b3dbb0
datetime: '2017-10-31T08:28:16+01:00'
fix_commit_message: 'ALSA: timer: Add missing mutex lock for compat ioctls


  The races among ioctl and other operations were protected by the

  commit af368027a49a ("ALSA: timer: Fix race among timer ioctls") and

  later fixes, but one code path was forgotten in the scenario: the

  32bit compat ioctl.  As syzkaller recently spotted, a very similar

  use-after-free may happen with the combination of compat ioctls.


  The fix is simply to apply the same ioctl_lock to the compat_ioctl

  callback, too.


  Fixes: af368027a49a ("ALSA: timer: Fix race among timer ioctls")

  Reference: http://lkml.kernel.org/r/089e082686ac9b482e055c832617@google.com

  Reported-by: syzbot <bot+e5f3c9783e7048a74233054febbe9f1bdf54b6da@syzkaller.appspotmail.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Takashi Iwai <tiwai@suse.de>

  '
submodule:
- sound/core
hunk_count: 3
covered_count: 3
