id: 78d82470c16a49702682
bug_link: https://syzkaller.appspot.com/bug?extid=78d82470c16a49702682
title: kernel BUG in bch2_btree_node_lock_write
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b3d82c2f27611c897c3877a51de8f8df755165af
fix_commit: f9e0a9be70c8f790fe721ee2796995b06a314b7f
datetime: '2024-12-21T01:36:20-05:00'
fix_commit_message: 'bcachefs: Issue a transaction restart after commit in repair


  transaction commits invalidate pointers to btree values, and they also

  downgrade intent locks.


  This breaks the interior btree update path, which takes intent locks and

  then calls into the allocator.


  This isn''t an ideal solution: we can''t unconditionally issue a restart

  after a transaction commit, because that would break other codepaths.


  Reported-by: syzbot+78d82470c16a49702682@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 2
covered_count: 0
