id: 1a247e36149ffd709a9b
bug_link: https://syzkaller.appspot.com/bug?extid=1a247e36149ffd709a9b
title: 'UBSAN: array-index-out-of-bounds in pvr2_i2c_core_init'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6b124062d5b0f594ea46a20968061b60b288b524
fix_commit: 471bec68457aaf981add77b4f590d65dd7da1059
datetime: '2022-05-13T11:02:19+02:00'
fix_commit_message: 'media: pvrusb2: fix array-index-out-of-bounds in pvr2_i2c_core_init


  Syzbot reported that -1 is used as array index. The problem was in

  missing validation check.


  hdw->unit_number is initialized with -1 and then if init table walk fails

  this value remains unchanged. Since code blindly uses this member for

  array indexing adding sanity check is the easiest fix for that.


  hdw->workpoll initialization moved upper to prevent warning in

  __flush_work.


  Reported-and-tested-by: syzbot+1a247e36149ffd709a9b@syzkaller.appspotmail.com


  Fixes: d855497edbfb ("V4L/DVB (4228a): pvrusb2 to kernel 2.6.18")

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>

  Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>

  '
submodule:
- drivers/media/usb/pvrusb2
hunk_count: 2
covered_count: 0
