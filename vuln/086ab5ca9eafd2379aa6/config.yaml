id: 086ab5ca9eafd2379aa6
bug_link: https://syzkaller.appspot.com/bug?extid=086ab5ca9eafd2379aa6
title: 'KMSAN: uninit-value in xa_load'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 92ed301919932f777713b9172e525674157e983d
fix_commit: 31142a4ba617f5aa8aefdf1c65561ca30d43f360
datetime: '2020-07-27T11:50:00-03:00'
fix_commit_message: "RDMA/cm: Add min length checks to user structure copies\n\nThese\
  \ are missing throughout ucma, it harmlessly copies garbage from\nuserspace, but\
  \ in this new code which uses min to compute the copy length\nit can result in uninitialized\
  \ stack memory. Check for minimum length at\nthe very start.\n\n  BUG: KMSAN: uninit-value\
  \ in ucma_connect+0x2aa/0xab0 drivers/infiniband/core/ucma.c:1091\n  CPU: 0 PID:\
  \ 8457 Comm: syz-executor069 Not tainted 5.8.0-rc5-syzkaller #0\n  Hardware name:\
  \ Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\n \
  \ Call Trace:\n   __dump_stack lib/dump_stack.c:77 [inline]\n   dump_stack+0x1df/0x240\
  \ lib/dump_stack.c:118\n   kmsan_report+0xf7/0x1e0 mm/kmsan/kmsan_report.c:121\n\
  \   __msan_warning+0x58/0xa0 mm/kmsan/kmsan_instr.c:215\n   ucma_connect+0x2aa/0xab0\
  \ drivers/infiniband/core/ucma.c:1091\n   ucma_write+0x5c5/0x630 drivers/infiniband/core/ucma.c:1764\n\
  \   do_loop_readv_writev fs/read_write.c:737 [inline]\n   do_iter_write+0x710/0xdc0\
  \ fs/read_write.c:1020\n   vfs_writev fs/read_write.c:1091 [inline]\n   do_writev+0x42d/0x8f0\
  \ fs/read_write.c:1134\n   __do_sys_writev fs/read_write.c:1207 [inline]\n   __se_sys_writev+0x9b/0xb0\
  \ fs/read_write.c:1204\n   __x64_sys_writev+0x4a/0x70 fs/read_write.c:1204\n   do_syscall_64+0xb0/0x150\
  \ arch/x86/entry/common.c:386\n   entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\nFixes:\
  \ 34e2ab57a911 (\"RDMA/ucma: Extend ucma_connect to receive ECE parameters\")\n\
  Fixes: 0cb15372a615 (\"RDMA/cma: Connect ECE to rdma_accept\")\nLink: https://lore.kernel.org/r/0-v1-d5b86dab17dc+28c25-ucma_syz_min_jgg@nvidia.com\n\
  Reported-by: syzbot+086ab5ca9eafd2379aa6@syzkaller.appspotmail.com\nReported-by:\
  \ syzbot+7446526858b83c8828b2@syzkaller.appspotmail.com\nReviewed-by: Leon Romanovsky\
  \ <leonro@mellanox.com>\nSigned-off-by: Jason Gunthorpe <jgg@nvidia.com>\n"
submodule:
- drivers/infiniband/core
hunk_count: 2
covered_count: 2
