id: b2be9dd8ca6f6c73ee2d
bug_link: https://syzkaller.appspot.com/bug?extid=b2be9dd8ca6f6c73ee2d
title: 'UBSAN: shift-out-of-bounds in xfrm_get_default'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 626bf91a292e2035af5b9d9cce35c5c138dfe06d
fix_commit: 3c10ffddc61f8a1a59e29a110ba70b47e679206a
datetime: '2021-09-09T12:12:17+02:00'
fix_commit_message: 'net: xfrm: fix shift-out-of-bounds in xfrm_get_default


  Syzbot hit shift-out-of-bounds in xfrm_get_default. The problem was in

  missing validation check for user data.


  up->dirmask comes from user-space, so we need to check if this value

  is less than XFRM_USERPOLICY_DIRMASK_MAX to avoid shift-out-of-bounds bugs.


  Fixes: 2d151d39073a ("xfrm: Add possibility to set the default to block if we have
  no policy")

  Reported-and-tested-by: syzbot+b2be9dd8ca6f6c73ee2d@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>

  '
submodule:
- net/xfrm
hunk_count: 1
covered_count: 1
