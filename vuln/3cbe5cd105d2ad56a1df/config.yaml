id: 3cbe5cd105d2ad56a1df
bug_link: https://syzkaller.appspot.com/bug?extid=3cbe5cd105d2ad56a1df
title: general protection fault in __pm_runtime_resume
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 416dacb819f59180e4d86a5550052033ebb6d72c
fix_commit: 5f9242775bb61f390f0885f23fc16397262c7538
datetime: '2019-08-22T09:53:08+02:00'
fix_commit_message: "HID: logitech: Fix general protection fault caused by Logitech\
  \ driver\n\nThe syzbot fuzzer found a general protection fault in the HID subsystem:\n\
  \nkasan: CONFIG_KASAN_INLINE enabled\nkasan: GPF could be caused by NULL-ptr deref\
  \ or user memory access\ngeneral protection fault: 0000 [#1] SMP KASAN\nCPU: 0 PID:\
  \ 3715 Comm: syz-executor.3 Not tainted 5.2.0-rc6+ #15\nHardware name: Google Google\
  \ Compute Engine/Google Compute Engine, BIOS\nGoogle 01/01/2011\nRIP: 0010:__pm_runtime_resume+0x49/0x180\
  \ drivers/base/power/runtime.c:1069\nCode: ed 74 d5 fe 45 85 ed 0f 85 9a 00 00 00\
  \ e8 6f 73 d5 fe 48 8d bd c1 02\n00 00 48 b8 00 00 00 00 00 fc ff df 48 89 fa 48\
  \ c1 ea 03 <0f> b6 04 02 48\n89 fa 83 e2 07 38 d0 7f 08 84 c0 0f 85 fe 00 00 00\n\
  RSP: 0018:ffff8881d99d78e0 EFLAGS: 00010202\nRAX: dffffc0000000000 RBX: 0000000000000020\
  \ RCX: ffffc90003f3f000\nRDX: 0000000416d8686d RSI: ffffffff82676841 RDI: 00000020b6c3436a\n\
  RBP: 00000020b6c340a9 R08: ffff8881c6d64800 R09: fffffbfff0e84c25\nR10: ffff8881d99d7940\
  \ R11: ffffffff87426127 R12: 0000000000000004\nR13: 0000000000000000 R14: ffff8881d9b94000\
  \ R15: ffffffff897f9048\nFS:  00007f047f542700(0000) GS:ffff8881db200000(0000) knlGS:0000000000000000\n\
  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000001b30f21000 CR3: 00000001ca032000\
  \ CR4: 00000000001406f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n\
  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n\
  \  pm_runtime_get_sync include/linux/pm_runtime.h:226 [inline]\n  usb_autopm_get_interface+0x1b/0x50\
  \ drivers/usb/core/driver.c:1707\n  usbhid_power+0x7c/0xe0 drivers/hid/usbhid/hid-core.c:1234\n\
  \  hid_hw_power include/linux/hid.h:1038 [inline]\n  hidraw_open+0x20d/0x740 drivers/hid/hidraw.c:282\n\
  \  chrdev_open+0x219/0x5c0 fs/char_dev.c:413\n  do_dentry_open+0x497/0x1040 fs/open.c:778\n\
  \  do_last fs/namei.c:3416 [inline]\n  path_openat+0x1430/0x3ff0 fs/namei.c:3533\n\
  \  do_filp_open+0x1a1/0x280 fs/namei.c:3563\n  do_sys_open+0x3c0/0x580 fs/open.c:1070\n\
  \  do_syscall_64+0xb7/0x560 arch/x86/entry/common.c:301\n  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\
  \nIt turns out the fault was caused by a bug in the HID Logitech driver,\nwhich\
  \ violates the requirement that every pathway calling\nhid_hw_start() must also\
  \ call hid_hw_stop().  This patch fixes the bug\nby making sure the requirement\
  \ is met.\n\nReported-and-tested-by: syzbot+3cbe5cd105d2ad56a1df@syzkaller.appspotmail.com\n\
  Signed-off-by: Alan Stern <stern@rowland.harvard.edu>\nCC: <stable@vger.kernel.org>\n\
  Signed-off-by: Jiri Kosina <jkosina@suse.cz>\n"
submodule:
- drivers/hid
hunk_count: 4
covered_count: 0
