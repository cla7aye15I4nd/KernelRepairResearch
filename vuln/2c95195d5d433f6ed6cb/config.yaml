id: 2c95195d5d433f6ed6cb
bug_link: https://syzkaller.appspot.com/bug?extid=2c95195d5d433f6ed6cb
title: 'BUG: Dentry still in use [unmount of nfsd nfsd]'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 609488bc979f99f805f34e9a32c1e3b71179d10b
fix_commit: d6846bfbeeac873d85f32bd2b988fa94c89dbcb8
datetime: '2019-08-15T14:53:00-04:00'
fix_commit_message: 'nfsd: fix dentry leak upon mkdir failure.


  syzbot is reporting that nfsd_mkdir() forgot to remove dentry created by

  d_alloc_name() when __nfsd_mkdir() failed (due to memory allocation fault

  injection) [1].


  [1] https://syzkaller.appspot.com/bug?id=ce41a1f769ea4637ebffedf004a803e8405b4674


  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Reported-by: syzbot <syzbot+2c95195d5d433f6ed6cb@syzkaller.appspotmail.com>

  Fixes: e8a79fb14f6b76b5 ("nfsd: add nfsd/clients directory")

  [bfields: clean up in nfsd_mkdir instead of __nfsd_mkdir]

  Signed-off-by: J. Bruce Fields <bfields@redhat.com>

  '
submodule:
- fs/nfsd
hunk_count: 1
covered_count: 0
