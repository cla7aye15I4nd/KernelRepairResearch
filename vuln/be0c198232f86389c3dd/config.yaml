id: be0c198232f86389c3dd
bug_link: https://syzkaller.appspot.com/bug?extid=be0c198232f86389c3dd
title: WARNING in lockdep_unregister_key
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9e98c678c2d6ae3a17cb2de55d17f69dddaa231b
fix_commit: 82efcab3b9f3ef59e9713237c6e3c05c3a95c1ae
datetime: '2019-03-21T12:00:18+01:00'
fix_commit_message: 'workqueue: Only unregister a registered lockdep key


  The recent change to prevent use after free and a memory leak introduced an

  unconditional call to wq_unregister_lockdep() in the error handling

  path. If the lockdep key had not been registered yet, then the lockdep core

  emits a warning.


  Only call wq_unregister_lockdep() if wq_register_lockdep() has been

  called first.


  Fixes: 009bb421b6ce ("workqueue, lockdep: Fix an alloc_workqueue() error path")

  Reported-by: syzbot+be0c198232f86389c3dd@syzkaller.appspotmail.com

  Signed-off-by: Bart Van Assche <bvanassche@acm.org>

  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

  Cc: Peter Zijlstra <peterz@infradead.org>

  Cc: Linus Torvalds <torvalds@linux-foundation.org>

  Cc: Tejun Heo <tj@kernel.org>

  Cc: Qian Cai <cai@lca.pw>

  Link: https://lkml.kernel.org/r/20190311230255.176081-1-bvanassche@acm.org


  '
submodule:
- kernel
hunk_count: 2
covered_count: 2
