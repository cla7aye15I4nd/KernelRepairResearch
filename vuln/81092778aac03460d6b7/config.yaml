id: 81092778aac03460d6b7
bug_link: https://syzkaller.appspot.com/bug?extid=81092778aac03460d6b7
title: kernel BUG in ocfs2_truncate_inline
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d949d1d14fa281ace388b1de978e8f2cd52875cf
fix_commit: bc0a2f3a73fcdac651fca64df39306d1e5ebe3b0
datetime: '2024-10-28T21:40:40-07:00'
fix_commit_message: 'ocfs2: pass u64 to ocfs2_truncate_inline maybe overflow


  Syzbot reported a kernel BUG in ocfs2_truncate_inline.  There are two

  reasons for this: first, the parameter value passed is greater than

  ocfs2_max_inline_data_with_xattr, second, the start and end parameters of

  ocfs2_truncate_inline are "unsigned int".


  So, we need to add a sanity check for byte_start and byte_len right before

  ocfs2_truncate_inline() in ocfs2_remove_inode_range(), if they are greater

  than ocfs2_max_inline_data_with_xattr return -EINVAL.


  Link: https://lkml.kernel.org/r/tencent_D48DB5122ADDAEDDD11918CFB68D93258C07@qq.com

  Fixes: 1afc32b95233 ("ocfs2: Write support for inline data")

  Signed-off-by: Edward Adam Davis <eadavis@qq.com>

  Reported-by: syzbot+81092778aac03460d6b7@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=81092778aac03460d6b7

  Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>

  Cc: Joel Becker <jlbec@evilplan.org>

  Cc: Joseph Qi <joseph.qi@linux.alibaba.com>

  Cc: Mark Fasheh <mark@fasheh.com>

  Cc: Junxiao Bi <junxiao.bi@oracle.com>

  Cc: Changwei Ge <gechangwei@live.cn>

  Cc: Gang He <ghe@suse.com>

  Cc: Jun Piao <piaojun@huawei.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/ocfs2
hunk_count: 1
covered_count: 1
