id: 2ee18845e89ae76342c5
bug_link: https://syzkaller.appspot.com/bug?extid=2ee18845e89ae76342c5
title: 'WARNING: suspicious RCU usage in mas_walk'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d035230ec9937a9138921d2a0eeb99496ea7eac0
fix_commit: 6db504ce55bdbc575723938fc480713c9183f6a2
datetime: '2023-03-23T17:18:33-07:00'
fix_commit_message: "mm/ksm: fix race with VMA iteration and mm_struct teardown\n\n\
  exit_mmap() will tear down the VMAs and maple tree with the mmap_lock held\nin write\
  \ mode.  Ensure that the maple tree is still valid by checking\nksm_test_exit()\
  \ after taking the mmap_lock in read mode, but before the\nfor_each_vma() iterator\
  \ dereferences a destroyed maple tree.\n\nSince the maple tree is destroyed, the\
  \ flags telling lockdep to check an\nexternal lock has been cleared.  Skip the for_each_vma()\
  \ iterator to avoid\ndereferencing a maple tree without the external lock flag,\
  \ which would\ncreate a lockdep warning.\n\nLink: https://lkml.kernel.org/r/20230308220310.3119196-1-Liam.Howlett@oracle.com\n\
  Fixes: a5f18ba07276 (\"mm/ksm: use vma iterators instead of vma linked list\")\n\
  Signed-off-by: Liam R. Howlett <Liam.Howlett@oracle.com>\nReported-by: Pengfei Xu\
  \ <pengfei.xu@intel.com>\n  Link: https://lore.kernel.org/lkml/ZAdUUhSbaa6fHS36@xpf.sh.intel.com/\n\
  Reported-by: syzbot+2ee18845e89ae76342c5@syzkaller.appspotmail.com\n  Link: https://syzkaller.appspot.com/bug?id=64a3e95957cd3deab99df7cd7b5a9475af92c93e\n\
  Acked-by: David Hildenbrand <david@redhat.com>\nCc: Matthew Wilcox (Oracle) <willy@infradead.org>\n\
  Cc: <heng.su@intel.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton\
  \ <akpm@linux-foundation.org>\n"
submodule:
- mm
hunk_count: 2
covered_count: 2
