id: 8ab8bf161038a8768553
bug_link: https://syzkaller.appspot.com/bug?extid=8ab8bf161038a8768553
title: divide error in dummy_timer
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 1186f86a71130a7635a20843e355bb880c7349b2
fix_commit: 54f83b8c8ea9b22082a496deadf90447a326954e
datetime: '2019-10-29T09:56:18+01:00'
fix_commit_message: 'USB: gadget: Reject endpoints with 0 maxpacket value


  Endpoints with a maxpacket length of 0 are probably useless.  They

  can''t transfer any data, and it''s not at all unlikely that a UDC will

  crash or hang when trying to handle a non-zero-length usb_request for

  such an endpoint.  Indeed, dummy-hcd gets a divide error when trying

  to calculate the remainder of a transfer length by the maxpacket

  value, as discovered by the syzbot fuzzer.


  Currently the gadget core does not check for endpoints having a

  maxpacket value of 0.  This patch adds a check to usb_ep_enable(),

  preventing such endpoints from being used.


  As far as I know, none of the gadget drivers in the kernel tries to

  create an endpoint with maxpacket = 0, but until now there has been

  nothing to prevent userspace programs under gadgetfs or configfs from

  doing it.


  Signed-off-by: Alan Stern <stern@rowland.harvard.edu>

  Reported-and-tested-by: syzbot+8ab8bf161038a8768553@syzkaller.appspotmail.com

  CC: <stable@vger.kernel.org>

  Acked-by: Felipe Balbi <balbi@kernel.org>


  Link: https://lore.kernel.org/r/Pine.LNX.4.44L0.1910281052370.1485-100000@iolanthe.rowland.org

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/usb/gadget/udc
hunk_count: 1
covered_count: 0
