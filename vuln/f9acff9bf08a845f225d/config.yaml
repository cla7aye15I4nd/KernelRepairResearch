id: f9acff9bf08a845f225d
bug_link: https://syzkaller.appspot.com/bug?extid=f9acff9bf08a845f225d
title: 'KASAN: use-after-free Read in ieee80211_scan_rx (3)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 24c7a64ea4764d70e4ac9b0a60ecd9b03c68435e
fix_commit: 60deb9f10eec5c6a20252ed36238b55d8b614a2c
datetime: '2022-08-25T10:00:21+02:00'
fix_commit_message: 'wifi: mac80211: Fix UAF in ieee80211_scan_rx()


  ieee80211_scan_rx() tries to access scan_req->flags after a

  null check, but a UAF is observed when the scan is completed

  and __ieee80211_scan_completed() executes, which then calls

  cfg80211_scan_done() leading to the freeing of scan_req.


  Since scan_req is rcu_dereference()''d, prevent the racing in

  __ieee80211_scan_completed() by ensuring that from mac80211''s

  POV it is no longer accessed from an RCU read critical section

  before we call cfg80211_scan_done().


  Cc: stable@vger.kernel.org

  Link: https://syzkaller.appspot.com/bug?extid=f9acff9bf08a845f225d

  Reported-by: syzbot+f9acff9bf08a845f225d@syzkaller.appspotmail.com

  Suggested-by: Johannes Berg <johannes@sipsolutions.net>

  Signed-off-by: Siddh Raman Pant <code@siddh.me>

  Link: https://lore.kernel.org/r/20220819200340.34826-1-code@siddh.me

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- net/mac80211
hunk_count: 1
covered_count: 0
