id: 510dcbdc6befa1e6b2f6
bug_link: https://syzkaller.appspot.com/bug?extid=510dcbdc6befa1e6b2f6
title: 'UBSAN: array-index-out-of-bounds in xfs_attr3_leaf_add_work'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 371baf5c9750a258fee21d0cb8c8d683bb057429
fix_commit: a49bbce58ea90b14d4cb1d00681023a8606955f2
datetime: '2023-07-17T08:48:56-07:00'
fix_commit_message: "xfs: convert flex-array declarations in xfs attr leaf blocks\n\
  \nAs of 6.5-rc1, UBSAN trips over the ondisk extended attribute leaf block\ndefinitions\
  \ using an array length of 1 to pretend to be a flex array.\nKernel compilers have\
  \ to support unbounded array declarations, so let's\ncorrect this.\n\n================================================================================\n\
  UBSAN: array-index-out-of-bounds in fs/xfs/libxfs/xfs_attr_leaf.c:2535:24\nindex\
  \ 2 is out of range for type '__u8 [1]'\nCall Trace:\n <TASK>\n dump_stack_lvl+0x33/0x50\n\
  \ __ubsan_handle_out_of_bounds+0x9c/0xd0\n xfs_attr3_leaf_getvalue+0x2ce/0x2e0 [xfs\
  \ 4a986a89a77bb77402ab8a87a37da369ef6a3f09]\n xfs_attr_leaf_get+0x148/0x1c0 [xfs\
  \ 4a986a89a77bb77402ab8a87a37da369ef6a3f09]\n xfs_attr_get_ilocked+0xae/0x110 [xfs\
  \ 4a986a89a77bb77402ab8a87a37da369ef6a3f09]\n xfs_attr_get+0xee/0x150 [xfs 4a986a89a77bb77402ab8a87a37da369ef6a3f09]\n\
  \ xfs_xattr_get+0x7d/0xc0 [xfs 4a986a89a77bb77402ab8a87a37da369ef6a3f09]\n __vfs_getxattr+0xa3/0x100\n\
  \ vfs_getxattr+0x87/0x1d0\n do_getxattr+0x17a/0x220\n getxattr+0x89/0xf0\n\nSigned-off-by:\
  \ Darrick J. Wong <djwong@kernel.org>\nReviewed-by: Christoph Hellwig <hch@lst.de>\n\
  Reviewed-by: Kees Cook <keescook@chromium.org>\n"
submodule:
- fs/xfs
hunk_count: 5
covered_count: 0
