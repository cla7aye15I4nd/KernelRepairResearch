id: 5f3a973ed3dfb85a6683
bug_link: https://syzkaller.appspot.com/bug?extid=5f3a973ed3dfb85a6683
title: 'KASAN: slab-out-of-bounds Write in hfs_bnode_read_key (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a94fd938df2b1628da66b498aa0eeb89593bc7a2
fix_commit: bb5e07cb927724e0b47be371fa081141cfb14414
datetime: '2025-04-07T19:21:51+02:00'
fix_commit_message: "hfs/hfsplus: fix slab-out-of-bounds in hfs_bnode_read_key\n\n\
  Syzbot reported an issue in hfs subsystem:\n\nBUG: KASAN: slab-out-of-bounds in\
  \ memcpy_from_page include/linux/highmem.h:423 [inline]\nBUG: KASAN: slab-out-of-bounds\
  \ in hfs_bnode_read fs/hfs/bnode.c:35 [inline]\nBUG: KASAN: slab-out-of-bounds in\
  \ hfs_bnode_read_key+0x314/0x450 fs/hfs/bnode.c:70\nWrite of size 94 at addr ffff8880123cd100\
  \ by task syz-executor237/5102\n\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:94\
  \ [inline]\n dump_stack_lvl+0x241/0x360 lib/dump_stack.c:120\n print_address_description\
  \ mm/kasan/report.c:377 [inline]\n print_report+0x169/0x550 mm/kasan/report.c:488\n\
  \ kasan_report+0x143/0x180 mm/kasan/report.c:601\n kasan_check_range+0x282/0x290\
  \ mm/kasan/generic.c:189\n __asan_memcpy+0x40/0x70 mm/kasan/shadow.c:106\n memcpy_from_page\
  \ include/linux/highmem.h:423 [inline]\n hfs_bnode_read fs/hfs/bnode.c:35 [inline]\n\
  \ hfs_bnode_read_key+0x314/0x450 fs/hfs/bnode.c:70\n hfs_brec_insert+0x7f3/0xbd0\
  \ fs/hfs/brec.c:159\n hfs_cat_create+0x41d/0xa50 fs/hfs/catalog.c:118\n hfs_mkdir+0x6c/0xe0\
  \ fs/hfs/dir.c:232\n vfs_mkdir+0x2f9/0x4f0 fs/namei.c:4257\n do_mkdirat+0x264/0x3a0\
  \ fs/namei.c:4280\n __do_sys_mkdir fs/namei.c:4300 [inline]\n __se_sys_mkdir fs/namei.c:4298\
  \ [inline]\n __x64_sys_mkdir+0x6c/0x80 fs/namei.c:4298\n do_syscall_x64 arch/x86/entry/common.c:52\
  \ [inline]\n do_syscall_64+0xf3/0x230 arch/x86/entry/common.c:83\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\n\
  RIP: 0033:0x7fbdd6057a99\n\nAdd a check for key length in hfs_bnode_read_key to\
  \ prevent\nout-of-bounds memory access. If the key length is invalid, the\nkey buffer\
  \ is cleared, improving stability and reliability.\n\nFixes: 1da177e4c3f4 (\"Linux-2.6.12-rc2\"\
  )\nReported-by: syzbot+5f3a973ed3dfb85a6683@syzkaller.appspotmail.com\nCloses: https://syzkaller.appspot.com/bug?extid=5f3a973ed3dfb85a6683\n\
  Cc: stable@vger.kernel.org\nSigned-off-by: Vasiliy Kovalev <kovalev@altlinux.org>\n\
  Link: https://lore.kernel.org/20241019191303.24048-1-kovalev@altlinux.org\nReviewed-by:\
  \ Cengiz Can <cengiz.can@canonical.com>\nSigned-off-by: Christian Brauner <brauner@kernel.org>\n"
submodule:
- fs/hfs
- fs/hfsplus
hunk_count: 2
covered_count: 1
