id: f2aca089e6f77e5acd46
bug_link: https://syzkaller.appspot.com/bug?extid=f2aca089e6f77e5acd46
title: WARNING in io_poll_double_wake
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ef04688871f3386b6d40ade8f5c664290420f819
fix_commit: a890d01e4ee016978776e45340e521b3bbbdf41f
datetime: '2021-07-28T07:24:57-06:00'
fix_commit_message: 'io_uring: fix poll requests leaking second poll entries


  For pure poll requests, it doesn''t remove the second poll wait entry

  when it''s done, neither after vfs_poll() or in the poll completion

  handler. We should remove the second poll wait entry.

  And we use io_poll_remove_double() rather than io_poll_remove_waitqs()

  since the latter has some redundant logic.


  Fixes: 88e41cf928a6 ("io_uring: add multishot mode for IORING_OP_POLL_ADD")

  Cc: stable@vger.kernel.org # 5.13+

  Signed-off-by: Hao Xu <haoxu@linux.alibaba.com>

  Link: https://lore.kernel.org/r/20210728030322.12307-1-haoxu@linux.alibaba.com

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- fs
hunk_count: 4
covered_count: 2
