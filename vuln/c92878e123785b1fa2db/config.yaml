id: c92878e123785b1fa2db
bug_link: https://syzkaller.appspot.com/bug?extid=c92878e123785b1fa2db
title: WARNING in iommufd_device_unbind
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 11534b4de2a1bcc438ed90d031184c9c847e8560
fix_commit: d9df72c6acd683adf6dd23c061f3a414ec00b1f8
datetime: '2025-01-14T13:50:05-04:00'
fix_commit_message: 'iommu: iommufd: fix WARNING in iommufd_device_unbind


  Fix an issue detected by syzbot:


  WARNING in iommufd_device_unbind iommufd: Time out waiting for iommufd object to
  become free


  Resolve a warning in iommufd_device_unbind caused by a timeout while

  waiting for the shortterm_users reference count to reach zero. The

  existing 10-second timeout is insufficient in some scenarios, resulting in

  failures the above warning.


  Increase the timeout in iommufd_object_dec_wait_shortterm from 10 seconds

  to 60 seconds to allow sufficient time for the reference count to drop to

  zero. This change prevents premature timeouts and reduces the likelihood

  of warnings during iommufd_device_unbind.


  Fixes: 6f9c4d8c468c ("iommufd: Do not UAF during iommufd_put_object()")

  Link: https://patch.msgid.link/r/20241123195900.3176-1-surajsonawane0215@gmail.com

  Reported-by: syzbot+c92878e123785b1fa2db@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=c92878e123785b1fa2db

  Tested-by: syzbot+c92878e123785b1fa2db@syzkaller.appspotmail.com

  Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>

  Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>

  '
submodule:
- drivers/iommu/iommufd
hunk_count: 1
covered_count: 0
