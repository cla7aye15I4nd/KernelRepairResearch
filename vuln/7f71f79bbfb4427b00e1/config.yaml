id: 7f71f79bbfb4427b00e1
bug_link: https://syzkaller.appspot.com/bug?extid=7f71f79bbfb4427b00e1
title: 'BUG: sleeping function called from invalid context in ntfs_d_hash'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bdd6baf7408c69d403365d156447a22982d45430
fix_commit: 589996bf8c459deb5bbc9747d8f1c51658608103
datetime: '2024-10-01T12:19:06+03:00'
fix_commit_message: 'ntfs3: Change to non-blocking allocation in ntfs_d_hash


  d_hash is done while under "rcu-walk" and should not sleep.

  __get_name() allocates using GFP_KERNEL, having the possibility

  to sleep when under memory pressure. Change the allocation to

  GFP_NOWAIT.


  Reported-by: syzbot+7f71f79bbfb4427b00e1@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=7f71f79bbfb4427b00e1

  Fixes: d392e85fd1e8 ("fs/ntfs3: Fix the format of the "nocase" mount option")

  Signed-off-by: Diogo Jahchan Koike <djahchankoike@gmail.com>

  Signed-off-by: Konstantin Komarov <almaz.alexandrovich@paragon-software.com>

  '
submodule:
- fs/ntfs3
hunk_count: 2
covered_count: 2
