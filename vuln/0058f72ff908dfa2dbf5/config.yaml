id: 0058f72ff908dfa2dbf5
bug_link: https://syzkaller.appspot.com/bug?extid=0058f72ff908dfa2dbf5
title: 'linux-next test error: general protection fault in of_pci_supply_present'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7582fe07f4ca4c560eb47800b640997f06a8baa2
fix_commit: 278dd091e95d428eea0a2c3c517d895b052de5ff
datetime: '2024-11-21T16:01:04+00:00'
fix_commit_message: "PCI/pwrctl: Create pwrctl device only if at least one power supply\
  \ is present\n\nCurrently, pwrctl devices are created if the corresponding PCI nodes\
  \ are\ndefined in devicetree. But this is not correct, because not all PCI nodes\n\
  require pwrctl support. Pwrctl comes into the picture only when the device\nrequires\
  \ kernel to manage its power state. This can be determined using the\npower supply\
  \ properties present in the devicetree node of the device.\n\nAdd of_pci_supply_present()\
  \ to check whether the devicetree contains at\nleast one power supply property for\
  \ a device. If one is present, create a\npwrctl device for that PCI node.\n\nSuggested-by:\
  \ Dmitry Baryshkov <dmitry.baryshkov@linaro.org>\nFixes: 8fb18619d910 (\"PCI/pwrctl:\
  \ Create platform devices for child OF nodes of the port node\")\nLink: https://lore.kernel.org/r/20241025-pci-pwrctl-rework-v2-2-568756156cbe@linaro.org\n\
  Tested-by: Bartosz Golaszewski <bartosz.golaszewski@linaro.org>\nTested-by: Krishna\
  \ chaitanya chundru <quic_krichai@quicinc.com>\nSigned-off-by: Manivannan Sadhasivam\
  \ <manivannan.sadhasivam@linaro.org>\n[bhelgaas: rename of_pci_is_supply_present()\
  \ to of_pci_supply_present() for\nreadability]\nSigned-off-by: Bjorn Helgaas <bhelgaas@google.com>\n\
  Signed-off-by: Krzysztof Wilczy≈Ñski <kwilczynski@kernel.org>\nReviewed-by: Bartosz\
  \ Golaszewski <bartosz.golaszewski@linaro.org>\nCc: stable+noautosel@kernel.org\t\
  \t# Depends on of_platform_device_create() rework\n"
submodule:
- drivers/pci
hunk_count: 4
covered_count: 1
