id: 2c56b725ec547fa9cb29
bug_link: https://syzkaller.appspot.com/bug?extid=2c56b725ec547fa9cb29
title: general protection fault in sg_alloc_append_table_from_pages
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 269332997a160b3785690a32d2c5496bce7dae51
fix_commit: 2b6dd600dd72573c23ea180b5b0b2f1813405882
datetime: '2022-01-18T07:52:41+01:00'
fix_commit_message: 'udmabuf: validate ubuf->pagecount


  Syzbot has reported GPF in sg_alloc_append_table_from_pages(). The

  problem was in ubuf->pages == ZERO_PTR.


  ubuf->pagecount is calculated from arguments passed from user-space. If

  user creates udmabuf with list.size == 0 then ubuf->pagecount will be

  also equal to zero; it causes kmalloc_array() to return ZERO_PTR.


  Fix it by validating ubuf->pagecount before passing it to

  kmalloc_array().


  Fixes: fbb0de795078 ("Add udmabuf misc device")

  Reported-and-tested-by: syzbot+2c56b725ec547fa9cb29@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Link: http://patchwork.freedesktop.org/patch/msgid/20211230142649.23022-1-paskripkin@gmail.com

  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

  '
submodule:
- drivers/dma-buf
hunk_count: 1
covered_count: 0
