id: 4376a9a073770c173269
bug_link: https://syzkaller.appspot.com/bug?extid=4376a9a073770c173269
title: 'WARNING: kmalloc bug in btrfs_ioctl_send'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: eadd7deca0ad8a83edb2b894d8326c78e78635d6
fix_commit: 33e17b3f5ab74af12aca58c515bc8424ff69a343
datetime: '2023-01-27T14:57:05+01:00'
fix_commit_message: 'btrfs: send: limit number of clones and allocated memory size


  The arg->clone_sources_count is u64 and can trigger a warning when a

  huge value is passed from user space and a huge array is allocated.

  Limit the allocated memory to 8MiB (can be increased if needed), which

  in turn limits the number of clone sources to 8M / sizeof(struct

  clone_root) = 8M / 40 = 209715.  Real world number of clones is from

  tens to hundreds, so this is future proof.


  Reported-by: syzbot+4376a9a073770c173269@syzkaller.appspotmail.com

  Signed-off-by: David Sterba <dsterba@suse.com>

  '
submodule:
- fs/btrfs
hunk_count: 1
covered_count: 0
