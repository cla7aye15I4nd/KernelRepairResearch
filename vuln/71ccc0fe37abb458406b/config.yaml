id: 71ccc0fe37abb458406b
bug_link: https://syzkaller.appspot.com/bug?extid=71ccc0fe37abb458406b
title: general protection fault in bpf_struct_ops_link_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 226bc6ae6405c46a6e9865835c36a1d45fc0b3bf
fix_commit: 55fbae05476df65e5eee8be54f61d0257af0240b
datetime: '2023-03-24T12:40:47-07:00'
fix_commit_message: 'bpf: Check IS_ERR for the bpf_map_get() return value


  This patch fixes a mistake in checking NULL instead of

  checking IS_ERR for the bpf_map_get() return value.


  It also fixes the return value in link_update_map() from -EINVAL

  to PTR_ERR(*_map).


  Reported-by: syzbot+71ccc0fe37abb458406b@syzkaller.appspotmail.com

  Fixes: 68b04864ca42 ("bpf: Create links for BPF struct_ops maps.")

  Fixes: aef56f2e918b ("bpf: Update the struct_ops of a bpf_link.")

  Signed-off-by: Martin KaFai Lau <martin.lau@kernel.org>

  Acked-by: Kui-Feng Lee <kuifeng@meta.com>

  Acked-by: Stanislav Fomichev <sdf@google.com>

  Link: https://lore.kernel.org/r/20230324184241.1387437-1-martin.lau@linux.dev

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 2
covered_count: 1
