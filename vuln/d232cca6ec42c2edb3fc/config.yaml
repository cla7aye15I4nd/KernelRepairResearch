id: d232cca6ec42c2edb3fc
bug_link: https://syzkaller.appspot.com/bug?extid=d232cca6ec42c2edb3fc
title: WARNING in wdm_write/usb_submit_urb
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 636bd02a7ba9025ff851d0cfb92768c8fa865859
fix_commit: 1426bd2c9f7e3126e2678e7469dca9fd9fc6dd3e
datetime: '2019-08-28T22:48:38+02:00'
fix_commit_message: 'USB: cdc-wdm: fix race between write and disconnect due to flag
  abuse


  In case of a disconnect an ongoing flush() has to be made fail.

  Nevertheless we cannot be sure that any pending URB has already

  finished, so although they will never succeed, they still must

  not be touched.

  The clean solution for this is to check for WDM_IN_USE

  and WDM_DISCONNECTED in flush(). There is no point in ever

  clearing WDM_IN_USE, as no further writes make sense.


  The issue is as old as the driver.


  Fixes: afba937e540c9 ("USB: CDC WDM driver")

  Reported-by: syzbot+d232cca6ec42c2edb3fc@syzkaller.appspotmail.com

  Signed-off-by: Oliver Neukum <oneukum@suse.com>

  Cc: stable <stable@vger.kernel.org>

  Link: https://lore.kernel.org/r/20190827103436.21143-1-oneukum@suse.com

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/usb/class
hunk_count: 2
covered_count: 0
