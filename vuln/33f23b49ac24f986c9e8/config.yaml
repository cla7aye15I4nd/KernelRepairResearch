id: 33f23b49ac24f986c9e8
bug_link: https://syzkaller.appspot.com/bug?extid=33f23b49ac24f986c9e8
title: 'KASAN: slab-out-of-bounds Read in getname_kernel (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5906333cc4af7b3fdb8cfff1cb3e8e579bd13174
fix_commit: 9845664b9ee47ce7ee7ea93caf47d39a9d4552c4
datetime: '2024-02-22T12:14:21+01:00'
fix_commit_message: 'btrfs: dev-replace: properly validate device names


  There''s a syzbot report that device name buffers passed to device

  replace are not properly checked for string termination which could lead

  to a read out of bounds in getname_kernel().


  Add a helper that validates both source and target device name buffers.

  For devid as the source initialize the buffer to empty string in case

  something tries to read it later.


  This was originally analyzed and fixed in a different way by Edward Adam

  Davis (see links).


  Link: https://lore.kernel.org/linux-btrfs/000000000000d1a1d1060cc9c5e7@google.com/

  Link: https://lore.kernel.org/linux-btrfs/tencent_44CA0665C9836EF9EEC80CB9E7E206DF5206@qq.com/

  CC: stable@vger.kernel.org # 4.19+

  CC: Edward Adam Davis <eadavis@qq.com>

  Reported-and-tested-by: syzbot+33f23b49ac24f986c9e8@syzkaller.appspotmail.com

  Reviewed-by: Boris Burkov <boris@bur.io>

  Signed-off-by: David Sterba <dsterba@suse.com>

  '
submodule:
- fs/btrfs
hunk_count: 2
covered_count: 2
