id: da4f525235510683d855
bug_link: https://syzkaller.appspot.com/bug?extid=da4f525235510683d855
title: 'KASAN: use-after-free Read in do_mount'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4f5cafb5cb8471e54afdc9054d973535614f7675
fix_commit: 0ecee66990644c3482209ff7c12faa7bc40449b1
datetime: '2019-10-16T23:15:09-04:00'
fix_commit_message: 'fs/namespace.c: fix use-after-free of mount in mnt_warn_timestamp_expiry()


  After do_add_mount() returns success, the caller doesn''t hold a

  reference to the ''struct mount'' anymore.  So it''s invalid to access it

  in mnt_warn_timestamp_expiry().


  Fix it by calling mnt_warn_timestamp_expiry() before do_add_mount()

  rather than after, and adjusting the warning message accordingly.


  Reported-by: syzbot+da4f525235510683d855@syzkaller.appspotmail.com

  Fixes: f8b92ba67c5d ("mount: Add mount warning for impending timestamp expiry")

  Signed-off-by: Eric Biggers <ebiggers@google.com>

  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

  '
submodule:
- fs
hunk_count: 2
covered_count: 1
