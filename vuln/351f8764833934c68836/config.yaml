id: 351f8764833934c68836
bug_link: https://syzkaller.appspot.com/bug?extid=351f8764833934c68836
title: 'BUG: sleeping function called from invalid context in vfree'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5ebe792a5139f1ce6e4aed22bef12e7e2660df96
fix_commit: 20c0c49720dc4e205d4c1d64add56a5043c5ec5f
datetime: '2024-11-25T15:48:05+01:00'
fix_commit_message: 'ALSA: rawmidi: Fix kvfree() call in spinlock


  At the conversion of locking with guard(), I overlooked that kvfree()

  must not be called inside the spinlock unlike kfree(), and this was

  caught by syzkaller now.


  This patch reverts the conversion partially for restoring the kvfree()

  call outside the spinlock.  It''s not trivial to use guard() in this

  context, unfortunately.


  Fixes: 84bb065b316e ("ALSA: rawmidi: Use guard() for locking")

  Reported-by: syzbot+351f8764833934c68836@syzkaller.appspotmail.com

  Reported-by: Eric Dumazet <eric.dumazet@gmail.com>

  Closes: https://lore.kernel.org/6744737b.050a0220.1cc393.007e.GAE@google.com

  Cc: <stable@vger.kernel.org>

  Link: https://patch.msgid.link/20241125142041.16578-1-tiwai@suse.de

  Signed-off-by: Takashi Iwai <tiwai@suse.de>

  '
submodule:
- sound/core
hunk_count: 2
covered_count: 2
