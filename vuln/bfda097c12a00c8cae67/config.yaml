id: bfda097c12a00c8cae67
bug_link: https://syzkaller.appspot.com/bug?extid=bfda097c12a00c8cae67
title: WARNING in slave_kobj_release
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 3c814519743a919f8b3c236c0565e24709806d66
fix_commit: 35d96e631860226d5dc4de0fad0a415362ec2457
datetime: '2021-05-17T15:24:20-07:00'
fix_commit_message: 'bonding: init notify_work earlier to avoid uninitialized use


  If bond_kobj_init() or later kzalloc() in bond_alloc_slave() fail,

  then we call kobject_put() on the slave->kobj. This in turn calls

  the release function slave_kobj_release() which will always try to

  cancel_delayed_work_sync(&slave->notify_work), which shouldn''t be

  done on an uninitialized work struct.


  Always initialize the work struct earlier to avoid problems here.


  Syzbot bisected this down to a completely pointless commit, some

  fault injection may have been at work here that caused the alloc

  failure in the first place, which may interact badly with bisect.


  Reported-by: syzbot+bfda097c12a00c8cae67@syzkaller.appspotmail.com

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  Acked-by: Jay Vosburgh <jay.vosburgh@canonical.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/net/bonding
hunk_count: 2
covered_count: 2
