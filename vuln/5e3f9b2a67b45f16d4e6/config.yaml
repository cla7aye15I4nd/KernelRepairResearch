id: 5e3f9b2a67b45f16d4e6
bug_link: https://syzkaller.appspot.com/bug?extid=5e3f9b2a67b45f16d4e6
title: 'KASAN: slab-use-after-free Read in fsnotify'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a5e57b4d370c6d320e5bfb0c919fe00aee29e039
fix_commit: 795bb82d12a16a4cee42845b0e4c7e3276574e5d
datetime: '2024-04-17T15:06:50+02:00'
fix_commit_message: 'fsnotify: fix UAF from FS_ERROR event on a shutting down filesystem


  Protect against use after free when filesystem calls fsnotify_sb_error()

  during fs shutdown.


  Move freeing of sb->s_fsnotify_info to destroy_super_work(), because it

  may be accessed from fs shutdown context.


  Reported-by: syzbot+5e3f9b2a67b45f16d4e6@syzkaller.appspotmail.com

  Suggested-by: Jan Kara <jack@suse.cz>

  Link: https://lore.kernel.org/linux-fsdevel/20240416173211.4lnmgctyo4jn5fha@quack3/

  Fixes: 07a3b8d0bf72 ("fsnotify: lazy attach fsnotify_sb_info state to sb")

  Reviewed-by: Christian Brauner <brauner@kernel.org>

  Signed-off-by: Amir Goldstein <amir73il@gmail.com>

  Signed-off-by: Jan Kara <jack@suse.cz>

  Message-Id: <20240416181452.567070-1-amir73il@gmail.com>

  '
submodule:
- fs
- fs/notify
- include/linux
hunk_count: 4
covered_count: 1
