id: 3140b17cb44a7b174008
bug_link: https://syzkaller.appspot.com/bug?extid=3140b17cb44a7b174008
title: kernel BUG in vhost_get_vq_desc
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 277f2bb14361790a70e4b3c649e794b75a91a597
fix_commit: a58da53ffd70294ebea8ecd0eb45fd0d74add9f9
datetime: '2022-02-23T12:32:33+00:00'
fix_commit_message: 'vhost/vsock: don''t check owner in vhost_vsock_stop() while releasing


  vhost_vsock_stop() calls vhost_dev_check_owner() to check the device

  ownership. It expects current->mm to be valid.


  vhost_vsock_stop() is also called by vhost_vsock_dev_release() when

  the user has not done close(), so when we are in do_exit(). In this

  case current->mm is invalid and we''re releasing the device, so we

  should clean it anyway.


  Let''s check the owner only when vhost_vsock_stop() is called

  by an ioctl.


  When invoked from release we can not fail so we don''t check return

  code of vhost_vsock_stop(). We need to stop vsock even if it''s not

  the owner.


  Fixes: 433fc58e6bf2 ("VSOCK: Introduce vhost_vsock.ko")

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+1e3ea63db39f2b4440e0@syzkaller.appspotmail.com

  Reported-and-tested-by: syzbot+3140b17cb44a7b174008@syzkaller.appspotmail.com

  Signed-off-by: Stefano Garzarella <sgarzare@redhat.com>

  Acked-by: Jason Wang <jasowang@redhat.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/vhost
hunk_count: 3
covered_count: 0
