id: 608a2acde8c5a101d07d
bug_link: https://syzkaller.appspot.com/bug?extid=608a2acde8c5a101d07d
title: WARNING in bpf_lwt_seg6_adjust_srh
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 605c96997d89c01c11bbddb4db820ede570581c7
fix_commit: c13fda93aca118b8e5cd202e339046728ee7dddb
datetime: '2024-07-10T09:58:52-07:00'
fix_commit_message: 'bpf: Remove tst_run from lwt_seg6local_prog_ops.


  The syzbot reported that the lwt_seg6 related BPF ops can be invoked

  via bpf_test_run() without without entering input_action_end_bpf()

  first.


  Martin KaFai Lau said that self test for BPF_PROG_TYPE_LWT_SEG6LOCAL

  probably didn''t work since it was introduced in commit 04d4b274e2a

  ("ipv6: sr: Add seg6local action End.BPF"). The reason is that the

  per-CPU variable seg6_bpf_srh_states::srh is never assigned in the self

  test case but each BPF function expects it.


  Remove test_run for BPF_PROG_TYPE_LWT_SEG6LOCAL.


  Suggested-by: Martin KaFai Lau <martin.lau@linux.dev>

  Reported-by: syzbot+608a2acde8c5a101d07d@syzkaller.appspotmail.com

  Fixes: d1542d4ae4df ("seg6: Use nested-BH locking for seg6_bpf_srh_states.")

  Fixes: 004d4b274e2a ("ipv6: sr: Add seg6local action End.BPF")

  Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>

  Acked-by: Daniel Borkmann <daniel@iogearbox.net>

  Link: https://lore.kernel.org/r/20240710141631.FbmHcQaX@linutronix.de

  Signed-off-by: Martin KaFai Lau <martin.lau@kernel.org>

  '
submodule:
- net/core
hunk_count: 1
covered_count: 0
