id: 7a6ee4d0078eac6bf782
bug_link: https://syzkaller.appspot.com/bug?extid=7a6ee4d0078eac6bf782
title: general protection fault in tls_sk_proto_close (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ebe26aca98fcf9fbe5017b5cbe216413cee69df5
fix_commit: 44580a0118d3ede95fec4dce32df5f75f73cd663
datetime: '2019-09-05T11:56:19+02:00'
fix_commit_message: 'net: sock_map, fix missing ulp check in sock hash case


  sock_map and ULP only work together when ULP is loaded after the sock

  map is loaded. In the sock_map case we added a check for this to fail

  the load if ULP is already set. However, we missed the check on the

  sock_hash side.


  Add a ULP check to the sock_hash update path.


  Fixes: 604326b41a6fb ("bpf, sockmap: convert to generic sk_msg interface")

  Reported-by: syzbot+7a6ee4d0078eac6bf782@syzkaller.appspotmail.com

  Signed-off-by: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/core
hunk_count: 2
covered_count: 0
