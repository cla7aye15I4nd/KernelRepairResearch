id: 4efacf59126f1ae87000
bug_link: https://syzkaller.appspot.com/bug?extid=4efacf59126f1ae87000
title: 'usb-fuzzer boot error: general protection fault in dma_direct_max_mapping_size'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: e70bdd81bfe230a1044eaa49f7d9c9450178d635
fix_commit: 1b5d9a6e98350e0713b4faa1b04e8f239f63b581
datetime: '2019-07-22T22:05:48-04:00'
fix_commit_message: 'scsi: core: fix the dma_max_mapping_size call


  We should only call dma_max_mapping_size for devices that have a DMA mask

  set, otherwise we can run into a NULL pointer dereference that will crash

  the system.


  Also we need to do right shift to get the sectors from the size in bytes,

  not a left shift.


  Fixes: bdd17bdef7d8 ("scsi: core: take the DMA max mapping size into account")

  Reported-by: Bart Van Assche <bvanassche@acm.org>

  Reported-by: Ming Lei <tom.leiming@gmail.com>

  Tested-by: Guilherme G. Piccoli <gpiccoli@canonical.com>

  Signed-off-by: Christoph Hellwig <hch@lst.de>

  Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

  '
submodule:
- drivers/scsi
hunk_count: 1
covered_count: 1
