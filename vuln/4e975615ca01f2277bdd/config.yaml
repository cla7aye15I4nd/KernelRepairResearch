id: 4e975615ca01f2277bdd
bug_link: https://syzkaller.appspot.com/bug?extid=4e975615ca01f2277bdd
title: 'KASAN: use-after-free Read in fuse_dev_do_read'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6bf4ca7fbc85d80446ac01c0d1d77db4d91a6d84
fix_commit: bc78abbd55dd28e2287ec6d6502b842321a17c87
datetime: '2018-09-28T16:43:21+02:00'
fix_commit_message: "fuse: Fix use-after-free in fuse_dev_do_read()\n\nWe may pick\
  \ freed req in this way:\n\n[cpu0]                                  [cpu1]\nfuse_dev_do_read()\
  \                      fuse_dev_do_write()\n   list_move_tail(&req->list, ...);\
  \     ...\n   spin_unlock(&fpq->lock);             ...\n   ...                 \
  \                 request_end(fc, req);\n   ...                                \
  \    fuse_put_request(fc, req);\n   if (test_bit(FR_INTERRUPTED, ...))\n       \
  \  queue_interrupt(fiq, req);\n\nFix that by keeping req alive until we finish all\
  \ manipulations.\n\nReported-by: syzbot+4e975615ca01f2277bdd@syzkaller.appspotmail.com\n\
  Signed-off-by: Kirill Tkhai <ktkhai@virtuozzo.com>\nSigned-off-by: Miklos Szeredi\
  \ <mszeredi@redhat.com>\nFixes: 46c34a348b0a (\"fuse: no fc->lock for pqueue parts\"\
  )\nCc: <stable@vger.kernel.org> # v4.2\n"
submodule:
- fs/fuse
hunk_count: 1
covered_count: 1
