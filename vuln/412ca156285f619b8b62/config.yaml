id: 412ca156285f619b8b62
bug_link: https://syzkaller.appspot.com/bug?extid=412ca156285f619b8b62
title: 'KASAN: use-after-free Read in blk_mq_sched_tags_teardown'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 297db731847e7808881ec2123c7564067d594d39
fix_commit: 8bdf7b3fe1f48a2c1c212d4685903bba01409c0e
datetime: '2021-10-22T09:16:12-06:00'
fix_commit_message: 'blk-mq-sched: Don''t reference queue tagset in blk_mq_sched_tags_teardown()


  We should not reference the queue tagset in blk_mq_sched_tags_teardown()

  (see function comment) for the blk-mq flags, so use the passed flags

  instead.


  This solves a use-after-free, similarly fixed earlier (and since broken

  again) in commit f0c1c4d2864e ("blk-mq: fix use-after-free in

  blk_mq_exit_sched").


  Reported-by: Linux Kernel Functional Testing <lkft@linaro.org>

  Reported-by: Naresh Kamboju <naresh.kamboju@linaro.org>

  Tested-by: Anders Roxell <anders.roxell@linaro.org>

  Fixes: e155b0c238b2 ("blk-mq: Use shared tags for shared sbitmap support")

  Signed-off-by: John Garry <john.garry@huawei.com>

  Link: https://lore.kernel.org/r/1634890340-15432-1-git-send-email-john.garry@huawei.com

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- block
hunk_count: 1
covered_count: 1
