id: 0dd5b81275fa083055d7
bug_link: https://syzkaller.appspot.com/bug?extid=0dd5b81275fa083055d7
title: 'INFO: task hung in ext4_stop_mmpd'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d1bc560e9a9c78d0b2314692847fc8661e0aeb99
fix_commit: d3476f3dad4ad68ae5f6b008ea6591d1520da5d8
datetime: '2024-08-26T23:53:20-04:00'
fix_commit_message: 'ext4: don''t set SB_RDONLY after filesystem errors


  When the filesystem is mounted with errors=remount-ro, we were setting

  SB_RDONLY flag to stop all filesystem modifications. We knew this misses

  proper locking (sb->s_umount) and does not go through proper filesystem

  remount procedure but it has been the way this worked since early ext2

  days and it was good enough for catastrophic situation damage

  mitigation. Recently, syzbot has found a way (see link) to trigger

  warnings in filesystem freezing because the code got confused by

  SB_RDONLY changing under its hands. Since these days we set

  EXT4_FLAGS_SHUTDOWN on the superblock which is enough to stop all

  filesystem modifications, modifying SB_RDONLY shouldn''t be needed. So

  stop doing that.


  Link: https://lore.kernel.org/all/000000000000b90a8e061e21d12f@google.com

  Reported-by: Christian Brauner <brauner@kernel.org>

  Signed-off-by: Jan Kara <jack@suse.cz>

  Reviewed-by: Christian Brauner <brauner@kernel.org>

  Link: https://patch.msgid.link/20240805201241.27286-1-jack@suse.cz

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 1
covered_count: 1
