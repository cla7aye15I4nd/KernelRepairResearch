id: 50f5cf33a284ce738b62
bug_link: https://syzkaller.appspot.com/bug?extid=50f5cf33a284ce738b62
title: general protection fault in cgroup_file_write
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0d2b5955b36250a9428c832664f2079cbf723bec
fix_commit: e57457641613fef0d147ede8bd6a3047df588b95
datetime: '2022-01-06T11:02:29-10:00'
fix_commit_message: "cgroup: Use open-time cgroup namespace for process migration\
  \ perm checks\n\ncgroup process migration permission checks are performed at write\
  \ time as\nwhether a given operation is allowed or not is dependent on the content\
  \ of\nthe write - the PID. This currently uses current's cgroup namespace which\
  \ is\na potential security weakness as it may allow scenarios where a less\nprivileged\
  \ process tricks a more privileged one into writing into a fd that\nit created.\n\
  \nThis patch makes cgroup remember the cgroup namespace at the time of open\nand\
  \ uses it for migration permission checks instad of current's. Note that\nthis only\
  \ applies to cgroup2 as cgroup1 doesn't have namespace support.\n\nThis also fixes\
  \ a use-after-free bug on cgroupns reported in\n\n https://lore.kernel.org/r/00000000000048c15c05d0083397@google.com\n\
  \nNote that backporting this fix also requires the preceding patch.\n\nReported-by:\
  \ \"Eric W. Biederman\" <ebiederm@xmission.com>\nSuggested-by: Linus Torvalds <torvalds@linuxfoundation.org>\n\
  Cc: Michal Koutný <mkoutny@suse.com>\nCc: Oleg Nesterov <oleg@redhat.com>\nReviewed-by:\
  \ Michal Koutný <mkoutny@suse.com>\nReported-by: syzbot+50f5cf33a284ce738b62@syzkaller.appspotmail.com\n\
  Link: https://lore.kernel.org/r/00000000000048c15c05d0083397@google.com\nFixes:\
  \ 5136f6365ce3 (\"cgroup: implement \"nsdelegate\" mount option\")\nSigned-off-by:\
  \ Tejun Heo <tj@kernel.org>\n"
submodule:
- kernel/cgroup
hunk_count: 9
covered_count: 3
