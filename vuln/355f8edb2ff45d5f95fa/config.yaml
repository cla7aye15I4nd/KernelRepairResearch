id: 355f8edb2ff45d5f95fa
bug_link: https://syzkaller.appspot.com/bug?extid=355f8edb2ff45d5f95fa
title: 'INFO: task hung in register_netdevice_notifier (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2030043e616cab40f510299f09b636285e0a3678
fix_commit: 8d0caedb759683041d9db82069937525999ada53
datetime: '2021-06-16T12:52:18+02:00'
fix_commit_message: 'can: bcm/raw/isotp: use per module netdevice notifier


  syzbot is reporting hung task at register_netdevice_notifier() [1] and

  unregister_netdevice_notifier() [2], for cleanup_net() might perform

  time consuming operations while CAN driver''s raw/bcm/isotp modules are

  calling {register,unregister}_netdevice_notifier() on each socket.


  Change raw/bcm/isotp modules to call register_netdevice_notifier() from

  module''s __init function and call unregister_netdevice_notifier() from

  module''s __exit function, as with gw/j1939 modules are doing.


  Link: https://syzkaller.appspot.com/bug?id=391b9498827788b3cc6830226d4ff5be87107c30
  [1]

  Link: https://syzkaller.appspot.com/bug?id=1724d278c83ca6e6df100a2e320c10d991cf2bce
  [2]

  Link: https://lore.kernel.org/r/54a5f451-05ed-f977-8534-79e7aa2bcc8f@i-love.sakura.ne.jp

  Cc: linux-stable <stable@vger.kernel.org>

  Reported-by: syzbot <syzbot+355f8edb2ff45d5f95fa@syzkaller.appspotmail.com>

  Reported-by: syzbot <syzbot+0f1827363a305f74996f@syzkaller.appspotmail.com>

  Reviewed-by: Kirill Tkhai <ktkhai@virtuozzo.com>

  Tested-by: syzbot <syzbot+355f8edb2ff45d5f95fa@syzkaller.appspotmail.com>

  Tested-by: Oliver Hartkopp <socketcan@hartkopp.net>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>

  '
submodule:
- net/can
hunk_count: 25
covered_count: 5
