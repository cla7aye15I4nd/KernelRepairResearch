diff --git a/mm/khugepaged.c b/mm/khugepaged.c
index 0bcba493ebb4..dc09cfe76e1f 100644
--- a/mm/khugepaged.c
+++ b/mm/khugepaged.c
@@ -2438,6 +2438,8 @@ int madvise_collapse(struct vm_area_struct *vma, struct vm_area_struct **prev,
 				last_fail = result;
 				goto out_nolock;
 			}
+
+			hend = vma->vm_end & HPAGE_PMD_MASK;
 		}
 		mmap_assert_locked(mm);
 		memset(cc->node_load, 0, sizeof(cc->node_load));
