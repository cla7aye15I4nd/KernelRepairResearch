id: 8bab8ed346746e7540e8
bug_link: https://syzkaller.appspot.com/bug?extid=8bab8ed346746e7540e8
title: general protection fault in btf_type_id_size
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: edbea922025169c0e5cdca5ebf7bf5374cc5566c
fix_commit: 350a5c4dd2452ea999cc5e1d4a8dbf12de2f97ef
datetime: '2021-03-08T13:32:46+01:00'
fix_commit_message: 'bpf: Dont allow vmlinux BTF to be used in map_create and prog_load.


  The syzbot got FD of vmlinux BTF and passed it into map_create which caused

  crash in btf_type_id_size() when it tried to access resolved_ids. The vmlinux

  BTF doesn''t have ''resolved_ids'' and ''resolved_sizes'' initialized to save

  memory. To avoid such issues disallow using vmlinux BTF in prog_load and

  map_create commands.


  Fixes: 5329722057d4 ("bpf: Assign ID to vmlinux BTF and return extra info for BTF
  in GET_OBJ_INFO")

  Reported-by: syzbot+8bab8ed346746e7540e8@syzkaller.appspotmail.com

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  Acked-by: Yonghong Song <yhs@fb.com>

  Link: https://lore.kernel.org/bpf/20210307225248.79031-1-alexei.starovoitov@gmail.com

  '
submodule:
- kernel/bpf
hunk_count: 2
covered_count: 1
