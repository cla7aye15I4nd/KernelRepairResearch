id: d4373fa8042c06cefa84
bug_link: https://syzkaller.appspot.com/bug?extid=d4373fa8042c06cefa84
title: WARNING in netlink_ack_tlv_fill
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f164b296638d1eb1fb1c537e93ab5c8b49966546
fix_commit: 3bf39fa849ab8ed52abb6715922e6102d3df9f97
datetime: '2024-11-24T16:58:07-08:00'
fix_commit_message: "netlink: fix false positive warning in extack during dumps\n\n\
  Commit under fixes extended extack reporting to dumps.\nIt works under normal conditions,\
  \ because extack errors are\nusually reported during ->start() or the first ->dump(),\n\
  it's quite rare that the dump starts okay but fails later.\nIf the dump does fail\
  \ later, however, the input skb will\nalready have the initiating message pulled,\
  \ so checking\nif bad attr falls within skb->data will fail.\n\nSwitch the check\
  \ to using nlh, which is always valid.\n\nsyzbot found a way to hit that scenario\
  \ by filling up\nthe receive queue. In this case we initiate a dump\nbut don't call\
  \ ->dump() until there is read space for\nan skb.\n\nWARNING: CPU: 1 PID: 5845 at\
  \ net/netlink/af_netlink.c:2210 netlink_ack_tlv_fill+0x1a8/0x560 net/netlink/af_netlink.c:2209\n\
  RIP: 0010:netlink_ack_tlv_fill+0x1a8/0x560 net/netlink/af_netlink.c:2209\nCall Trace:\n\
  \ <TASK>\n netlink_dump_done+0x513/0x970 net/netlink/af_netlink.c:2250\n netlink_dump+0x91f/0xe10\
  \ net/netlink/af_netlink.c:2351\n netlink_recvmsg+0x6bb/0x11d0 net/netlink/af_netlink.c:1983\n\
  \ sock_recvmsg_nosec net/socket.c:1051 [inline]\n sock_recvmsg+0x22f/0x280 net/socket.c:1073\n\
  \ __sys_recvfrom+0x246/0x3d0 net/socket.c:2267\n __do_sys_recvfrom net/socket.c:2285\
  \ [inline]\n __se_sys_recvfrom net/socket.c:2281 [inline]\n __x64_sys_recvfrom+0xde/0x100\
  \ net/socket.c:2281\n do_syscall_x64 arch/x86/entry/common.c:52 [inline]\n do_syscall_64+0xf3/0x230\
  \ arch/x86/entry/common.c:83\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\n RIP: 0033:0x7ff37dd17a79\n\
  \nReported-by: syzbot+d4373fa8042c06cefa84@syzkaller.appspotmail.com\nFixes: 8af4f60472fc\
  \ (\"netlink: support all extack types in dumps\")\nReviewed-by: Jacob Keller <jacob.e.keller@intel.com>\n\
  Link: https://patch.msgid.link/20241119224432.1713040-1-kuba@kernel.org\nSigned-off-by:\
  \ Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/netlink
hunk_count: 5
covered_count: 4
