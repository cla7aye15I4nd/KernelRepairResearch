id: 1ad8bac5af24d01e2cbd
bug_link: https://syzkaller.appspot.com/bug?extid=1ad8bac5af24d01e2cbd
title: divide error in ext4_mb_regular_allocator
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cc749e61c011c255d81b192a822db650c68b313f
fix_commit: ee85e0938aa8f9846d21e4d302c3cf6a2a75110d
datetime: '2024-09-03T22:14:17-04:00'
fix_commit_message: 'ext4: check stripe size compatibility on remount as well


  We disable stripe size in __ext4_fill_super if it is not a multiple of

  the cluster ratio however this check is missed when trying to remount.

  This can leave us with cases where stripe < cluster_ratio after

  remount:set making EXT4_B2C(sbi->s_stripe) become 0 that can cause some

  unforeseen bugs like divide by 0.


  Fix that by adding the check in remount path as well.


  Reported-by: syzbot+1ad8bac5af24d01e2cbd@syzkaller.appspotmail.com

  Tested-by: syzbot+1ad8bac5af24d01e2cbd@syzkaller.appspotmail.com

  Reviewed-by: Kemeng Shi <shikemeng@huaweicloud.com>

  Reviewed-by: Ritesh Harjani (IBM) <ritesh.list@gmail.com>

  Fixes: c3defd99d58c ("ext4: treat stripe in block unit")

  Signed-off-by: Ojaswin Mujoo <ojaswin@linux.ibm.com>

  Link: https://patch.msgid.link/3a493bb503c3598e25dcfbed2936bb2dff3fece7.1725002410.git.ojaswin@linux.ibm.com

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 3
covered_count: 0
