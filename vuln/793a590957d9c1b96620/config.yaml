id: 793a590957d9c1b96620
bug_link: https://syzkaller.appspot.com/bug?extid=793a590957d9c1b96620
title: 'KASAN: use-after-free Read in nf_confirm'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ffd219efd9ee1ceccc7ccfa9361fd40705680fc3
fix_commit: 56b14ecec97f39118bf85c9ac2438c5a949509ed
datetime: '2022-05-27T11:16:34+02:00'
fix_commit_message: 'netfilter: conntrack: re-fetch conntrack after insertion


  In case the conntrack is clashing, insertion can free skb->_nfct and

  set skb->_nfct to the already-confirmed entry.


  This wasn''t found before because the conntrack entry and the extension

  space used to free''d after an rcu grace period, plus the race needs

  events enabled to trigger.


  Reported-by: <syzbot+793a590957d9c1b96620@syzkaller.appspotmail.com>

  Fixes: 71d8c47fc653 ("netfilter: conntrack: introduce clash resolution on insertion
  race")

  Fixes: 2ad9d7747c10 ("netfilter: conntrack: free extension area immediately")

  Signed-off-by: Florian Westphal <fw@strlen.de>

  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

  '
submodule:
- include/net/netfilter
hunk_count: 1
covered_count: 1
