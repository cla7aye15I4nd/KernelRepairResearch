id: f87f60bb6f13f39b54e3
bug_link: https://syzkaller.appspot.com/bug?extid=f87f60bb6f13f39b54e3
title: 'KASAN: use-after-free Read in kvm_put_kvm'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7566ec393f4161572ba6f11ad5171fd5d59b0fbd
fix_commit: 987d1149be7ddcc1380ff946cf236874421a7e1b
datetime: '2018-12-18T22:07:25+01:00'
fix_commit_message: 'KVM: fix unregistering coalesced mmio zone from wrong bus


  If you register a kvm_coalesced_mmio_zone with ''.pio = 0'' but then

  unregister it with ''.pio = 1'', KVM_UNREGISTER_COALESCED_MMIO will try to

  unregister it from KVM_PIO_BUS rather than KVM_MMIO_BUS, which is a

  no-op.  But it frees the kvm_coalesced_mmio_dev anyway, causing a

  use-after-free.


  Fix it by only unregistering and freeing the zone if the correct value

  of ''pio'' is provided.


  Reported-by: syzbot+f87f60bb6f13f39b54e3@syzkaller.appspotmail.com

  Fixes: 0804c849f1df ("kvm/x86 : add coalesced pio support")

  Signed-off-by: Eric Biggers <ebiggers@google.com>

  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

  '
submodule:
- virt/kvm
hunk_count: 1
covered_count: 1
