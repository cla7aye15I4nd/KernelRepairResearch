id: aa0227369be2dcc26ebe
bug_link: https://syzkaller.appspot.com/bug?extid=aa0227369be2dcc26ebe
title: general protection fault in smc_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2be922f31606f114119f48de3207d122a90e7357
fix_commit: a5dcb73b96a9d21431048bdaac02d9e96f386da3
datetime: '2018-02-28T12:30:25-05:00'
fix_commit_message: "net/smc: fix NULL pointer dereference on sock_create_kern() error\
  \ path\n\nwhen sock_create_kern(..., a) returns an error, 'a' might not be a valid\n\
  pointer, so it shouldn't be dereferenced to read a->sk->sk_sndbuf and\nand a->sk->sk_rcvbuf;\
  \ not doing that caused the following crash:\n\ngeneral protection fault: 0000 [#1]\
  \ SMP KASAN\nDumping ftrace buffer:\n    (ftrace buffer empty)\nModules linked in:\n\
  CPU: 0 PID: 4254 Comm: syzkaller919713 Not tainted 4.16.0-rc1+ #18\nHardware name:\
  \ Google Google Compute Engine/Google Compute Engine, BIOS\nGoogle 01/01/2011\n\
  RIP: 0010:smc_create+0x14e/0x300 net/smc/af_smc.c:1410\nRSP: 0018:ffff8801b06afbc8\
  \ EFLAGS: 00010202\nRAX: dffffc0000000000 RBX: ffff8801b63457c0 RCX: ffffffff85a3e746\n\
  RDX: 0000000000000004 RSI: 00000000ffffffff RDI: 0000000000000020\nRBP: ffff8801b06afbf0\
  \ R08: 00000000000007c0 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000000\
  \ R12: 0000000000000000\nR13: ffff8801b6345c08 R14: 00000000ffffffe9 R15: ffffffff8695ced0\n\
  FS:  0000000001afb880(0000) GS:ffff8801db200000(0000)\nknlGS:0000000000000000\n\
  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000000020000040 CR3: 00000001b0721004\
  \ CR4: 00000000001606f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n\
  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n\
  \  __sock_create+0x4d4/0x850 net/socket.c:1285\n  sock_create net/socket.c:1325\
  \ [inline]\n  SYSC_socketpair net/socket.c:1409 [inline]\n  SyS_socketpair+0x1c0/0x6f0\
  \ net/socket.c:1366\n  do_syscall_64+0x282/0x940 arch/x86/entry/common.c:287\n \
  \ entry_SYSCALL_64_after_hwframe+0x26/0x9b\nRIP: 0033:0x4404b9\nRSP: 002b:00007fff44ab6908\
  \ EFLAGS: 00000246 ORIG_RAX: 0000000000000035\nRAX: ffffffffffffffda RBX: 0000000000000000\
  \ RCX: 00000000004404b9\nRDX: 0000000000000000 RSI: 0000000000000001 RDI: 000000000000002b\n\
  RBP: 00007fff44ab6910 R08: 0000000000000002 R09: 00007fff44003031\nR10: 0000000020000040\
  \ R11: 0000000000000246 R12: ffffffffffffffff\nR13: 0000000000000006 R14: 0000000000000000\
  \ R15: 0000000000000000\nCode: 48 c1 ea 03 80 3c 02 00 0f 85 b3 01 00 00 4c 8b a3\
  \ 48 04 00 00 48\nb8\n00 00 00 00 00 fc ff df 49 8d 7c 24 20 48 89 fa 48 c1 ea 03\
  \ <80> 3c 02\n00\n0f 85 82 01 00 00 4d 8b 7c 24 20 48 b8 00 00 00 00\nRIP: smc_create+0x14e/0x300\
  \ net/smc/af_smc.c:1410 RSP: ffff8801b06afbc8\n\nFixes: cd6851f30386 smc: remote\
  \ memory buffers (RMBs)\nReported-and-tested-by: syzbot+aa0227369be2dcc26ebe@syzkaller.appspotmail.com\n\
  Signed-off-by: Davide Caratti <dcaratti@redhat.com>\nSigned-off-by: Ursula Braun\
  \ <ubraun@linux.vnet.ibm.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/smc
hunk_count: 1
covered_count: 1
