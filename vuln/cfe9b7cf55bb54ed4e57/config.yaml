id: cfe9b7cf55bb54ed4e57
bug_link: https://syzkaller.appspot.com/bug?extid=cfe9b7cf55bb54ed4e57
title: memory leak in bsg_register_queue
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4521428c48118b0f5f7a637ce7dedd76c29bcdaa
fix_commit: 1a0db7744e453844aa2db3f2959aea4a378025ea
datetime: '2021-09-14T00:22:15-04:00'
fix_commit_message: 'scsi: bsg: Fix device unregistration


  device_initialize() is used to take a refcount on the device. However,

  put_device() is not called during device teardown. This leads to a

  leak of private data of the driver core, dev_name(), etc. This is

  reported by kmemleak at boot time if we compile kernel with

  DEBUG_TEST_DRIVER_REMOVE.


  Fix memory leaks during unregistration and implement a release

  function.


  Link: https://lore.kernel.org/r/20210911105306.1511-1-yuzenghui@huawei.com

  Fixes: ead09dd3aed5 ("scsi: bsg: Simplify device registration")

  Reviewed-by: Johan Hovold <johan@kernel.org>

  Signed-off-by: Zenghui Yu <yuzenghui@huawei.com>

  Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

  '
submodule:
- block
hunk_count: 4
covered_count: 4
