id: b08315e8cf5a78eed03c
bug_link: https://syzkaller.appspot.com/bug?extid=b08315e8cf5a78eed03c
title: WARNING in netdev_open
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ac19020be0e2e6ff62d18439d7f81251bdd1bb5a
fix_commit: 1422b526fba994cf05fd288a152106563b875fce
datetime: '2023-08-04T16:20:13+02:00'
fix_commit_message: 'staging: rtl8712: fix race condition


  In probe function, request_firmware_nowait() is called to load firmware

  asynchronously. At completion of firmware loading, register_netdev() is

  called. However, a mutex needed by netdev is initialized after the call

  to request_firmware_nowait(). Consequently, it can happen that

  register_netdev() is called before the driver is ready.


  Move the mutex initialization into r8712_init_drv_sw(), which is called

  before request_firmware_nowait().


  Reported-by: syzbot+b08315e8cf5a78eed03c@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/linux-staging/000000000000d9d4560601b8e0d7@google.com/T/#u

  Fixes: 8c213fa59199 ("staging: r8712u: Use asynchronous firmware loading")

  Cc: stable <stable@kernel.org>

  Signed-off-by: Nam Cao <namcaov@gmail.com>

  Link: https://lore.kernel.org/r/20230731110620.116562-1-namcaov@gmail.com

  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  '
submodule:
- drivers/staging/rtl8712
hunk_count: 2
covered_count: 0
