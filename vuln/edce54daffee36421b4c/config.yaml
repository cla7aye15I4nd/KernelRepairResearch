id: edce54daffee36421b4c
bug_link: https://syzkaller.appspot.com/bug?extid=edce54daffee36421b4c
title: possible deadlock in ext4_xattr_set_handle (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7877cb91f1081754a1487c144d85dc0d2e2e7fc4
fix_commit: b3e6bcb94590dea45396b9481e47b809b1be4afa
datetime: '2023-05-28T14:18:03-04:00'
fix_commit_message: 'ext4: add EA_INODE checking to ext4_iget()


  Add a new flag, EXT4_IGET_EA_INODE which indicates whether the inode

  is expected to have the EA_INODE flag or not.  If the flag is not

  set/clear as expected, then fail the iget() operation and mark the

  file system as corrupted.


  This commit also makes the ext4_iget() always perform the

  is_bad_inode() check even when the inode is already inode cache.  This

  allows us to remove the is_bad_inode() check from the callers of

  ext4_iget() in the ea_inode code.


  Reported-by: syzbot+cbb68193bdb95af4340a@syzkaller.appspotmail.com

  Reported-by: syzbot+62120febbd1ee3c3c860@syzkaller.appspotmail.com

  Reported-by: syzbot+edce54daffee36421b4c@syzkaller.appspotmail.com

  Cc: stable@kernel.org

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  Link: https://lore.kernel.org/r/20230524034951.779531-2-tytso@mit.edu

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 10
covered_count: 2
