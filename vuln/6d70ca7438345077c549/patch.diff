diff --git a/net/bpf/test_run.c b/net/bpf/test_run.c
index 65b52b4bd6e1..0220b0822d77 100644
--- a/net/bpf/test_run.c
+++ b/net/bpf/test_run.c
@@ -962,6 +962,11 @@ int bpf_prog_test_run_xdp(struct bpf_prog *prog, const union bpf_attr *kattr,
 			skb_frag_t *frag;
 			int data_len;
 
+			if (sinfo->nr_frags == MAX_SKB_FRAGS) {
+				ret = -ENOMEM;
+				goto out;
+			}
+
 			page = alloc_page(GFP_KERNEL);
 			if (!page) {
 				ret = -ENOMEM;
