id: 77a25acfa0382e06ab23
bug_link: https://syzkaller.appspot.com/bug?extid=77a25acfa0382e06ab23
title: 'BUG: corrupted list in p9_read_work (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a39c46067c845a8a2d7144836e9468b7f072343e
fix_commit: 74d6a5d5662975aed7f25952f62efbb6f6dadd29
datetime: '2020-07-19T14:58:47+02:00'
fix_commit_message: '9p/trans_fd: Fix concurrency del of req_list in p9_fd_cancelled/p9_read_work


  p9_read_work and p9_fd_cancelled may be called concurrently.

  In some cases, req->req_list may be deleted by both p9_read_work

  and p9_fd_cancelled.


  We can fix it by ignoring replies associated with a cancelled

  request and ignoring cancelled request if message has been received

  before lock.


  Link: http://lkml.kernel.org/r/20200612090833.36149-1-wanghai38@huawei.com

  Fixes: 60ff779c4abb ("9p: client: remove unused code and any reference to "cancelled"
  function")

  Cc: <stable@vger.kernel.org> # v3.12+

  Reported-by: syzbot+77a25acfa0382e06ab23@syzkaller.appspotmail.com

  Signed-off-by: Wang Hai <wanghai38@huawei.com>

  Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>

  '
submodule:
- net/9p
hunk_count: 2
covered_count: 1
