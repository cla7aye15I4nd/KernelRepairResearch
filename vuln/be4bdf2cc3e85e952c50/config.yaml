id: be4bdf2cc3e85e952c50
bug_link: https://syzkaller.appspot.com/bug?extid=be4bdf2cc3e85e952c50
title: general protection fault in tipc_mcast_filter_msg
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 77d5ad4048fba5bd6e16f78498d4b41e5534b8f5
fix_commit: 08e046c8966a872a4fb047aa940b5c991ee5635d
datetime: '2019-03-21T09:56:55-07:00'
fix_commit_message: "tipc: fix a null pointer deref\n\nIn commit c55c8edafa91 (\"\
  tipc: smooth change between replicast and\nbroadcast\") we introduced new method\
  \ to eliminate the risk of message\nreordering that happen in between different\
  \ nodes.\nUnfortunately, we forgot checking at receiving side to ignore intra node.\n\
  \nWe fix this by checking and returning if arrived message from intra node.\n\n\
  syzbot report:\n\n==================================================================\n\
  kasan: CONFIG_KASAN_INLINE enabled\nkasan: GPF could be caused by NULL-ptr deref\
  \ or user memory access\ngeneral protection fault: 0000 [#1] PREEMPT SMP KASAN\n\
  CPU: 0 PID: 7820 Comm: syz-executor418 Not tainted 5.0.0+ #61\nHardware name: Google\
  \ Google Compute Engine/Google Compute Engine,\nBIOS Google 01/01/2011\nRIP: 0010:tipc_mcast_filter_msg+0x21b/0x13d0\
  \ net/tipc/bcast.c:782\nCode: 45 c0 0f 84 39 06 00 00 48 89 5d 98 e8 ce ab a5 fa\
  \ 49 8d bc\n 24 c8 00 00 00 48 b9 00 00 00 00 00 fc ff df 48 89 f8 48 c1 e8 03\n\
  \ <80> 3c 08 00 0f 85 9a 0e 00 00 49 8b 9c 24 c8 00 00 00 48 be 00 00\nRSP: 0018:ffff8880959defc8\
  \ EFLAGS: 00010202\nRAX: 0000000000000019 RBX: ffff888081258a48 RCX: dffffc0000000000\n\
  RDX: 0000000000000000 RSI: ffffffff86cab862 RDI: 00000000000000c8\nRBP: ffff8880959df030\
  \ R08: ffff8880813d0200 R09: ffffed1015d05bc8\nR10: ffffed1015d05bc7 R11: ffff8880ae82de3b\
  \ R12: 0000000000000000\nR13: 000000000000002c R14: 0000000000000000 R15: ffff888081258a48\n\
  FS:  000000000106a880(0000) GS:ffff8880ae800000(0000)\n knlGS:0000000000000000\n\
  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000000020001cc0 CR3: 0000000094a20000\
  \ CR4: 00000000001406f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n\
  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n\
  \ tipc_sk_filter_rcv+0x182d/0x34f0 net/tipc/socket.c:2168\n tipc_sk_enqueue net/tipc/socket.c:2254\
  \ [inline]\n tipc_sk_rcv+0xc45/0x25a0 net/tipc/socket.c:2305\n tipc_sk_mcast_rcv+0x724/0x1020\
  \ net/tipc/socket.c:1209\n tipc_mcast_xmit+0x7fe/0x1200 net/tipc/bcast.c:410\n tipc_sendmcast+0xb36/0xfc0\
  \ net/tipc/socket.c:820\n __tipc_sendmsg+0x10df/0x18d0 net/tipc/socket.c:1358\n\
  \ tipc_sendmsg+0x53/0x80 net/tipc/socket.c:1291\n sock_sendmsg_nosec net/socket.c:651\
  \ [inline]\n sock_sendmsg+0xdd/0x130 net/socket.c:661\n ___sys_sendmsg+0x806/0x930\
  \ net/socket.c:2260\n __sys_sendmsg+0x105/0x1d0 net/socket.c:2298\n __do_sys_sendmsg\
  \ net/socket.c:2307 [inline]\n __se_sys_sendmsg net/socket.c:2305 [inline]\n __x64_sys_sendmsg+0x78/0xb0\
  \ net/socket.c:2305\n do_syscall_64+0x103/0x610 arch/x86/entry/common.c:290\n entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\
  RIP: 0033:0x4401c9\nCode: 18 89 d0 c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 48\
  \ 89 f8\n 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05\n <48>\
  \ 3d 01 f0 ff ff 0f 83 fb 13 fc ff c3 66 2e 0f 1f 84 00 00 00 00\nRSP: 002b:00007ffd887fa9d8\
  \ EFLAGS: 00000246 ORIG_RAX: 000000000000002e\nRAX: ffffffffffffffda RBX: 00000000004002c8\
  \ RCX: 00000000004401c9\nRDX: 0000000000000000 RSI: 0000000020002140 RDI: 0000000000000003\n\
  RBP: 00000000006ca018 R08: 0000000000000000 R09: 00000000004002c8\nR10: 0000000000000000\
  \ R11: 0000000000000246 R12: 0000000000401a50\nR13: 0000000000401ae0 R14: 0000000000000000\
  \ R15: 0000000000000000\nModules linked in:\n---[ end trace ba79875754e1708f ]---\n\
  \nReported-by: syzbot+be4bdf2cc3e85e952c50@syzkaller.appspotmail.com\nFixes: c55c8eda\
  \ (\"tipc: smooth change between replicast and broadcast\")\nAcked-by: Jon Maloy\
  \ <jon.maloy@ericsson.com>\nSigned-off-by: Hoang Le <hoang.h.le@dektech.com.au>\n\
  Signed-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- net/tipc
hunk_count: 4
covered_count: 3
