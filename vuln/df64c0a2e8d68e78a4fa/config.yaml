id: df64c0a2e8d68e78a4fa
bug_link: https://syzkaller.appspot.com/bug?extid=df64c0a2e8d68e78a4fa
title: memory leak in nfc_genl_se_io
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cf871006c01709211f2620a33de37257362a05e8
fix_commit: 25ff6f8a5a3b8dc48e8abda6f013e8cc4b14ffea
datetime: '2023-02-26T14:55:13+00:00'
fix_commit_message: 'nfc: fix memory leak of se_io context in nfc_genl_se_io


  The callback context for sending/receiving APDUs to/from the selected

  secure element is allocated inside nfc_genl_se_io and supposed to be

  eventually freed in se_io_cb callback function. However, there are several

  error paths where the bwi_timer is not charged to call se_io_cb later, and

  the cb_context is leaked.


  The patch proposes to free the cb_context explicitly on those error paths.


  At the moment we can''t simply check ''dev->ops->se_io()'' return value as it

  may be negative in both cases: when the timer was charged and was not.


  Fixes: 5ce3f32b5264 ("NFC: netlink: SE API implementation")

  Reported-by: syzbot+df64c0a2e8d68e78a4fa@syzkaller.appspotmail.com

  Signed-off-by: Fedor Pchelkin <pchelkin@ispras.ru>

  Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/nfc/st-nci
- drivers/nfc/st21nfca
- net/nfc
hunk_count: 3
covered_count: 0
