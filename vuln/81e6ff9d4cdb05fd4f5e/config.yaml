id: 81e6ff9d4cdb05fd4f5e
bug_link: https://syzkaller.appspot.com/bug?extid=81e6ff9d4cdb05fd4f5e
title: general protection fault in tss_update_io_bitmap
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a3ba966066afbe8fd0d3605ffe04c633083752f1
fix_commit: e3cb0c7102f04c83bf1a7cb1d052e92749310b46
datetime: '2019-11-20T23:40:05+01:00'
fix_commit_message: "x86/ioperm: Fix use of deprecated config option\n\nThe commit\n\
  \n  111e7b15cf10 (\"x86/ioperm: Extend IOPL config to control ioperm() as well\"\
  )\n\nreplaced X86_IOPL_EMULATION with X86_IOPL_IOPERM. However it appears\nthat\
  \ there was at least one spot missed as tss_update_io_bitmap() still\nhad a reference\
  \ to it contained in the code.\n\nThe result of this is that it exposed a NULL pointer\
  \ dereference as seen\nbelow with a linux-next next-20191120 kernel:\n\n  BUG: kernel\
  \ NULL pointer dereference, address: 0000000000000000\n  #PF: supervisor read access\
  \ in kernel mode\n  #PF: error_code(0x0000) - not-present page\n  PGD 0 P4D 0\n\
  \  Oops: 0000 [#1] SMP PTI\n  CPU: 5 PID: 1542 Comm: ovs-vswitchd Tainted: G   \
  \     W 5.4.0-rc8-next-20191120 #125\n  RIP: 0010:tss_update_io_bitmap+0x4e/0x180\n\
  \  Code: 10 31 c0 65 48 03 1d 69 54 5d 6d 65 48 8b 04 25 40 8c 01 00 48 8b 10 \\\
  \n\t  f7 c2 00 00 40 00 0f 84 8c 00 00 00 4c 8b a0 c0 22 00 00 <49> 8b 04 \\\n\t\
  \  24 48 39 43 68 74 2e 8b 53 70 41 39 54 24 0c 48 8d 7b 78\n  RSP: 0018:ffffb8888a0ebf08\
  \ EFLAGS: 00010006\n  RAX: ffff8a429811a680 RBX: ffff8a4c3f946000 RCX: 0000000000000011\n\
  \  RDX: 0000000000400080 RSI: 0000000000400080 RDI: 0000000000000000\n  RBP: ffffb8888a0ebf30\
  \ R08: 00007ffffb5d7ce0 R09: 0000000000000000\n  R10: 0000000000000000 R11: 0000000000000000\
  \ R12: 0000000000000000\n  R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000\n\
  \  FS:  00007f68a9635c40(0000) GS:ffff8a4c3f940000(0000) knlGS:0000000000000000\n\
  \  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 0000000000000000 CR3:\
  \ 000000103572a001 CR4: 00000000001606e0\n  Call Trace:\n   ? syscall_slow_exit_work+0x39/0xdb\n\
  \   do_syscall_64+0x1a5/0x200\n   entry_SYSCALL_64_after_hwframe+0x44/0xa9\n  RIP:\
  \ 0033:0x7f68a7aff797\n\nFixes: 111e7b15cf10 (\"x86/ioperm: Extend IOPL config to\
  \ control ioperm() as well\")\nSigned-off-by: Alexander Duyck <alexander.h.duyck@linux.intel.com>\n\
  Signed-off-by: Borislav Petkov <bp@suse.de>\nReviewed-by: Thomas Gleixner <tglx@linutronix.de>\n\
  Cc: \"H. Peter Anvin\" <hpa@zytor.com>\nCc: Andy Lutomirski <luto@kernel.org>\n\
  Cc: Ingo Molnar <mingo@kernel.org>\nCc: Rik van Riel <riel@surriel.com>\nCc: x86-ml\
  \ <x86@kernel.org>\nLink: https://lkml.kernel.org/r/20191120222426.3060.18462.stgit@localhost.localdomain\n"
submodule:
- arch/x86/kernel
hunk_count: 1
covered_count: 1
