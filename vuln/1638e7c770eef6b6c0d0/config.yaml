id: 1638e7c770eef6b6c0d0
bug_link: https://syzkaller.appspot.com/bug?extid=1638e7c770eef6b6c0d0
title: memory leak in reg_copy_regd
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 63214f02cff9ebd57be00e143de12107c66f5394
fix_commit: e53e9828a8d2c6545e01ff9711f1221f2fd199ce
datetime: '2021-09-27T13:30:33+02:00'
fix_commit_message: 'cfg80211: always free wiphy specific regdomain


  In the (somewhat unlikely) event that we allocate a wiphy, then

  add a regdomain to it, and then fail registration, we leak the

  regdomain. Fix this by just always freeing it at the end, in the

  normal cases we''ll free (and NULL) it during wiphy_unregister().

  This happened when the wiphy settings were bad, and since they

  can be controlled by userspace with hwsim, syzbot was able to

  find this issue.


  Reported-by: syzbot+1638e7c770eef6b6c0d0@syzkaller.appspotmail.com

  Fixes: 3e0c3ff36c4c ("cfg80211: allow multiple driver regulatory_hints()")

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  Link: https://lore.kernel.org/r/20210927131105.68b70cef4674.I4b9f0aa08c2af28555963b9fe3d34395bb72e0cc@changeid

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- net/wireless
hunk_count: 1
covered_count: 0
