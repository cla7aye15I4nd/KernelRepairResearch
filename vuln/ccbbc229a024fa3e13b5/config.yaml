id: ccbbc229a024fa3e13b5
bug_link: https://syzkaller.appspot.com/bug?extid=ccbbc229a024fa3e13b5
title: WARNING in cxacru_cm/usb_submit_urb (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0ad2507d5d93f39619fc42372c347d6006b64319
fix_commit: c90aad369899a607cfbc002bebeafd51e31900cd
datetime: '2025-02-19T15:18:16+01:00'
fix_commit_message: "usb: atm: cxacru: fix a flaw in existing endpoint checks\n\n\
  Syzbot once again identified a flaw in usb endpoint checking, see [1].\nThis time\
  \ the issue stems from a commit authored by me (2eabb655a968\n(\"usb: atm: cxacru:\
  \ fix endpoint checking in cxacru_bind()\")).\n\nWhile using usb_find_common_endpoints()\
  \ may usually be enough to\ndiscard devices with wrong endpoints, in this case one\
  \ needs more\nthan just finding and identifying the sufficient number of endpoints\n\
  of correct types - one needs to check the endpoint's address as well.\n\nSince cxacru_bind()\
  \ fills URBs with CXACRU_EP_CMD address in mind,\nswitch the endpoint verification\
  \ approach to usb_check_XXX_endpoints()\ninstead to fix incomplete ep testing.\n\
  \n[1] Syzbot report:\nusb 5-1: BOGUS urb xfer, pipe 3 != type 1\nWARNING: CPU: 0\
  \ PID: 1378 at drivers/usb/core/urb.c:504 usb_submit_urb+0xc4e/0x18c0 drivers/usb/core/urb.c:503\n\
  ...\nRIP: 0010:usb_submit_urb+0xc4e/0x18c0 drivers/usb/core/urb.c:503\n...\nCall\
  \ Trace:\n <TASK>\n cxacru_cm+0x3c8/0xe50 drivers/usb/atm/cxacru.c:649\n cxacru_card_status\
  \ drivers/usb/atm/cxacru.c:760 [inline]\n cxacru_bind+0xcf9/0x1150 drivers/usb/atm/cxacru.c:1223\n\
  \ usbatm_usb_probe+0x314/0x1d30 drivers/usb/atm/usbatm.c:1058\n cxacru_usb_probe+0x184/0x220\
  \ drivers/usb/atm/cxacru.c:1377\n usb_probe_interface+0x641/0xbb0 drivers/usb/core/driver.c:396\n\
  \ really_probe+0x2b9/0xad0 drivers/base/dd.c:658\n __driver_probe_device+0x1a2/0x390\
  \ drivers/base/dd.c:800\n driver_probe_device+0x50/0x430 drivers/base/dd.c:830\n\
  ...\n\nReported-and-tested-by: syzbot+ccbbc229a024fa3e13b5@syzkaller.appspotmail.com\n\
  Closes: https://syzkaller.appspot.com/bug?extid=ccbbc229a024fa3e13b5\nFixes: 2eabb655a968\
  \ (\"usb: atm: cxacru: fix endpoint checking in cxacru_bind()\")\nCc: stable@kernel.org\n\
  Signed-off-by: Nikita Zhandarovich <n.zhandarovich@fintech.ru>\nLink: https://lore.kernel.org/r/20250213122259.730772-1-n.zhandarovich@fintech.ru\n\
  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n"
submodule:
- drivers/usb/atm
hunk_count: 2
covered_count: 1
