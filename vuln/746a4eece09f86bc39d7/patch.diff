diff --git a/block/blk-mq.c b/block/blk-mq.c
index cdd8efcec191..4e6b3ccd4989 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -4630,9 +4630,9 @@ static bool blk_mq_elv_switch_none(struct list_head *head,
 
 	INIT_LIST_HEAD(&qe->node);
 	qe->q = q;
+	qe->type = q->elevator->type;
 	/* keep a reference to the elevator module as we'll switch back */
 	__elevator_get(qe->type);
-	qe->type = q->elevator->type;
 	list_add(&qe->node, head);
 	elevator_disable(q);
 	mutex_unlock(&q->sysfs_lock);
