id: 6dc95bddc6976b800b0b
bug_link: https://syzkaller.appspot.com/bug?extid=6dc95bddc6976b800b0b
title: 'KASAN: slab-out-of-bounds Write in tcp_v6_syn_recv_sock'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f8b39039cbf2a15f2b8c9f081e1cbd5dee00aaf5
fix_commit: d91c3e17f75f218022140dee18cf515292184a8f
datetime: '2018-01-17T16:05:28-05:00'
fix_commit_message: 'net/tls: Only attach to sockets in ESTABLISHED state


  Calling accept on a TCP socket with a TLS ulp attached results

  in two sockets that share the same ulp context.

  The ulp context is freed while a socket is destroyed, so

  after one of the sockets is released, the second second will

  trigger a use after free when it tries to access the ulp context

  attached to it.

  We restrict the TLS ulp to sockets in ESTABLISHED state

  to prevent the scenario above.


  Fixes: 3c4d7559159b ("tls: kernel TLS support")

  Reported-by: syzbot+904e7cd6c5c741609228@syzkaller.appspotmail.com

  Signed-off-by: Ilya Lesokhin <ilyal@mellanox.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/tls
hunk_count: 1
covered_count: 0
