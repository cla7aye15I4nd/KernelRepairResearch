id: d464d2c20c717ef5a6a8
bug_link: https://syzkaller.appspot.com/bug?extid=d464d2c20c717ef5a6a8
title: 'WARNING: refcount bug in smap_release_sock'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 99ba2b5aba24e022683a7db63204f9e306fe7ab9
fix_commit: 7ebc14d507b4b55105da8d1a1eda323381529cc7
datetime: '2018-07-07T15:19:30-07:00'
fix_commit_message: 'bpf: sockmap, consume_skb in close path


  Currently, when a sock is closed and the bpf_tcp_close() callback is

  used we remove memory but do not free the skb. Call consume_skb() if

  the skb is attached to the buffer.


  Reported-by: syzbot+d464d2c20c717ef5a6a8@syzkaller.appspotmail.com

  Fixes: 1aa12bdf1bfb ("bpf: sockmap, add sock close() hook to remove socks")

  Signed-off-by: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>

  '
submodule:
- kernel/bpf
hunk_count: 2
covered_count: 0
