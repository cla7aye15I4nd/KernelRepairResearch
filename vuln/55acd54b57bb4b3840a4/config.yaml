id: 55acd54b57bb4b3840a4
bug_link: https://syzkaller.appspot.com/bug?extid=55acd54b57bb4b3840a4
title: 'BUG: using smp_processor_id() in preemptible [ADDR] code: mime_typevmnet0/NUM'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5d2295f3a93b04986d069ebeaf5b07725f9096c1
fix_commit: 00d9e47f8ec2a293db9ebed86aab0583d9a49533
datetime: '2019-09-05T21:16:22+02:00'
fix_commit_message: 'posix-cpu-timers: Always clear head pointer on dequeue


  The head pointer in struct cpu_timer is checked to be NULL in

  posix_cpu_timer_del() when the delete raced with the exit cleanup. The

  works correctly as long as the timer is actually dequeued via

  posix_cpu_timers_exit*().


  But if the timer was dequeued due to expiry the head pointer is still set

  and triggers the warning.


  In fact keeping the head pointer around after any dequeue is pointless as

  is has no meaning at all after that.


  Clear the head pointer always on dequeue and remove the unused requeue

  function while at it.


  Fixes: 60bda037f1dd ("posix-cpu-timers: Utilize timerqueue for storage")

  Reported-by: syzbot+55acd54b57bb4b3840a4@syzkaller.appspotmail.com

  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

  Reviewed-by: Frederic Weisbecker <frederic@kernel.org>

  Link: https://lkml.kernel.org/r/20190905120539.707986830@linutronix.de


  '
submodule:
- include/linux
hunk_count: 2
covered_count: 0
