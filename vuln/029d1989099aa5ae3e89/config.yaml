id: 029d1989099aa5ae3e89
bug_link: https://syzkaller.appspot.com/bug?extid=029d1989099aa5ae3e89
title: 'UBSAN: shift-out-of-bounds in __bch2_btree_node_hash_insert'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ef6fac0f9e5d0695cee1d820c727fe753eca52d5
fix_commit: 96de8f85203147e3d1e646da891307fa3e462c32
datetime: '2025-06-27T12:47:07-04:00'
fix_commit_message: 'bcachefs: mark invalid_btree_id autofix


  Checking for invalid IDs was introduced in 9e7cfb35e266 ("bcachefs: Check for invalid
  btree IDs")

  to prevent an invalid shift later, but since 141526548052 ("bcachefs: Bad btree
  roots are now autofix")

  which made btree_root_bkey_invalid autofix, the fsck_err_on call didn''t

  do anything.


  We can mark this err type (invalid_btree_id) autofix as well, so it gets

  handled.


  Reported-by: syzbot+029d1989099aa5ae3e89@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=029d1989099aa5ae3e89

  Fixes: 141526548052 ("bcachefs: Bad btree roots are now autofix")


  Signed-off-by: Bharadwaj Raju <bharadwaj.raju777@gmail.com>

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 0
