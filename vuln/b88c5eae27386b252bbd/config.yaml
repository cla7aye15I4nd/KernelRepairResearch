id: b88c5eae27386b252bbd
bug_link: https://syzkaller.appspot.com/bug?extid=b88c5eae27386b252bbd
title: WARNING in atp_close (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4ebfee2bbc1a9c343dd50565ba5ae249fac32267
fix_commit: 9f3ccdc3f6ef10084ceb3a47df0961bec6196fd0
datetime: '2021-12-30T21:04:04-08:00'
fix_commit_message: 'Input: appletouch - initialize work before device registration


  Syzbot has reported warning in __flush_work(). This warning is caused by

  work->func == NULL, which means missing work initialization.


  This may happen, since input_dev->close() calls

  cancel_work_sync(&dev->work), but dev->work initalization happens _after_

  input_register_device() call.


  So this patch moves dev->work initialization before registering input

  device


  Fixes: 5a6eb676d3bc ("Input: appletouch - improve powersaving for Geyser3 devices")

  Reported-and-tested-by: syzbot+b88c5eae27386b252bbd@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Link: https://lore.kernel.org/r/20211230141151.17300-1-paskripkin@gmail.com

  Cc: stable@vger.kernel.org

  Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

  '
submodule:
- drivers/input/mouse
hunk_count: 2
covered_count: 0
