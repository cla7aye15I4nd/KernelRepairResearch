id: 29d3a3b4d86c8136ad9e
bug_link: https://syzkaller.appspot.com/bug?extid=29d3a3b4d86c8136ad9e
title: WARNING in cpuset_attach
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 763f4fb76e24959c370cdaa889b2492ba6175580
fix_commit: 43626dade36fa74d3329046f4ae2d7fdefe401c6
datetime: '2022-08-25T07:36:30-10:00'
fix_commit_message: 'cgroup: Add missing cpus_read_lock() to cgroup_attach_task_all()


  syzbot is hitting percpu_rwsem_assert_held(&cpu_hotplug_lock) warning at

  cpuset_attach() [1], for commit 4f7e7236435ca0ab ("cgroup: Fix

  threadgroup_rwsem <-> cpus_read_lock() deadlock") missed that

  cpuset_attach() is also called from cgroup_attach_task_all().

  Add cpus_read_lock() like what cgroup_procs_write_start() does.


  Link: https://syzkaller.appspot.com/bug?extid=29d3a3b4d86c8136ad9e [1]

  Reported-by: syzbot <syzbot+29d3a3b4d86c8136ad9e@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Fixes: 4f7e7236435ca0ab ("cgroup: Fix threadgroup_rwsem <-> cpus_read_lock() deadlock")

  Signed-off-by: Tejun Heo <tj@kernel.org>

  '
submodule:
- kernel/cgroup
hunk_count: 2
covered_count: 2
