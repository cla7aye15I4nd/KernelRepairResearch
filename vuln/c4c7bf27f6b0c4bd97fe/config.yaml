id: c4c7bf27f6b0c4bd97fe
bug_link: https://syzkaller.appspot.com/bug?extid=c4c7bf27f6b0c4bd97fe
title: general protection fault in veth_xdp_rcv
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a844b0c864a28e43affa3f1a048414b7122def40
fix_commit: 9337c54401a5bb6ac3c9f6c71dd2a9130cfba82e
datetime: '2025-06-12T08:08:32-07:00'
fix_commit_message: 'veth: prevent NULL pointer dereference in veth_xdp_rcv


  The veth peer device is RCU protected, but when the peer device gets

  deleted (veth_dellink) then the pointer is assigned NULL (via

  RCU_INIT_POINTER).


  This patch adds a necessary NULL check in veth_xdp_rcv when accessing

  the veth peer net_device.


  This fixes a bug introduced in commit dc82a33297fc ("veth: apply qdisc

  backpressure on full ptr_ring to reduce TX drops"). The bug is a race

  and only triggers when having inflight packets on a veth that is being

  deleted.


  Reported-by: Ihor Solodrai <ihor.solodrai@linux.dev>

  Closes: https://lore.kernel.org/all/fecfcad0-7a16-42b8-bff2-66ee83a6e5c4@linux.dev/

  Reported-by: syzbot+c4c7bf27f6b0c4bd97fe@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/all/683da55e.a00a0220.d8eae.0052.GAE@google.com/

  Fixes: dc82a33297fc ("veth: apply qdisc backpressure on full ptr_ring to reduce
  TX drops")

  Signed-off-by: Jesper Dangaard Brouer <hawk@kernel.org>

  Acked-by: Ihor Solodrai <ihor.solodrai@linux.dev>

  Link: https://patch.msgid.link/174964557873.519608.10855046105237280978.stgit@firesoul

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- drivers/net
hunk_count: 2
covered_count: 2
