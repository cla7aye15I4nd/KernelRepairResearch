id: 75cc0f9f7e6324dd2501
bug_link: https://syzkaller.appspot.com/bug?extid=75cc0f9f7e6324dd2501
title: WARNING in vkms_get_vblank_timestamp
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5d844091f2370f01752c3129b147861b9dcd3d98
fix_commit: f2c7ca890182d24ac817fa321489346000271c5c
datetime: '2023-04-06T07:33:25+02:00'
fix_commit_message: 'drm/atomic-helper: Don''t set deadline for modesets


  If the crtc is being switched on or off then the semantics of

  computing the timestampe of the next vblank is somewhat ill-defined.

  And indeed, the code splats with a warning in the timestamp

  computation code. Specifically it hits the check to make sure that

  atomic drivers have full set up the timing constants in the drm_vblank

  structure, and that''s just not the case before the crtc is actually

  on.


  For robustness it seems best to just not set deadlines for modesets.


  v2: Also skip on inactive crtc (Ville)


  Link: https://lore.kernel.org/dri-devel/dfc21f18-7e1e-48f0-c05a-d659b9c90b91@linaro.org/

  Fixes: d39e48ca80c0 ("drm/atomic-helper: Set fence deadline for vblank")

  Cc: Ville Syrj채l채 <ville.syrjala@linux.intel.com>

  Cc: Rob Clark <robdclark@chromium.org>

  Cc: Daniel Vetter <daniel.vetter@ffwll.ch>

  Cc: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>

  Cc: Maxime Ripard <mripard@kernel.org>

  Cc: Thomas Zimmermann <tzimmermann@suse.de>

  Reported-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>

  Tested-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org> # test patch only

  Cc: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>

  Reviewed-by: Ville Syrj채l채 <ville.syrjala@linux.intel.com>

  Reviewed-by: Rob Clark <robdclark@gmail.com>

  Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>

  Link: https://patchwork.freedesktop.org/patch/msgid/20230405133105.947834-1-daniel.vetter@ffwll.ch

  '
submodule:
- drivers/gpu/drm
hunk_count: 1
covered_count: 1
