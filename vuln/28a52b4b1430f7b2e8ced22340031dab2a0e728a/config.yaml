id: 28a52b4b1430f7b2e8ced22340031dab2a0e728a
bug_link: https://syzkaller.appspot.com/bug?extid=28a52b4b1430f7b2e8ced22340031dab2a0e728a
title: WARNING in free_kthread_struct
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 18c53e40487f56369c3ba9331ec3597d9b48d97c
fix_commit: e10237cc76ef9a4066a84aa2cc710bfd708cc341
datetime: '2017-11-10T19:53:25-07:00'
fix_commit_message: 'kthread: zero the kthread data structure


  kthread() could bail out early before we initialize blkcg_css (if the

  kthread is killed very early. Please see xchg() statement in kthread()),

  which confuses free_kthread_struct. Instead of moving the blkcg_css

  initialization early, we simply zero the whole ''self'' data structure,

  which doesn''t sound much overhead.


  Reported-by: syzbot <syzkaller@googlegroups.com>

  Fixes: 05e3db95ebfc ("kthread: add a mechanism to store cgroup info")

  Cc: Andrew Morton <akpm@linux-foundation.org>

  Cc: Ingo Molnar <mingo@kernel.org>

  Cc: Dmitry Vyukov <dvyukov@google.com>

  Acked-by: Tejun Heo <tj@kernel.org>

  Signed-off-by: Shaohua Li <shli@fb.com>

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- kernel
hunk_count: 2
covered_count: 0
