id: 210dfbddd64294066983
bug_link: https://syzkaller.appspot.com/bug?extid=210dfbddd64294066983
title: kernel BUG in bch2_trans_update_by_path
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ddb9680a7226d6081b42869d2875715a17ecb51d
fix_commit: c72d628469b8f46251b3afc361269cb15de0c988
datetime: '2025-07-04T15:47:13-04:00'
fix_commit_message: 'bcachefs: Fix btree for nonexistent tree depth


  The fix for when we should increase tree depth in journal replay was

  entirely bogus.


  We should only increase the tree depth in journal replay when recovery

  from btree node scan, and then only for keys found by btree node scan.


  This needs additional work - we should be shooting down existing

  interior node pointers when recovery from scan, they shouldn''t be

  showing up here.


  Fixes: b47a82ff4772 ("bcachefs: Only run ''increase_depth'' for keys from btree
  node csan")

  Cc: Alan Huang <mmpgouride@gmail.com>

  Reported-by: syzbot+8deb6ff4415db67a9f18@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 1
