id: 6b7c68d9c21e4ee4251b
bug_link: https://syzkaller.appspot.com/bug?extid=6b7c68d9c21e4ee4251b
title: memory leak in virtual_ncidev_write (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 37e8c97e539015637cb920d3e6f1e404f707a06e
fix_commit: bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c
datetime: '2024-01-29T12:05:31+00:00'
fix_commit_message: 'nfc: nci: free rx_data_reassembly skb on NCI device cleanup


  rx_data_reassembly skb is stored during NCI data exchange for processing

  fragmented packets. It is dropped only when the last fragment is processed

  or when an NTF packet with NCI_OP_RF_DEACTIVATE_NTF opcode is received.

  However, the NCI device may be deallocated before that which leads to skb

  leak.


  As by design the rx_data_reassembly skb is bound to the NCI device and

  nothing prevents the device to be freed before the skb is processed in

  some way and cleaned, free it on the NCI device cleanup.


  Found by Linux Verification Center (linuxtesting.org) with Syzkaller.


  Fixes: 6a2968aaf50c ("NFC: basic NCI protocol implementation")

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+6b7c68d9c21e4ee4251b@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/lkml/000000000000f43987060043da7b@google.com/

  Signed-off-by: Fedor Pchelkin <pchelkin@ispras.ru>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/nfc
hunk_count: 1
covered_count: 0
