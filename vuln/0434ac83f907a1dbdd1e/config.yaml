id: 0434ac83f907a1dbdd1e
bug_link: https://syzkaller.appspot.com/bug?extid=0434ac83f907a1dbdd1e
title: 'KASAN: use-after-free Read in powermate_config_complete (4)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a65cd7ef5a864bdbbe037267c327786b7759d4c6
fix_commit: 5c15c60e7be615f05a45cd905093a54b11f461bc
datetime: '2023-10-13T20:17:02-07:00'
fix_commit_message: 'Input: powermate - fix use-after-free in powermate_config_complete


  syzbot has found a use-after-free bug [1] in the powermate driver. This

  happens when the device is disconnected, which leads to a memory free from

  the powermate_device struct.  When an asynchronous control message

  completes after the kfree and its callback is invoked, the lock does not

  exist anymore and hence the bug.


  Use usb_kill_urb() on pm->config to cancel any in-progress requests upon

  device disconnection.


  [1] https://syzkaller.appspot.com/bug?extid=0434ac83f907a1dbdd1e


  Signed-off-by: Javier Carrasco <javier.carrasco.cruz@gmail.com>

  Reported-by: syzbot+0434ac83f907a1dbdd1e@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/r/20230916-topic-powermate_use_after_free-v3-1-64412b81a7a2@gmail.com

  Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

  '
submodule:
- drivers/input/misc
hunk_count: 1
covered_count: 1
