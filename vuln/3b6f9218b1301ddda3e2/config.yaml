id: 3b6f9218b1301ddda3e2
bug_link: https://syzkaller.appspot.com/bug?extid=3b6f9218b1301ddda3e2
title: possible deadlock in dquot_commit
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 15fc69bbbbbc8c72e5f6cc4e1be0f51283c5448e
fix_commit: 4013d47a5307fdb5c13370b5392498b00fedd274
datetime: '2022-01-10T13:25:55-05:00'
fix_commit_message: 'ext4: make sure to reset inode lockdep class when quota enabling
  fails


  When we succeed in enabling some quota type but fail to enable another

  one with quota feature, we correctly disable all enabled quota types.

  However we forget to reset i_data_sem lockdep class. When the inode gets

  freed and reused, it will inherit this lockdep class (i_data_sem is

  initialized only when a slab is created) and thus eventually lockdep

  barfs about possible deadlocks.


  Reported-and-tested-by: syzbot+3b6f9218b1301ddda3e2@syzkaller.appspotmail.com

  Signed-off-by: Jan Kara <jack@suse.cz>

  Cc: stable@kernel.org

  Link: https://lore.kernel.org/r/20211007155336.12493-3-jack@suse.cz

  Signed-off-by: Theodore Ts''o <tytso@mit.edu>

  '
submodule:
- fs/ext4
hunk_count: 1
covered_count: 0
