id: d27b4c8adbbff70fbfde
bug_link: https://syzkaller.appspot.com/bug?extid=d27b4c8adbbff70fbfde
title: general protection fault in kobject_cleanup
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 542104ee0cafe789cc07291b71818c143df8d623
fix_commit: a6112998ee45514def58200a7914706c0703f3d7
datetime: '2021-03-08T11:59:17+01:00'
fix_commit_message: 'gpio: fix NULL-deref-on-deregistration regression


  Fix a NULL-pointer deference when deregistering the gpio character

  device that was introduced by the recent stub-driver hack. When the new

  "driver" is unbound as part of deregistration, driver core clears the

  driver-data pointer which is used to retrieve the struct gpio_device in

  its release callback.


  Fix this by using container_of() in the release callback as should have

  been done all along.


  Fixes: 4731210c09f5 ("gpiolib: Bind gpio_device to a driver to enable fw_devlink=on
  by default")

  Cc: Saravana Kannan <saravanak@google.com>

  Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

  Reported-by: syzbot+d27b4c8adbbff70fbfde@syzkaller.appspotmail.com

  Signed-off-by: Johan Hovold <johan@kernel.org>

  Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>

  '
submodule:
- drivers/gpio
hunk_count: 2
covered_count: 1
