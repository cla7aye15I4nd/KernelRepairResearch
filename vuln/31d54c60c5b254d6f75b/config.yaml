id: 31d54c60c5b254d6f75b
bug_link: https://syzkaller.appspot.com/bug?extid=31d54c60c5b254d6f75b
title: 'INFO: trying to register non-static key in ath9k_wmi_event_tasklet'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b0ec7e55fce65f125bd1d7f02e2dc4de62abee34
fix_commit: 8b3046abc99eefe11438090bcc4ec3a3994b55d0
datetime: '2021-12-20T18:08:58+02:00'
fix_commit_message: "ath9k_htc: fix NULL pointer dereference at ath9k_htc_tx_get_packet()\n\
  \nsyzbot is reporting lockdep warning at ath9k_wmi_event_tasklet() followed\nby\
  \ kernel panic at get_htc_epid_queue() from ath9k_htc_tx_get_packet() from\nath9k_htc_txstatus()\
  \ [1], for ath9k_wmi_event_tasklet(WMI_TXSTATUS_EVENTID)\ndepends on spin_lock_init()\
  \ from ath9k_init_priv() being already completed.\n\nSince ath9k_wmi_event_tasklet()\
  \ is set by ath9k_init_wmi() from\nath9k_htc_probe_device(), it is possible that\
  \ ath9k_wmi_event_tasklet() is\ncalled via tasklet interrupt before spin_lock_init()\
  \ from ath9k_init_priv()\n from ath9k_init_device() from ath9k_htc_probe_device()\
  \ is called.\n\nLet's hold ath9k_wmi_event_tasklet(WMI_TXSTATUS_EVENTID) no-op until\n\
  ath9k_tx_init() completes.\n\nLink: https://syzkaller.appspot.com/bug?extid=31d54c60c5b254d6f75b\
  \ [1]\nReported-by: syzbot <syzbot+31d54c60c5b254d6f75b@syzkaller.appspotmail.com>\n\
  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>\nTested-by: syzbot\
  \ <syzbot+31d54c60c5b254d6f75b@syzkaller.appspotmail.com>\nSigned-off-by: Kalle\
  \ Valo <quic_kvalo@quicinc.com>\nLink: https://lore.kernel.org/r/77b76ac8-2bee-6444-d26c-8c30858b8daa@i-love.sakura.ne.jp\n"
submodule:
- drivers/net/wireless/ath/ath9k
hunk_count: 3
covered_count: 1
