id: 14c52d86ddbd89bea13e
bug_link: https://syzkaller.appspot.com/bug?extid=14c52d86ddbd89bea13e
title: 'UBSAN: array-index-out-of-bounds in bch2_sb_downgrade_update'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 757601ef853359fe2d57d75c00b5045f62efc608
fix_commit: 082c74411491f8b0d31465fc104b8342e66c4056
datetime: '2025-06-11T23:21:30-04:00'
fix_commit_message: 'bcachefs: Fix downgrade_table_extra()


  Fix a UAF: we were calling darray_make_room() and retaining a pointer to

  the old buffer.


  And fix an UBSAN warning: struct bch_sb_field_downgrade_entry uses

  __counted_by, so set dst->nr_errors before assigning to the array entry.


  Reported-by: syzbot+14c52d86ddbd89bea13e@syzkaller.appspotmail.com

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 3
covered_count: 3
