id: 5d1bad8042a8f0e8117a
bug_link: https://syzkaller.appspot.com/bug?extid=5d1bad8042a8f0e8117a
title: 'BUG: sleeping function called from invalid context in __fdget_pos'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f03a3cab26c1b7f628a3be6d33ae1b483829b630
fix_commit: 821720b9f34ec54106ebf012a712ba73bbcf47c2
datetime: '2021-07-23T14:49:18+08:00'
fix_commit_message: 'crypto: x86/aes-ni - add missing error checks in XTS code


  The updated XTS code fails to check the return code of skcipher_walk_virt,

  which may lead to skcipher_walk_abort() or skcipher_walk_done() being called

  while the walk argument is in an inconsistent state.


  So check the return value after each such call, and bail on errors.


  Fixes: 2481104fe98d ("crypto: x86/aes-ni-xts - rewrite and drop indirections via
  glue helper")

  Reported-by: Dave Hansen <dave.hansen@intel.com>

  Reported-by: syzbot <syzbot+5d1bad8042a8f0e8117a@syzkaller.appspotmail.com>

  Signed-off-by: Ard Biesheuvel <ardb@kernel.org>

  Reviewed-by: Eric Biggers <ebiggers@google.com>

  Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

  '
submodule:
- arch/x86/crypto
hunk_count: 2
covered_count: 0
