id: 5a864149dd970b546223
bug_link: https://syzkaller.appspot.com/bug?extid=5a864149dd970b546223
title: WARNING in io_link_timeout_fn
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a298232ee6b9a1d5d732aa497ff8be0d45b5bd82
fix_commit: 447c19f3b5074409c794b350b10306e1da1ef4ba
datetime: '2021-05-14T06:06:15-06:00'
fix_commit_message: 'io_uring: fix ltout double free on completion race


  Always remove linked timeout on io_link_timeout_fn() from the master

  request link list, otherwise we may get use-after-free when first

  io_link_timeout_fn() puts linked timeout in the fail path, and then

  will be found and put on master''s free.


  Cc: stable@vger.kernel.org # 5.10+

  Fixes: 90cd7e424969d ("io_uring: track link timeout''s master explicitly")

  Reported-and-tested-by: syzbot+5a864149dd970b546223@syzkaller.appspotmail.com

  Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>

  Link: https://lore.kernel.org/r/69c46bf6ce37fec4fdcd98f0882e18eb07ce693a.1620990121.git.asml.silence@gmail.com

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- fs
hunk_count: 1
covered_count: 1
