id: 690b90b14f14f43f4688
bug_link: https://syzkaller.appspot.com/bug?extid=690b90b14f14f43f4688
title: 'KASAN: slab-use-after-free Read in hci_conn_del'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9025944fddfed5966c8f102f1fe921ab3aee2c12
fix_commit: ca1fd42e7dbfcb34890ffbf1f2f4b356776dab6f
datetime: '2023-05-19T15:37:45-07:00'
fix_commit_message: 'Bluetooth: Fix potential double free caused by hci_conn_unlink


  The hci_conn_unlink function is being called by hci_conn_del, which

  means it should not call hci_conn_del with the input parameter conn

  again. If it does, conn may have already been released when

  hci_conn_unlink returns, leading to potential UAF and double-free

  issues.


  This patch resolves the problem by modifying hci_conn_unlink to release

  only conn''s child links when necessary, but never release conn itself.


  Reported-by: syzbot+690b90b14f14f43f4688@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/linux-bluetooth/000000000000484a8205faafe216@google.com/

  Fixes: 06149746e720 ("Bluetooth: hci_conn: Add support for linking multiple hcon")

  Signed-off-by: Ruihan Li <lrh2000@pku.edu.cn>

  Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>

  Reported-by: syzbot+690b90b14f14f43f4688@syzkaller.appspotmail.com

  Reported-by: Luiz Augusto von Dentz <luiz.dentz@gmail.com>

  Reported-by: syzbot+8bb72f86fc823817bc5d@syzkaller.appspotmail.com

  '
submodule:
- net/bluetooth
hunk_count: 2
covered_count: 2
