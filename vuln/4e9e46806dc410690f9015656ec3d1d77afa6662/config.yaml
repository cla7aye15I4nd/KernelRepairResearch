id: 4e9e46806dc410690f9015656ec3d1d77afa6662
bug_link: https://syzkaller.appspot.com/bug?extid=4e9e46806dc410690f9015656ec3d1d77afa6662
title: 'BUG: workqueue lockup'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: d70eaa386bf9ecc1e5b3002f64eb59172fcec4fd
fix_commit: 93161922c658c714715686cd0cf69b090cb9bf1d
datetime: '2017-11-01T20:52:36+09:00'
fix_commit_message: "tun/tap: sanitize TUNSETSNDBUF input\n\nSyzkaller found several\
  \ variants of the lockup below by setting negative\nvalues with the TUNSETSNDBUF\
  \ ioctl.  This patch adds a sanity check\nto both the tun and tap versions of this\
  \ ioctl.\n\n  watchdog: BUG: soft lockup - CPU#0 stuck for 22s! [repro:2389]\n \
  \ Modules linked in:\n  irq event stamp: 329692056\n  hardirqs last  enabled at\
  \ (329692055): [<ffffffff824b8381>] _raw_spin_unlock_irqrestore+0x31/0x75\n  hardirqs\
  \ last disabled at (329692056): [<ffffffff824b9e58>] apic_timer_interrupt+0x98/0xb0\n\
  \  softirqs last  enabled at (35659740): [<ffffffff824bc958>] __do_softirq+0x328/0x48c\n\
  \  softirqs last disabled at (35659731): [<ffffffff811c796c>] irq_exit+0xbc/0xd0\n\
  \  CPU: 0 PID: 2389 Comm: repro Not tainted 4.14.0-rc7 #23\n  Hardware name: QEMU\
  \ Standard PC (i440FX + PIIX, 1996), BIOS Bochs 01/01/2011\n  task: ffff880009452140\
  \ task.stack: ffff880006a20000\n  RIP: 0010:_raw_spin_lock_irqsave+0x11/0x80\n \
  \ RSP: 0018:ffff880006a27c50 EFLAGS: 00000282 ORIG_RAX: ffffffffffffff10\n  RAX:\
  \ ffff880009ac68d0 RBX: ffff880006a27ce0 RCX: 0000000000000000\n  RDX: 0000000000000001\
  \ RSI: ffff880006a27ce0 RDI: ffff880009ac6900\n  RBP: ffff880006a27c60 R08: 0000000000000000\
  \ R09: 0000000000000000\n  R10: 0000000000000001 R11: 000000000063ff00 R12: ffff880009ac6900\n\
  \  R13: ffff880006a27cf8 R14: 0000000000000001 R15: ffff880006a27cf8\n  FS:  00007f4be4838700(0000)\
  \ GS:ffff88000cc00000(0000) knlGS:0000000000000000\n  CS:  0010 DS: 0000 ES: 0000\
  \ CR0: 0000000080050033\n  CR2: 0000000020101000 CR3: 0000000009616000 CR4: 00000000000006f0\n\
  \  Call Trace:\n   prepare_to_wait+0x26/0xc0\n   sock_alloc_send_pskb+0x14e/0x270\n\
  \   ? remove_wait_queue+0x60/0x60\n   tun_get_user+0x2cc/0x19d0\n   ? __tun_get+0x60/0x1b0\n\
  \   tun_chr_write_iter+0x57/0x86\n   __vfs_write+0x156/0x1e0\n   vfs_write+0xf7/0x230\n\
  \   SyS_write+0x57/0xd0\n   entry_SYSCALL_64_fastpath+0x1f/0xbe\n  RIP: 0033:0x7f4be4356df9\n\
  \  RSP: 002b:00007ffc18101c08 EFLAGS: 00000293 ORIG_RAX: 0000000000000001\n  RAX:\
  \ ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4be4356df9\n  RDX: 0000000000000046\
  \ RSI: 0000000020101000 RDI: 0000000000000005\n  RBP: 00007ffc18101c40 R08: 0000000000000001\
  \ R09: 0000000000000001\n  R10: 0000000000000001 R11: 0000000000000293 R12: 0000559c75f64780\n\
  \  R13: 00007ffc18101d30 R14: 0000000000000000 R15: 0000000000000000\n\nFixes: 33dccbb050bb\
  \ (\"tun: Limit amount of queued packets per device\")\nFixes: 20d29d7a916a (\"\
  net: macvtap driver\")\nSigned-off-by: Craig Gallek <kraig@google.com>\nReviewed-by:\
  \ Eric Dumazet <edumazet@google.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n"
submodule:
- drivers/net
hunk_count: 2
covered_count: 0
