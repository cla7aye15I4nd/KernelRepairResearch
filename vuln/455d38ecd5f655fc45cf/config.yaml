id: 455d38ecd5f655fc45cf
bug_link: https://syzkaller.appspot.com/bug?extid=455d38ecd5f655fc45cf
title: WARNING in mptcp_pm_nl_set_flags
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 58e1b66b4e4b8a602d3f2843e8eba00a969ecce2
fix_commit: 9366922adc6a71378ca01f898c41be295309f044
datetime: '2024-08-29T10:39:50+02:00'
fix_commit_message: 'mptcp: pm: fix ID 0 endp usage after multiple re-creations


  ''local_addr_used'' and ''add_addr_accepted'' are decremented for addresses

  not related to the initial subflow (ID0), because the source and

  destination addresses of the initial subflows are known from the

  beginning: they don''t count as "additional local address being used" or

  "ADD_ADDR being accepted".


  It is then required not to increment them when the entrypoint used by

  the initial subflow is removed and re-added during a connection. Without

  this modification, this entrypoint cannot be removed and re-added more

  than once.


  Reported-by: Arınç ÜNAL <arinc.unal@arinc9.com>

  Closes: https://github.com/multipath-tcp/mptcp_net-next/issues/512

  Fixes: 3ad14f54bd74 ("mptcp: more accurate MPC endpoint tracking")

  Reported-by: syzbot+455d38ecd5f655fc45cf@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/00000000000049861306209237f4@google.com

  Cc: stable@vger.kernel.org

  Tested-by: Arınç ÜNAL <arinc.unal@arinc9.com>

  Reviewed-by: Mat Martineau <martineau@kernel.org>

  Signed-off-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>

  Signed-off-by: Paolo Abeni <pabeni@redhat.com>


  '
submodule:
- net/mptcp
hunk_count: 2
covered_count: 0
