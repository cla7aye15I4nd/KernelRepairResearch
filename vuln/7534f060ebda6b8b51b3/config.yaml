id: 7534f060ebda6b8b51b3
bug_link: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3
title: 'KASAN: vmalloc-out-of-bounds Read in acpi_nfit_ctl (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 40384c840ea1944d7c5a392e8975ed088ecf0b37
fix_commit: 265e98f72bac6c41a4492d3e30a8e5fd22fe0779
datetime: '2024-12-04T14:58:44-06:00'
fix_commit_message: 'acpi: nfit: vmalloc-out-of-bounds Read in acpi_nfit_ctl


  Fix an issue detected by syzbot with KASAN:


  BUG: KASAN: vmalloc-out-of-bounds in cmd_to_func drivers/acpi/nfit/

  core.c:416 [inline]

  BUG: KASAN: vmalloc-out-of-bounds in acpi_nfit_ctl+0x20e8/0x24a0

  drivers/acpi/nfit/core.c:459


  The issue occurs in cmd_to_func when the call_pkg->nd_reserved2

  array is accessed without verifying that call_pkg points to a buffer

  that is appropriately sized as a struct nd_cmd_pkg. This can lead

  to out-of-bounds access and undefined behavior if the buffer does not

  have sufficient space.


  To address this, a check was added in acpi_nfit_ctl() to ensure that

  buf is not NULL and that buf_len is less than sizeof(*call_pkg)

  before accessing it. This ensures safe access to the members of

  call_pkg, including the nd_reserved2 array.


  Reported-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=7534f060ebda6b8b51b3

  Tested-by: syzbot+7534f060ebda6b8b51b3@syzkaller.appspotmail.com

  Fixes: ebe9f6f19d80 ("acpi/nfit: Fix bus command validation")

  Signed-off-by: Suraj Sonawane <surajsonawane0215@gmail.com>

  Reviewed-by: Alison Schofield <alison.schofield@intel.com>

  Reviewed-by: Dave Jiang <dave.jiang@intel.com>

  Link: https://patch.msgid.link/20241118162609.29063-1-surajsonawane0215@gmail.com

  Signed-off-by: Ira Weiny <ira.weiny@intel.com>

  '
submodule:
- drivers/acpi/nfit
hunk_count: 1
covered_count: 1
