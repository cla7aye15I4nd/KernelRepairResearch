id: 7ca4b2719dc742b8d0a4
bug_link: https://syzkaller.appspot.com/bug?extid=7ca4b2719dc742b8d0a4
title: WARNING in unmap_page_range (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0dff1b407def32452a0d80148172889862c64fe7
fix_commit: 4980e837cab7e2acc4dad18dba656c6896c531aa
datetime: '2023-12-06T16:12:45-08:00'
fix_commit_message: 'mm/pagemap: fix wr-protect even if PM_SCAN_WP_MATCHING not set


  The new pagemap ioctl contains a fast path for wr-protections without

  looking into category masks.  It forgets to check PM_SCAN_WP_MATCHING

  before applying the wr-protections.  It can cause, e.g., pte markers

  installed on archs that do not even support uffd wr-protect.


  WARNING: CPU: 0 PID: 5059 at mm/memory.c:1520 zap_pte_range mm/memory.c:1520 [inline]


  Link: https://lkml.kernel.org/r/20231116201547.536857-3-peterx@redhat.com

  Fixes: 12f6b01a0bcb ("fs/proc/task_mmu: add fast paths to get/clear PAGE_IS_WRITTEN
  flag")

  Signed-off-by: Peter Xu <peterx@redhat.com>

  Reported-by: syzbot+7ca4b2719dc742b8d0a4@syzkaller.appspotmail.com

  Reviewed-by: David Hildenbrand <david@redhat.com>

  Reviewed-by: Andrei Vagin <avagin@gmail.com>

  Cc: Muhammad Usama Anjum <usama.anjum@collabora.com>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/proc
hunk_count: 1
covered_count: 0
