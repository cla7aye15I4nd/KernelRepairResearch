id: 38e876a8aa44b7115c76
bug_link: https://syzkaller.appspot.com/bug?extid=38e876a8aa44b7115c76
title: 'UBSAN: array-index-out-of-bounds in dbNextAG'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 525b861a008143048535011f3816d407940f4bfa
fix_commit: 64933ab7b04881c6c18b21ff206c12278341c72e
datetime: '2023-10-03T18:41:12-05:00'
fix_commit_message: 'fs/jfs: Add validity check for db_maxag and db_agpref


  Both db_maxag and db_agpref are used as the index of the

  db_agfree array, but there is currently no validity check for

  db_maxag and db_agpref, which can lead to errors.


  The following is related bug reported by Syzbot:


  UBSAN: array-index-out-of-bounds in fs/jfs/jfs_dmap.c:639:20

  index 7936 is out of range for type ''atomic_t[128]''


  Add checking that the values of db_maxag and db_agpref are valid

  indexes for the db_agfree array.


  Reported-by: syzbot+38e876a8aa44b7115c76@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=38e876a8aa44b7115c76

  Signed-off-by: Juntong Deng <juntong.deng@outlook.com>

  Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>

  '
submodule:
- fs/jfs
hunk_count: 1
covered_count: 0
