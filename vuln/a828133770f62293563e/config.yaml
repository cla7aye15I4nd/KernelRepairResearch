id: a828133770f62293563e
bug_link: https://syzkaller.appspot.com/bug?extid=a828133770f62293563e
title: WARNING in __v4l2_ctrl_modify_dimensions
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 2a45db41b8974f4b62fbf001feaffc7d3b699b8d
fix_commit: 9f070b1862f3411b8bcdfd51a8eaad25286f9deb
datetime: '2024-10-28T15:35:56+01:00'
fix_commit_message: 'media: v4l2-core: v4l2-dv-timings: check cvt/gtf result


  The v4l2_detect_cvt/gtf functions should check the result against the

  timing capabilities: these functions calculate the timings, so if they

  are out of bounds, they should be rejected.


  To do this, add the struct v4l2_dv_timings_cap as argument to those

  functions.


  This required updates to the adv7604 and adv7842 drivers since the

  prototype of these functions has now changed. The timings struct

  that is passed to v4l2_detect_cvt/gtf in those two drivers is filled

  with the timings detected by the hardware.


  The vivid driver was also updated, but an additional check was added:

  the width and height specified by VIDIOC_S_DV_TIMINGS has to match the

  calculated result, otherwise something went wrong. Note that vivid

  *emulates* hardware, so all the values passed to the v4l2_detect_cvt/gtf

  functions came from the timings struct that was filled by userspace

  and passed on to the driver via VIDIOC_S_DV_TIMINGS. So these fields

  can contain random data. Both the constraints check via

  struct v4l2_dv_timings_cap and the additional width/height check

  ensure that the resulting timings are sane and not messed up by the

  v4l2_detect_cvt/gtf calculations.


  Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>

  Fixes: 2576415846bc ("[media] v4l2: move dv-timings related code to v4l2-dv-timings.c")

  Cc: stable@vger.kernel.org

  Reported-by: syzbot+a828133770f62293563e@syzkaller.appspotmail.com

  Closes: https://lore.kernel.org/linux-media/000000000000013050062127830a@google.com/

  '
submodule:
- drivers/media/i2c
- drivers/media/test-drivers/vivid
- drivers/media/v4l2-core
- include/media
hunk_count: 10
covered_count: 2
