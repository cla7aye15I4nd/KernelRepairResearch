id: b75c138e9286ac742647
bug_link: https://syzkaller.appspot.com/bug?extid=b75c138e9286ac742647
title: 'KASAN: use-after-free Read in free_netdev (3)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6f0012e35160cd08a53e46e3b3bbf724b92dfe68
fix_commit: 3b9bc84d311104906d2b4995a9a02d7b7ddab2db
datetime: '2022-06-24T16:28:08-07:00'
fix_commit_message: 'net: tun: unlink NAPI from device on destruction


  Syzbot found a race between tun file and device destruction.

  NAPIs live in struct tun_file which can get destroyed before

  the netdev so we have to del them explicitly. The current

  code is missing deleting the NAPI if the queue was detached

  first.


  Fixes: 943170998b20 ("tun: enable NAPI for TUN/TAP driver")

  Reported-by: syzbot+b75c138e9286ac742647@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/r/20220623042039.2274708-1-kuba@kernel.org

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- drivers/net
hunk_count: 1
covered_count: 1
