id: 4f2e5f086147d543ab03
bug_link: https://syzkaller.appspot.com/bug?extid=4f2e5f086147d543ab03
title: 'WARNING: ODEBUG bug in hfsplus_fill_super'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ab1e8d8960b68f54af42b6484b5950bd13a4054b
fix_commit: 66072c29328717072fd84aaff3e070e3f008ba77
datetime: '2018-05-18T17:17:12-07:00'
fix_commit_message: 'hfsplus: stop workqueue when fill_super() failed


  syzbot is reporting ODEBUG messages at hfsplus_fill_super() [1].  This

  is because hfsplus_fill_super() forgot to call cancel_delayed_work_sync().


  As far as I can see, it is hfsplus_mark_mdb_dirty() from

  hfsplus_new_inode() in hfsplus_fill_super() that calls

  queue_delayed_work().  Therefore, I assume that hfsplus_new_inode() does

  not fail if queue_delayed_work() was called, and the out_put_hidden_dir

  label is the appropriate location to call cancel_delayed_work_sync().


  [1] https://syzkaller.appspot.com/bug?id=a66f45e96fdbeb76b796bf46eb25ea878c42a6c9


  Link: http://lkml.kernel.org/r/964a8b27-cd69-357c-fe78-76b066056201@I-love.SAKURA.ne.jp

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Reported-by: syzbot <syzbot+4f2e5f086147d543ab03@syzkaller.appspotmail.com>

  Cc: Al Viro <viro@zeniv.linux.org.uk>

  Cc: David Howells <dhowells@redhat.com>

  Cc: Ernesto A. Fernandez <ernesto.mnd.fernandez@gmail.com>

  Cc: Vyacheslav Dubeyko <slava@dubeyko.com>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

  '
submodule:
- fs/hfsplus
hunk_count: 1
covered_count: 1
