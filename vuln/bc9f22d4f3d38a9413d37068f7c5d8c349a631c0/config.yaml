id: bc9f22d4f3d38a9413d37068f7c5d8c349a631c0
bug_link: https://syzkaller.appspot.com/bug?extid=bc9f22d4f3d38a9413d37068f7c5d8c349a631c0
title: 'INFO: trying to register non-static key in pfifo_fast_reset'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4eb50ceb5c156a166c0b00ac27f0ff3a0943cdfb
fix_commit: 1df94c3c5dadbce3df6cc0e989d8c85d43a903d6
datetime: '2017-12-19T14:13:12-05:00'
fix_commit_message: 'net_sched: properly check for empty skb array on error path


  First, the check of &q->ring.queue against NULL is wrong, it

  is always false. We should check the value rather than the address.


  Secondly, we need the same check in pfifo_fast_reset() too,

  as both ->reset() and ->destroy() are called in qdisc_destroy().


  Fixes: c5ad119fb6c0 ("net: sched: pfifo_fast use skb_array")

  Reported-by: syzbot <syzkaller@googlegroups.com>

  Cc: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>

  Acked-by: John Fastabend <john.fastabend@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- net/sched
hunk_count: 2
covered_count: 1
