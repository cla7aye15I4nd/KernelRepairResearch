id: 4f3abbb335d1bed2287c
bug_link: https://syzkaller.appspot.com/bug?extid=4f3abbb335d1bed2287c
title: 'KMSAN: uninit-value in rtm_new_nexthop'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c36757eb9dee13681227ad3676d37f14b3a2b2af
fix_commit: d00ee64e1dcf09b3afefd1340f3e9eb637272714
datetime: '2019-08-13T20:37:16-07:00'
fix_commit_message: "netlink: Fix nlmsg_parse as a wrapper for strict message parsing\n\
  \nEric reported a syzbot warning:\n\nBUG: KMSAN: uninit-value in nh_valid_get_del_req+0x6f1/0x8c0\
  \ net/ipv4/nexthop.c:1510\nCPU: 0 PID: 11812 Comm: syz-executor444 Not tainted 5.3.0-rc3+\
  \ #17\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google\
  \ 01/01/2011\nCall Trace:\n __dump_stack lib/dump_stack.c:77 [inline]\n dump_stack+0x191/0x1f0\
  \ lib/dump_stack.c:113\n kmsan_report+0x162/0x2d0 mm/kmsan/kmsan_report.c:109\n\
  \ __msan_warning+0x75/0xe0 mm/kmsan/kmsan_instr.c:294\n nh_valid_get_del_req+0x6f1/0x8c0\
  \ net/ipv4/nexthop.c:1510\n rtm_del_nexthop+0x1b1/0x610 net/ipv4/nexthop.c:1543\n\
  \ rtnetlink_rcv_msg+0x115a/0x1580 net/core/rtnetlink.c:5223\n netlink_rcv_skb+0x431/0x620\
  \ net/netlink/af_netlink.c:2477\n rtnetlink_rcv+0x50/0x60 net/core/rtnetlink.c:5241\n\
  \ netlink_unicast_kernel net/netlink/af_netlink.c:1302 [inline]\n netlink_unicast+0xf6c/0x1050\
  \ net/netlink/af_netlink.c:1328\n netlink_sendmsg+0x110f/0x1330 net/netlink/af_netlink.c:1917\n\
  \ sock_sendmsg_nosec net/socket.c:637 [inline]\n sock_sendmsg net/socket.c:657 [inline]\n\
  \ ___sys_sendmsg+0x14ff/0x1590 net/socket.c:2311\n __sys_sendmmsg+0x53a/0xae0 net/socket.c:2413\n\
  \ __do_sys_sendmmsg net/socket.c:2442 [inline]\n __se_sys_sendmmsg+0xbd/0xe0 net/socket.c:2439\n\
  \ __x64_sys_sendmmsg+0x56/0x70 net/socket.c:2439\n do_syscall_64+0xbc/0xf0 arch/x86/entry/common.c:297\n\
  \ entry_SYSCALL_64_after_hwframe+0x63/0xe7\n\nThe root cause is nlmsg_parse calling\
  \ __nla_parse which means the\nheader struct size is not checked.\n\nnlmsg_parse\
  \ should be a wrapper around __nlmsg_parse with\nNL_VALIDATE_STRICT for the validate\
  \ argument very much like\nnlmsg_parse_deprecated is for NL_VALIDATE_LIBERAL.\n\n\
  Fixes: 3de6440354465 (\"netlink: re-add parse/validate functions in strict mode\"\
  )\nReported-by: Eric Dumazet <edumazet@google.com>\nReported-by: syzbot <syzkaller@googlegroups.com>\n\
  Signed-off-by: David Ahern <dsahern@gmail.com>\nReviewed-by: Eric Dumazet <edumazet@google.com>\n\
  Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>\n"
submodule:
- include/net
hunk_count: 1
covered_count: 0
