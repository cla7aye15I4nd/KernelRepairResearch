id: da4fe66aaadd3c2e2d1c
bug_link: https://syzkaller.appspot.com/bug?extid=da4fe66aaadd3c2e2d1c
title: 'UBSAN: shift-out-of-bounds in exfat_fill_super'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f40ddce88593482919761f74910f42f4b84c004b
fix_commit: 78c276f5495aa53a8beebb627e5bf6a54f0af34f
datetime: '2021-02-22T09:55:13+09:00'
fix_commit_message: "exfat: fix shift-out-of-bounds in exfat_fill_super()\n\nsyzbot\
  \ reported a warning which could cause shift-out-of-bounds issue.\n\nCall Trace:\n\
  \ __dump_stack lib/dump_stack.c:79 [inline]\n dump_stack+0x183/0x22e lib/dump_stack.c:120\n\
  \ ubsan_epilogue lib/ubsan.c:148 [inline]\n __ubsan_handle_shift_out_of_bounds+0x432/0x4d0\
  \ lib/ubsan.c:395\n exfat_read_boot_sector fs/exfat/super.c:471 [inline]\n __exfat_fill_super\
  \ fs/exfat/super.c:556 [inline]\n exfat_fill_super+0x2acb/0x2d00 fs/exfat/super.c:624\n\
  \ get_tree_bdev+0x406/0x630 fs/super.c:1291\n vfs_get_tree+0x86/0x270 fs/super.c:1496\n\
  \ do_new_mount fs/namespace.c:2881 [inline]\n path_mount+0x1937/0x2c50 fs/namespace.c:3211\n\
  \ do_mount fs/namespace.c:3224 [inline]\n __do_sys_mount fs/namespace.c:3432 [inline]\n\
  \ __se_sys_mount+0x2f9/0x3b0 fs/namespace.c:3409\n do_syscall_64+0x2d/0x70 arch/x86/entry/common.c:46\n\
  \ entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\nexfat specification describe sect_per_clus_bits\
  \ field of boot sector\ncould be at most 25 - sect_size_bits and at least 0. And\
  \ sect_size_bits\ncan also affect this calculation, It also needs validation.\n\
  This patch add validation for sect_per_clus_bits and sect_size_bits\nfield of boot\
  \ sector.\n\nFixes: 719c1e182916 (\"exfat: add super block operations\")\nCc: stable@vger.kernel.org\
  \ # v5.9+\nReported-by: syzbot+da4fe66aaadd3c2e2d1c@syzkaller.appspotmail.com\n\
  Reviewed-by: Sungjong Seo <sj1557.seo@samsung.com>\nTested-by: Randy Dunlap <rdunlap@infradead.org>\n\
  Signed-off-by: Namjae Jeon <namjae.jeon@samsung.com>\n"
submodule:
- fs/exfat
hunk_count: 4
covered_count: 2
