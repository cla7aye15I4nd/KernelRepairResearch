id: 8fede7e30c7cee0de139
bug_link: https://syzkaller.appspot.com/bug?extid=8fede7e30c7cee0de139
title: 'KASAN: use-after-free Read in disk_part_iter_next (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7de55b7d6f09a2865279d3c41c0fbdbfdb87486a
fix_commit: e82fc7855749aa197740a60ef22c492c41ea5d5f
datetime: '2021-03-27T09:22:18-06:00'
fix_commit_message: 'block: don''t create too many partitions


  Commit a33df75c6328 ("block: use an xarray for disk->part_tbl") drops the

  check on max supported number of partitionsr, and allows partition with

  bigger partition numbers to be added. However, ->bd_partno is defined as

  u8, so partition index of xarray table may not match with ->bd_partno.

  Then delete_partition() may delete one unmatched partition, and caused

  use-after-free.


  Reviewed-by: Bart Van Assche <bvanassche@acm.org>

  Reported-by: syzbot+8fede7e30c7cee0de139@syzkaller.appspotmail.com

  Fixes: a33df75c6328 ("block: use an xarray for disk->part_tbl")

  Signed-off-by: Ming Lei <ming.lei@redhat.com>

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- block/partitions
hunk_count: 1
covered_count: 1
