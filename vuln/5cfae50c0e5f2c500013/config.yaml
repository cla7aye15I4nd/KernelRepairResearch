id: 5cfae50c0e5f2c500013
bug_link: https://syzkaller.appspot.com/bug?extid=5cfae50c0e5f2c500013
title: 'UBSAN: array-index-out-of-bounds in mr_table_dump'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 965adae5a33a998e2b62ec1b37c5eb21f1875b15
fix_commit: 15a901361ec3fb1c393f91880e1cbf24ec0a88bd
datetime: '2025-01-23T07:08:13-08:00'
fix_commit_message: "ipmr: do not call mr_mfc_uses_dev() for unres entries\n\nsyzbot\
  \ found that calling mr_mfc_uses_dev() for unres entries\nwould crash [1], because\
  \ c->mfc_un.res.minvif / c->mfc_un.res.maxvif\nalias to \"struct sk_buff_head unresolved\"\
  , which contain two pointers.\n\nThis code never worked, lets remove it.\n\n[1]\n\
  Unable to handle kernel paging request at virtual address ffff5fff2d536613\nKASAN:\
  \ maybe wild-memory-access in range [0xfffefff96a9b3098-0xfffefff96a9b309f]\nModules\
  \ linked in:\nCPU: 1 UID: 0 PID: 7321 Comm: syz.0.16 Not tainted 6.13.0-rc7-syzkaller-g1950a0af2d55\
  \ #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google\
  \ 09/13/2024\npstate: 80400005 (Nzcv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)\n\
  \ pc : mr_mfc_uses_dev net/ipv4/ipmr_base.c:290 [inline]\n pc : mr_table_dump+0x5a4/0x8b0\
  \ net/ipv4/ipmr_base.c:334\n lr : mr_mfc_uses_dev net/ipv4/ipmr_base.c:289 [inline]\n\
  \ lr : mr_table_dump+0x694/0x8b0 net/ipv4/ipmr_base.c:334\nCall trace:\n  mr_mfc_uses_dev\
  \ net/ipv4/ipmr_base.c:290 [inline] (P)\n  mr_table_dump+0x5a4/0x8b0 net/ipv4/ipmr_base.c:334\
  \ (P)\n  mr_rtm_dumproute+0x254/0x454 net/ipv4/ipmr_base.c:382\n  ipmr_rtm_dumproute+0x248/0x4b4\
  \ net/ipv4/ipmr.c:2648\n  rtnl_dump_all+0x2e4/0x4e8 net/core/rtnetlink.c:4327\n\
  \  rtnl_dumpit+0x98/0x1d0 net/core/rtnetlink.c:6791\n  netlink_dump+0x4f0/0xbc0\
  \ net/netlink/af_netlink.c:2317\n  netlink_recvmsg+0x56c/0xe64 net/netlink/af_netlink.c:1973\n\
  \  sock_recvmsg_nosec net/socket.c:1033 [inline]\n  sock_recvmsg net/socket.c:1055\
  \ [inline]\n  sock_read_iter+0x2d8/0x40c net/socket.c:1125\n  new_sync_read fs/read_write.c:484\
  \ [inline]\n  vfs_read+0x740/0x970 fs/read_write.c:565\n  ksys_read+0x15c/0x26c\
  \ fs/read_write.c:708\n\nFixes: cb167893f41e (\"net: Plumb support for filtering\
  \ ipv4 and ipv6 multicast route dumps\")\nReported-by: syzbot+5cfae50c0e5f2c500013@syzkaller.appspotmail.com\n\
  Closes: https://lore.kernel.org/netdev/678fe2d1.050a0220.15cac.00b3.GAE@google.com/T/#u\n\
  Signed-off-by: Eric Dumazet <edumazet@google.com>\nReviewed-by: David Ahern <dsahern@kernel.org>\n\
  Link: https://patch.msgid.link/20250121181241.841212-1-edumazet@google.com\nSigned-off-by:\
  \ Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/ipv4
hunk_count: 1
covered_count: 1
