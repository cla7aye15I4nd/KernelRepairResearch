id: a225ee3df7e7f9372dbe
bug_link: https://syzkaller.appspot.com/bug?extid=a225ee3df7e7f9372dbe
title: inconsistent lock state in valid_state (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 39bc27bd688066a63e56f7f64ad34fae03fbe3b8
fix_commit: b794918961516f667b0c745aebdfebbb8a98df39
datetime: '2024-05-24T16:30:05+02:00'
fix_commit_message: 'dma-buf/sw-sync: don''t enable IRQ from sync_print_obj()


  Since commit a6aa8fca4d79 ("dma-buf/sw-sync: Reduce irqsave/irqrestore from

  known context") by error replaced spin_unlock_irqrestore() with

  spin_unlock_irq() for both sync_debugfs_show() and sync_print_obj() despite

  sync_print_obj() is called from sync_debugfs_show(), lockdep complains

  inconsistent lock state warning.


  Use plain spin_{lock,unlock}() for sync_print_obj(), for

  sync_debugfs_show() is already using spin_{lock,unlock}_irq().


  Reported-by: syzbot <syzbot+a225ee3df7e7f9372dbe@syzkaller.appspotmail.com>

  Closes: https://syzkaller.appspot.com/bug?extid=a225ee3df7e7f9372dbe

  Fixes: a6aa8fca4d79 ("dma-buf/sw-sync: Reduce irqsave/irqrestore from known context")

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Reviewed-by: Christian König <christian.koenig@amd.com>

  Link: https://patchwork.freedesktop.org/patch/msgid/c2e46020-aaa6-4e06-bf73-f05823f913f0@I-love.SAKURA.ne.jp

  Signed-off-by: Christian König <christian.koenig@amd.com>

  '
submodule:
- drivers/dma-buf
hunk_count: 1
covered_count: 1
