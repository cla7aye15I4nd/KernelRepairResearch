id: fae49d997eb56fa7c74d
bug_link: https://syzkaller.appspot.com/bug?extid=fae49d997eb56fa7c74d
title: general protection fault in kernel_sock_shutdown (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: daf63408dd3aa29b24815ea34bc5176f132ca6d1
fix_commit: 10206302af856791fbcc27a33ed3c3eb09b2793d
datetime: '2025-04-02T16:04:19-07:00'
fix_commit_message: "sctp: add mutual exclusion in proc_sctp_do_udp_port()\n\nWe must\
  \ serialize calls to sctp_udp_sock_stop() and sctp_udp_sock_start()\nor risk a crash\
  \ as syzbot reported:\n\nOops: general protection fault, probably for non-canonical\
  \ address 0xdffffc000000000d: 0000 [#1] SMP KASAN PTI\nKASAN: null-ptr-deref in\
  \ range [0x0000000000000068-0x000000000000006f]\nCPU: 1 UID: 0 PID: 6551 Comm: syz.1.44\
  \ Not tainted 6.14.0-syzkaller-g7f2ff7b62617 #0 PREEMPT(full)\nHardware name: Google\
  \ Google Compute Engine/Google Compute Engine, BIOS Google 02/12/2025\n RIP: 0010:kernel_sock_shutdown+0x47/0x70\
  \ net/socket.c:3653\nCall Trace:\n <TASK>\n  udp_tunnel_sock_release+0x68/0x80 net/ipv4/udp_tunnel_core.c:181\n\
  \  sctp_udp_sock_stop+0x71/0x160 net/sctp/protocol.c:930\n  proc_sctp_do_udp_port+0x264/0x450\
  \ net/sctp/sysctl.c:553\n  proc_sys_call_handler+0x3d0/0x5b0 fs/proc/proc_sysctl.c:601\n\
  \  iter_file_splice_write+0x91c/0x1150 fs/splice.c:738\n  do_splice_from fs/splice.c:935\
  \ [inline]\n  direct_splice_actor+0x18f/0x6c0 fs/splice.c:1158\n  splice_direct_to_actor+0x342/0xa30\
  \ fs/splice.c:1102\n  do_splice_direct_actor fs/splice.c:1201 [inline]\n  do_splice_direct+0x174/0x240\
  \ fs/splice.c:1227\n  do_sendfile+0xafd/0xe50 fs/read_write.c:1368\n  __do_sys_sendfile64\
  \ fs/read_write.c:1429 [inline]\n  __se_sys_sendfile64 fs/read_write.c:1415 [inline]\n\
  \  __x64_sys_sendfile64+0x1d8/0x220 fs/read_write.c:1415\n  do_syscall_x64 arch/x86/entry/syscall_64.c:63\
  \ [inline]\n\nFixes: 046c052b475e (\"sctp: enable udp tunneling socks\")\nReported-by:\
  \ syzbot+fae49d997eb56fa7c74d@syzkaller.appspotmail.com\nCloses: https://lore.kernel.org/netdev/67ea5c01.050a0220.1547ec.012b.GAE@google.com/T/#u\n\
  Signed-off-by: Eric Dumazet <edumazet@google.com>\nCc: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>\n\
  Acked-by: Xin Long <lucien.xin@gmail.com>\nLink: https://patch.msgid.link/20250331091532.224982-1-edumazet@google.com\n\
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/sctp
hunk_count: 3
covered_count: 3
