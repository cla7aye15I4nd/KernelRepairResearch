id: df3f3ef31f60781fa911
bug_link: https://syzkaller.appspot.com/bug?extid=df3f3ef31f60781fa911
title: 'BUG: corrupted list in ptp_open'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b714ca2ccf6a90733f6ceb14abb6ce914f8832c3
fix_commit: 1bea2c3e6df8caf45d18384abfb707f47e9ff993
datetime: '2023-11-08T18:47:07-08:00'
fix_commit_message: 'ptp: fix corrupted list in ptp_open


  There is no lock protection when writing ptp->tsevqs in ptp_open() and

  ptp_release(), which can cause data corruption, use spin lock to avoid this

  issue.


  Moreover, ptp_release() should not be used to release the queue in ptp_read(),

  and it should be deleted altogether.


  Acked-by: Richard Cochran <richardcochran@gmail.com>

  Reported-and-tested-by: syzbot+df3f3ef31f60781fa911@syzkaller.appspotmail.com

  Fixes: 8f5de6fb2453 ("ptp: support multiple timestamp event readers")

  Signed-off-by: Edward Adam Davis <eadavis@qq.com>

  Link: https://lore.kernel.org/r/tencent_CD19564FFE8DA8A5918DFE92325D92DD8107@qq.com

  Signed-off-by: Jakub Kicinski <kuba@kernel.org>

  '
submodule:
- drivers/ptp
hunk_count: 8
covered_count: 3
