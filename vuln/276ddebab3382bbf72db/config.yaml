id: 276ddebab3382bbf72db
bug_link: https://syzkaller.appspot.com/bug?extid=276ddebab3382bbf72db
title: WARNING in xt_compat_add_offset
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 91826ba13855f73e252fef68369b3b0e1ed25253
fix_commit: 3b48300d5cc7c7bed63fddb006c4046549ed4aec
datetime: '2019-07-30T13:37:44+02:00'
fix_commit_message: 'netfilter: ebtables: also count base chain policies


  ebtables doesn''t include the base chain policies in the rule count,

  so we need to add them manually when we call into the x_tables core

  to allocate space for the comapt offset table.


  This lead syzbot to trigger:

  WARNING: CPU: 1 PID: 9012 at net/netfilter/x_tables.c:649

  xt_compat_add_offset.cold+0x11/0x36 net/netfilter/x_tables.c:649


  Reported-by: syzbot+276ddebab3382bbf72db@syzkaller.appspotmail.com

  Fixes: 2035f3ff8eaa ("netfilter: ebtables: compat: un-break 32bit setsockopt when
  no rules are present")

  Signed-off-by: Florian Westphal <fw@strlen.de>

  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

  '
submodule:
- net/bridge
hunk_count: 2
covered_count: 1
