id: 7456b5dcf65111553320
bug_link: https://syzkaller.appspot.com/bug?extid=7456b5dcf65111553320
title: 'BUG: unable to handle kernel paging request in ovs_vport_add'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: dafcbce07136d799edc4c67f04f9fd69ff1eac1f
fix_commit: a552bfa16bab4ce901ee721346a28c4e483f4066
datetime: '2023-08-15T19:07:52-07:00'
fix_commit_message: "net: openvswitch: reject negative ifindex\n\nRecent changes in\
  \ net-next (commit 759ab1edb56c (\"net: store netdevs\nin an xarray\")) refactored\
  \ the handling of pre-assigned ifindexes\nand let syzbot surface a latent problem\
  \ in ovs. ovs does not validate\nifindex, making it possible to create netdev ports\
  \ with negative\nifindex values. It's easy to repro with YNL:\n\n$ ./cli.py --spec\
  \ netlink/specs/ovs_datapath.yaml \\\n         --do new \\\n\t --json '{\"upcall-pid\"\
  : 1, \"name\":\"my-dp\"}'\n$ ./cli.py --spec netlink/specs/ovs_vport.yaml \\\n\t\
  \ --do new \\\n\t --json '{\"upcall-pid\": \"00000001\", \"name\": \"some-port0\"\
  , \"dp-ifindex\":3,\"ifindex\":4294901760,\"type\":2}'\n\n$ ip link show\n-65536:\
  \ some-port0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT\
  \ group default qlen 1000\n    link/ether 7a:48:21:ad:0b:fb brd ff:ff:ff:ff:ff:ff\n\
  ...\n\nValidate the inputs. Now the second command correctly returns:\n\n$ ./cli.py\
  \ --spec netlink/specs/ovs_vport.yaml \\\n\t --do new \\\n\t --json '{\"upcall-pid\"\
  : \"00000001\", \"name\": \"some-port0\", \"dp-ifindex\":3,\"ifindex\":4294901760,\"\
  type\":2}'\n\nlib.ynl.NlError: Netlink error: Numerical result out of range\nnl_len\
  \ = 108 (92) nl_flags = 0x300 nl_type = 2\n\terror: -34\textack: {'msg': 'integer\
  \ out of range', 'unknown': [[type:4 len:36] b'\\x0c\\x00\\x02\\x00\\x00\\x00\\\
  x00\\x00\\x00\\x00\\x00\\x00\\x0c\\x00\\x03\\x00\\xff\\xff\\xff\\x7f\\x00\\x00\\\
  x00\\x00\\x08\\x00\\x01\\x00\\x08\\x00\\x00\\x00'], 'bad-attr': '.ifindex'}\n\n\
  Accept 0 since it used to be silently ignored.\n\nFixes: 54c4ef34c4b6 (\"openvswitch:\
  \ allow specifying ifindex of new interfaces\")\nReported-by: syzbot+7456b5dcf65111553320@syzkaller.appspotmail.com\n\
  Reviewed-by: Leon Romanovsky <leonro@nvidia.com>\nReviewed-by: Aaron Conole <aconole@redhat.com>\n\
  Link: https://lore.kernel.org/r/20230814203840.2908710-1-kuba@kernel.org\nSigned-off-by:\
  \ Jakub Kicinski <kuba@kernel.org>\n"
submodule:
- net/openvswitch
hunk_count: 4
covered_count: 1
