id: 2e293dbd67de2836ba42
bug_link: https://syzkaller.appspot.com/bug?extid=2e293dbd67de2836ba42
title: memory leak in ieee80211_check_fast_xmit
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 9bdaf3b91efd229dd272b228e13df10310c80d19
fix_commit: dcd479e10a0510522a5d88b29b8f79ea3467d501
datetime: '2020-10-30T10:05:12+01:00'
fix_commit_message: 'mac80211: always wind down STA state


  When (for example) an IBSS station is pre-moved to AUTHORIZED

  before it''s inserted, and then the insertion fails, we don''t

  clean up the fast RX/TX states that might already have been

  created, since we don''t go through all the state transitions

  again on the way down.


  Do that, if it hasn''t been done already, when the station is

  freed. I considered only freeing the fast TX/RX state there,

  but we might add more state so it''s more robust to wind down

  the state properly.


  Note that we warn if the station was ever inserted, it should

  have been properly cleaned up in that case, and the driver

  will probably not like things happening out of order.


  Reported-by: syzbot+2e293dbd67de2836ba42@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/r/20201009141710.7223b322a955.I95bd08b9ad0e039c034927cce0b75beea38e059b@changeid

  Signed-off-by: Johannes Berg <johannes.berg@intel.com>

  '
submodule:
- net/mac80211
hunk_count: 1
covered_count: 0
