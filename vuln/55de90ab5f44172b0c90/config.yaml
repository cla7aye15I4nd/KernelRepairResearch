id: 55de90ab5f44172b0c90
bug_link: https://syzkaller.appspot.com/bug?extid=55de90ab5f44172b0c90
title: possible deadlock in cma_netdev_callback
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 79db784e794b6e7b7fb9b1dd464a34e4c0c039af
fix_commit: 33fb27fd54465c74cbffba6315b2f043e90cec4c
datetime: '2020-03-04T14:22:46-04:00'
fix_commit_message: 'RDMA/siw: Fix passive connection establishment


  Holding the rtnl_lock while iterating a devices interface address list

  potentially causes deadlocks with the cma_netdev_callback. While this was

  implemented to limit the scope of a wildcard listen to addresses of the

  current device only, a better solution limits the scope of the socket to

  the device. This completely avoiding locking, and also results in

  significant code simplification.


  Fixes: c421651fa229 ("RDMA/siw: Add missing rtnl_lock around access to ifa")

  Link: https://lore.kernel.org/r/20200228173534.26815-1-bmt@zurich.ibm.com

  Reported-by: syzbot+55de90ab5f44172b0c90@syzkaller.appspotmail.com

  Suggested-by: Jason Gunthorpe <jgg@ziepe.ca>

  Signed-off-by: Bernard Metzler <bmt@zurich.ibm.com>

  Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>

  '
submodule:
- drivers/infiniband/sw/siw
hunk_count: 4
covered_count: 1
