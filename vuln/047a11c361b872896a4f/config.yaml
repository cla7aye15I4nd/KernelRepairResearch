id: 047a11c361b872896a4f
bug_link: https://syzkaller.appspot.com/bug?extid=047a11c361b872896a4f
title: 'KMSAN: uninit-value in ip6_compressed_string'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 582549e3fbe137eb6ce9be591aca25c2222a36b4
fix_commit: 7c2bd9a39845bfb6d72ddb55ce737650271f6f96
datetime: '2019-04-11T15:23:48-04:00'
fix_commit_message: 'NFS: Forbid setting AF_INET6 to "struct sockaddr_in"->sin_family.


  syzbot is reporting uninitialized value at rpc_sockaddr2uaddr() [1]. This

  is because syzbot is setting AF_INET6 to "struct sockaddr_in"->sin_family

  (which is embedded into user-visible "struct nfs_mount_data" structure)

  despite nfs23_validate_mount_data() cannot pass sizeof(struct sockaddr_in6)

  bytes of AF_INET6 address to rpc_sockaddr2uaddr().


  Since "struct nfs_mount_data" structure is user-visible, we can''t change

  "struct nfs_mount_data" to use "struct sockaddr_storage". Therefore,

  assuming that everybody is using AF_INET family when passing address via

  "struct nfs_mount_data"->addr, reject if its sin_family is not AF_INET.


  [1] https://syzkaller.appspot.com/bug?id=599993614e7cbbf66bc2656a919ab2a95fb5d75c


  Reported-by: syzbot <syzbot+047a11c361b872896a4f@syzkaller.appspotmail.com>

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>

  '
submodule:
- fs/nfs
hunk_count: 1
covered_count: 0
