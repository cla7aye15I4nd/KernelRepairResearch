id: f7af59df5d6b25f0febd
bug_link: https://syzkaller.appspot.com/bug?extid=f7af59df5d6b25f0febd
title: 'WARNING: ODEBUG bug in ocfs2_local_read_info'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 33b525cef4cff49e216e4133cc48452e11c0391e
fix_commit: 35fccce29feb3706f649726d410122dd81b92c18
datetime: '2024-09-09T15:15:54-07:00'
fix_commit_message: 'ocfs2: cancel dqi_sync_work before freeing oinfo


  ocfs2_global_read_info() will initialize and schedule dqi_sync_work at the

  end, if error occurs after successfully reading global quota, it will

  trigger the following warning with CONFIG_DEBUG_OBJECTS_* enabled:


  ODEBUG: free active (active state 0) object: 00000000d8b0ce28 object type: timer_list
  hint: qsync_work_fn+0x0/0x16c


  This reports that there is an active delayed work when freeing oinfo in

  error handling, so cancel dqi_sync_work first.  BTW, return status instead

  of -1 when .read_file_info fails.


  Link: https://syzkaller.appspot.com/bug?extid=f7af59df5d6b25f0febd

  Link: https://lkml.kernel.org/r/20240904071004.2067695-1-joseph.qi@linux.alibaba.com

  Fixes: 171bf93ce11f ("ocfs2: Periodic quota syncing")

  Signed-off-by: Joseph Qi <joseph.qi@linux.alibaba.com>

  Reviewed-by: Heming Zhao <heming.zhao@suse.com>

  Reported-by: syzbot+f7af59df5d6b25f0febd@syzkaller.appspotmail.com

  Tested-by: syzbot+f7af59df5d6b25f0febd@syzkaller.appspotmail.com

  Cc: Mark Fasheh <mark@fasheh.com>

  Cc: Joel Becker <jlbec@evilplan.org>

  Cc: Junxiao Bi <junxiao.bi@oracle.com>

  Cc: Changwei Ge <gechangwei@live.cn>

  Cc: Gang He <ghe@suse.com>

  Cc: Jun Piao <piaojun@huawei.com>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/ocfs2
hunk_count: 4
covered_count: 1
