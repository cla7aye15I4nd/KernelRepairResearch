id: 2d4f8693f438d2bd4bdb
bug_link: https://syzkaller.appspot.com/bug?extid=2d4f8693f438d2bd4bdb
title: kernel BUG in vmf_insert_pfn_prot
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: db8496d0b50519540e1ee50f7e209b3a536ed671
fix_commit: a5b44c4adb1699661d22e5152fb26885f30a2e4c
datetime: '2023-03-22T13:32:46+01:00'
fix_commit_message: 'drm/fbdev-generic: Always use shadow buffering


  Remove all codepaths that implement fbdev output directly on GEM

  buffers. Always allocate a shadow buffer in system memory and set

  up deferred I/O for mmap.


  The fbdev code that operated directly on GEM buffers was used by

  drivers based on GEM DMA helpers. Those drivers have been migrated

  to use fbdev-dma, a dedicated fbdev emulation for DMA memory. All

  remaining users of fbdev-generic require shadow buffering.


  Memory management of the remaining callers uses TTM, GEM SHMEM

  helpers or a variant of GEM DMA helpers that is incompatible with

  fbdev-dma. Therefore remove the unused codepaths from fbdev-generic

  and simplify the code.


  Using a shadow buffer with deferred I/O is probably the best case

  for most remaining callers. Some of the TTM-based drivers might

  benefit from a dedicated fbdev emulation that operates directly on

  the driver''s video memory.


  Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>

  Reviewed-by: Javier Martinez Canillas <javierm@redhat.com>

  Acked-by: Zack Rusin <zackr@vmware.com>

  Tested-by: Sui Jingfeng <suijingfeng@loongson.cn>

  Link: https://patchwork.freedesktop.org/patch/msgid/20230320150751.20399-2-tzimmermann@suse.de

  '
submodule:
- drivers/gpu/drm
hunk_count: 6
covered_count: 0
