id: ab4dae63f7d310641ded
bug_link: https://syzkaller.appspot.com/bug?extid=ab4dae63f7d310641ded
title: 'WARNING: kobject bug in add_one_compat_dev'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7aefa6237cfe4a6fcf06a8656eee988b36f8fefc
fix_commit: f2f2b3bbf0d9f8d090b9a019679223b2bd1c66c4
datetime: '2020-03-13T10:30:11-03:00'
fix_commit_message: "RDMA/core: Fix missing error check on dev_set_name()\n\nIf name\
  \ memory allocation fails the name will be left empty and\ndevice_add_one() will\
  \ crash:\n\n  kobject: (0000000004952746): attempted to be registered with empty\
  \ name!\n  WARNING: CPU: 0 PID: 329 at lib/kobject.c:234 kobject_add_internal+0x7ac/0x9a0\
  \ lib/kobject.c:234\n  Kernel panic - not syncing: panic_on_warn set ...\n  CPU:\
  \ 0 PID: 329 Comm: syz-executor.5 Not tainted 5.6.0-rc2-syzkaller #0\n  Hardware\
  \ name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\n\
  \  Call Trace:\n   __dump_stack lib/dump_stack.c:77 [inline]\n   dump_stack+0x197/0x210\
  \ lib/dump_stack.c:118\n   panic+0x2e3/0x75c kernel/panic.c:221\n   __warn.cold+0x2f/0x3e\
  \ kernel/panic.c:582\n   report_bug+0x289/0x300 lib/bug.c:195\n   fixup_bug arch/x86/kernel/traps.c:174\
  \ [inline]\n   fixup_bug arch/x86/kernel/traps.c:169 [inline]\n   do_error_trap+0x11b/0x200\
  \ arch/x86/kernel/traps.c:267\n   do_invalid_op+0x37/0x50 arch/x86/kernel/traps.c:286\n\
  \   invalid_op+0x23/0x30 arch/x86/entry/entry_64.S:1027\n  RIP: 0010:kobject_add_internal+0x7ac/0x9a0\
  \ lib/kobject.c:234\n  Code: 1a 98 ca f9 e9 f0 f8 ff ff 4c 89 f7 e8 6d 98 ca f9\
  \ e9 95 f9 ff ff e8 c3 f0 8b f9 4c 89 e6 48 c7 c7 a0 0e 1a 89 e8 e3 41 5c f9 <0f>\
  \ 0b 41 bd ea ff ff ff e9 52 ff ff ff e8 a2 f0 8b f9 0f 0b e8 9b\n  RSP: 0018:ffffc90005b27908\
  \ EFLAGS: 00010286\n  RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000\n\
  \  RDX: 0000000000040000 RSI: ffffffff815eae46 RDI: fffff52000b64f13\n  RBP: ffffc90005b27960\
  \ R08: ffff88805aeba480 R09: ffffed1015d06659\n  R10: ffffed1015d06658 R11: ffff8880ae8332c7\
  \ R12: ffff8880a37fd000\n  R13: 0000000000000000 R14: ffff888096691780 R15: 0000000000000001\n\
  \   kobject_add_varg lib/kobject.c:390 [inline]\n   kobject_add+0x150/0x1c0 lib/kobject.c:442\n\
  \   device_add+0x3be/0x1d00 drivers/base/core.c:2412\n   add_one_compat_dev drivers/infiniband/core/device.c:901\
  \ [inline]\n   add_one_compat_dev+0x46a/0x7e0 drivers/infiniband/core/device.c:857\n\
  \   rdma_dev_init_net+0x2eb/0x490 drivers/infiniband/core/device.c:1120\n   ops_init+0xb3/0x420\
  \ net/core/net_namespace.c:137\n   setup_net+0x2d5/0x8b0 net/core/net_namespace.c:327\n\
  \   copy_net_ns+0x29e/0x5a0 net/core/net_namespace.c:468\n   create_new_namespaces+0x403/0xb50\
  \ kernel/nsproxy.c:108\n   unshare_nsproxy_namespaces+0xc2/0x200 kernel/nsproxy.c:229\n\
  \   ksys_unshare+0x444/0x980 kernel/fork.c:2955\n   __do_sys_unshare kernel/fork.c:3023\
  \ [inline]\n   __se_sys_unshare kernel/fork.c:3021 [inline]\n   __x64_sys_unshare+0x31/0x40\
  \ kernel/fork.c:3021\n   do_syscall_64+0xfa/0x790 arch/x86/entry/common.c:294\n\
  \   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nLink: https://lore.kernel.org/r/20200309193200.GA10633@ziepe.ca\n\
  Cc: stable@kernel.org\nFixes: 4e0f7b907072 (\"RDMA/core: Implement compat device/sysfs\
  \ tree in net namespace\")\nReported-by: syzbot+ab4dae63f7d310641ded@syzkaller.appspotmail.com\n\
  Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>\n"
submodule:
- drivers/infiniband/core
hunk_count: 1
covered_count: 1
