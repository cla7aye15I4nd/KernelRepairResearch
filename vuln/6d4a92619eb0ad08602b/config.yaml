id: 6d4a92619eb0ad08602b
bug_link: https://syzkaller.appspot.com/bug?extid=6d4a92619eb0ad08602b
title: WARNING in __kthread_bind_mask
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 4443f8e6ac7755cd775c70d08be8042dc2f936cb
fix_commit: 06058632464845abb1af91521122fd04dd3daaec
datetime: '2019-04-13T19:08:22-06:00'
fix_commit_message: "io_uring: park SQPOLL thread if it's percpu\n\nkthread expects\
  \ this, or we can throw a warning on exit:\n\nWARNING: CPU: 0 PID: 7822 at kernel/kthread.c:399\n\
  __kthread_bind_mask+0x3b/0xc0 kernel/kthread.c:399\nKernel panic - not syncing:\
  \ panic_on_warn set ...\nCPU: 0 PID: 7822 Comm: syz-executor030 Not tainted 5.1.0-rc4-next-20190412\n\
  Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS\nGoogle\
  \ 01/01/2011\nCall Trace:\n  __dump_stack lib/dump_stack.c:77 [inline]\n  dump_stack+0x172/0x1f0\
  \ lib/dump_stack.c:113\n  panic+0x2cb/0x72b kernel/panic.c:214\n  __warn.cold+0x20/0x46\
  \ kernel/panic.c:576\n  report_bug+0x263/0x2b0 lib/bug.c:186\n  fixup_bug arch/x86/kernel/traps.c:179\
  \ [inline]\n  fixup_bug arch/x86/kernel/traps.c:174 [inline]\n  do_error_trap+0x11b/0x200\
  \ arch/x86/kernel/traps.c:272\n  do_invalid_op+0x37/0x50 arch/x86/kernel/traps.c:291\n\
  \  invalid_op+0x14/0x20 arch/x86/entry/entry_64.S:973\nRIP: 0010:__kthread_bind_mask+0x3b/0xc0\
  \ kernel/kthread.c:399\nCode: 48 89 fb e8 f7 ab 24 00 4c 89 e6 48 89 df e8 ac e1\
  \ 02 00 31 ff 49 89\nc4 48 89 c6 e8 7f ad 24 00 4d 85 e4 75 15 e8 d5 ab 24 00 <0f>\
  \ 0b e8 ce ab\n24 00 5b 41 5c 41 5d 41 5e 5d c3 e8 c0 ab 24 00 4c\nRSP: 0018:ffff8880a89bfbb8\
  \ EFLAGS: 00010293\nRAX: ffff88808ca7a280 RBX: ffff8880a98e4380 RCX: ffffffff814bdd11\n\
  RDX: 0000000000000000 RSI: ffffffff814bdd1b RDI: 0000000000000007\nRBP: ffff8880a89bfbd8\
  \ R08: ffff88808ca7a280 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000000\
  \ R12: 0000000000000000\nR13: ffffffff87691148 R14: ffff8880a98e43a0 R15: ffffffff81c91e10\n\
  \  __kthread_bind kernel/kthread.c:412 [inline]\n  kthread_unpark+0x123/0x160 kernel/kthread.c:480\n\
  \  kthread_stop+0xfa/0x6c0 kernel/kthread.c:556\n  io_sq_thread_stop fs/io_uring.c:2057\
  \ [inline]\n  io_sq_thread_stop fs/io_uring.c:2052 [inline]\n  io_finish_async+0xab/0x180\
  \ fs/io_uring.c:2064\n  io_ring_ctx_free fs/io_uring.c:2534 [inline]\n  io_ring_ctx_wait_and_kill+0x133/0x510\
  \ fs/io_uring.c:2591\n  io_uring_release+0x42/0x50 fs/io_uring.c:2599\n  __fput+0x2e5/0x8d0\
  \ fs/file_table.c:278\n  ____fput+0x16/0x20 fs/file_table.c:309\n  task_work_run+0x14a/0x1c0\
  \ kernel/task_work.c:113\n  exit_task_work include/linux/task_work.h:22 [inline]\n\
  \  do_exit+0x90a/0x2fa0 kernel/exit.c:876\n  do_group_exit+0x135/0x370 kernel/exit.c:980\n\
  \  __do_sys_exit_group kernel/exit.c:991 [inline]\n  __se_sys_exit_group kernel/exit.c:989\
  \ [inline]\n  __x64_sys_exit_group+0x44/0x50 kernel/exit.c:989\n  do_syscall_64+0x103/0x610\
  \ arch/x86/entry/common.c:290\n  entry_SYSCALL_64_after_hwframe+0x49/0xbe\n\nReported-by:\
  \ syzbot+6d4a92619eb0ad08602b@syzkaller.appspotmail.com\nFixes: 6c271ce2f1d5 (\"\
  io_uring: add submission polling\")\nSigned-off-by: Jens Axboe <axboe@kernel.dk>\n"
submodule:
- fs
hunk_count: 2
covered_count: 1
