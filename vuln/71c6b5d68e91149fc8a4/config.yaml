id: 71c6b5d68e91149fc8a4
bug_link: https://syzkaller.appspot.com/bug?extid=71c6b5d68e91149fc8a4
title: 'WARNING: kmalloc bug in bfs_fill_super'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6f0483d1f91b612186abeaebf3ce43bf805eb9f7
fix_commit: 9f2df09a33aa2c76ce6385d382693f98d7f2f07e
datetime: '2018-11-03T10:09:38-07:00'
fix_commit_message: 'bfs: add sanity check at bfs_fill_super()


  syzbot is reporting too large memory allocation at bfs_fill_super() [1].

  Since file system image is corrupted such that bfs_sb->s_start == 0,

  bfs_fill_super() is trying to allocate 8MB of continuous memory. Fix

  this by adding a sanity check on bfs_sb->s_start, __GFP_NOWARN and

  printf().


  [1] https://syzkaller.appspot.com/bug?id=16a87c236b951351374a84c8a32f40edbc034e96


  Link: http://lkml.kernel.org/r/1525862104-3407-1-git-send-email-penguin-kernel@I-love.SAKURA.ne.jp

  Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>

  Reported-by: syzbot <syzbot+71c6b5d68e91149fc8a4@syzkaller.appspotmail.com>

  Reviewed-by: Andrew Morton <akpm@linux-foundation.org>

  Cc: Tigran Aivazian <aivazian.tigran@gmail.com>

  Cc: Matthew Wilcox <willy@infradead.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

  '
submodule:
- fs/bfs
hunk_count: 2
covered_count: 2
