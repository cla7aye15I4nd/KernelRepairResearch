id: 4da3ff23081bafe74fc2
bug_link: https://syzkaller.appspot.com/bug?extid=4da3ff23081bafe74fc2
title: WARNING in __mark_chain_precision
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 327835fb1e838c7098731899ec76aba912edddf1
fix_commit: b3b50f05dc501cc2cd90349a7bbfd932af0ceb31
datetime: '2019-07-12T14:48:52+02:00'
fix_commit_message: 'bpf: fix precision bit propagation for BPF_ST instructions


  When backtracking instructions to propagate precision bit for registers

  and stack slots, one class of instructions (BPF_ST) weren''t handled

  causing extra stack slots to be propagated into parent state. Parent

  state might not have that much stack allocated, though, which causes

  warning on invalid stack slot usage.


  This patch adds handling of BPF_ST instructions:


  BPF_MEM | <size> | BPF_ST:   *(size *) (dst_reg + off) = imm32


  Reported-by: syzbot+4da3ff23081bafe74fc2@syzkaller.appspotmail.com

  Fixes: b5dc0163d8fd ("bpf: precise scalar_value tracking")

  Cc: Alexei Starovoitov <ast@fb.com>

  Signed-off-by: Andrii Nakryiko <andriin@fb.com>

  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>

  '
submodule:
- kernel/bpf
hunk_count: 3
covered_count: 0
