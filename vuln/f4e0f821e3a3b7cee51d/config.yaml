id: f4e0f821e3a3b7cee51d
bug_link: https://syzkaller.appspot.com/bug?extid=f4e0f821e3a3b7cee51d
title: general protection fault in sctp_inet_listen
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: c6929644c1e0d6108e57061d427eb966e1746351
fix_commit: 8beee4d8dee76b67c75dc91fd8185d91e845c160
datetime: '2024-10-03T12:18:29+02:00'
fix_commit_message: "sctp: set sk_state back to CLOSED if autobind fails in sctp_listen_start\n\
  \nIn sctp_listen_start() invoked by sctp_inet_listen(), it should set the\nsk_state\
  \ back to CLOSED if sctp_autobind() fails due to whatever reason.\n\nOtherwise,\
  \ next time when calling sctp_inet_listen(), if sctp_sk(sk)->reuse\nis already set\
  \ via setsockopt(SCTP_REUSE_PORT), sctp_sk(sk)->bind_hash will\nbe dereferenced\
  \ as sk_state is LISTENING, which causes a crash as bind_hash\nis NULL.\n\n  KASAN:\
  \ null-ptr-deref in range [0x0000000000000000-0x0000000000000007]\n  RIP: 0010:sctp_inet_listen+0x7f0/0xa20\
  \ net/sctp/socket.c:8617\n  Call Trace:\n   <TASK>\n   __sys_listen_socket net/socket.c:1883\
  \ [inline]\n   __sys_listen+0x1b7/0x230 net/socket.c:1894\n   __do_sys_listen net/socket.c:1902\
  \ [inline]\n\nFixes: 5e8f3f703ae4 (\"sctp: simplify sctp listening code\")\nReported-by:\
  \ syzbot+f4e0f821e3a3b7cee51d@syzkaller.appspotmail.com\nSigned-off-by: Xin Long\
  \ <lucien.xin@gmail.com>\nAcked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>\n\
  Link: https://patch.msgid.link/a93e655b3c153dc8945d7a812e6d8ab0d52b7aa0.1727729391.git.lucien.xin@gmail.com\n\
  Signed-off-by: Paolo Abeni <pabeni@redhat.com>\n\n"
submodule:
- net/sctp
hunk_count: 1
covered_count: 0
