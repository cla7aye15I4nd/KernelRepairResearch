id: 57e3e98f7e3b80f64d56
bug_link: https://syzkaller.appspot.com/bug?extid=57e3e98f7e3b80f64d56
title: 'KASAN: use-after-free Read in hfsplus_release_folio'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b905039e428d639adeebb719b76f98865ea38d4d
fix_commit: 07db5e247ab5858439b14dd7cc1fe538b9efcf32
datetime: '2023-03-02T21:54:23-08:00'
fix_commit_message: 'fs: hfsplus: fix UAF issue in hfsplus_put_super


  The current hfsplus_put_super first calls hfs_btree_close on

  sbi->ext_tree, then invokes iput on sbi->hidden_dir, resulting in an

  use-after-free issue in hfsplus_release_folio.


  As shown in hfsplus_fill_super, the error handling code also calls iput

  before hfs_btree_close.


  To fix this error, we move all iput calls before hfsplus_btree_close.


  Note that this patch is tested on Syzbot.


  Link: https://lkml.kernel.org/r/20230226124948.3175736-1-mudongliangabcd@gmail.com

  Reported-by: syzbot+57e3e98f7e3b80f64d56@syzkaller.appspotmail.com

  Tested-by: Dongliang Mu <mudongliangabcd@gmail.com>

  Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>

  Cc: Bart Van Assche <bvanassche@acm.org>

  Cc: Jens Axboe <axboe@kernel.dk>

  Cc: Muchun Song <songmuchun@bytedance.com>

  Cc: Roman Gushchin <roman.gushchin@linux.dev>

  Cc: "Theodore Ts''o" <tytso@mit.edu>

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>

  '
submodule:
- fs/hfsplus
hunk_count: 1
covered_count: 1
