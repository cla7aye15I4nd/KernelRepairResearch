id: 5702f46b5b22bdb38b7e
bug_link: https://syzkaller.appspot.com/bug?extid=5702f46b5b22bdb38b7e
title: 'riscv/fixes boot error: WARNING in __apply_to_page_range (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cd0334e1c091fc0263ccf76e81d333a2ece4f3ab
fix_commit: 96f9d4daf745205fe869e9e5ac23199ef11c5448
datetime: '2023-04-19T07:24:50-07:00'
fix_commit_message: 'riscv: Rework kasan population functions


  Our previous kasan population implementation used to have the final kasan

  shadow region mapped with kasan_early_shadow_page, because we did not clean

  the early mapping and then we had to populate the kasan region "in-place"

  which made the code cumbersome.


  So now we clear the early mapping, establish a temporary mapping while we

  populate the kasan shadow region with just the kernel regions that will

  be used.


  This new version uses the "generic" way of going through a page table

  that may be folded at runtime (avoid the XXX_next macros).


  It was tested with outline instrumentation on an Ubuntu kernel

  configuration successfully.


  Signed-off-by: Alexandre Ghiti <alexghiti@rivosinc.com>

  Reviewed-by: Björn Töpel <bjorn@rivosinc.com>

  Link: https://lore.kernel.org/r/20230203075232.274282-3-alexghiti@rivosinc.com

  Signed-off-by: Palmer Dabbelt <palmer@rivosinc.com>

  '
submodule:
- arch/riscv/mm
hunk_count: 10
covered_count: 0
