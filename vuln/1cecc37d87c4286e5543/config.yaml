id: 1cecc37d87c4286e5543
bug_link: https://syzkaller.appspot.com/bug?extid=1cecc37d87c4286e5543
title: general protection fault in bch2_fs_recovery
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: abb43dd677f3c5508dc369a61f82f89a8b16b811
fix_commit: 025c55a4c7f11ea38521c6e797f3192ad8768c93
datetime: '2024-09-21T11:39:49-04:00'
fix_commit_message: 'bcachefs: return err ptr instead of null in read sb clean


  syzbot reported a null-ptr-deref in bch2_fs_start. [0]


  When a sb is marked clear but doesn''t have a clean section

  bch2_read_superblock_clean returns NULL which PTR_ERR_OR_ZERO

  lets through, eventually leading to a null ptr dereference down

  the line. Adjust read sb clean to return an ERR_PTR indicating the

  invalid clean section.


  [0] https://syzkaller.appspot.com/bug?extid=1cecc37d87c4286e5543


  Reported-by: syzbot+1cecc37d87c4286e5543@syzkaller.appspotmail.com

  Closes: https://syzkaller.appspot.com/bug?extid=1cecc37d87c4286e5543

  Signed-off-by: Diogo Jahchan Koike <djahchankoike@gmail.com>

  Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

  '
submodule:
- fs/bcachefs
hunk_count: 1
covered_count: 0
