id: 15ec7391f3d6a1a7cc7d
bug_link: https://syzkaller.appspot.com/bug?extid=15ec7391f3d6a1a7cc7d
title: WARNING in qp_broker_alloc
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: b2c852f490e086e0683d929d8eb75ccae068bd7b
fix_commit: 2fd10bcf0310b9525b2af9e1f7aa9ddd87c3772e
datetime: '2021-02-09T12:22:32+01:00'
fix_commit_message: "drivers/misc/vmw_vmci: restrict too big queue size in qp_host_alloc_queue\n\
  \nsyzbot found WARNING in qp_broker_alloc[1] in qp_host_alloc_queue()\nwhen num_pages\
  \ is 0x100001, giving queue_size + queue_page_size\nbigger than KMALLOC_MAX_SIZE\
  \ for kzalloc(), resulting order >= MAX_ORDER\ncondition.\n\nqueue_size + queue_page_size=0x8000d8,\
  \ where KMALLOC_MAX_SIZE=0x400000.\n\n[1]\nCall Trace:\n alloc_pages include/linux/gfp.h:547\
  \ [inline]\n kmalloc_order+0x40/0x130 mm/slab_common.c:837\n kmalloc_order_trace+0x15/0x70\
  \ mm/slab_common.c:853\n kmalloc_large include/linux/slab.h:481 [inline]\n __kmalloc+0x257/0x330\
  \ mm/slub.c:3959\n kmalloc include/linux/slab.h:557 [inline]\n kzalloc include/linux/slab.h:682\
  \ [inline]\n qp_host_alloc_queue drivers/misc/vmw_vmci/vmci_queue_pair.c:540 [inline]\n\
  \ qp_broker_create drivers/misc/vmw_vmci/vmci_queue_pair.c:1351 [inline]\n qp_broker_alloc+0x936/0x2740\
  \ drivers/misc/vmw_vmci/vmci_queue_pair.c:1739\n\nReported-by: syzbot+15ec7391f3d6a1a7cc7d@syzkaller.appspotmail.com\n\
  Signed-off-by: Sabyrzhan Tasbolatov <snovitoll@gmail.com>\nLink: https://lore.kernel.org/r/20210209102612.2112247-1-snovitoll@gmail.com\n\
  Cc: stable <stable@vger.kernel.org>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n"
submodule:
- drivers/misc/vmw_vmci
hunk_count: 1
covered_count: 1
