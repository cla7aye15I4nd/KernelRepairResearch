id: e9cd3122a37c5d6c51e8
bug_link: https://syzkaller.appspot.com/bug?extid=e9cd3122a37c5d6c51e8
title: general protection fault in udmabuf_create
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 83326a73a1f2933295d30667ab4996b1b1099708
fix_commit: b9770b0b6eac2be3772b6f4748e6b899a9ab2870
datetime: '2021-08-12T09:27:22+02:00'
fix_commit_message: 'udmabuf: fix general protection fault in udmabuf_create


  Syzbot reported general protection fault in udmabuf_create. The problem

  was in wrong error handling.


  In commit 16c243e99d33 ("udmabuf: Add support for mapping hugepages (v4)")

  shmem_read_mapping_page() call was replaced with find_get_page_flags(),

  but find_get_page_flags() returns NULL on failure instead PTR_ERR().


  Wrong error checking was causing GPF in get_page(), since passed page

  was equal to NULL. Fix it by changing if (IS_ER(!hpage)) to if (!hpage)


  Reported-by: syzbot+e9cd3122a37c5d6c51e8@syzkaller.appspotmail.com

  Fixes: 16c243e99d33 ("udmabuf: Add support for mapping hugepages (v4)")

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Link: http://patchwork.freedesktop.org/patch/msgid/20210811175052.21254-1-paskripkin@gmail.com

  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

  '
submodule:
- drivers/dma-buf
hunk_count: 1
covered_count: 1
