id: c95173762127ad76a824
bug_link: https://syzkaller.appspot.com/bug?extid=c95173762127ad76a824
title: general protection fault in ntfs_update_mftmirr
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: e4d2f4fd5341064d2b3c5158da69421a581e7ec1
fix_commit: 321460ca3b55f48b3ba6008248264ab2bd6407d9
datetime: '2022-07-05T16:07:46+03:00'
fix_commit_message: "fs/ntfs3: Fix NULL deref in ntfs_update_mftmirr\n\nIf ntfs_fill_super()\
  \ wasn't called then sbi->sb will be equal to NULL.\nCode should check this ptr\
  \ before dereferencing. Syzbot hit this issue\nvia passing wrong mount param as\
  \ can be seen from log below\n\nFail log:\nntfs3: Unknown parameter 'iochvrset'\n\
  general protection fault, probably for non-canonical address 0xdffffc0000000003:\
  \ 0000 [#1] PREEMPT SMP KASAN\nKASAN: null-ptr-deref in range [0x0000000000000018-0x000000000000001f]\n\
  CPU: 1 PID: 3589 Comm: syz-executor210 Not tainted 5.18.0-rc3-syzkaller-00016-gb253435746d9\
  \ #0\n...\nCall Trace:\n <TASK>\n put_ntfs+0x1ed/0x2a0 fs/ntfs3/super.c:463\n ntfs_fs_free+0x6a/0xe0\
  \ fs/ntfs3/super.c:1363\n put_fs_context+0x119/0x7a0 fs/fs_context.c:469\n do_new_mount+0x2b4/0xad0\
  \ fs/namespace.c:3044\n do_mount fs/namespace.c:3383 [inline]\n __do_sys_mount fs/namespace.c:3591\
  \ [inline]\n\nFixes: 82cae269cfa9 (\"fs/ntfs3: Add initialization of super block\"\
  )\nReported-and-tested-by: syzbot+c95173762127ad76a824@syzkaller.appspotmail.com\n\
  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>\nSigned-off-by: Konstantin\
  \ Komarov <almaz.alexandrovich@paragon-software.com>\n"
submodule:
- fs/ntfs3
hunk_count: 1
covered_count: 1
