id: 05017ad275a64a3246f8
bug_link: https://syzkaller.appspot.com/bug?extid=05017ad275a64a3246f8
title: 'BUG: spinlock bad magic in synchronize_srcu'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: cd36ae8761775e78154ba6bd7a3bd2ab538c589f
fix_commit: eb7511bf9182292ef1df1082d23039e856d1ddfb
datetime: '2021-09-22T10:33:09-04:00'
fix_commit_message: 'KVM: x86: Handle SRCU initialization failure during page track
  init


  Check the return of init_srcu_struct(), which can fail due to OOM, when

  initializing the page track mechanism.  Lack of checking leads to a NULL

  pointer deref found by a modified syzkaller.


  Reported-by: TCS Robot <tcs_robot@tencent.com>

  Signed-off-by: Haimin Zhang <tcs_kernel@tencent.com>

  Message-Id: <1630636626-12262-1-git-send-email-tcs_kernel@tencent.com>

  [Move the call towards the beginning of kvm_arch_init_vm. - Paolo]

  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

  '
submodule:
- arch/x86/include/asm
- arch/x86/kvm
- arch/x86/kvm/mmu
hunk_count: 4
covered_count: 0
