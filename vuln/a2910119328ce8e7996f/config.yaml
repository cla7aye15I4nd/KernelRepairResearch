id: a2910119328ce8e7996f
bug_link: https://syzkaller.appspot.com/bug?extid=a2910119328ce8e7996f
title: 'WARNING: refcount bug in __io_queue_sqe'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 50b7b6f29de3e18e9d6c09641256a0296361cfee
fix_commit: a298232ee6b9a1d5d732aa497ff8be0d45b5bd82
datetime: '2021-05-08T22:11:49-06:00'
fix_commit_message: "io_uring: fix link timeout refs\n\nWARNING: CPU: 0 PID: 10242\
  \ at lib/refcount.c:28 refcount_warn_saturate+0x15b/0x1a0 lib/refcount.c:28\nRIP:\
  \ 0010:refcount_warn_saturate+0x15b/0x1a0 lib/refcount.c:28\nCall Trace:\n __refcount_sub_and_test\
  \ include/linux/refcount.h:283 [inline]\n __refcount_dec_and_test include/linux/refcount.h:315\
  \ [inline]\n refcount_dec_and_test include/linux/refcount.h:333 [inline]\n io_put_req\
  \ fs/io_uring.c:2140 [inline]\n io_queue_linked_timeout fs/io_uring.c:6300 [inline]\n\
  \ __io_queue_sqe+0xbef/0xec0 fs/io_uring.c:6354\n io_submit_sqe fs/io_uring.c:6534\
  \ [inline]\n io_submit_sqes+0x2bbd/0x7c50 fs/io_uring.c:6660\n __do_sys_io_uring_enter\
  \ fs/io_uring.c:9240 [inline]\n __se_sys_io_uring_enter+0x256/0x1d60 fs/io_uring.c:9182\n\
  \nio_link_timeout_fn() should put only one reference of the linked timeout\nrequest,\
  \ however in case of racing with the master request's completion\nfirst io_req_complete()\
  \ puts one and then io_put_req_deferred() is\ncalled.\n\nCc: stable@vger.kernel.org\
  \ # 5.12+\nFixes: 9ae1f8dd372e0 (\"io_uring: fix inconsistent lock state\")\nReported-by:\
  \ syzbot+a2910119328ce8e7996f@syzkaller.appspotmail.com\nSigned-off-by: Pavel Begunkov\
  \ <asml.silence@gmail.com>\nLink: https://lore.kernel.org/r/ff51018ff29de5ffa76f09273ef48cb24c720368.1620417627.git.asml.silence@gmail.com\n\
  Signed-off-by: Jens Axboe <axboe@kernel.dk>\n"
submodule:
- fs
hunk_count: 1
covered_count: 1
