id: c52ab18308964d248092
bug_link: https://syzkaller.appspot.com/bug?extid=c52ab18308964d248092
title: 'INFO: task hung in hwrng_fillfn'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 01d70a4bbff20ea05cadb4c208841985a7cc6596
fix_commit: 78aafb3884f6bc6636efcc1760c891c8500b9922
datetime: '2023-12-08T11:59:45+08:00'
fix_commit_message: 'hwrng: core - Fix page fault dead lock on mmap-ed hwrng


  There is a dead-lock in the hwrng device read path.  This triggers

  when the user reads from /dev/hwrng into memory also mmap-ed from

  /dev/hwrng.  The resulting page fault triggers a recursive read

  which then dead-locks.


  Fix this by using a stack buffer when calling copy_to_user.


  Reported-by: Edward Adam Davis <eadavis@qq.com>

  Reported-by: syzbot+c52ab18308964d248092@syzkaller.appspotmail.com

  Fixes: 9996508b3353 ("hwrng: core - Replace u32 in driver API with byte array")

  Cc: <stable@vger.kernel.org>

  Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

  '
submodule:
- drivers/char/hw_random
hunk_count: 5
covered_count: 5
