id: ebea2790904673d7c618
bug_link: https://syzkaller.appspot.com/bug?extid=ebea2790904673d7c618
title: kernel BUG in f2fs_evict_inode (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: fccaa81de87e80b1809906f7e438e5766fbdc172
fix_commit: 884ee6dc85b959bc152f15bca80c30f06069e6c4
datetime: '2024-09-11T03:30:27+00:00'
fix_commit_message: "f2fs: get rid of online repaire on corrupted directory\n\nsyzbot\
  \ reports a f2fs bug as below:\n\nkernel BUG at fs/f2fs/inode.c:896!\nRIP: 0010:f2fs_evict_inode+0x1598/0x15c0\
  \ fs/f2fs/inode.c:896\nCall Trace:\n evict+0x532/0x950 fs/inode.c:704\n dispose_list\
  \ fs/inode.c:747 [inline]\n evict_inodes+0x5f9/0x690 fs/inode.c:797\n generic_shutdown_super+0x9d/0x2d0\
  \ fs/super.c:627\n kill_block_super+0x44/0x90 fs/super.c:1696\n kill_f2fs_super+0x344/0x690\
  \ fs/f2fs/super.c:4898\n deactivate_locked_super+0xc4/0x130 fs/super.c:473\n cleanup_mnt+0x41f/0x4b0\
  \ fs/namespace.c:1373\n task_work_run+0x24f/0x310 kernel/task_work.c:228\n ptrace_notify+0x2d2/0x380\
  \ kernel/signal.c:2402\n ptrace_report_syscall include/linux/ptrace.h:415 [inline]\n\
  \ ptrace_report_syscall_exit include/linux/ptrace.h:477 [inline]\n syscall_exit_work+0xc6/0x190\
  \ kernel/entry/common.c:173\n syscall_exit_to_user_mode_prepare kernel/entry/common.c:200\
  \ [inline]\n __syscall_exit_to_user_mode_work kernel/entry/common.c:205 [inline]\n\
  \ syscall_exit_to_user_mode+0x279/0x370 kernel/entry/common.c:218\n do_syscall_64+0x100/0x230\
  \ arch/x86/entry/common.c:89\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\nRIP: 0010:f2fs_evict_inode+0x1598/0x15c0\
  \ fs/f2fs/inode.c:896\n\nOnline repaire on corrupted directory in f2fs_lookup()\
  \ can generate\ndirty data/meta while racing w/ readonly remount, it may leave dirty\n\
  inode after filesystem becomes readonly, however, checkpoint() will\nskips flushing\
  \ dirty inode in a state of readonly mode, result in\nabove panic.\n\nLet's get\
  \ rid of online repaire in f2fs_lookup(), and leave the work\nto fsck.f2fs.\n\n\
  Fixes: 510022a85839 (\"f2fs: add F2FS_INLINE_DOTS to recover missing dot dentries\"\
  )\nReported-by: syzbot+ebea2790904673d7c618@syzkaller.appspotmail.com\nCloses: https://lore.kernel.org/all/000000000000a7b20f061ff2d56a@google.com\n\
  Signed-off-by: Chao Yu <chao@kernel.org>\nSigned-off-by: Jaegeuk Kim <jaegeuk@kernel.org>\n"
submodule:
- fs/f2fs
- include/linux
hunk_count: 9
covered_count: 0
