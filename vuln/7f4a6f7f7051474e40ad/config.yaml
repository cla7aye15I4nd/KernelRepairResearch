id: 7f4a6f7f7051474e40ad
bug_link: https://syzkaller.appspot.com/bug?extid=7f4a6f7f7051474e40ad
title: 'WARNING: locking bug in ext4_move_extents'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0784181b44af831a3fa52e1e5ff77c388d699dba
fix_commit: d7fe143cb115076fed0126ad8cf5ba6c3e575e43
datetime: '2024-10-17T20:07:23-07:00'
fix_commit_message: 'locking/lockdep: Avoid creating new name string literals in lockdep_set_subclass()


  Syzbot reports a problem that a warning will be triggered while

  searching a lock class in look_up_lock_class().


  The cause of the issue is that a new name is created and used by

  lockdep_set_subclass() instead of using the existing one. This results

  in a lock instance has a different name pointer than previous registered

  one stored in lock class, and WARN_ONCE() is triggered because of that

  in look_up_lock_class().


  To fix this, change lockdep_set_subclass() to use the existing name

  instead of a new one. Hence, no new name will be created by

  lockdep_set_subclass(). Hence, the warning is avoided.


  [boqun: Reword the commit log to state the correct issue]


  Reported-by: <syzbot+7f4a6f7f7051474e40ad@syzkaller.appspotmail.com>

  Fixes: de8f5e4f2dc1f ("lockdep: Introduce wait-type checks")

  Cc: stable@vger.kernel.org

  Signed-off-by: Ahmed Ehab <bottaawesome633@gmail.com>

  Signed-off-by: Boqun Feng <boqun.feng@gmail.com>

  Link: https://lore.kernel.org/lkml/20240824221031.7751-1-bottaawesome633@gmail.com/

  '
submodule:
- include/linux
hunk_count: 1
covered_count: 0
