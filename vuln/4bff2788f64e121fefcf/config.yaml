id: 4bff2788f64e121fefcf
bug_link: https://syzkaller.appspot.com/bug?extid=4bff2788f64e121fefcf
title: 'linux-next boot error: INFO: task hung in add_early_randomness (2)'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: f2906aa863381afb0015a9eb7fefad885d4e5a56
fix_commit: 228432551bd8783211e494ab35f42a4344580502
datetime: '2022-06-08T08:56:03-04:00'
fix_commit_message: 'virtio-rng: make device ready before making request


  Current virtio-rng does a entropy request before DRIVER_OK, this

  violates the spec:


  virtio spec requires that all drivers set DRIVER_OK

  before using devices.


  Further, kernel will ignore the interrupt after commit

  8b4ec69d7e09 ("virtio: harden vring IRQ").


  Fixing this by making device ready before the request.


  Cc: stable@vger.kernel.org

  Fixes: 8b4ec69d7e09 ("virtio: harden vring IRQ")

  Fixes: f7f510ec1957 ("virtio: An entropy device, as suggested by hpa.")

  Reported-and-tested-by: syzbot+5b59d6d459306a556f54@syzkaller.appspotmail.com

  Signed-off-by: Jason Wang <jasowang@redhat.com>

  Message-Id: <20220608061422.38437-1-jasowang@redhat.com>

  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>

  Reviewed-by: Laurent Vivier <lvivier@redhat.com>

  '
submodule:
- drivers/char/hw_random
hunk_count: 1
covered_count: 1
