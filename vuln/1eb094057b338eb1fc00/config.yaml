id: 1eb094057b338eb1fc00
bug_link: https://syzkaller.appspot.com/bug?extid=1eb094057b338eb1fc00
title: general protection fault in ___bpf_prog_run
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 62a06994ced17f295fc51ea0815580ee7ccb668d
fix_commit: 65073a67331de3d2cce35607807ddec284e75e81
datetime: '2018-02-01T07:43:56-08:00'
fix_commit_message: "bpf: fix null pointer deref in bpf_prog_test_run_xdp\n\nsyzkaller\
  \ was able to generate the following XDP program ...\n\n  (18) r0 = 0x0\n  (61)\
  \ r5 = *(u32 *)(r1 +12)\n  (04) (u32) r0 += (u32) 0\n  (95) exit\n\n... and trigger\
  \ a NULL pointer dereference in ___bpf_prog_run()\nvia bpf_prog_test_run_xdp() where\
  \ this was attempted to run.\n\nReason is that recent xdp_rxq_info addition to XDP\
  \ programs\nupdated all drivers, but not bpf_prog_test_run_xdp(), where\nxdp_buff\
  \ is set up. Thus when context rewriter does the deref\non the netdev it's NULL\
  \ at runtime. Fix it by using xdp_rxq\nfrom loopback dev. __netif_get_rx_queue()\
  \ helper can also be\nreused in various other locations later on.\n\nFixes: 02dd3291b2f0\
  \ (\"bpf: finally expose xdp_rxq_info to XDP bpf-programs\")\nReported-by: syzbot+1eb094057b338eb1fc00@syzkaller.appspotmail.com\n\
  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>\nCc: Jesper Dangaard Brouer\
  \ <brouer@redhat.com>\nAcked-by: Jesper Dangaard Brouer <brouer@redhat.com>\nSigned-off-by:\
  \ Alexei Starovoitov <ast@kernel.org>\n"
submodule:
- include/linux
- net/bpf
- tools/testing/selftests/bpf
hunk_count: 4
covered_count: 2
