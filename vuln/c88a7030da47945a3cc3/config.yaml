id: c88a7030da47945a3cc3
bug_link: https://syzkaller.appspot.com/bug?extid=c88a7030da47945a3cc3
title: WARNING in mntput_no_expire (2)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 7f6c411c9b50cfab41cc798e003eff27608c7016
fix_commit: 7d01ef7585c07afaf487759a48486228cd065726
datetime: '2021-04-06T12:33:07-04:00'
fix_commit_message: "Make sure nd->path.mnt and nd->path.dentry are always valid pointers\n\
  \nInitialize them in set_nameidata() and make sure that terminate_walk() clears\
  \ them\nonce the pointers become potentially invalid (i.e. we leave RCU mode or\
  \ drop them\nin non-RCU one).  Currently we have \"path_init() always initializes\
  \ them and nobody\naccesses them outside of path_init()/terminate_walk() segments\"\
  , which is asking\nfor trouble.\n\nWith that change we would have nd->path.{mnt,dentry}\n\
  \t1) always valid - NULL or pointing to currently allocated objects.\n\t2) non-NULL\
  \ while we are successfully walking\n\t3) NULL when we are not walking at all\n\t\
  4) contributing to refcounts whenever non-NULL outside of RCU mode.\n\nFixes: 6c6ec2b0a3e0\
  \ (\"fs: add support for LOOKUP_CACHED\")\nReported-by: syzbot+c88a7030da47945a3cc3@syzkaller.appspotmail.com\n\
  Tested-by: Christian Brauner <christian.brauner@ubuntu.com>\nSigned-off-by: Al Viro\
  \ <viro@zeniv.linux.org.uk>\n"
submodule:
- fs
hunk_count: 3
covered_count: 0
