id: 6339eda9cb4ebbc4c37b
bug_link: https://syzkaller.appspot.com/bug?extid=6339eda9cb4ebbc4c37b
title: 'INFO: task hung in fuse_sb_destroy'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 651022382c7f8da46cb4872a545ee1da6d097d2a
fix_commit: 7fabaf303458fcabb694999d6fa772cc13d4e217
datetime: '2018-11-09T15:52:16+01:00'
fix_commit_message: 'fuse: fix leaked notify reply


  fuse_request_send_notify_reply() may fail if the connection was reset for

  some reason (e.g. fs was unmounted).  Don''t leak request reference in this

  case.  Besides leaking memory, this resulted in fc->num_waiting not being

  decremented and hence fuse_wait_aborted() left in a hanging and unkillable

  state.


  Fixes: 2d45ba381a74 ("fuse: add retrieve request")

  Fixes: b8f95e5d13f5 ("fuse: umount should wait for all requests")

  Reported-and-tested-by: syzbot+6339eda9cb4ebbc4c37b@syzkaller.appspotmail.com

  Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

  Cc: <stable@vger.kernel.org> #v2.6.36

  '
submodule:
- fs/fuse
hunk_count: 1
covered_count: 0
