id: a4c6e5ef999b68b26ed1
bug_link: https://syzkaller.appspot.com/bug?extid=a4c6e5ef999b68b26ed1
title: 'UBSAN: array-index-out-of-bounds in io_setup_async_msg'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0bb80ecc33a8fb5a682236443c1e740d5c917d1d
fix_commit: c21a8027ad8a68c340d0d58bf1cc61dcb0bc4d2f
datetime: '2023-09-14T10:12:55-06:00'
fix_commit_message: 'io_uring/net: fix iter retargeting for selected buf


  When using selected buffer feature, io_uring delays data iter setup

  until later. If io_setup_async_msg() is called before that it might see

  not correctly setup iterator. Pre-init nr_segs and judge from its state

  whether we repointing.


  Cc: stable@vger.kernel.org

  Reported-by: syzbot+a4c6e5ef999b68b26ed1@syzkaller.appspotmail.com

  Fixes: 0455d4ccec548 ("io_uring: add POLL_FIRST support for send/sendmsg and recv/recvmsg")

  Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>

  Link: https://lore.kernel.org/r/0000000000002770be06053c7757@google.com

  Signed-off-by: Jens Axboe <axboe@kernel.dk>

  '
submodule:
- io_uring
hunk_count: 2
covered_count: 1
