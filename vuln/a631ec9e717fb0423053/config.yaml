id: a631ec9e717fb0423053
bug_link: https://syzkaller.appspot.com/bug?extid=a631ec9e717fb0423053
title: 'KMSAN: uninit-value in asix_mdio_read'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 01634047bf0d5c2d9b7d8095bb4de1663dbeedeb
fix_commit: a786e3195d6af183033e86f0518ffd2c51c0e8ac
datetime: '2021-08-18T11:46:52+01:00'
fix_commit_message: 'net: asix: fix uninit value bugs


  Syzbot reported uninit-value in asix_mdio_read(). The problem was in

  missing error handling. asix_read_cmd() should initialize passed stack

  variable smsr, but it can fail in some cases. Then while condidition

  checks possibly uninit smsr variable.


  Since smsr is uninitialized stack variable, driver can misbehave,

  because smsr will be random in case of asix_read_cmd() failure.

  Fix it by adding error handling and just continue the loop instead of

  checking uninit value.


  Added helper function for checking Host_En bit, since wrong loop was used

  in 4 functions and there is no need in copy-pasting code parts.


  Cc: Robert Foss <robert.foss@collabora.com>

  Fixes: d9fe64e51114 ("net: asix: Add in_pm parameter")

  Reported-by: syzbot+a631ec9e717fb0423053@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Signed-off-by: David S. Miller <davem@davemloft.net>

  '
submodule:
- drivers/net/usb
hunk_count: 5
covered_count: 3
