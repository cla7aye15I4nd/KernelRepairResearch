id: ebbab3e04c88fa141e6b
bug_link: https://syzkaller.appspot.com/bug?extid=ebbab3e04c88fa141e6b
title: 'WARNING: ODEBUG bug in ip_set_free'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: ab0beafd52b98dfb8b8244b2c6794efbc87478db
fix_commit: 27c5a095e2518975e20a10102908ae8231699879
datetime: '2024-02-08T12:09:23+01:00'
fix_commit_message: 'netfilter: ipset: Missing gc cancellations fixed


  The patch fdb8e12cc2cc ("netfilter: ipset: fix performance regression

  in swap operation") missed to add the calls to gc cancellations

  at the error path of create operations and at module unload. Also,

  because the half of the destroy operations now executed by a

  function registered by call_rcu(), neither NFNL_SUBSYS_IPSET mutex

  or rcu read lock is held and therefore the checking of them results

  false warnings.


  Fixes: 97f7cf1cd80e ("netfilter: ipset: fix performance regression in swap operation")

  Reported-by: syzbot+52bbc0ad036f6f0d4a25@syzkaller.appspotmail.com

  Reported-by: Brad Spengler <spender@grsecurity.net>

  Reported-by: Стас Ничипорович <stasn77@gmail.com>

  Tested-by: Brad Spengler <spender@grsecurity.net>

  Tested-by: Стас Ничипорович <stasn77@gmail.com>

  Signed-off-by: Jozsef Kadlecsik <kadlec@netfilter.org>

  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

  '
submodule:
- net/netfilter
hunk_count: 4
covered_count: 1
