id: 5134cdf021c4ed5aaa5f
bug_link: https://syzkaller.appspot.com/bug?extid=5134cdf021c4ed5aaa5f
title: memory leak in rds_send_probe
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: df693f13a18f6eee0355741988f30c7c1e40ed9f
fix_commit: 49bfcbfd989a8f1f23e705759a6bb099de2cff9f
datetime: '2021-06-08T16:32:17-07:00'
fix_commit_message: "net: rds: fix memory leak in rds_recvmsg\n\nSyzbot reported memory\
  \ leak in rds. The problem\nwas in unputted refcount in case of error.\n\nint rds_recvmsg(struct\
  \ socket *sock, struct msghdr *msg, size_t size,\n\t\tint msg_flags)\n{\n...\n\n\
  \tif (!rds_next_incoming(rs, &inc)) {\n\t\t...\n\t}\n\nAfter this \"if\" inc refcount\
  \ incremented and\n\n\tif (rds_cmsg_recv(inc, msg, rs)) {\n\t\tret = -EFAULT;\n\t\
  \tgoto out;\n\t}\n...\nout:\n\treturn ret;\n}\n\nin case of rds_cmsg_recv() fail\
  \ the refcount won't be\ndecremented. And it's easy to see from ftrace log, that\n\
  rds_inc_addref() don't have rds_inc_put() pair in\nrds_recvmsg() after rds_cmsg_recv()\n\
  \n 1)               |  rds_recvmsg() {\n 1)   3.721 us    |    rds_inc_addref();\n\
  \ 1)   3.853 us    |    rds_message_inc_copy_to_user();\n 1) + 10.395 us   |   \
  \ rds_cmsg_recv();\n 1) + 34.260 us   |  }\n\nFixes: bdbe6fbc6a2f (\"RDS: recv.c\"\
  )\nReported-and-tested-by: syzbot+5134cdf021c4ed5aaa5f@syzkaller.appspotmail.com\n\
  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>\nReviewed-by: HÃ¥kon Bugge <haakon.bugge@oracle.com>\n\
  Acked-by: Santosh Shilimkar <santosh.shilimkar@oracle.com>\nSigned-off-by: David\
  \ S. Miller <davem@davemloft.net>\n"
submodule:
- net/rds
hunk_count: 1
covered_count: 0
