id: 485cc00ea7cf41dfdbf1
bug_link: https://syzkaller.appspot.com/bug?extid=485cc00ea7cf41dfdbf1
title: 'BUG: sleeping function called from invalid context in hci_cmd_sync_cancel'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: df1e5c51492fd93ffc293acdcc6f00698d19fedc
fix_commit: 744451c162a514044a912cbbd64b7a386035cc5b
datetime: '2021-12-22T23:01:27+01:00'
fix_commit_message: 'Bluetooth: hci_sync: Push sync command cancellation to workqueue


  syzbot reported that hci_cmd_sync_cancel may sleep from the wrong

  context. To avoid this, create a new work item that pushes the relevant

  parts into a different context.


  Note that we keep the old implementation with the name

  __hci_cmd_sync_cancel as the sleeping behaviour is desired in some

  cases.


  Reported-and-tested-by: syzbot+485cc00ea7cf41dfdbf1@syzkaller.appspotmail.com

  Fixes: c97a747efc93 ("Bluetooth: btusb: Cancel sync commands for certain URB errors")

  Signed-off-by: Benjamin Berg <bberg@redhat.com>

  Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

  '
submodule:
- include/net/bluetooth
- net/bluetooth
hunk_count: 7
covered_count: 3
