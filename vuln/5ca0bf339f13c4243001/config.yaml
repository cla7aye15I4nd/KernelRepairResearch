id: 5ca0bf339f13c4243001
bug_link: https://syzkaller.appspot.com/bug?extid=5ca0bf339f13c4243001
title: 'INFO: trying to register non-static key in mxl111sf_ctrl_msg'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: dccdd92b7b08ddbb7a8dbc1d6daba1f4fbd6bba2
fix_commit: 44870a9e7a3c24acbb3f888b2a7cc22c9bdf7e7f
datetime: '2021-09-30T10:08:01+02:00'
fix_commit_message: "media: mxl111sf: change mutex_init() location\n\nSyzbot reported,\
  \ that mxl111sf_ctrl_msg() uses uninitialized\nmutex. The problem was in wrong mutex_init()\
  \ location.\n\nPrevious mutex_init(&state->msg_lock) call was in ->init() function,\
  \ but\ndvb_usbv2_init() has this order of calls:\n\n\tdvb_usbv2_init()\n\t  dvb_usbv2_adapter_init()\n\
  \t    dvb_usbv2_adapter_frontend_init()\n\t      props->frontend_attach()\n\n\t\
  \  props->init()\n\nSince mxl111sf_* devices call mxl111sf_ctrl_msg() in ->frontend_attach()\n\
  internally we need to initialize state->msg_lock before\nfrontend_attach(). To achieve\
  \ it, ->probe() call added to all mxl111sf_*\ndevices, which will simply initiaize\
  \ mutex.\n\nReported-and-tested-by: syzbot+5ca0bf339f13c4243001@syzkaller.appspotmail.com\n\
  \nFixes: 8572211842af (\"[media] mxl111sf: convert to new DVB USB\")\nSigned-off-by:\
  \ Pavel Skripkin <paskripkin@gmail.com>\nSigned-off-by: Sean Young <sean@mess.org>\n\
  Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>\n"
submodule:
- drivers/media/usb/dvb-usb-v2
hunk_count: 8
covered_count: 1
