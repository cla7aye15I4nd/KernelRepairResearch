id: 5b96d55e5b54924c77ad
bug_link: https://syzkaller.appspot.com/bug?extid=5b96d55e5b54924c77ad
title: 'KASAN: use-after-free Read in do_sync_mmap_readahead'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 6bf74cddcffac0bc5ee0fad724aac778d2e53f75
fix_commit: dcfa24ba68991ab69a48254a18377b45180ae664
datetime: '2022-06-09T16:24:25-04:00'
fix_commit_message: 'filemap: Cache the value of vm_flags


  After we have unlocked the mmap_lock for I/O, the file is pinned, but

  the VMA is not.  Checking this flag after that can be a use-after-free.

  It''s not a terribly interesting use-after-free as it can only read one

  bit, and it''s used to decide whether to read 2MB or 4MB.  But it

  upsets the automated tools and it''s generally bad practice anyway,

  so let''s fix it.


  Reported-by: syzbot+5b96d55e5b54924c77ad@syzkaller.appspotmail.com

  Fixes: 4687fdbb805a ("mm/filemap: Support VM_HUGEPAGE for file mappings")

  Cc: stable@vger.kernel.org

  Signed-off-by: Matthew Wilcox (Oracle) <willy@infradead.org>

  '
submodule:
- mm
hunk_count: 3
covered_count: 3
