id: aab53008a5adf26abe91
bug_link: https://syzkaller.appspot.com/bug?extid=aab53008a5adf26abe91
title: 'KASAN: use-after-free Read in rxe_queue_cleanup'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 136057256686de39cc3a07c2e39ef6bc43003ff6
fix_commit: 84b01721e8042cdd1e8ffeb648844a09cd4213e0
datetime: '2021-11-25T13:15:59-04:00'
fix_commit_message: 'RDMA: Fix use-after-free in rxe_queue_cleanup


  On error handling path in rxe_qp_from_init() qp->sq.queue is freed and

  then rxe_create_qp() will drop last reference to this object. qp clean up

  function will try to free this queue one time and it causes UAF bug.


  Fix it by zeroing queue pointer after freeing queue in rxe_qp_from_init().


  Fixes: 514aee660df4 ("RDMA: Globally allocate and release QP memory")

  Link: https://lore.kernel.org/r/20211121202239.3129-1-paskripkin@gmail.com

  Reported-by: syzbot+aab53008a5adf26abe91@syzkaller.appspotmail.com

  Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>

  Reviewed-by: Zhu Yanjun <zyjzyj2000@gmail.com>

  Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>

  '
submodule:
- drivers/infiniband/sw/rxe
hunk_count: 1
covered_count: 1
