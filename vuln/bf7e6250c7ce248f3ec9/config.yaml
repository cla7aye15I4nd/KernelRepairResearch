id: bf7e6250c7ce248f3ec9
bug_link: https://syzkaller.appspot.com/bug?extid=bf7e6250c7ce248f3ec9
title: 'KMSAN: uninit-value in IP6_ECN_decapsulate'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 0b9c3914ad92e6ac69368a87c82796c4611b7758
fix_commit: 484b4833c604c0adcf19eac1ca14b60b757355b5
datetime: '2023-09-11T08:28:36+01:00'
fix_commit_message: "hsr: Fix uninit-value access in fill_frame_info()\n\nSyzbot reports\
  \ the following uninit-value access problem.\n\n=====================================================\n\
  BUG: KMSAN: uninit-value in fill_frame_info net/hsr/hsr_forward.c:601 [inline]\n\
  BUG: KMSAN: uninit-value in hsr_forward_skb+0x9bd/0x30f0 net/hsr/hsr_forward.c:616\n\
  \ fill_frame_info net/hsr/hsr_forward.c:601 [inline]\n hsr_forward_skb+0x9bd/0x30f0\
  \ net/hsr/hsr_forward.c:616\n hsr_dev_xmit+0x192/0x330 net/hsr/hsr_device.c:223\n\
  \ __netdev_start_xmit include/linux/netdevice.h:4889 [inline]\n netdev_start_xmit\
  \ include/linux/netdevice.h:4903 [inline]\n xmit_one net/core/dev.c:3544 [inline]\n\
  \ dev_hard_start_xmit+0x247/0xa10 net/core/dev.c:3560\n __dev_queue_xmit+0x34d0/0x52a0\
  \ net/core/dev.c:4340\n dev_queue_xmit include/linux/netdevice.h:3082 [inline]\n\
  \ packet_xmit+0x9c/0x6b0 net/packet/af_packet.c:276\n packet_snd net/packet/af_packet.c:3087\
  \ [inline]\n packet_sendmsg+0x8b1d/0x9f30 net/packet/af_packet.c:3119\n sock_sendmsg_nosec\
  \ net/socket.c:730 [inline]\n sock_sendmsg net/socket.c:753 [inline]\n __sys_sendto+0x781/0xa30\
  \ net/socket.c:2176\n __do_sys_sendto net/socket.c:2188 [inline]\n __se_sys_sendto\
  \ net/socket.c:2184 [inline]\n __ia32_sys_sendto+0x11f/0x1c0 net/socket.c:2184\n\
  \ do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]\n __do_fast_syscall_32+0xa2/0x100\
  \ arch/x86/entry/common.c:178\n do_fast_syscall_32+0x37/0x80 arch/x86/entry/common.c:203\n\
  \ do_SYSENTER_32+0x1f/0x30 arch/x86/entry/common.c:246\n entry_SYSENTER_compat_after_hwframe+0x70/0x82\n\
  \nUninit was created at:\n slab_post_alloc_hook+0x12f/0xb70 mm/slab.h:767\n slab_alloc_node\
  \ mm/slub.c:3478 [inline]\n kmem_cache_alloc_node+0x577/0xa80 mm/slub.c:3523\n kmalloc_reserve+0x148/0x470\
  \ net/core/skbuff.c:559\n __alloc_skb+0x318/0x740 net/core/skbuff.c:644\n alloc_skb\
  \ include/linux/skbuff.h:1286 [inline]\n alloc_skb_with_frags+0xc8/0xbd0 net/core/skbuff.c:6299\n\
  \ sock_alloc_send_pskb+0xa80/0xbf0 net/core/sock.c:2794\n packet_alloc_skb net/packet/af_packet.c:2936\
  \ [inline]\n packet_snd net/packet/af_packet.c:3030 [inline]\n packet_sendmsg+0x70e8/0x9f30\
  \ net/packet/af_packet.c:3119\n sock_sendmsg_nosec net/socket.c:730 [inline]\n sock_sendmsg\
  \ net/socket.c:753 [inline]\n __sys_sendto+0x781/0xa30 net/socket.c:2176\n __do_sys_sendto\
  \ net/socket.c:2188 [inline]\n __se_sys_sendto net/socket.c:2184 [inline]\n __ia32_sys_sendto+0x11f/0x1c0\
  \ net/socket.c:2184\n do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]\n\
  \ __do_fast_syscall_32+0xa2/0x100 arch/x86/entry/common.c:178\n do_fast_syscall_32+0x37/0x80\
  \ arch/x86/entry/common.c:203\n do_SYSENTER_32+0x1f/0x30 arch/x86/entry/common.c:246\n\
  \ entry_SYSENTER_compat_after_hwframe+0x70/0x82\n\nIt is because VLAN not yet supported\
  \ in hsr driver. Return error\nwhen protocol is ETH_P_8021Q in fill_frame_info()\
  \ now to fix it.\n\nFixes: 451d8123f897 (\"net: prp: add packet handling support\"\
  )\nReported-by: syzbot+bf7e6250c7ce248f3ec9@syzkaller.appspotmail.com\nCloses: https://syzkaller.appspot.com/bug?extid=bf7e6250c7ce248f3ec9\n\
  Signed-off-by: Ziyang Xuan <william.xuanziyang@huawei.com>\nSigned-off-by: David\
  \ S. Miller <davem@davemloft.net>\n"
submodule:
- net/hsr
hunk_count: 1
covered_count: 1
