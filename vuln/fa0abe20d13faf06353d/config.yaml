id: fa0abe20d13faf06353d
bug_link: https://syzkaller.appspot.com/bug?extid=fa0abe20d13faf06353d
title: 'INFO: task hung in hwrng_register'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: bf3175bc50a3754dc427e2f5046e17a9fafc8be7
fix_commit: 2bb31abdbe55742c89f4dc0cc26fcbc8467364f6
datetime: '2021-11-01T05:26:47-04:00'
fix_commit_message: 'hwrng: virtio - don''t wait on cleanup


  When virtio-rng device was dropped by the hwrng core we were forced

  to wait the buffer to come back from the device to not have

  remaining ongoing operation that could spoil the buffer.


  But now, as the buffer is internal to the virtio-rng we can release

  the waiting loop immediately, the buffer will be retrieve and use

  when the virtio-rng driver will be selected again.


  This avoids to hang on an rng_current write command if the virtio-rng

  device is blocked by a lack of entropy. This allows to select

  another entropy source if the current one is empty.


  Signed-off-by: Laurent Vivier <lvivier@redhat.com>

  Link: https://lore.kernel.org/r/20211028101111.128049-3-lvivier@redhat.com

  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>

  '
submodule:
- drivers/char/hw_random
hunk_count: 2
covered_count: 2
