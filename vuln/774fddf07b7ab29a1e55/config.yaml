id: 774fddf07b7ab29a1e55
bug_link: https://syzkaller.appspot.com/bug?extid=774fddf07b7ab29a1e55
title: WARNING in tracepoint_probe_register_prio (3)
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 5c3469cb899abe998299aafb8f16f325d62d2d68
fix_commit: 64ae572bc7d0060429e40e1c8d803ce5eb31a0d6
datetime: '2020-01-30T09:46:10-05:00'
fix_commit_message: 'tracing: Fix sched switch start/stop refcount racy updates


  Reading the sched_cmdline_ref and sched_tgid_ref initial state within

  tracing_start_sched_switch without holding the sched_register_mutex is

  racy against concurrent updates, which can lead to tracepoint probes

  being registered more than once (and thus trigger warnings within

  tracepoint.c).


  [ May be the fix for this bug ]

  Link: https://lore.kernel.org/r/000000000000ab6f84056c786b93@google.com


  Link: http://lkml.kernel.org/r/20190817141208.15226-1-mathieu.desnoyers@efficios.com


  Cc: stable@vger.kernel.org

  CC: Steven Rostedt (VMware) <rostedt@goodmis.org>

  CC: Joel Fernandes (Google) <joel@joelfernandes.org>

  CC: Peter Zijlstra <peterz@infradead.org>

  CC: Thomas Gleixner <tglx@linutronix.de>

  CC: Paul E. McKenney <paulmck@linux.ibm.com>

  Reported-by: syzbot+774fddf07b7ab29a1e55@syzkaller.appspotmail.com

  Fixes: d914ba37d7145 ("tracing: Add support for recording tgid of tasks")

  Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>

  Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>

  '
submodule:
- kernel/trace
hunk_count: 1
covered_count: 1
