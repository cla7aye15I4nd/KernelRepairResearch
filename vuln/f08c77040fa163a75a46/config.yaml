id: f08c77040fa163a75a46
bug_link: https://syzkaller.appspot.com/bug?extid=f08c77040fa163a75a46
title: memory leak in blk_mq_init_tags
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: 61144d83376a136d8aa7a9e057d916c505bfb75f
fix_commit: 03252259e18e63eb56a0d29c2fefcc30b58b812b
datetime: '2022-04-06T22:37:49-04:00'
fix_commit_message: 'scsi: sd: Clean up gendisk if device_add_disk() failed


  We forgot to call blk_cleanup_disk() when device_add_disk() failed.  This

  would cause a memory leak of gendisk and sched_tags allocated in

  elevator_init_mq()


  Reference:https://syzkaller.appspot.com/x/log.txt?x=13b41dcb700000

  Reported-and-tested-by: syzbot+f08c77040fa163a75a46@syzkaller.appspotmail.com

  Link: https://lore.kernel.org/r/20220401011018.1026553-1-haowenchao@huawei.com

  Signed-off-by: Wenchao Hao <haowenchao@huawei.com>

  Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

  '
submodule:
- drivers/scsi
hunk_count: 1
covered_count: 1
