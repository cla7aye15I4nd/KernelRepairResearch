id: 16e3f2c77e7c5a0113f9
bug_link: https://syzkaller.appspot.com/bug?extid=16e3f2c77e7c5a0113f9
title: 'linux-next boot error: WARNING: suspicious RCU usage in cpuacct_charge'
source_page: https://syzkaller.appspot.com/upstream/fixed
trigger_commit: a0a7e453b502cbbf7ff372f907a4e27a2ebf5445
fix_commit: f2aa197e4794bf4c2c0c9570684f86e6fa103e8b
datetime: '2022-03-12T13:22:11+01:00'
fix_commit_message: 'cgroup: Fix suspicious rcu_dereference_check() usage warning


  task_css_set_check() will use rcu_dereference_check() to check for

  rcu_read_lock_held() on the read-side, which is not true after commit

  dc6e0818bc9a ("sched/cpuacct: Optimize away RCU read lock"). This

  commit drop explicit rcu_read_lock(), change to RCU-sched read-side

  critical section. So fix the RCU warning by adding check for

  rcu_read_lock_sched_held().


  Fixes: dc6e0818bc9a ("sched/cpuacct: Optimize away RCU read lock")

  Reported-by: Linux Kernel Functional Testing <lkft@linaro.org>

  Reported-by: syzbot+16e3f2c77e7c5a0113f9@syzkaller.appspotmail.com

  Signed-off-by: Chengming Zhou <zhouchengming@bytedance.com>

  Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>

  Acked-by: Tejun Heo <tj@kernel.org>

  Tested-by: Zhouyi Zhou <zhouzhouyi@gmail.com>

  Tested-by: Marek Szyprowski <m.szyprowski@samsung.com>

  Link: https://lore.kernel.org/r/20220305034103.57123-1-zhouchengming@bytedance.com

  '
submodule:
- include/linux
hunk_count: 1
covered_count: 1
